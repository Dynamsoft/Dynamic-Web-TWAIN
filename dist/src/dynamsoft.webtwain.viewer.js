/* ! 20250423171530
* Dynamsoft JavaScript Library
* Product: Dynamic Web TWAIN
* Web Site: https://www.dynamsoft.com
*
* Copyright 2025, Dynamsoft Corporation
* Author: Dynamsoft Support Team
* Version: 19.1
*/function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o;}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o;},_typeof(o);}!function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;}var i={},r={get exports(){return i;},set exports(e){i=e;}},n=function n(e){return e&&e.Math===Math&&e;},o=n("object"==(typeof globalThis==="undefined"?"undefined":_typeof(globalThis))&&globalThis)||n("object"==(typeof window==="undefined"?"undefined":_typeof(window))&&window)||n("object"==(typeof self==="undefined"?"undefined":_typeof(self))&&self)||n("object"==_typeof(e)&&e)||n("object"==_typeof(e)&&e)||function(){return this;}()||Function("return this")(),a=function a(e){try{return!!e();}catch(e){return!0;}},s=!a(function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype");}),u=s,l=Function.prototype,c=l.apply,h=l.call,d="object"==(typeof Reflect==="undefined"?"undefined":_typeof(Reflect))&&Reflect.apply||(u?h.bind(c):function(){return h.apply(c,arguments);}),f=s,v=Function.prototype,g=v.call,m=f&&v.bind.bind(g,g),y=f?m:function(e){return function(){return g.apply(e,arguments);};},p=y,w=p({}.toString),b=p("".slice),k=function k(e){return b(w(e),8,-1);},S=k,x=y,C=function C(e){if("Function"===S(e))return x(e);},V="object"==(typeof document==="undefined"?"undefined":_typeof(document))&&document.all,T=void 0===V&&void 0!==V?function(e){return"function"==typeof e||e===V;}:function(e){return"function"==typeof e;},I={},E=!a(function(){return 7!==Object.defineProperty({},1,{get:function get(){return 7;}})[1];}),P=s,B=Function.prototype.call,D=P?B.bind(B):function(){return B.apply(B,arguments);},M={},z={}.propertyIsEnumerable,U=Object.getOwnPropertyDescriptor,A=U&&!z.call({1:2},1);M.f=A?function(e){var t=U(this,e);return!!t&&t.enumerable;}:z;var R,L,N=function N(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t};},O=a,W=k,H=Object,F=y("".split),j=O(function(){return!H("z").propertyIsEnumerable(0);})?function(e){return"String"===W(e)?F(e,""):H(e);}:H,Y=function Y(e){return null==e;},X=Y,q=TypeError,Z=function Z(e){if(X(e))throw new q("Can't call method on "+e);return e;},_=j,G=Z,K=function K(e){return _(G(e));},$=T,J=function J(e){return"object"==_typeof(e)?null!==e:$(e);},Q={},ee=Q,te=o,ie=T,re=function re(e){return ie(e)?e:void 0;},ne=function ne(e,t){return arguments.length<2?re(ee[e])||re(te[e]):ee[e]&&ee[e][t]||te[e]&&te[e][t];},oe=y({}.isPrototypeOf),ae=o.navigator,se=ae&&ae.userAgent,ue=se?String(se):"",le=o,ce=ue,he=le.process,de=le.Deno,fe=he&&he.versions||de&&de.version,ve=fe&&fe.v8;ve&&(L=(R=ve.split("."))[0]>0&&R[0]<4?1:+(R[0]+R[1])),!L&&ce&&(!(R=ce.match(/Edge\/(\d+)/))||R[1]>=74)&&(R=ce.match(/Chrome\/(\d+)/))&&(L=+R[1]);var ge=L,me=ge,ye=a,pe=o.String,we=!!Object.getOwnPropertySymbols&&!ye(function(){var e=Symbol("symbol detection");return!pe(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&me&&me<41;}),be=we&&!Symbol.sham&&"symbol"==_typeof(Symbol.iterator),ke=ne,Se=T,xe=oe,Ce=Object,Ve=be?function(e){return"symbol"==_typeof(e);}:function(e){var t=ke("Symbol");return Se(t)&&xe(t.prototype,Ce(e));},Te=String,Ie=function Ie(e){try{return Te(e);}catch(e){return"Object";}},Ee=T,Pe=Ie,Be=TypeError,De=function De(e){if(Ee(e))return e;throw new Be(Pe(e)+" is not a function");},Me=De,ze=Y,Ue=function Ue(e,t){var i=e[t];return ze(i)?void 0:Me(i);},Ae=D,Re=T,Le=J,Ne=TypeError,Oe={},We={get exports(){return Oe;},set exports(e){Oe=e;}},He=!0,Fe=o,je=Object.defineProperty,Ye=o,Xe=function Xe(e,t){try{je(Fe,e,{value:t,configurable:!0,writable:!0});}catch(i){Fe[e]=t;}return t;},qe="__core-js_shared__",Ze=We.exports=Ye[qe]||Xe(qe,{});(Ze.versions||(Ze.versions=[])).push({version:"3.41.0",mode:"pure",copyright:"Â© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.41.0/LICENSE",source:"https://github.com/zloirock/core-js"});var _e=Oe,Ge=function Ge(e,t){return _e[e]||(_e[e]=t||{});},Ke=Z,$e=Object,Je=function Je(e){return $e(Ke(e));},Qe=Je,et=y({}.hasOwnProperty),tt=Object.hasOwn||function(e,t){return et(Qe(e),t);},it=y,rt=0,nt=Math.random(),ot=it(1..toString),at=function at(e){return"Symbol("+(void 0===e?"":e)+")_"+ot(++rt+nt,36);},st=Ge,ut=tt,lt=at,ct=we,ht=be,dt=o.Symbol,ft=st("wks"),vt=ht?dt.for||dt:dt&&dt.withoutSetter||lt,gt=function gt(e){return ut(ft,e)||(ft[e]=ct&&ut(dt,e)?dt[e]:vt("Symbol."+e)),ft[e];},mt=D,yt=J,pt=Ve,wt=Ue,bt=function bt(e,t){var i,r;if("string"===t&&Re(i=e.toString)&&!Le(r=Ae(i,e)))return r;if(Re(i=e.valueOf)&&!Le(r=Ae(i,e)))return r;if("string"!==t&&Re(i=e.toString)&&!Le(r=Ae(i,e)))return r;throw new Ne("Can't convert object to primitive value");},kt=TypeError,St=gt("toPrimitive"),xt=function xt(e,t){if(!yt(e)||pt(e))return e;var i,r=wt(e,St);if(r){if(void 0===t&&(t="default"),i=mt(r,e,t),!yt(i)||pt(i))return i;throw new kt("Can't convert object to primitive value");}return void 0===t&&(t="number"),bt(e,t);},Ct=xt,Vt=Ve,Tt=function Tt(e){var t=Ct(e,"string");return Vt(t)?t:t+"";},It=J,Et=o.document,Pt=It(Et)&&It(Et.createElement),Bt=function Bt(e){return Pt?Et.createElement(e):{};},Dt=Bt,Mt=!E&&!a(function(){return 7!==Object.defineProperty(Dt("div"),"a",{get:function get(){return 7;}}).a;}),zt=E,Ut=D,At=M,Rt=N,Lt=K,Nt=Tt,Ot=tt,Wt=Mt,Ht=Object.getOwnPropertyDescriptor;I.f=zt?Ht:function(e,t){if(e=Lt(e),t=Nt(t),Wt)try{return Ht(e,t);}catch(e){}if(Ot(e,t))return Rt(!Ut(At.f,e,t),e[t]);};var Ft=a,jt=T,Yt=/#|\.prototype\./,Xt=function Xt(e,t){var i=Zt[qt(e)];return i===Gt||i!==_t&&(jt(t)?Ft(t):!!t);},qt=Xt.normalize=function(e){return String(e).replace(Yt,".").toLowerCase();},Zt=Xt.data={},_t=Xt.NATIVE="N",Gt=Xt.POLYFILL="P",Kt=Xt,$t=De,Jt=s,Qt=C(C.bind),ei=function ei(e,t){return $t(e),void 0===t?e:Jt?Qt(e,t):function(){return e.apply(t,arguments);};},ti={},ii=E&&a(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype;}),ri=J,ni=String,oi=TypeError,ai=function ai(e){if(ri(e))return e;throw new oi(ni(e)+" is not an object");},si=E,ui=Mt,li=ii,ci=ai,hi=Tt,di=TypeError,fi=Object.defineProperty,vi=Object.getOwnPropertyDescriptor,gi="enumerable",mi="configurable",yi="writable";ti.f=si?li?function(e,t,i){if(ci(e),t=hi(t),ci(i),"function"==typeof e&&"prototype"===t&&"value"in i&&yi in i&&!i[yi]){var r=vi(e,t);r&&r[yi]&&(e[t]=i.value,i={configurable:mi in i?i[mi]:r[mi],enumerable:gi in i?i[gi]:r[gi],writable:!1});}return fi(e,t,i);}:fi:function(e,t,i){if(ci(e),t=hi(t),ci(i),ui)try{return fi(e,t,i);}catch(e){}if("get"in i||"set"in i)throw new di("Accessors not supported");return"value"in i&&(e[t]=i.value),e;};var pi=ti,wi=N,bi=E?function(e,t,i){return pi.f(e,t,wi(1,i));}:function(e,t,i){return e[t]=i,e;},ki=o,Si=d,xi=C,Ci=T,Vi=I.f,Ti=Kt,Ii=Q,Ei=ei,Pi=bi,Bi=tt,Di=function Di(e){var _t2=function t(i,r,n){if(this instanceof _t2){switch(arguments.length){case 0:return new e();case 1:return new e(i);case 2:return new e(i,r);}return new e(i,r,n);}return Si(e,this,arguments);};return _t2.prototype=e.prototype,_t2;},Mi=function Mi(e,t){var i,r,n,o,a,s,u,l,c,h=e.target,d=e.global,f=e.stat,v=e.proto,g=d?ki:f?ki[h]:ki[h]&&ki[h].prototype,m=d?Ii:Ii[h]||Pi(Ii,h,{})[h],y=m.prototype;for(o in t)r=!(i=Ti(d?o:h+(f?".":"#")+o,e.forced))&&g&&Bi(g,o),s=m[o],r&&(u=e.dontCallGetSet?(c=Vi(g,o))&&c.value:g[o]),a=r&&u?u:t[o],(i||v||_typeof(s)!=_typeof(a))&&(l=e.bind&&r?Ei(a,ki):e.wrap&&r?Di(a):v&&Ci(a)?xi(a):a,(e.sham||a&&a.sham||s&&s.sham)&&Pi(l,"sham",!0),Pi(m,o,l),v&&(Bi(Ii,n=h+"Prototype")||Pi(Ii,n,{}),Pi(Ii[n],o,a),e.real&&y&&(i||!y[o])&&Pi(y,o,a)));},zi=y([].slice),Ui=y,Ai=De,Ri=J,Li=tt,Ni=zi,Oi=s,Wi=Function,Hi=Ui([].concat),Fi=Ui([].join),ji={},Yi=Oi?Wi.bind:function(e){var t=Ai(this),i=t.prototype,r=Ni(arguments,1),_n2=function n(){var i=Hi(r,Ni(arguments));return this instanceof _n2?function(e,t,i){if(!Li(ji,t)){for(var r=[],n=0;n<t;n++)r[n]="a["+n+"]";ji[t]=Wi("C,a","return new C("+Fi(r,",")+")");}return ji[t](e,i);}(t,i.length,i):t.apply(e,i);};return Ri(i)&&(_n2.prototype=i),_n2;},Xi={};Xi[gt("toStringTag")]="z";var qi="[object z]"===String(Xi),Zi=qi,_i=T,Gi=k,Ki=gt("toStringTag"),$i=Object,Ji="Arguments"===Gi(function(){return arguments;}()),Qi=Zi?Gi:function(e){var t,i,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t];}catch(e){}}(t=$i(e),Ki))?i:Ji?Gi(t):"Object"===(r=Gi(t))&&_i(t.callee)?"Arguments":r;},er=T,tr=Oe,ir=y(Function.toString);er(tr.inspectSource)||(tr.inspectSource=function(e){return ir(e);});var rr=tr.inspectSource,nr=y,or=a,ar=T,sr=Qi,ur=rr,lr=function lr(){},cr=ne("Reflect","construct"),hr=/^\s*(?:class|function)\b/,dr=nr(hr.exec),fr=!hr.test(lr),vr=function vr(e){if(!ar(e))return!1;try{return cr(lr,[],e),!0;}catch(e){return!1;}},gr=function gr(e){if(!ar(e))return!1;switch(sr(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1;}try{return fr||!!dr(hr,ur(e));}catch(e){return!0;}};gr.sham=!0;var mr=!cr||or(function(){var e;return vr(vr.call)||!vr(Object)||!vr(function(){e=!0;})||e;})?gr:vr,yr=mr,pr=Ie,wr=TypeError,br=function br(e){if(yr(e))return e;throw new wr(pr(e)+" is not a constructor");},kr={},Sr=Math.ceil,xr=Math.floor,Cr=Math.trunc||function(e){var t=+e;return(t>0?xr:Sr)(t);},Vr=Cr,Tr=function Tr(e){var t=+e;return t!=t||0===t?0:Vr(t);},Ir=Tr,Er=Math.max,Pr=Math.min,Br=function Br(e,t){var i=Ir(e);return i<0?Er(i+t,0):Pr(i,t);},Dr=Tr,Mr=Math.min,zr=function zr(e){var t=Dr(e);return t>0?Mr(t,9007199254740991):0;},Ur=zr,Ar=function Ar(e){return Ur(e.length);},Rr=K,Lr=Br,Nr=Ar,Or=function Or(e){return function(t,i,r){var n=Rr(t),o=Nr(n);if(0===o)return!e&&-1;var a,s=Lr(r,o);if(e&&i!=i){for(;o>s;)if((a=n[s++])!=a)return!0;}else for(;o>s;s++)if((e||s in n)&&n[s]===i)return e||s||0;return!e&&-1;};},Wr={includes:Or(!0),indexOf:Or(!1)},Hr={},Fr=tt,jr=K,Yr=Wr.indexOf,Xr=Hr,qr=y([].push),Zr=function Zr(e,t){var i,r=jr(e),n=0,o=[];for(i in r)!Fr(Xr,i)&&Fr(r,i)&&qr(o,i);for(;t.length>n;)Fr(r,i=t[n++])&&(~Yr(o,i)||qr(o,i));return o;},_r=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Gr=Zr,Kr=_r,$r=Object.keys||function(e){return Gr(e,Kr);},Jr=E,Qr=ii,en=ti,tn=ai,rn=K,nn=$r;kr.f=Jr&&!Qr?Object.defineProperties:function(e,t){tn(e);for(var i,r=rn(t),n=nn(t),o=n.length,a=0;o>a;)en.f(e,i=n[a++],r[i]);return e;};var on,an=ne("document","documentElement"),sn=at,un=Ge("keys"),ln=function ln(e){return un[e]||(un[e]=sn(e));},cn=ai,hn=kr,dn=_r,fn=Hr,vn=an,gn=Bt,mn="prototype",yn="script",pn=ln("IE_PROTO"),wn=function wn(){},bn=function bn(e){return"<"+yn+">"+e+"</"+yn+">";},kn=function kn(e){e.write(bn("")),e.close();var t=e.parentWindow.Object;return e=null,t;},_Sn=function Sn(){try{on=new ActiveXObject("htmlfile");}catch(e){}var e,t,i;_Sn="undefined"!=typeof document?document.domain&&on?kn(on):(t=gn("iframe"),i="java"+yn+":",t.style.display="none",vn.appendChild(t),t.src=String(i),(e=t.contentWindow.document).open(),e.write(bn("document.F=Object")),e.close(),e.F):kn(on);for(var r=dn.length;r--;)delete _Sn[mn][dn[r]];return _Sn();};fn[pn]=!0;var xn=Object.create||function(e,t){var i;return null!==e?(wn[mn]=cn(e),i=new wn(),wn[mn]=null,i[pn]=e):i=_Sn(),void 0===t?i:hn.f(i,t);},Cn=Mi,Vn=d,Tn=Yi,In=br,En=ai,Pn=J,Bn=xn,Dn=a,Mn=ne("Reflect","construct"),zn=Object.prototype,Un=[].push,An=Dn(function(){function e(){}return!(Mn(function(){},[],e)instanceof e);}),Rn=!Dn(function(){Mn(function(){});}),Ln=An||Rn;Cn({target:"Reflect",stat:!0,forced:Ln,sham:Ln},{construct:function construct(e,t){In(e),En(t);var i=arguments.length<3?e:In(arguments[2]);if(Rn&&!An)return Mn(e,t,i);if(e===i){switch(t.length){case 0:return new e();case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);}var r=[null];return Vn(Un,r,t),new(Vn(Tn,e,r))();}var n=i.prototype,o=Bn(Pn(n)?n:zn),a=Vn(e,o,t);return Pn(a)?a:o;}});var Nn=Q.Reflect.construct;r.exports=Nn;var On=t(i),Wn={},Hn={get exports(){return Wn;},set exports(e){Wn=e;}},Fn={},jn={get exports(){return Fn;},set exports(e){Fn=e;}},Yn=k,Xn=Array.isArray||function(e){return"Array"===Yn(e);},qn=TypeError,Zn=function Zn(e){if(e>9007199254740991)throw qn("Maximum allowed index exceeded");return e;},_n=E,Gn=ti,Kn=N,$n=function $n(e,t,i){_n?Gn.f(e,t,Kn(0,i)):e[t]=i;},Jn=Xn,Qn=mr,eo=J,to=gt("species"),io=Array,ro=function ro(e){var t;return Jn(e)&&(t=e.constructor,(Qn(t)&&(t===io||Jn(t.prototype))||eo(t)&&null===(t=t[to]))&&(t=void 0)),void 0===t?io:t;},no=function no(e,t){return new(ro(e))(0===t?0:t);},oo=a,ao=ge,so=gt("species"),uo=function uo(e){return ao>=51||!oo(function(){var t=[];return(t.constructor={})[so]=function(){return{foo:1};},1!==t[e](Boolean).foo;});},lo=Mi,co=a,ho=Xn,fo=J,vo=Je,go=Ar,mo=Zn,yo=$n,po=no,wo=uo,bo=ge,ko=gt("isConcatSpreadable"),So=bo>=51||!co(function(){var e=[];return e[ko]=!1,e.concat()[0]!==e;}),xo=function xo(e){if(!fo(e))return!1;var t=e[ko];return void 0!==t?!!t:ho(e);};lo({target:"Array",proto:!0,arity:1,forced:!So||!wo("concat")},{concat:function concat(e){var t,i,r,n,o,a=vo(this),s=po(a,0),u=0;for(t=-1,r=arguments.length;t<r;t++)if(xo(o=-1===t?a:arguments[t]))for(n=go(o),mo(u+n),i=0;i<n;i++,u++)i in o&&yo(s,u,o[i]);else mo(u+1),yo(s,u++,o);return s.length=u,s;}});var Co=Qi,Vo=String,To=function To(e){if("Symbol"===Co(e))throw new TypeError("Cannot convert a Symbol value to a string");return Vo(e);},Io={},Eo=Zr,Po=_r.concat("length","prototype");Io.f=Object.getOwnPropertyNames||function(e){return Eo(e,Po);};var Bo={},Do=k,Mo=K,zo=Io.f,Uo=zi,Ao="object"==(typeof window==="undefined"?"undefined":_typeof(window))&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Bo.f=function(e){return Ao&&"Window"===Do(e)?function(e){try{return zo(e);}catch(e){return Uo(Ao);}}(e):zo(Mo(e));};var Ro={};Ro.f=Object.getOwnPropertySymbols;var Lo=bi,No=function No(e,t,i,r){return r&&r.enumerable?e[t]=i:Lo(e,t,i),e;},Oo=ti,Wo=function Wo(e,t,i){return Oo.f(e,t,i);},Ho={},Fo=gt;Ho.f=Fo;var jo,Yo,Xo,qo=Q,Zo=tt,_o=Ho,Go=ti.f,Ko=function Ko(e){var t=qo.Symbol||(qo.Symbol={});Zo(t,e)||Go(t,e,{value:_o.f(e)});},$o=D,Jo=ne,Qo=gt,ea=No,ta=function ta(){var e=Jo("Symbol"),t=e&&e.prototype,i=t&&t.valueOf,r=Qo("toPrimitive");t&&!t[r]&&ea(t,r,function(e){return $o(i,this);},{arity:1});},ia=Qi,ra=qi?{}.toString:function(){return"[object "+ia(this)+"]";},na=qi,oa=ti.f,aa=bi,sa=tt,ua=ra,la=gt("toStringTag"),ca=function ca(e,t,i,r){var n=i?e:e&&e.prototype;n&&(sa(n,la)||oa(n,la,{configurable:!0,value:t}),r&&!na&&aa(n,"toString",ua));},ha=T,da=o.WeakMap,fa=ha(da)&&/native code/.test(String(da)),va=o,ga=J,ma=bi,ya=tt,pa=Oe,wa=ln,ba=Hr,ka="Object already initialized",Sa=va.TypeError,xa=va.WeakMap;if(fa||pa.state){var Ca=pa.state||(pa.state=new xa());Ca.get=Ca.get,Ca.has=Ca.has,Ca.set=Ca.set,jo=function jo(e,t){if(Ca.has(e))throw new Sa(ka);return t.facade=e,Ca.set(e,t),t;},Yo=function Yo(e){return Ca.get(e)||{};},Xo=function Xo(e){return Ca.has(e);};}else{var Va=wa("state");ba[Va]=!0,jo=function jo(e,t){if(ya(e,Va))throw new Sa(ka);return t.facade=e,ma(e,Va,t),t;},Yo=function Yo(e){return ya(e,Va)?e[Va]:{};},Xo=function Xo(e){return ya(e,Va);};}var Ta={set:jo,get:Yo,has:Xo,enforce:function enforce(e){return Xo(e)?Yo(e):jo(e,{});},getterFor:function getterFor(e){return function(t){var i;if(!ga(t)||(i=Yo(t)).type!==e)throw new Sa("Incompatible receiver, "+e+" required");return i;};}},Ia=ei,Ea=j,Pa=Je,Ba=Ar,Da=no,Ma=y([].push),za=function za(e){var t=1===e,i=2===e,r=3===e,n=4===e,o=6===e,a=7===e,s=5===e||o;return function(u,l,c,h){for(var d,f,v=Pa(u),g=Ea(v),m=Ba(g),y=Ia(l,c),p=0,w=h||Da,b=t?w(u,m):i||a?w(u,0):void 0;m>p;p++)if((s||p in g)&&(f=y(d=g[p],p,v),e))if(t)b[p]=f;else if(f)switch(e){case 3:return!0;case 5:return d;case 6:return p;case 2:Ma(b,d);}else switch(e){case 4:return!1;case 7:Ma(b,d);}return o?-1:r||n?n:b;};},Ua={forEach:za(0),map:za(1),filter:za(2),some:za(3),every:za(4),find:za(5),findIndex:za(6),filterReject:za(7)},Aa=Mi,Ra=o,La=D,Na=y,Oa=E,Wa=we,Ha=a,Fa=tt,ja=oe,Ya=ai,Xa=K,qa=Tt,Za=To,_a=N,Ga=xn,Ka=$r,$a=Io,Ja=Bo,Qa=Ro,es=I,ts=ti,is=kr,rs=M,ns=No,os=Wo,as=Ge,ss=Hr,us=at,ls=gt,cs=Ho,hs=Ko,ds=ta,fs=ca,vs=Ta,gs=Ua.forEach,ms=ln("hidden"),ys="Symbol",ps="prototype",ws=vs.set,bs=vs.getterFor(ys),ks=Object[ps],Ss=Ra.Symbol,xs=Ss&&Ss[ps],Cs=Ra.RangeError,Vs=Ra.TypeError,Ts=Ra.QObject,Is=es.f,Es=ts.f,Ps=Ja.f,Bs=rs.f,Ds=Na([].push),Ms=as("symbols"),zs=as("op-symbols"),Us=as("wks"),As=!Ts||!Ts[ps]||!Ts[ps].findChild,Rs=function Rs(e,t,i){var r=Is(ks,t);r&&delete ks[t],Es(e,t,i),r&&e!==ks&&Es(ks,t,r);},Ls=Oa&&Ha(function(){return 7!==Ga(Es({},"a",{get:function get(){return Es(this,"a",{value:7}).a;}})).a;})?Rs:Es,Ns=function Ns(e,t){var i=Ms[e]=Ga(xs);return ws(i,{type:ys,tag:e,description:t}),Oa||(i.description=t),i;},_Os=function Os(e,t,i){e===ks&&_Os(zs,t,i),Ya(e);var r=qa(t);return Ya(i),Fa(Ms,r)?(i.enumerable?(Fa(e,ms)&&e[ms][r]&&(e[ms][r]=!1),i=Ga(i,{enumerable:_a(0,!1)})):(Fa(e,ms)||Es(e,ms,_a(1,Ga(null))),e[ms][r]=!0),Ls(e,r,i)):Es(e,r,i);},Ws=function Ws(e,t){Ya(e);var i=Xa(t),r=Ka(i).concat(Ys(i));return gs(r,function(t){Oa&&!La(Hs,i,t)||_Os(e,t,i[t]);}),e;},Hs=function Hs(e){var t=qa(e),i=La(Bs,this,t);return!(this===ks&&Fa(Ms,t)&&!Fa(zs,t))&&(!(i||!Fa(this,t)||!Fa(Ms,t)||Fa(this,ms)&&this[ms][t])||i);},Fs=function Fs(e,t){var i=Xa(e),r=qa(t);if(i!==ks||!Fa(Ms,r)||Fa(zs,r)){var n=Is(i,r);return!n||!Fa(Ms,r)||Fa(i,ms)&&i[ms][r]||(n.enumerable=!0),n;}},js=function js(e){var t=Ps(Xa(e)),i=[];return gs(t,function(e){Fa(Ms,e)||Fa(ss,e)||Ds(i,e);}),i;},Ys=function Ys(e){var t=e===ks,i=Ps(t?zs:Xa(e)),r=[];return gs(i,function(e){!Fa(Ms,e)||t&&!Fa(ks,e)||Ds(r,Ms[e]);}),r;};Wa||(Ss=function Ss(){if(ja(xs,this))throw new Vs("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?Za(arguments[0]):void 0,t=us(e),_i2=function i(e){var r=void 0===this?Ra:this;r===ks&&La(_i2,zs,e),Fa(r,ms)&&Fa(r[ms],t)&&(r[ms][t]=!1);var n=_a(1,e);try{Ls(r,t,n);}catch(e){if(!(e instanceof Cs))throw e;Rs(r,t,n);}};return Oa&&As&&Ls(ks,t,{configurable:!0,set:_i2}),Ns(t,e);},ns(xs=Ss[ps],"toString",function(){return bs(this).tag;}),ns(Ss,"withoutSetter",function(e){return Ns(us(e),e);}),rs.f=Hs,ts.f=_Os,is.f=Ws,es.f=Fs,$a.f=Ja.f=js,Qa.f=Ys,cs.f=function(e){return Ns(ls(e),e);},Oa&&os(xs,"description",{configurable:!0,get:function get(){return bs(this).description;}})),Aa({global:!0,constructor:!0,wrap:!0,forced:!Wa,sham:!Wa},{Symbol:Ss}),gs(Ka(Us),function(e){hs(e);}),Aa({target:ys,stat:!0,forced:!Wa},{useSetter:function useSetter(){As=!0;},useSimple:function useSimple(){As=!1;}}),Aa({target:"Object",stat:!0,forced:!Wa,sham:!Oa},{create:function create(e,t){return void 0===t?Ga(e):Ws(Ga(e),t);},defineProperty:_Os,defineProperties:Ws,getOwnPropertyDescriptor:Fs}),Aa({target:"Object",stat:!0,forced:!Wa},{getOwnPropertyNames:js}),ds(),fs(Ss,ys),ss[ms]=!0;var Xs=we&&!!Symbol.for&&!!Symbol.keyFor,qs=Mi,Zs=ne,_s=tt,Gs=To,Ks=Ge,$s=Xs,Js=Ks("string-to-symbol-registry"),Qs=Ks("symbol-to-string-registry");qs({target:"Symbol",stat:!0,forced:!$s},{for:function _for(e){var t=Gs(e);if(_s(Js,t))return Js[t];var i=Zs("Symbol")(t);return Js[t]=i,Qs[i]=t,i;}});var eu=Mi,tu=tt,iu=Ve,ru=Ie,nu=Xs,ou=Ge("symbol-to-string-registry");eu({target:"Symbol",stat:!0,forced:!nu},{keyFor:function keyFor(e){if(!iu(e))throw new TypeError(ru(e)+" is not a symbol");if(tu(ou,e))return ou[e];}});var au=Xn,su=T,uu=k,lu=To,cu=y([].push),hu=Mi,du=ne,fu=d,vu=D,gu=y,mu=a,yu=T,pu=Ve,wu=zi,bu=function bu(e){if(su(e))return e;if(au(e)){for(var t=e.length,i=[],r=0;r<t;r++){var n=e[r];"string"==typeof n?cu(i,n):"number"!=typeof n&&"Number"!==uu(n)&&"String"!==uu(n)||cu(i,lu(n));}var o=i.length,a=!0;return function(e,t){if(a)return a=!1,t;if(au(this))return t;for(var r=0;r<o;r++)if(i[r]===e)return t;};}},ku=we,Su=String,xu=du("JSON","stringify"),Cu=gu(/./.exec),Vu=gu("".charAt),Tu=gu("".charCodeAt),Iu=gu("".replace),Eu=gu(1..toString),Pu=/[\uD800-\uDFFF]/g,Bu=/^[\uD800-\uDBFF]$/,Du=/^[\uDC00-\uDFFF]$/,Mu=!ku||mu(function(){var e=du("Symbol")("stringify detection");return"[null]"!==xu([e])||"{}"!==xu({a:e})||"{}"!==xu(Object(e));}),zu=mu(function(){return"\"\\udf06\\ud834\""!==xu("\uDF06\uD834")||"\"\\udead\""!==xu("\uDEAD");}),Uu=function Uu(e,t){var i=wu(arguments),r=bu(t);if(yu(r)||void 0!==e&&!pu(e))return i[1]=function(e,t){if(yu(r)&&(t=vu(r,this,Su(e),t)),!pu(t))return t;},fu(xu,null,i);},Au=function Au(e,t,i){var r=Vu(i,t-1),n=Vu(i,t+1);return Cu(Bu,e)&&!Cu(Du,n)||Cu(Du,e)&&!Cu(Bu,r)?"\\u"+Eu(Tu(e,0),16):e;};xu&&hu({target:"JSON",stat:!0,arity:3,forced:Mu||zu},{stringify:function stringify(e,t,i){var r=wu(arguments),n=fu(Mu?Uu:xu,null,r);return zu&&"string"==typeof n?Iu(n,Pu,Au):n;}});var Ru=Ro,Lu=Je;Mi({target:"Object",stat:!0,forced:!we||a(function(){Ru.f(1);})},{getOwnPropertySymbols:function getOwnPropertySymbols(e){var t=Ru.f;return t?t(Lu(e)):[];}}),Ko("asyncIterator"),Ko("hasInstance"),Ko("isConcatSpreadable"),Ko("iterator"),Ko("match"),Ko("matchAll"),Ko("replace"),Ko("search"),Ko("species"),Ko("split");var Nu=ta;Ko("toPrimitive"),Nu();var Ou=ne,Wu=ca;Ko("toStringTag"),Wu(Ou("Symbol"),"Symbol"),Ko("unscopables"),ca(o.JSON,"JSON",!0);var Hu,Fu,ju,Yu=Q.Symbol,Xu={},qu=E,Zu=tt,_u=Function.prototype,Gu=qu&&Object.getOwnPropertyDescriptor,Ku=Zu(_u,"name"),$u={EXISTS:Ku,PROPER:Ku&&"something"===function(){}.name,CONFIGURABLE:Ku&&(!qu||qu&&Gu(_u,"name").configurable)},Ju=!a(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e())!==e.prototype;}),Qu=tt,el=T,tl=Je,il=Ju,rl=ln("IE_PROTO"),nl=Object,ol=nl.prototype,al=il?nl.getPrototypeOf:function(e){var t=tl(e);if(Qu(t,rl))return t[rl];var i=t.constructor;return el(i)&&t instanceof i?i.prototype:t instanceof nl?ol:null;},sl=a,ul=T,ll=J,cl=xn,hl=al,dl=No,fl=gt("iterator"),vl=!1;[].keys&&("next"in(ju=[].keys())?(Fu=hl(hl(ju)))!==Object.prototype&&(Hu=Fu):vl=!0);var gl=!ll(Hu)||sl(function(){var e={};return Hu[fl].call(e)!==e;});ul((Hu=gl?{}:cl(Hu))[fl])||dl(Hu,fl,function(){return this;});var ml={IteratorPrototype:Hu,BUGGY_SAFARI_ITERATORS:vl},yl=ml.IteratorPrototype,pl=xn,wl=N,bl=ca,kl=Xu,Sl=function Sl(){return this;},xl=function xl(e,t,i,r){var n=t+" Iterator";return e.prototype=pl(yl,{next:wl(+!r,i)}),bl(e,n,!1,!0),kl[n]=Sl,e;},Cl=y,Vl=De,Tl=J,Il=function Il(e){return Tl(e)||null===e;},El=String,Pl=TypeError,Bl=function Bl(e,t,i){try{return Cl(Vl(Object.getOwnPropertyDescriptor(e,t)[i]));}catch(e){}},Dl=J,Ml=Z,zl=function zl(e){if(Il(e))return e;throw new Pl("Can't set "+El(e)+" as a prototype");},Ul=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,i={};try{(e=Bl(Object.prototype,"__proto__","set"))(i,[]),t=i instanceof Array;}catch(e){}return function(i,r){return Ml(i),zl(r),Dl(i)?(t?e(i,r):i.__proto__=r,i):i;};}():void 0),Al=Mi,Rl=D,Ll=$u,Nl=xl,Ol=al,Wl=ca,Hl=No,Fl=Xu,jl=ml,Yl=Ll.PROPER,Xl=jl.BUGGY_SAFARI_ITERATORS,ql=gt("iterator"),Zl="keys",_l="values",Gl="entries",Kl=function Kl(){return this;},$l=function $l(e,t,i,r,n,o,a){Nl(i,t,r);var s,u,l,c=function c(e){if(e===n&&g)return g;if(!Xl&&e&&e in f)return f[e];switch(e){case Zl:case _l:case Gl:return function(){return new i(this,e);};}return function(){return new i(this);};},h=t+" Iterator",d=!1,f=e.prototype,v=f[ql]||f["@@iterator"]||n&&f[n],g=!Xl&&v||c(n),m="Array"===t&&f.entries||v;if(m&&(s=Ol(m.call(new e())))!==Object.prototype&&s.next&&(Wl(s,h,!0,!0),Fl[h]=Kl),Yl&&n===_l&&v&&v.name!==_l&&(d=!0,g=function g(){return Rl(v,this);}),n)if(u={values:c(_l),keys:o?g:c(Zl),entries:c(Gl)},a)for(l in u)(Xl||d||!(l in f))&&Hl(f,l,u[l]);else Al({target:t,proto:!0,forced:Xl||d},u);return a&&f[ql]!==g&&Hl(f,ql,g,{name:n}),Fl[t]=g,u;},Jl=function Jl(e,t){return{value:e,done:t};},Ql=K,ec=function ec(){},tc=Xu,ic=Ta,rc=(ti.f,$l),nc=Jl,oc="Array Iterator",ac=ic.set,sc=ic.getterFor(oc);rc(Array,"Array",function(e,t){ac(this,{type:oc,target:Ql(e),index:0,kind:t});},function(){var e=sc(this),t=e.target,i=e.index++;if(!t||i>=t.length)return e.target=null,nc(void 0,!0);switch(e.kind){case"keys":return nc(i,!1);case"values":return nc(t[i],!1);}return nc([i,t[i]],!1);},"values");tc.Arguments=tc.Array;ec(),ec(),ec();var uc={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},lc=o,cc=ca,hc=Xu;for(var dc in uc)cc(lc[dc],dc),hc[dc]=hc.Array;var fc=Yu,vc=gt,gc=ti.f,mc=vc("metadata"),yc=Function.prototype;void 0===yc[mc]&&gc(yc,mc,{value:null}),Ko("asyncDispose"),Ko("dispose"),Ko("metadata");var pc=fc,wc=y,bc=ne("Symbol"),kc=bc.keyFor,Sc=wc(bc.prototype.valueOf),xc=bc.isRegisteredSymbol||function(e){try{return void 0!==kc(Sc(e));}catch(e){return!1;}};Mi({target:"Symbol",stat:!0},{isRegisteredSymbol:xc});for(var Cc=Ge,Vc=ne,Tc=y,Ic=Ve,Ec=gt,Pc=Vc("Symbol"),Bc=Pc.isWellKnownSymbol,Dc=Vc("Object","getOwnPropertyNames"),Mc=Tc(Pc.prototype.valueOf),zc=Cc("wks"),Uc=0,Ac=Dc(Pc),Rc=Ac.length;Uc<Rc;Uc++)try{var Lc=Ac[Uc];Ic(Pc[Lc])&&Ec(Lc);}catch(e){}var Nc=function Nc(e){if(Bc&&Bc(e))return!0;try{for(var t=Mc(e),i=0,r=Dc(zc),n=r.length;i<n;i++)if(zc[r[i]]==t)return!0;}catch(e){}return!1;};Mi({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:Nc}),Ko("customMatcher"),Ko("observable"),Mi({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:xc}),Mi({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:Nc}),Ko("matcher"),Ko("metadataKey"),Ko("patternMatch"),Ko("replaceAll");var Oc=pc;!function(e){e.exports=Oc;}(jn),function(e){e.exports=Fn;}(Hn);var Wc=t(Wn),Hc={},Fc={get exports(){return Hc;},set exports(e){Hc=e;}},jc={},Yc={get exports(){return jc;},set exports(e){jc=e;}},Xc=y,qc=Tr,Zc=To,_c=Z,Gc=Xc("".charAt),Kc=Xc("".charCodeAt),$c=Xc("".slice),Jc=function Jc(e){return function(t,i){var r,n,o=Zc(_c(t)),a=qc(i),s=o.length;return a<0||a>=s?e?"":void 0:(r=Kc(o,a))<55296||r>56319||a+1===s||(n=Kc(o,a+1))<56320||n>57343?e?Gc(o,a):r:e?$c(o,a,a+2):n-56320+(r-55296<<10)+65536;};},Qc={codeAt:Jc(!1),charAt:Jc(!0)},eh=Qc.charAt,th=To,ih=Ta,rh=$l,nh=Jl,oh="String Iterator",ah=ih.set,sh=ih.getterFor(oh);rh(String,"String",function(e){ah(this,{type:oh,string:th(e),index:0});},function(){var e,t=sh(this),i=t.string,r=t.index;return r>=i.length?nh(void 0,!0):(e=eh(i,r),t.index+=e.length,nh(e,!1));});var uh=Ho.f("iterator");!function(e){e.exports=uh;}(Yc),function(e){e.exports=jc;}(Fc);var lh=t(Hc);function ch(e){return ch="function"==typeof Wc&&"symbol"==_typeof(lh)?function(e){return _typeof(e);}:function(e){return e&&"function"==typeof Wc&&e.constructor===Wc&&e!==Wc.prototype?"symbol":_typeof(e);},ch(e);}var hh={},dh={get exports(){return hh;},set exports(e){hh=e;}},fh={},vh={get exports(){return fh;},set exports(e){fh=e;}};Mi({target:"Array",stat:!0},{isArray:Xn});var gh=Q.Array.isArray,mh=gh;!function(e){e.exports=mh;}(vh),function(e){e.exports=fh;}(dh);var yh=t(hh);function ph(e){if(yh(e))return e;}var wh={},bh={get exports(){return wh;},set exports(e){wh=e;}},kh={},Sh={get exports(){return kh;},set exports(e){kh=e;}},xh=Qi,Ch=Ue,Vh=Y,Th=Xu,Ih=gt("iterator"),Eh=function Eh(e){if(!Vh(e))return Ch(e,Ih)||Ch(e,"@@iterator")||Th[xh(e)];},Ph=Eh;!function(e){e.exports=Ph;}(Sh),function(e){e.exports=kh;}(bh);var Bh=t(wh),Dh={},Mh={get exports(){return Dh;},set exports(e){Dh=e;}},zh={},Uh={get exports(){return zh;},set exports(e){zh=e;}},Ah=D,Rh=ai,Lh=Ue,Nh=function Nh(e,t,i){var r,n;Rh(e);try{if(!(r=Lh(e,"return"))){if("throw"===t)throw i;return i;}r=Ah(r,e);}catch(e){n=!0,r=e;}if("throw"===t)throw i;if(n)throw r;return Rh(r),i;},Oh=ai,Wh=Nh,Hh=Xu,Fh=gt("iterator"),jh=Array.prototype,Yh=function Yh(e){return void 0!==e&&(Hh.Array===e||jh[Fh]===e);},Xh=D,qh=De,Zh=ai,_h=Ie,Gh=Eh,Kh=TypeError,$h=function $h(e,t){var i=arguments.length<2?Gh(e):t;if(qh(i))return Zh(Xh(i,e));throw new Kh(_h(e)+" is not iterable");},Jh=ei,Qh=D,ed=Je,td=function td(e,t,i,r){try{return r?t(Oh(i)[0],i[1]):t(i);}catch(t){Wh(e,"throw",t);}},id=Yh,rd=mr,nd=Ar,od=$n,ad=$h,sd=Eh,ud=Array,ld=function ld(e){var t=ed(e),i=rd(this),r=arguments.length,n=r>1?arguments[1]:void 0,o=void 0!==n;o&&(n=Jh(n,r>2?arguments[2]:void 0));var a,s,u,l,c,h,d=sd(t),f=0;if(!d||this===ud&&id(d))for(a=nd(t),s=i?new this(a):ud(a);a>f;f++)h=o?n(t[f],f):t[f],od(s,f,h);else for(s=i?new this():[],c=(l=ad(t,d)).next;!(u=Qh(c,l)).done;f++)h=o?td(l,n,[u.value,f],!0):u.value,od(s,f,h);return s.length=f,s;},cd=gt("iterator"),hd=!1;try{var dd=0,fd={next:function next(){return{done:!!dd++};},return:function _return(){hd=!0;}};fd[cd]=function(){return this;},Array.from(fd,function(){throw 2;});}catch(e){}var vd=function vd(e,t){try{if(!t&&!hd)return!1;}catch(e){return!1;}var i=!1;try{var r={};r[cd]=function(){return{next:function next(){return{done:i=!0};}};},e(r);}catch(e){}return i;},gd=ld;Mi({target:"Array",stat:!0,forced:!vd(function(e){Array.from(e);})},{from:gd});var md=Q.Array.from,yd=md;!function(e){e.exports=yd;}(Uh),function(e){e.exports=zh;}(Mh);var pd=t(Dh);function wd(e){if(void 0!==Wc&&null!=Bh(e)||null!=e["@@iterator"])return pd(e);}var bd={},kd={get exports(){return bd;},set exports(e){bd=e;}},Sd={},xd={get exports(){return Sd;},set exports(e){Sd=e;}},Cd=Mi,Vd=Xn,Td=mr,Id=J,Ed=Br,Pd=Ar,Bd=K,Dd=$n,Md=gt,zd=zi,Ud=uo("slice"),Ad=Md("species"),Rd=Array,Ld=Math.max;Cd({target:"Array",proto:!0,forced:!Ud},{slice:function slice(e,t){var i,r,n,o=Bd(this),a=Pd(o),s=Ed(e,a),u=Ed(void 0===t?a:t,a);if(Vd(o)&&(i=o.constructor,(Td(i)&&(i===Rd||Vd(i.prototype))||Id(i)&&null===(i=i[Ad]))&&(i=void 0),i===Rd||void 0===i))return zd(o,s,u);for(r=new(void 0===i?Rd:i)(Ld(u-s,0)),n=0;s<u;s++,n++)s in o&&Dd(r,n,o[s]);return r.length=n,r;}});var Nd=o,Od=Q,Wd=function Wd(e,t){var i=Od[e+"Prototype"],r=i&&i[t];if(r)return r;var n=Nd[e],o=n&&n.prototype;return o&&o[t];},Hd=Wd("Array","slice"),Fd=oe,jd=Hd,Yd=Array.prototype,Xd=function Xd(e){var t=e.slice;return e===Yd||Fd(Yd,e)&&t===Yd.slice?jd:t;},qd=Xd,Zd=qd;!function(e){e.exports=Zd;}(xd),function(e){e.exports=Sd;}(kd);var _d=t(bd);function Gd(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r;}function Kd(e,t){var i;if(e){if("string"==typeof e)return Gd(e,t);var r=_d(i=Object.prototype.toString.call(e)).call(i,8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?pd(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Gd(e,t):void 0;}}function $d(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var Jd={},Qd={get exports(){return Jd;},set exports(e){Jd=e;}},ef={},tf={get exports(){return ef;},set exports(e){ef=e;}},rf=Q.Object.getOwnPropertySymbols;!function(e){e.exports=rf;}(tf),function(e){e.exports=ef;}(Qd);var nf=t(Jd),of={},af={get exports(){return of;},set exports(e){of=e;}},sf={},uf={get exports(){return sf;},set exports(e){sf=e;}},lf=a,cf=function cf(e,t){var i=[][e];return!!i&&lf(function(){i.call(null,t||function(){return 1;},1);});},hf=Mi,df=Wr.indexOf,ff=cf,vf=C([].indexOf),gf=!!vf&&1/vf([1],1,-0)<0;hf({target:"Array",proto:!0,forced:gf||!ff("indexOf")},{indexOf:function indexOf(e){var t=arguments.length>1?arguments[1]:void 0;return gf?vf(this,e,t)||0:df(this,e,t);}});var mf=Wd("Array","indexOf"),yf=oe,pf=mf,wf=Array.prototype,bf=function bf(e){var t=e.indexOf;return e===wf||yf(wf,e)&&t===wf.indexOf?pf:t;},kf=bf,Sf=kf;!function(e){e.exports=Sf;}(uf),function(e){e.exports=sf;}(af);var xf=t(of),Cf={},Vf={get exports(){return Cf;},set exports(e){Cf=e;}},Tf={},If={get exports(){return Tf;},set exports(e){Tf=e;}},Ef=Je,Pf=$r;Mi({target:"Object",stat:!0,forced:a(function(){Pf(1);})},{keys:function keys(e){return Pf(Ef(e));}});var Bf=Q.Object.keys,Df=Bf;!function(e){e.exports=Df;}(If),function(e){e.exports=Tf;}(Vf);var Mf=t(Cf);function zf(e,t){if(null==e)return{};var i,r,n=function(e,t){if(null==e)return{};var i,r,n={},o=Mf(e);for(r=0;r<o.length;r++)i=o[r],xf(t).call(t,i)>=0||(n[i]=e[i]);return n;}(e,t);if(nf){var o=nf(e);for(r=0;r<o.length;r++)i=o[r],xf(t).call(t,i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i]);}return n;}var Uf={},Af={get exports(){return Uf;},set exports(e){Uf=e;}},Rf={},Lf={get exports(){return Rf;},set exports(e){Rf=e;}},Nf=Yi;Mi({target:"Function",proto:!0,forced:Function.bind!==Nf},{bind:Nf});var Of=Wd("Function","bind"),Wf=oe,Hf=Of,Ff=Function.prototype,jf=function jf(e){var t=e.bind;return e===Ff||Wf(Ff,e)&&t===Ff.bind?Hf:t;},Yf=jf,Xf=Yf;!function(e){e.exports=Xf;}(Lf),function(e){e.exports=Rf;}(Af);var qf=t(Uf),Zf={},_f={get exports(){return Zf;},set exports(e){Zf=e;}},Gf={},Kf={get exports(){return Gf;},set exports(e){Gf=e;}},$f=Nn;!function(e){e.exports=$f;}(Kf),function(e){e.exports=Gf;}(_f);var Jf=t(Zf),Qf={},ev={get exports(){return Qf;},set exports(e){Qf=e;}},tv={},iv={get exports(){return tv;},set exports(e){tv=e;}};Mi({target:"Object",stat:!0},{setPrototypeOf:Ul});var rv=Q.Object.setPrototypeOf;!function(e){e.exports=rv;}(iv),function(e){e.exports=tv;}(ev);var nv=t(Qf);function ov(e,t){var i;return ov=nv?qf(i=nv).call(i):function(e,t){return e.__proto__=t,e;},ov(e,t);}function av(){if("undefined"==typeof Reflect||!Jf)return!1;if(Jf.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Jf(Boolean,[],function(){})),!0;}catch(e){return!1;}}function sv(e,t,i){var r;av()?sv=qf(r=Jf).call(r):sv=function sv(e,t,i){var r=[null];r.push.apply(r,t);var n=new(qf(Function).apply(e,r))();return i&&ov(n,i.prototype),n;};return sv.apply(null,arguments);}var uv={},lv={get exports(){return uv;},set exports(e){uv=e;}},cv={},hv={get exports(){return cv;},set exports(e){cv=e;}},dv={},fv={get exports(){return dv;},set exports(e){dv=e;}},vv=Mi,gv=E,mv=ti.f;vv({target:"Object",stat:!0,forced:Object.defineProperty!==mv,sham:!gv},{defineProperty:mv});var yv=Q.Object,pv=fv.exports=function(e,t,i){return yv.defineProperty(e,t,i);};yv.defineProperty.sham&&(pv.sham=!0);var wv=dv,bv=wv;!function(e){e.exports=bv;}(hv),function(e){e.exports=cv;}(lv);var kv=t(uv),Sv={},xv={get exports(){return Sv;},set exports(e){Sv=e;}},Cv={},Vv={get exports(){return Cv;},set exports(e){Cv=e;}};Mi({target:"Object",stat:!0,sham:!E},{create:xn});var Tv=Q.Object,Iv=function Iv(e,t){return Tv.create(e,t);},Ev=Iv;!function(e){e.exports=Ev;}(Vv),function(e){e.exports=Cv;}(xv);var Pv=t(Sv),Bv={},Dv={get exports(){return Bv;},set exports(e){Bv=e;}},Mv={},zv={get exports(){return Mv;},set exports(e){Mv=e;}},Uv=Je,Av=al,Rv=Ju;Mi({target:"Object",stat:!0,forced:a(function(){Av(1);}),sham:!Rv},{getPrototypeOf:function getPrototypeOf(e){return Av(Uv(e));}});var Lv=Q.Object.getPrototypeOf;!function(e){e.exports=Lv;}(zv),function(e){e.exports=Mv;}(Dv);var Nv=t(Bv),Ov={},Wv={get exports(){return Ov;},set exports(e){Ov=e;}},Hv={},Fv={get exports(){return Hv;},set exports(e){Hv=e;}},jv=Ua.forEach,Yv=cf("forEach")?[].forEach:function(e){return jv(this,e,arguments.length>1?arguments[1]:void 0);};Mi({target:"Array",proto:!0,forced:[].forEach!==Yv},{forEach:Yv});var Xv=Wd("Array","forEach"),qv=Qi,Zv=tt,_v=oe,Gv=Xv,Kv=Array.prototype,$v={DOMTokenList:!0,NodeList:!0},Jv=function Jv(e){var t=e.forEach;return e===Kv||_v(Kv,e)&&t===Kv.forEach||Zv($v,qv(e))?Gv:t;},Qv=Jv;!function(e){e.exports=Qv;}(Fv),function(e){e.exports=Hv;}(Wv);var eg=t(Ov),tg={},ig={get exports(){return tg;},set exports(e){tg=e;}},rg={},ng={get exports(){return rg;},set exports(e){rg=e;}},og=ne,ag=Io,sg=Ro,ug=ai,lg=y([].concat),cg=og("Reflect","ownKeys")||function(e){var t=ag.f(ug(e)),i=sg.f;return i?lg(t,i(e)):t;},hg=tt,dg=cg,fg=I,vg=ti,gg=J,mg=bi,yg=Error,pg=y("".replace),wg=String(new yg("zxcasd").stack),bg=/\n\s*at [^:]*:[^\n]*/,kg=bg.test(wg),Sg=N,xg=!a(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Sg(1,7)),7!==e.stack);}),Cg=bi,Vg=function Vg(e,t){if(kg&&"string"==typeof e&&!yg.prepareStackTrace)for(;t--;)e=pg(e,bg,"");return e;},Tg=xg,Ig=Error.captureStackTrace,Eg=ei,Pg=D,Bg=ai,Dg=Ie,Mg=Yh,zg=Ar,Ug=oe,Ag=$h,Rg=Eh,Lg=Nh,Ng=TypeError,Og=function Og(e,t){this.stopped=e,this.result=t;},Wg=Og.prototype,Hg=function Hg(e,t,i){var r,n,o,a,s,u,l,c=i&&i.that,h=!(!i||!i.AS_ENTRIES),d=!(!i||!i.IS_RECORD),f=!(!i||!i.IS_ITERATOR),v=!(!i||!i.INTERRUPTED),g=Eg(t,c),m=function m(e){return r&&Lg(r,"normal",e),new Og(!0,e);},y=function y(e){return h?(Bg(e),v?g(e[0],e[1],m):g(e[0],e[1])):v?g(e,m):g(e);};if(d)r=e.iterator;else if(f)r=e;else{if(!(n=Rg(e)))throw new Ng(Dg(e)+" is not iterable");if(Mg(n)){for(o=0,a=zg(e);a>o;o++)if((s=y(e[o]))&&Ug(Wg,s))return s;return new Og(!1);}r=Ag(e,n);}for(u=d?e.next:r.next;!(l=Pg(u,r)).done;){try{s=y(l.value);}catch(e){Lg(r,"throw",e);}if("object"==_typeof(s)&&s&&Ug(Wg,s))return s;}return new Og(!1);},Fg=To,jg=Mi,Yg=oe,Xg=al,qg=Ul,Zg=function Zg(e,t,i){for(var r=dg(t),n=vg.f,o=fg.f,a=0;a<r.length;a++){var s=r[a];hg(e,s)||i&&hg(i,s)||n(e,s,o(t,s));}},_g=xn,Gg=bi,Kg=N,$g=function $g(e,t){gg(t)&&"cause"in t&&mg(e,"cause",t.cause);},Jg=function Jg(e,t,i,r){Tg&&(Ig?Ig(e,t):Cg(e,"stack",Vg(i,r)));},Qg=Hg,em=function em(e,t){return void 0===e?arguments.length<2?"":t:Fg(e);},tm=gt("toStringTag"),im=Error,rm=[].push,_nm=function nm(e,t){var i,r=Yg(om,this);qg?i=qg(new im(),r?Xg(this):om):(i=r?this:_g(om),Gg(i,tm,"Error")),void 0!==t&&Gg(i,"message",em(t)),Jg(i,_nm,i.stack,1),arguments.length>2&&$g(i,arguments[2]);var n=[];return Qg(e,rm,{that:n}),Gg(i,"errors",n),i;};qg?qg(_nm,im):Zg(_nm,im,{name:!0});var om=_nm.prototype=_g(im.prototype,{constructor:Kg(1,_nm),message:Kg(1,""),name:Kg(1,"AggregateError")});jg({global:!0,constructor:!0,arity:2},{AggregateError:_nm});var am,sm,um,lm,cm=o,hm=ue,dm=k,fm=function fm(e){return hm.slice(0,e.length)===e;},vm=fm("Bun/")?"BUN":fm("Cloudflare-Workers")?"CLOUDFLARE":fm("Deno/")?"DENO":fm("Node.js/")?"NODE":cm.Bun&&"string"==typeof Bun.version?"BUN":cm.Deno&&"object"==_typeof(Deno.version)?"DENO":"process"===dm(cm.process)?"NODE":cm.window&&cm.document?"BROWSER":"REST",gm="NODE"===vm,mm=ne,ym=Wo,pm=E,wm=gt("species"),bm=function bm(e){var t=mm(e);pm&&t&&!t[wm]&&ym(t,wm,{configurable:!0,get:function get(){return this;}});},km=oe,Sm=TypeError,xm=function xm(e,t){if(km(t,e))return e;throw new Sm("Incorrect invocation");},Cm=ai,Vm=br,Tm=Y,Im=gt("species"),Em=function Em(e,t){var i,r=Cm(e).constructor;return void 0===r||Tm(i=Cm(r)[Im])?t:Vm(i);},Pm=TypeError,Bm=function Bm(e,t){if(e<t)throw new Pm("Not enough arguments");return e;},Dm=/(?:ipad|iphone|ipod).*applewebkit/i.test(ue),Mm=o,zm=d,Um=ei,Am=T,Rm=tt,Lm=a,Nm=an,Om=zi,Wm=Bt,Hm=Bm,Fm=Dm,jm=gm,Ym=Mm.setImmediate,Xm=Mm.clearImmediate,qm=Mm.process,Zm=Mm.Dispatch,_m=Mm.Function,Gm=Mm.MessageChannel,Km=Mm.String,$m=0,Jm={},Qm="onreadystatechange";Lm(function(){am=Mm.location;});var ey=function ey(e){if(Rm(Jm,e)){var t=Jm[e];delete Jm[e],t();}},ty=function ty(e){return function(){ey(e);};},iy=function iy(e){ey(e.data);},ry=function ry(e){Mm.postMessage(Km(e),am.protocol+"//"+am.host);};Ym&&Xm||(Ym=function Ym(e){Hm(arguments.length,1);var t=Am(e)?e:_m(e),i=Om(arguments,1);return Jm[++$m]=function(){zm(t,void 0,i);},sm($m),$m;},Xm=function Xm(e){delete Jm[e];},jm?sm=function sm(e){qm.nextTick(ty(e));}:Zm&&Zm.now?sm=function sm(e){Zm.now(ty(e));}:Gm&&!Fm?(lm=(um=new Gm()).port2,um.port1.onmessage=iy,sm=Um(lm.postMessage,lm)):Mm.addEventListener&&Am(Mm.postMessage)&&!Mm.importScripts&&am&&"file:"!==am.protocol&&!Lm(ry)?(sm=ry,Mm.addEventListener("message",iy,!1)):sm=Qm in Wm("script")?function(e){Nm.appendChild(Wm("script"))[Qm]=function(){Nm.removeChild(this),ey(e);};}:function(e){setTimeout(ty(e),0);});var ny={set:Ym,clear:Xm},oy=o,ay=E,sy=Object.getOwnPropertyDescriptor,uy=function uy(e){if(!ay)return oy[e];var t=sy(oy,e);return t&&t.value;},ly=function ly(){this.head=null,this.tail=null;};ly.prototype={add:function add(e){var t={item:e,next:null},i=this.tail;i?i.next=t:this.head=t,this.tail=t;},get:function get(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item;}};var cy,hy,dy,fy,vy,gy=ly,my=/ipad|iphone|ipod/i.test(ue)&&"undefined"!=typeof Pebble,yy=/web0s(?!.*chrome)/i.test(ue),py=o,wy=uy,by=ei,ky=ny.set,Sy=gy,xy=Dm,Cy=my,Vy=yy,Ty=gm,Iy=py.MutationObserver||py.WebKitMutationObserver,Ey=py.document,Py=py.process,By=py.Promise,Dy=wy("queueMicrotask");if(!Dy){var My=new Sy(),zy=function zy(){var e,t;for(Ty&&(e=Py.domain)&&e.exit();t=My.get();)try{t();}catch(e){throw My.head&&cy(),e;}e&&e.enter();};xy||Ty||Vy||!Iy||!Ey?!Cy&&By&&By.resolve?((fy=By.resolve(void 0)).constructor=By,vy=by(fy.then,fy),cy=function cy(){vy(zy);}):Ty?cy=function cy(){Py.nextTick(zy);}:(ky=by(ky,py),cy=function cy(){ky(zy);}):(hy=!0,dy=Ey.createTextNode(""),new Iy(zy).observe(dy,{characterData:!0}),cy=function cy(){dy.data=hy=!hy;}),Dy=function Dy(e){My.head||cy(),My.add(e);};}var Uy=Dy,Ay=function Ay(e){try{return{error:!1,value:e()};}catch(e){return{error:!0,value:e};}},Ry=o.Promise,Ly=o,Ny=Ry,Oy=T,Wy=Kt,Hy=rr,Fy=gt,jy=vm,Yy=ge,Xy=Ny&&Ny.prototype,qy=Fy("species"),Zy=!1,_y=Oy(Ly.PromiseRejectionEvent),Gy=Wy("Promise",function(){var e=Hy(Ny),t=e!==String(Ny);if(!t&&66===Yy)return!0;if(!Xy.catch||!Xy.finally)return!0;if(!Yy||Yy<51||!/native code/.test(e)){var i=new Ny(function(e){e(1);}),r=function r(e){e(function(){},function(){});};if((i.constructor={})[qy]=r,!(Zy=i.then(function(){})instanceof r))return!0;}return!(t||"BROWSER"!==jy&&"DENO"!==jy||_y);}),Ky={CONSTRUCTOR:Gy,REJECTION_EVENT:_y,SUBCLASSING:Zy},$y={},Jy=De,Qy=TypeError,ep=function ep(e){var t,i;this.promise=new e(function(e,r){if(void 0!==t||void 0!==i)throw new Qy("Bad Promise constructor");t=e,i=r;}),this.resolve=Jy(t),this.reject=Jy(i);};$y.f=function(e){return new ep(e);};var tp,ip,rp=Mi,np=gm,op=o,ap=D,sp=No,up=ca,lp=bm,cp=De,hp=T,dp=J,fp=xm,vp=Em,gp=ny.set,mp=Uy,yp=function yp(e,t){try{1===arguments.length?console.error(e):console.error(e,t);}catch(e){}},pp=Ay,wp=gy,bp=Ta,kp=Ry,Sp=Ky,xp=$y,Cp="Promise",Vp=Sp.CONSTRUCTOR,Tp=Sp.REJECTION_EVENT,Ip=bp.getterFor(Cp),Ep=bp.set,Pp=kp&&kp.prototype,Bp=kp,Dp=Pp,Mp=op.TypeError,zp=op.document,Up=op.process,Ap=xp.f,Rp=Ap,Lp=!!(zp&&zp.createEvent&&op.dispatchEvent),Np="unhandledrejection",Op=function Op(e){var t;return!(!dp(e)||!hp(t=e.then))&&t;},Wp=function Wp(e,t){var i,r,n,o=t.value,a=1===t.state,s=a?e.ok:e.fail,u=e.resolve,l=e.reject,c=e.domain;try{s?(a||(2===t.rejection&&Xp(t),t.rejection=1),!0===s?i=o:(c&&c.enter(),i=s(o),c&&(c.exit(),n=!0)),i===e.promise?l(new Mp("Promise-chain cycle")):(r=Op(i))?ap(r,i,u,l):u(i)):l(o);}catch(e){c&&!n&&c.exit(),l(e);}},Hp=function Hp(e,t){e.notified||(e.notified=!0,mp(function(){for(var i,r=e.reactions;i=r.get();)Wp(i,e);e.notified=!1,t&&!e.rejection&&jp(e);}));},Fp=function Fp(e,t,i){var r,n;Lp?((r=zp.createEvent("Event")).promise=t,r.reason=i,r.initEvent(e,!1,!0),op.dispatchEvent(r)):r={promise:t,reason:i},!Tp&&(n=op["on"+e])?n(r):e===Np&&yp("Unhandled promise rejection",i);},jp=function jp(e){ap(gp,op,function(){var t,i=e.facade,r=e.value;if(Yp(e)&&(t=pp(function(){np?Up.emit("unhandledRejection",r,i):Fp(Np,i,r);}),e.rejection=np||Yp(e)?2:1,t.error))throw t.value;});},Yp=function Yp(e){return 1!==e.rejection&&!e.parent;},Xp=function Xp(e){ap(gp,op,function(){var t=e.facade;np?Up.emit("rejectionHandled",t):Fp("rejectionhandled",t,e.value);});},qp=function qp(e,t,i){return function(r){e(t,r,i);};},Zp=function Zp(e,t,i){e.done||(e.done=!0,i&&(e=i),e.value=t,e.state=2,Hp(e,!0));},_p2=function _p(e,t,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===t)throw new Mp("Promise can't be resolved itself");var r=Op(t);r?mp(function(){var i={done:!1};try{ap(r,t,qp(_p2,i,e),qp(Zp,i,e));}catch(t){Zp(i,t,e);}}):(e.value=t,e.state=1,Hp(e,!1));}catch(t){Zp({done:!1},t,e);}}};Vp&&(Dp=(Bp=function Bp(e){fp(this,Dp),cp(e),ap(tp,this);var t=Ip(this);try{e(qp(_p2,t),qp(Zp,t));}catch(e){Zp(t,e);}}).prototype,(tp=function tp(e){Ep(this,{type:Cp,done:!1,notified:!1,parent:!1,reactions:new wp(),rejection:!1,state:0,value:null});}).prototype=sp(Dp,"then",function(e,t){var i=Ip(this),r=Ap(vp(this,Bp));return i.parent=!0,r.ok=!hp(e)||e,r.fail=hp(t)&&t,r.domain=np?Up.domain:void 0,0===i.state?i.reactions.add(r):mp(function(){Wp(r,i);}),r.promise;}),ip=function ip(){var e=new tp(),t=Ip(e);this.promise=e,this.resolve=qp(_p2,t),this.reject=qp(Zp,t);},xp.f=Ap=function Ap(e){return e===Bp||undefined===e?new ip(e):Rp(e);}),rp({global:!0,constructor:!0,wrap:!0,forced:Vp},{Promise:Bp}),up(Bp,Cp,!1,!0),lp(Cp);var Gp=Ry,Kp=Ky.CONSTRUCTOR||!vd(function(e){Gp.all(e).then(void 0,function(){});}),$p=D,Jp=De,Qp=$y,ew=Ay,tw=Hg;Mi({target:"Promise",stat:!0,forced:Kp},{all:function all(e){var t=this,i=Qp.f(t),r=i.resolve,n=i.reject,o=ew(function(){var i=Jp(t.resolve),o=[],a=0,s=1;tw(e,function(e){var u=a++,l=!1;s++,$p(i,t,e).then(function(e){l||(l=!0,o[u]=e,--s||r(o));},n);}),--s||r(o);});return o.error&&n(o.value),i.promise;}});var iw=Mi,rw=Ky.CONSTRUCTOR;Ry&&Ry.prototype,iw({target:"Promise",proto:!0,forced:rw,real:!0},{catch:function _catch(e){return this.then(void 0,e);}});var nw=D,ow=De,aw=$y,sw=Ay,uw=Hg;Mi({target:"Promise",stat:!0,forced:Kp},{race:function race(e){var t=this,i=aw.f(t),r=i.reject,n=sw(function(){var n=ow(t.resolve);uw(e,function(e){nw(n,t,e).then(i.resolve,r);});});return n.error&&r(n.value),i.promise;}});var lw=$y;Mi({target:"Promise",stat:!0,forced:Ky.CONSTRUCTOR},{reject:function reject(e){var t=lw.f(this);return(0,t.reject)(e),t.promise;}});var cw=ai,hw=J,dw=$y,fw=function fw(e,t){if(cw(e),hw(t)&&t.constructor===e)return t;var i=dw.f(e);return(0,i.resolve)(t),i.promise;},vw=Mi,gw=Ry,mw=Ky.CONSTRUCTOR,yw=fw,pw=ne("Promise"),ww=!mw;vw({target:"Promise",stat:!0,forced:true},{resolve:function resolve(e){return yw(ww&&this===pw?gw:this,e);}});var bw=D,kw=De,Sw=$y,xw=Ay,Cw=Hg;Mi({target:"Promise",stat:!0,forced:Kp},{allSettled:function allSettled(e){var t=this,i=Sw.f(t),r=i.resolve,n=i.reject,o=xw(function(){var i=kw(t.resolve),n=[],o=0,a=1;Cw(e,function(e){var s=o++,u=!1;a++,bw(i,t,e).then(function(e){u||(u=!0,n[s]={status:"fulfilled",value:e},--a||r(n));},function(e){u||(u=!0,n[s]={status:"rejected",reason:e},--a||r(n));});}),--a||r(n);});return o.error&&n(o.value),i.promise;}});var Vw=D,Tw=De,Iw=ne,Ew=$y,Pw=Ay,Bw=Hg,Dw="No one promise resolved";Mi({target:"Promise",stat:!0,forced:Kp},{any:function any(e){var t=this,i=Iw("AggregateError"),r=Ew.f(t),n=r.resolve,o=r.reject,a=Pw(function(){var r=Tw(t.resolve),a=[],s=0,u=1,l=!1;Bw(e,function(e){var c=s++,h=!1;u++,Vw(r,t,e).then(function(e){h||l||(l=!0,n(e));},function(e){h||l||(h=!0,a[c]=e,--u||o(new i(a,Dw)));});}),--u||o(new i(a,Dw));});return a.error&&o(a.value),r.promise;}});var Mw=Mi,zw=d,Uw=zi,Aw=$y,Rw=De,Lw=Ay,Nw=o.Promise,Ow=!1;Mw({target:"Promise",stat:!0,forced:!Nw||!Nw.try||Lw(function(){Nw.try(function(e){Ow=8===e;},8);}).error||!Ow},{try:function _try(e){var t=arguments.length>1?Uw(arguments,1):[],i=Aw.f(this),r=Lw(function(){return zw(Rw(e),void 0,t);});return(r.error?i.reject:i.resolve)(r.value),i.promise;}});var Ww=$y;Mi({target:"Promise",stat:!0},{withResolvers:function withResolvers(){var e=Ww.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject};}});var Hw=Mi,Fw=Ry,jw=a,Yw=ne,Xw=T,qw=Em,Zw=fw,_w=Fw&&Fw.prototype;Hw({target:"Promise",proto:!0,real:!0,forced:!!Fw&&jw(function(){_w.finally.call({then:function then(){}},function(){});})},{finally:function _finally(e){var t=qw(this,Yw("Promise")),i=Xw(e);return this.then(i?function(i){return Zw(t,e()).then(function(){return i;});}:e,i?function(i){return Zw(t,e()).then(function(){throw i;});}:e);}});var Gw=Q.Promise,Kw=Gw;!function(e){e.exports=Kw;}(ng),function(e){e.exports=rg;}(ig);var $w=t(tg),Jw={},Qw={get exports(){return Jw;},set exports(e){Jw=e;}},eb={},tb={get exports(){return eb;},set exports(e){eb=e;}},ib=Mi,rb=Xn,nb=y([].reverse),ob=[1,2];ib({target:"Array",proto:!0,forced:String(ob)===String(ob.reverse())},{reverse:function reverse(){return rb(this)&&(this.length=this.length),nb(this);}});var ab=Wd("Array","reverse"),sb=oe,ub=ab,lb=Array.prototype,cb=function cb(e){var t=e.reverse;return e===lb||sb(lb,e)&&t===lb.reverse?ub:t;},hb=cb,db=hb;!function(e){e.exports=db;}(tb),function(e){e.exports=eb;}(Qw);var fb=t(Jw);function vb(){vb=function vb(){return e;};var e={},t=Object.prototype,i=t.hasOwnProperty,r=kv||function(e,t,i){e[t]=i.value;},n="function"==typeof Wc?Wc:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",s=n.toStringTag||"@@toStringTag";function u(e,t,i){return kv(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t];}try{u({},"");}catch(e){u=function u(e,t,i){return e[t]=i;};}function l(e,t,i,n){var o=t&&t.prototype instanceof d?t:d,a=Pv(o.prototype),s=new C(n||[]);return r(a,"_invoke",{value:b(e,i,s)}),a;}function c(e,t,i){try{return{type:"normal",arg:e.call(t,i)};}catch(e){return{type:"throw",arg:e};}}e.wrap=l;var h={};function d(){}function f(){}function v(){}var g={};u(g,o,function(){return this;});var m=Nv&&Nv(Nv(V([])));m&&m!==t&&i.call(m,o)&&(g=m);var y=v.prototype=d.prototype=Pv(g);function p(e){var t;eg(t=["next","throw","return"]).call(t,function(t){u(e,t,function(e){return this._invoke(t,e);});});}function w(e,t){function n(r,o,a,s){var u=c(e[r],e,o);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==ch(h)&&i.call(h,"__await")?t.resolve(h.__await).then(function(e){n("next",e,a,s);},function(e){n("throw",e,a,s);}):t.resolve(h).then(function(e){l.value=e,a(l);},function(e){return n("throw",e,a,s);});}s(u.arg);}var o;r(this,"_invoke",{value:function value(e,i){function r(){return new t(function(t,r){n(e,i,t,r);});}return o=o?o.then(r,r):r();}});}function b(e,t,i){var r="suspendedStart";return function(n,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===n)throw o;return T();}for(i.method=n,i.arg=o;;){var a=i.delegate;if(a){var s=k(a,i);if(s){if(s===h)continue;return s;}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===r)throw r="completed",i.arg;i.dispatchException(i.arg);}else"return"===i.method&&i.abrupt("return",i.arg);r="executing";var u=c(e,t,i);if("normal"===u.type){if(r=i.done?"completed":"suspendedYield",u.arg===h)continue;return{value:u.arg,done:i.done};}"throw"===u.type&&(r="completed",i.method="throw",i.arg=u.arg);}};}function k(e,t){var i=t.method,r=e.iterator[i];if(void 0===r)return t.delegate=null,"throw"===i&&e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method)||"return"!==i&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),h;var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,h;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h);}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t);}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t;}function C(e){this.tryEntries=[{tryLoc:"root"}],eg(e).call(e,S,this),this.reset(!0);}function V(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t;};return n.next=n;}}return{next:T};}function T(){return{value:void 0,done:!0};}return f.prototype=v,r(y,"constructor",{value:v,configurable:!0}),r(v,"constructor",{value:f,configurable:!0}),f.displayName=u(v,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name));},e.mark=function(e){return nv?nv(e,v):(e.__proto__=v,u(e,s,"GeneratorFunction")),e.prototype=Pv(y),e;},e.awrap=function(e){return{__await:e};},p(w.prototype),u(w.prototype,a,function(){return this;}),e.AsyncIterator=w,e.async=function(t,i,r,n,o){void 0===o&&(o=$w);var a=new w(l(t,i,r,n),o);return e.isGeneratorFunction(i)?a:a.next().then(function(e){return e.done?e.value:a.next();});},p(y),u(y,s,"Generator"),u(y,o,function(){return this;}),u(y,"toString",function(){return"[object Generator]";}),e.keys=function(e){var t=Object(e),i=[];for(var r in t)i.push(r);return fb(i).call(i),function e(){for(;i.length;){var r=i.pop();if(r in t)return e.value=r,e.done=!1,e;}return e.done=!0,e;};},e.values=V,C.prototype={constructor:C,reset:function reset(e){var t;if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,eg(t=this.tryEntries).call(t,x),!e)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+_d(r).call(r,1))&&(this[r]=void 0);},stop:function stop(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval;},dispatchException:function dispatchException(e){if(this.done)throw e;var t=this;function r(i,r){return a.type="throw",a.arg=e,t.next=i,r&&(t.method="next",t.arg=void 0),!!r;}for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=i.call(o,"catchLoc"),u=i.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc);}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc);}}}},abrupt:function abrupt(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break;}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(a);},complete:function complete(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h;},finish:function finish(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),x(i),h;}},catch:function _catch(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var r=i.completion;if("throw"===r.type){var n=r.arg;x(i);}return n;}}throw new Error("illegal catch attempt");},delegateYield:function delegateYield(e,t,i){return this.delegate={iterator:V(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),h;}},e;}function gb(e,t,i,r,n,o,a){try{var s=e[o](a),u=s.value;}catch(e){return void i(e);}s.done?t(u):$w.resolve(u).then(r,n);}function mb(e){return function(){var t=this,i=arguments;return new $w(function(r,n){var o=e.apply(t,i);function a(e){gb(o,r,n,a,s,"next",e);}function s(e){gb(o,r,n,a,s,"throw",e);}a(void 0);});};}function yb(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e;}function pb(e){var t;return pb=nv?qf(t=Nv).call(t):function(e){return e.__proto__||Nv(e);},pb(e);}var wb={},bb={get exports(){return wb;},set exports(e){wb=e;}},kb={},Sb={get exports(){return kb;},set exports(e){kb=e;}},xb=tt,Cb=D,Vb=J,Tb=ai,Ib=function Ib(e){return void 0!==e&&(xb(e,"value")||xb(e,"writable"));},Eb=I,Pb=al;Mi({target:"Reflect",stat:!0},{get:function e(t,i){var r,n,o=arguments.length<3?t:arguments[2];return Tb(t)===o?t[i]:(r=Eb.f(t,i))?Ib(r)?r.value:void 0===r.get?void 0:Cb(r.get,o):Vb(n=Pb(t))?e(n,i,o):void 0;}});var Bb=Q.Reflect.get;!function(e){e.exports=Bb;}(Sb),function(e){e.exports=kb;}(bb);var Db=t(wb),Mb={},zb={get exports(){return Mb;},set exports(e){Mb=e;}},Ub={},Ab={get exports(){return Ub;},set exports(e){Ub=e;}},Rb={},Lb={get exports(){return Rb;},set exports(e){Rb=e;}},Nb=Mi,Ob=a,Wb=K,Hb=I.f,Fb=E;Nb({target:"Object",stat:!0,forced:!Fb||Ob(function(){Hb(1);}),sham:!Fb},{getOwnPropertyDescriptor:function getOwnPropertyDescriptor(e,t){return Hb(Wb(e),t);}});var jb=Q.Object,Yb=Lb.exports=function(e,t){return jb.getOwnPropertyDescriptor(e,t);};jb.getOwnPropertyDescriptor.sham&&(Yb.sham=!0);var Xb=Rb;!function(e){e.exports=Xb;}(Ab),function(e){e.exports=Ub;}(zb);var qb=t(Mb);function Zb(){var e;"undefined"!=typeof Reflect&&Db?Zb=qf(e=Db).call(e):Zb=function Zb(e,t,i){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=pb(e)););return e;}(e,t);if(r){var n=qb(r,t);return n.get?n.get.call(arguments.length<3?e:i):n.value;}};return Zb.apply(this,arguments);}function _b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Pv(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),kv(e,"prototype",{writable:!1}),t&&ov(e,t);}function Gb(e,t){return ph(e)||function(e,t){var i=null==e?null:void 0!==Wc&&Bh(e)||e["@@iterator"];if(null!=i){var r,n,o,a,s=[],u=!0,l=!1;try{if(o=(i=i.call(e)).next,0===t){if(Object(i)!==i)return;u=!1;}else for(;!(u=(r=o.call(i)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){l=!0,n=e;}finally{try{if(!u&&null!=i.return&&(a=i.return(),Object(a)!==a))return;}finally{if(l)throw n;}}return s;}}(e,t)||Kd(e,t)||$d();}function Kb(e){return function(e){if(yh(e))return Gd(e);}(e)||wd(e)||Kd(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}();}var $b={},Jb={get exports(){return $b;},set exports(e){$b=e;}},Qb={},ek={get exports(){return Qb;},set exports(e){Qb=e;}},tk=Ua.filter;Mi({target:"Array",proto:!0,forced:!uo("filter")},{filter:function filter(e){return tk(this,e,arguments.length>1?arguments[1]:void 0);}});var ik=Wd("Array","filter"),rk=oe,nk=ik,ok=Array.prototype,ak=function ak(e){var t=e.filter;return e===ok||rk(ok,e)&&t===ok.filter?nk:t;},sk=ak,uk=sk;!function(e){e.exports=uk;}(ek),function(e){e.exports=Qb;}(Jb);var lk=t($b),ck={},hk={get exports(){return ck;},set exports(e){ck=e;}},dk={},fk={get exports(){return dk;},set exports(e){dk=e;}},vk=cg,gk=K,mk=I,yk=$n;Mi({target:"Object",stat:!0,sham:!E},{getOwnPropertyDescriptors:function getOwnPropertyDescriptors(e){for(var t,i,r=gk(e),n=mk.f,o=vk(r),a={},s=0;o.length>s;)void 0!==(i=n(r,t=o[s++]))&&yk(a,t,i);return a;}});var pk=Q.Object.getOwnPropertyDescriptors;!function(e){e.exports=pk;}(fk),function(e){e.exports=dk;}(hk);var wk=t(ck),bk={},kk={get exports(){return bk;},set exports(e){bk=e;}},Sk={},xk={get exports(){return Sk;},set exports(e){Sk=e;}},Ck={},Vk={get exports(){return Ck;},set exports(e){Ck=e;}},Tk=Mi,Ik=E,Ek=kr.f;Tk({target:"Object",stat:!0,forced:Object.defineProperties!==Ek,sham:!Ik},{defineProperties:Ek});var Pk=Q.Object,Bk=Vk.exports=function(e,t){return Pk.defineProperties(e,t);};Pk.defineProperties.sham&&(Bk.sham=!0);var Dk=Ck;!function(e){e.exports=Dk;}(xk),function(e){e.exports=Sk;}(kk);var Mk=t(bk),zk={},Uk={get exports(){return zk;},set exports(e){zk=e;}},Ak={},Rk={get exports(){return Ak;},set exports(e){Ak=e;}},Lk=Ho.f("toPrimitive");!function(e){e.exports=Lk;}(Rk),function(e){e.exports=Ak;}(Uk);var Nk=t(zk);function Ok(e){var t=function(e,t){if("object"!==ch(e)||null===e)return e;var i=e[Nk];if(void 0!==i){var r=i.call(e,t||"default");if("object"!==ch(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.");}return("string"===t?String:Number)(e);}(e,"string");return"symbol"===ch(t)?t:String(t);}function Wk(e,t,i){return(t=Ok(t))in e?kv(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e;}function Hk(e,t){var i=Mf(e);if(nf){var r=nf(e);t&&(r=lk(r).call(r,function(t){return qb(e,t).enumerable;})),i.push.apply(i,r);}return i;}function Fk(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?eg(i=Hk(Object(n),!0)).call(i,function(t){Wk(e,t,n[t]);}):wk?Mk(e,wk(n)):eg(r=Hk(Object(n))).call(r,function(t){kv(e,t,qb(n,t));});}return e;}function jk(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),kv(e,Ok(r.key),r);}}function Yk(e,t,i){return t&&jk(e.prototype,t),i&&jk(e,i),kv(e,"prototype",{writable:!1}),e;}function Xk(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function");}var qk={},Zk={get exports(){return qk;},set exports(e){qk=e;}};!function(e){e.exports=gh;}(Zk);var _k=t(qk),Gk={},Kk={get exports(){return Gk;},set exports(e){Gk=e;}};!function(e){e.exports=Jv;}(Kk);var $k=t(Gk),Jk={},Qk={get exports(){return Jk;},set exports(e){Jk=e;}};!function(e){e.exports=Bf;}(Qk);var eS=t(Jk),tS={},iS={get exports(){return tS;},set exports(e){tS=e;}},rS=Wd("Array","concat"),nS=oe,oS=rS,aS=Array.prototype,sS=function sS(e){var t=e.concat;return e===aS||nS(aS,e)&&t===aS.concat?oS:t;},uS=sS;!function(e){e.exports=uS;}(iS);var lS=t(tS),cS={},hS={get exports(){return cS;},set exports(e){cS=e;}};Mi({target:"Number",stat:!0},{isNaN:function isNaN(e){return e!=e;}});var dS=Q.Number.isNaN;!function(e){e.exports=dS;}(hS);var fS=t(cS),vS={},gS={get exports(){return vS;},set exports(e){vS=e;}},mS="\t\n\x0B\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF",yS=Z,pS=To,wS=mS,bS=y("".replace),kS=RegExp("^["+wS+"]+"),SS=RegExp("(^|[^"+wS+"])["+wS+"]+$"),xS=function xS(e){return function(t){var i=pS(yS(t));return 1&e&&(i=bS(i,kS,"")),2&e&&(i=bS(i,SS,"$1")),i;};},CS={start:xS(1),end:xS(2),trim:xS(3)},VS=$u.PROPER,TS=a,IS=mS,ES=CS.trim;Mi({target:"String",proto:!0,forced:function(e){return TS(function(){return!!IS[e]()||"âÂá "!=="âÂá "[e]()||VS&&IS[e].name!==e;});}("trim")},{trim:function trim(){return ES(this);}});var PS=Wd("String","trim"),BS=oe,DS=PS,MS=String.prototype,zS=function zS(e){var t=e.trim;return"string"==typeof e||e===MS||BS(MS,e)&&t===MS.trim?DS:t;},US=zS;!function(e){e.exports=US;}(gS);var AS=t(vS),RS={},LS={get exports(){return RS;},set exports(e){RS=e;}},NS=o,OS=a,WS=y,HS=To,FS=CS.trim,jS=mS,YS=NS.parseInt,XS=NS.Symbol,qS=XS&&XS.iterator,ZS=/^[+-]?0x/i,_S=WS(ZS.exec),GS=8!==YS(jS+"08")||22!==YS(jS+"0x16")||qS&&!OS(function(){YS(Object(qS));})?function(e,t){var i=FS(HS(e));return YS(i,t>>>0||(_S(ZS,i)?16:10));}:YS;Mi({global:!0,forced:parseInt!==GS},{parseInt:GS});var KS=Q.parseInt;!function(e){e.exports=KS;}(LS);var $S=t(RS),JS={},QS={get exports(){return JS;},set exports(e){JS=e;}},ex=De,tx=Je,ix=j,rx=Ar,nx=TypeError,ox="Reduce of empty array with no initial value",ax=function ax(e){return function(t,i,r,n){var o=tx(t),a=ix(o),s=rx(o);if(ex(i),0===s&&r<2)throw new nx(ox);var u=e?s-1:0,l=e?-1:1;if(r<2)for(;;){if(u in a){n=a[u],u+=l;break;}if(u+=l,e?u<0:s<=u)throw new nx(ox);}for(;e?u>=0:s>u;u+=l)u in a&&(n=i(n,a[u],u,o));return n;};},sx={left:ax(!1),right:ax(!0)}.left;Mi({target:"Array",proto:!0,forced:!gm&&ge>79&&ge<83||!cf("reduce")},{reduce:function reduce(e){var t=arguments.length;return sx(this,e,t,t>1?arguments[1]:void 0);}});var ux=Wd("Array","reduce"),lx=oe,cx=ux,hx=Array.prototype,dx=function dx(e){var t=e.reduce;return e===hx||lx(hx,e)&&t===hx.reduce?cx:t;},fx=dx;!function(e){e.exports=fx;}(QS);var vx=t(JS),gx={},mx={get exports(){return gx;},set exports(e){gx=e;}};!function(e){e.exports=sk;}(mx);var yx=t(gx),px={},wx={get exports(){return px;},set exports(e){px=e;}},bx=Mi,kx=y,Sx=Br,xx=RangeError,Cx=String.fromCharCode,Vx=String.fromCodePoint,Tx=kx([].join);bx({target:"String",stat:!0,arity:1,forced:!!Vx&&1!==Vx.length},{fromCodePoint:function fromCodePoint(e){for(var t,i=[],r=arguments.length,n=0;r>n;){if(t=+arguments[n++],Sx(t,1114111)!==t)throw new xx(t+" is not a valid code point");i[n]=t<65536?Cx(t):Cx(55296+((t-=65536)>>10),t%1024+56320);}return Tx(i,"");}});var Ix=a,Ex=He,Px=gt("iterator"),Bx=!Ix(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,i=new URLSearchParams("a=1&a=2&b=3"),r="";return e.pathname="c%20d",t.forEach(function(e,i){t.delete("b"),r+=i+e;}),i.delete("a",2),i.delete("b",void 0),!e.toJSON||!i.has("a",1)||i.has("a",2)||!i.has("a",void 0)||i.has("b")||!t.size&&Ex||!t.sort||"https://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[Px]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("https://ÑÐµÑÑ").host||"#%D0%B1"!==new URL("https://a#Ð±").hash||"a1c3"!==r||"x"!==new URL("https://x",void 0).host;}),Dx=No,Mx=function Mx(e,t,i){for(var r in t)i&&i.unsafe&&e[r]?e[r]=t[r]:Dx(e,r,t[r],i);return e;},zx=zi,Ux=Math.floor,_Ax=function Ax(e,t){var i=e.length;if(i<8)for(var r,n,o=1;o<i;){for(n=o,r=e[o];n&&t(e[n-1],r)>0;)e[n]=e[--n];n!==o++&&(e[n]=r);}else for(var a=Ux(i/2),s=_Ax(zx(e,0,a),t),u=_Ax(zx(e,a),t),l=s.length,c=u.length,h=0,d=0;h<l||d<c;)e[h+d]=h<l&&d<c?t(s[h],u[d])<=0?s[h++]:u[d++]:h<l?s[h++]:u[d++];return e;},Rx=_Ax,Lx=Mi,Nx=o,Ox=uy,Wx=ne,Hx=D,Fx=y,jx=E,Yx=Bx,Xx=No,qx=Wo,Zx=Mx,_x=ca,Gx=xl,Kx=Ta,$x=xm,Jx=T,Qx=tt,eC=ei,tC=Qi,iC=ai,rC=J,nC=To,oC=xn,aC=N,sC=$h,uC=Eh,lC=Jl,cC=Bm,hC=Rx,dC=gt("iterator"),fC="URLSearchParams",vC=fC+"Iterator",gC=Kx.set,mC=Kx.getterFor(fC),yC=Kx.getterFor(vC),pC=Ox("fetch"),wC=Ox("Request"),bC=Ox("Headers"),kC=wC&&wC.prototype,SC=bC&&bC.prototype,xC=Nx.TypeError,CC=Nx.encodeURIComponent,VC=String.fromCharCode,TC=Wx("String","fromCodePoint"),IC=parseInt,EC=Fx("".charAt),PC=Fx([].join),BC=Fx([].push),DC=Fx("".replace),MC=Fx([].shift),zC=Fx([].splice),UC=Fx("".split),AC=Fx("".slice),RC=Fx(/./.exec),LC=/\+/g,NC=/^[0-9a-f]+$/i,OC=function OC(e,t){var i=AC(e,t,t+2);return RC(NC,i)?IC(i,16):NaN;},WC=function WC(e){for(var t=0,i=128;i>0&&e&i;i>>=1)t++;return t;},HC=function HC(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3];}return t>1114111?null:t;},FC=function FC(e){for(var t=(e=DC(e,LC," ")).length,i="",r=0;r<t;){var n=EC(e,r);if("%"===n){if("%"===EC(e,r+1)||r+3>t){i+="%",r++;continue;}var o=OC(e,r+1);if(o!=o){i+=n,r++;continue;}r+=2;var a=WC(o);if(0===a)n=VC(o);else{if(1===a||a>4){i+="ï¿½",r++;continue;}for(var s=[o],u=1;u<a&&!(++r+3>t||"%"!==EC(e,r));){var l=OC(e,r+1);if(l!=l){r+=3;break;}if(l>191||l<128)break;BC(s,l),r+=2,u++;}if(s.length!==a){i+="ï¿½";continue;}var c=HC(s);null===c?i+="ï¿½":n=TC(c);}}i+=n,r++;}return i;},jC=/[!'()~]|%20/g,YC={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},XC=function XC(e){return YC[e];},qC=function qC(e){return DC(CC(e),jC,XC);},ZC=Gx(function(e,t){gC(this,{type:vC,target:mC(e).entries,index:0,kind:t});},fC,function(){var e=yC(this),t=e.target,i=e.index++;if(!t||i>=t.length)return e.target=null,lC(void 0,!0);var r=t[i];switch(e.kind){case"keys":return lC(r.key,!1);case"values":return lC(r.value,!1);}return lC([r.key,r.value],!1);},!0),_C=function _C(e){this.entries=[],this.url=null,void 0!==e&&(rC(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===EC(e,0)?AC(e,1):e:nC(e)));};_C.prototype={type:fC,bindURL:function bindURL(e){this.url=e,this.update();},parseObject:function parseObject(e){var t,i,r,n,o,a,s,u=this.entries,l=uC(e);if(l)for(i=(t=sC(e,l)).next;!(r=Hx(i,t)).done;){if(o=(n=sC(iC(r.value))).next,(a=Hx(o,n)).done||(s=Hx(o,n)).done||!Hx(o,n).done)throw new xC("Expected sequence with length 2");BC(u,{key:nC(a.value),value:nC(s.value)});}else for(var c in e)Qx(e,c)&&BC(u,{key:c,value:nC(e[c])});},parseQuery:function parseQuery(e){if(e)for(var t,i,r=this.entries,n=UC(e,"&"),o=0;o<n.length;)(t=n[o++]).length&&(i=UC(t,"="),BC(r,{key:FC(MC(i)),value:FC(PC(i,"="))}));},serialize:function serialize(){for(var e,t=this.entries,i=[],r=0;r<t.length;)e=t[r++],BC(i,qC(e.key)+"="+qC(e.value));return PC(i,"&");},update:function update(){this.entries.length=0,this.parseQuery(this.url.query);},updateURL:function updateURL(){this.url&&this.url.update();}};var GC=function GC(){$x(this,KC);var e=gC(this,new _C(arguments.length>0?arguments[0]:void 0));jx||(this.size=e.entries.length);},KC=GC.prototype;if(Zx(KC,{append:function append(e,t){var i=mC(this);cC(arguments.length,2),BC(i.entries,{key:nC(e),value:nC(t)}),jx||this.length++,i.updateURL();},delete:function _delete(e){for(var t=mC(this),i=cC(arguments.length,1),r=t.entries,n=nC(e),o=i<2?void 0:arguments[1],a=void 0===o?o:nC(o),s=0;s<r.length;){var u=r[s];if(u.key!==n||void 0!==a&&u.value!==a)s++;else if(zC(r,s,1),void 0!==a)break;}jx||(this.size=r.length),t.updateURL();},get:function get(e){var t=mC(this).entries;cC(arguments.length,1);for(var i=nC(e),r=0;r<t.length;r++)if(t[r].key===i)return t[r].value;return null;},getAll:function getAll(e){var t=mC(this).entries;cC(arguments.length,1);for(var i=nC(e),r=[],n=0;n<t.length;n++)t[n].key===i&&BC(r,t[n].value);return r;},has:function has(e){for(var t=mC(this).entries,i=cC(arguments.length,1),r=nC(e),n=i<2?void 0:arguments[1],o=void 0===n?n:nC(n),a=0;a<t.length;){var s=t[a++];if(s.key===r&&(void 0===o||s.value===o))return!0;}return!1;},set:function set(e,t){var i=mC(this);cC(arguments.length,1);for(var r,n=i.entries,o=!1,a=nC(e),s=nC(t),u=0;u<n.length;u++)(r=n[u]).key===a&&(o?zC(n,u--,1):(o=!0,r.value=s));o||BC(n,{key:a,value:s}),jx||(this.size=n.length),i.updateURL();},sort:function sort(){var e=mC(this);hC(e.entries,function(e,t){return e.key>t.key?1:-1;}),e.updateURL();},forEach:function forEach(e){for(var t,i=mC(this).entries,r=eC(e,arguments.length>1?arguments[1]:void 0),n=0;n<i.length;)r((t=i[n++]).value,t.key,this);},keys:function keys(){return new ZC(this,"keys");},values:function values(){return new ZC(this,"values");},entries:function entries(){return new ZC(this,"entries");}},{enumerable:!0}),Xx(KC,dC,KC.entries,{name:"entries"}),Xx(KC,"toString",function(){return mC(this).serialize();},{enumerable:!0}),jx&&qx(KC,"size",{get:function get(){return mC(this).entries.length;},configurable:!0,enumerable:!0}),_x(GC,fC),Lx({global:!0,constructor:!0,forced:!Yx},{URLSearchParams:GC}),!Yx&&Jx(bC)){var $C=Fx(SC.has),JC=Fx(SC.set),QC=function QC(e){if(rC(e)){var t,i=e.body;if(tC(i)===fC)return t=e.headers?new bC(e.headers):new bC(),$C(t,"content-type")||JC(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),oC(e,{body:aC(0,nC(i)),headers:aC(0,t)});}return e;};if(Jx(pC)&&Lx({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function fetch(e){return pC(e,arguments.length>1?QC(arguments[1]):{});}}),Jx(wC)){var eV=function eV(e){return $x(this,kC),new wC(e,arguments.length>1?QC(arguments[1]):{});};kC.constructor=eV,eV.prototype=kC,Lx({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:eV});}}var tV,iV={URLSearchParams:GC,getState:mC},rV=E,nV=y,oV=D,aV=a,sV=$r,uV=Ro,lV=M,cV=Je,hV=j,dV=Object.assign,fV=Object.defineProperty,vV=nV([].concat),gV=!dV||aV(function(){if(rV&&1!==dV({b:1},dV(fV({},"a",{enumerable:!0,get:function get(){fV(this,"b",{value:3,enumerable:!1});}}),{b:2})).b)return!0;var e={},t={},i=Symbol("assign detection"),r="abcdefghijklmnopqrst";return e[i]=7,r.split("").forEach(function(e){t[e]=e;}),7!==dV({},e)[i]||sV(dV({},t)).join("")!==r;})?function(e,t){for(var i=cV(e),r=arguments.length,n=1,o=uV.f,a=lV.f;r>n;)for(var s,u=hV(arguments[n++]),l=o?vV(sV(u),o(u)):sV(u),c=l.length,h=0;c>h;)s=l[h++],rV&&!oV(a,u,s)||(i[s]=u[s]);return i;}:dV,mV=y,yV=2147483647,pV=/[^\0-\u007E]/,wV=/[.\u3002\uFF0E\uFF61]/g,bV="Overflow: input needs wider integers to process",kV=RangeError,SV=mV(wV.exec),xV=Math.floor,CV=String.fromCharCode,VV=mV("".charCodeAt),TV=mV([].join),IV=mV([].push),EV=mV("".replace),PV=mV("".split),BV=mV("".toLowerCase),DV=function DV(e){return e+22+75*(e<26);},MV=function MV(e,t,i){var r=0;for(e=i?xV(e/700):e>>1,e+=xV(e/t);e>455;)e=xV(e/35),r+=36;return xV(r+36*e/(e+38));},zV=function zV(e){var t=[];e=function(e){for(var t=[],i=0,r=e.length;i<r;){var n=VV(e,i++);if(n>=55296&&n<=56319&&i<r){var o=VV(e,i++);56320==(64512&o)?IV(t,((1023&n)<<10)+(1023&o)+65536):(IV(t,n),i--);}else IV(t,n);}return t;}(e);var i,r,n=e.length,o=128,a=0,s=72;for(i=0;i<e.length;i++)(r=e[i])<128&&IV(t,CV(r));var u=t.length,l=u;for(u&&IV(t,"-");l<n;){var c=yV;for(i=0;i<e.length;i++)(r=e[i])>=o&&r<c&&(c=r);var h=l+1;if(c-o>xV((yV-a)/h))throw new kV(bV);for(a+=(c-o)*h,o=c,i=0;i<e.length;i++){if((r=e[i])<o&&++a>yV)throw new kV(bV);if(r===o){for(var d=a,f=36;;){var v=f<=s?1:f>=s+26?26:f-s;if(d<v)break;var g=d-v,m=36-v;IV(t,CV(DV(v+g%m))),d=xV(g/m),f+=36;}IV(t,CV(DV(d))),s=MV(a,h,l===u),a=0,l++;}}a++,o++;}return TV(t,"");},UV=Mi,AV=E,RV=Bx,LV=o,NV=ei,OV=y,WV=No,HV=Wo,FV=xm,jV=tt,YV=gV,XV=ld,qV=zi,ZV=Qc.codeAt,_V=function _V(e){var t,i,r=[],n=PV(EV(BV(e),wV,"."),".");for(t=0;t<n.length;t++)i=n[t],IV(r,SV(pV,i)?"xn--"+zV(i):i);return TV(r,".");},GV=To,KV=ca,$V=Bm,JV=iV,QV=Ta,eT=QV.set,tT=QV.getterFor("URL"),iT=JV.URLSearchParams,rT=JV.getState,nT=LV.URL,oT=LV.TypeError,aT=LV.parseInt,sT=Math.floor,uT=Math.pow,lT=OV("".charAt),cT=OV(/./.exec),hT=OV([].join),dT=OV(1..toString),fT=OV([].pop),vT=OV([].push),gT=OV("".replace),mT=OV([].shift),yT=OV("".split),pT=OV("".slice),wT=OV("".toLowerCase),bT=OV([].unshift),kT="Invalid scheme",ST="Invalid host",xT="Invalid port",CT=/[a-z]/i,VT=/[\d+-.a-z]/i,TT=/\d/,IT=/^0x/i,ET=/^[0-7]+$/,PT=/^\d+$/,BT=/^[\da-f]+$/i,DT=/[\0\t\n\r #%/:<>?@[\\\]^|]/,MT=/[\0\t\n\r #/:<>?@[\\\]^|]/,zT=/^[\u0000-\u0020]+/,UT=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,AT=/[\t\n\r]/g,RT=function RT(e){var t,i,r,n;if("number"==typeof e){for(t=[],i=0;i<4;i++)bT(t,e%256),e=sT(e/256);return hT(t,".");}if("object"==_typeof(e)){for(t="",r=function(e){for(var t=null,i=1,r=null,n=0,o=0;o<8;o++)0!==e[o]?(n>i&&(t=r,i=n),r=null,n=0):(null===r&&(r=o),++n);return n>i?r:t;}(e),i=0;i<8;i++)n&&0===e[i]||(n&&(n=!1),r===i?(t+=i?":":"::",n=!0):(t+=dT(e[i],16),i<7&&(t+=":")));return"["+t+"]";}return e;},LT={},NT=YV({},LT,{" ":1,'"':1,"<":1,">":1,"`":1}),OT=YV({},NT,{"#":1,"?":1,"{":1,"}":1}),WT=YV({},OT,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),HT=function HT(e,t){var i=ZV(e,0);return i>32&&i<127&&!jV(t,e)?e:encodeURIComponent(e);},FT={ftp:21,file:null,http:80,https:443,ws:80,wss:443},jT=function jT(e,t){var i;return 2===e.length&&cT(CT,lT(e,0))&&(":"===(i=lT(e,1))||!t&&"|"===i);},YT=function YT(e){var t;return e.length>1&&jT(pT(e,0,2))&&(2===e.length||"/"===(t=lT(e,2))||"\\"===t||"?"===t||"#"===t);},XT=function XT(e){return"."===e||"%2e"===wT(e);},qT={},ZT={},_T={},GT={},KT={},$T={},JT={},QT={},eI={},tI={},iI={},rI={},nI={},oI={},aI={},sI={},uI={},lI={},cI={},hI={},dI={},_fI=function fI(e,t,i){var r,n,o,a=GV(e);if(t){if(n=this.parse(a))throw new oT(n);this.searchParams=null;}else{if(void 0!==i&&(r=new _fI(i,!0)),n=this.parse(a,null,r))throw new oT(n);(o=rT(new iT())).bindURL(this),this.searchParams=o;}};_fI.prototype={type:"URL",parse:function parse(e,t,i){var r,n,o,a,s,u=this,l=t||qT,c=0,h="",d=!1,f=!1,v=!1;for(e=GV(e),t||(u.scheme="",u.username="",u.password="",u.host=null,u.port=null,u.path=[],u.query=null,u.fragment=null,u.cannotBeABaseURL=!1,e=gT(e,zT,""),e=gT(e,UT,"$1")),e=gT(e,AT,""),r=XV(e);c<=r.length;){switch(n=r[c],l){case qT:if(!n||!cT(CT,n)){if(t)return kT;l=_T;continue;}h+=wT(n),l=ZT;break;case ZT:if(n&&(cT(VT,n)||"+"===n||"-"===n||"."===n))h+=wT(n);else{if(":"!==n){if(t)return kT;h="",l=_T,c=0;continue;}if(t&&(u.isSpecial()!==jV(FT,h)||"file"===h&&(u.includesCredentials()||null!==u.port)||"file"===u.scheme&&!u.host))return;if(u.scheme=h,t)return void(u.isSpecial()&&FT[u.scheme]===u.port&&(u.port=null));h="","file"===u.scheme?l=oI:u.isSpecial()&&i&&i.scheme===u.scheme?l=GT:u.isSpecial()?l=QT:"/"===r[c+1]?(l=KT,c++):(u.cannotBeABaseURL=!0,vT(u.path,""),l=cI);}break;case _T:if(!i||i.cannotBeABaseURL&&"#"!==n)return kT;if(i.cannotBeABaseURL&&"#"===n){u.scheme=i.scheme,u.path=qV(i.path),u.query=i.query,u.fragment="",u.cannotBeABaseURL=!0,l=dI;break;}l="file"===i.scheme?oI:$T;continue;case GT:if("/"!==n||"/"!==r[c+1]){l=$T;continue;}l=eI,c++;break;case KT:if("/"===n){l=tI;break;}l=lI;continue;case $T:if(u.scheme=i.scheme,n===tV)u.username=i.username,u.password=i.password,u.host=i.host,u.port=i.port,u.path=qV(i.path),u.query=i.query;else if("/"===n||"\\"===n&&u.isSpecial())l=JT;else if("?"===n)u.username=i.username,u.password=i.password,u.host=i.host,u.port=i.port,u.path=qV(i.path),u.query="",l=hI;else{if("#"!==n){u.username=i.username,u.password=i.password,u.host=i.host,u.port=i.port,u.path=qV(i.path),u.path.length--,l=lI;continue;}u.username=i.username,u.password=i.password,u.host=i.host,u.port=i.port,u.path=qV(i.path),u.query=i.query,u.fragment="",l=dI;}break;case JT:if(!u.isSpecial()||"/"!==n&&"\\"!==n){if("/"!==n){u.username=i.username,u.password=i.password,u.host=i.host,u.port=i.port,l=lI;continue;}l=tI;}else l=eI;break;case QT:if(l=eI,"/"!==n||"/"!==lT(h,c+1))continue;c++;break;case eI:if("/"!==n&&"\\"!==n){l=tI;continue;}break;case tI:if("@"===n){d&&(h="%40"+h),d=!0,o=XV(h);for(var g=0;g<o.length;g++){var m=o[g];if(":"!==m||v){var y=HT(m,WT);v?u.password+=y:u.username+=y;}else v=!0;}h="";}else if(n===tV||"/"===n||"?"===n||"#"===n||"\\"===n&&u.isSpecial()){if(d&&""===h)return"Invalid authority";c-=XV(h).length+1,h="",l=iI;}else h+=n;break;case iI:case rI:if(t&&"file"===u.scheme){l=sI;continue;}if(":"!==n||f){if(n===tV||"/"===n||"?"===n||"#"===n||"\\"===n&&u.isSpecial()){if(u.isSpecial()&&""===h)return ST;if(t&&""===h&&(u.includesCredentials()||null!==u.port))return;if(a=u.parseHost(h))return a;if(h="",l=uI,t)return;continue;}"["===n?f=!0:"]"===n&&(f=!1),h+=n;}else{if(""===h)return ST;if(a=u.parseHost(h))return a;if(h="",l=nI,t===rI)return;}break;case nI:if(!cT(TT,n)){if(n===tV||"/"===n||"?"===n||"#"===n||"\\"===n&&u.isSpecial()||t){if(""!==h){var p=aT(h,10);if(p>65535)return xT;u.port=u.isSpecial()&&p===FT[u.scheme]?null:p,h="";}if(t)return;l=uI;continue;}return xT;}h+=n;break;case oI:if(u.scheme="file","/"===n||"\\"===n)l=aI;else{if(!i||"file"!==i.scheme){l=lI;continue;}switch(n){case tV:u.host=i.host,u.path=qV(i.path),u.query=i.query;break;case"?":u.host=i.host,u.path=qV(i.path),u.query="",l=hI;break;case"#":u.host=i.host,u.path=qV(i.path),u.query=i.query,u.fragment="",l=dI;break;default:YT(hT(qV(r,c),""))||(u.host=i.host,u.path=qV(i.path),u.shortenPath()),l=lI;continue;}}break;case aI:if("/"===n||"\\"===n){l=sI;break;}i&&"file"===i.scheme&&!YT(hT(qV(r,c),""))&&(jT(i.path[0],!0)?vT(u.path,i.path[0]):u.host=i.host),l=lI;continue;case sI:if(n===tV||"/"===n||"\\"===n||"?"===n||"#"===n){if(!t&&jT(h))l=lI;else if(""===h){if(u.host="",t)return;l=uI;}else{if(a=u.parseHost(h))return a;if("localhost"===u.host&&(u.host=""),t)return;h="",l=uI;}continue;}h+=n;break;case uI:if(u.isSpecial()){if(l=lI,"/"!==n&&"\\"!==n)continue;}else if(t||"?"!==n){if(t||"#"!==n){if(n!==tV&&(l=lI,"/"!==n))continue;}else u.fragment="",l=dI;}else u.query="",l=hI;break;case lI:if(n===tV||"/"===n||"\\"===n&&u.isSpecial()||!t&&("?"===n||"#"===n)){if(".."===(s=wT(s=h))||"%2e."===s||".%2e"===s||"%2e%2e"===s?(u.shortenPath(),"/"===n||"\\"===n&&u.isSpecial()||vT(u.path,"")):XT(h)?"/"===n||"\\"===n&&u.isSpecial()||vT(u.path,""):("file"===u.scheme&&!u.path.length&&jT(h)&&(u.host&&(u.host=""),h=lT(h,0)+":"),vT(u.path,h)),h="","file"===u.scheme&&(n===tV||"?"===n||"#"===n))for(;u.path.length>1&&""===u.path[0];)mT(u.path);"?"===n?(u.query="",l=hI):"#"===n&&(u.fragment="",l=dI);}else h+=HT(n,OT);break;case cI:"?"===n?(u.query="",l=hI):"#"===n?(u.fragment="",l=dI):n!==tV&&(u.path[0]+=HT(n,LT));break;case hI:t||"#"!==n?n!==tV&&("'"===n&&u.isSpecial()?u.query+="%27":u.query+="#"===n?"%23":HT(n,LT)):(u.fragment="",l=dI);break;case dI:n!==tV&&(u.fragment+=HT(n,NT));}c++;}},parseHost:function parseHost(e){var t,i,r;if("["===lT(e,0)){if("]"!==lT(e,e.length-1))return ST;if(t=function(e){var t,i,r,n,o,a,s,u=[0,0,0,0,0,0,0,0],l=0,c=null,h=0,d=function d(){return lT(e,h);};if(":"===d()){if(":"!==lT(e,1))return;h+=2,c=++l;}for(;d();){if(8===l)return;if(":"!==d()){for(t=i=0;i<4&&cT(BT,d());)t=16*t+aT(d(),16),h++,i++;if("."===d()){if(0===i)return;if(h-=i,l>6)return;for(r=0;d();){if(n=null,r>0){if(!("."===d()&&r<4))return;h++;}if(!cT(TT,d()))return;for(;cT(TT,d());){if(o=aT(d(),10),null===n)n=o;else{if(0===n)return;n=10*n+o;}if(n>255)return;h++;}u[l]=256*u[l]+n,2!=++r&&4!==r||l++;}if(4!==r)return;break;}if(":"===d()){if(h++,!d())return;}else if(d())return;u[l++]=t;}else{if(null!==c)return;h++,c=++l;}}if(null!==c)for(a=l-c,l=7;0!==l&&a>0;)s=u[l],u[l--]=u[c+a-1],u[c+--a]=s;else if(8!==l)return;return u;}(pT(e,1,-1)),!t)return ST;this.host=t;}else if(this.isSpecial()){if(e=_V(e),cT(DT,e))return ST;if(t=function(e){var t,i,r,n,o,a,s,u=yT(e,".");if(u.length&&""===u[u.length-1]&&u.length--,(t=u.length)>4)return e;for(i=[],r=0;r<t;r++){if(""===(n=u[r]))return e;if(o=10,n.length>1&&"0"===lT(n,0)&&(o=cT(IT,n)?16:8,n=pT(n,8===o?1:2)),""===n)a=0;else{if(!cT(10===o?PT:8===o?ET:BT,n))return e;a=aT(n,o);}vT(i,a);}for(r=0;r<t;r++)if(a=i[r],r===t-1){if(a>=uT(256,5-t))return null;}else if(a>255)return null;for(s=fT(i),r=0;r<i.length;r++)s+=i[r]*uT(256,3-r);return s;}(e),null===t)return ST;this.host=t;}else{if(cT(MT,e))return ST;for(t="",i=XV(e),r=0;r<i.length;r++)t+=HT(i[r],LT);this.host=t;}},cannotHaveUsernamePasswordPort:function cannotHaveUsernamePasswordPort(){return!this.host||this.cannotBeABaseURL||"file"===this.scheme;},includesCredentials:function includesCredentials(){return""!==this.username||""!==this.password;},isSpecial:function isSpecial(){return jV(FT,this.scheme);},shortenPath:function shortenPath(){var e=this.path,t=e.length;!t||"file"===this.scheme&&1===t&&jT(e[0],!0)||e.length--;},serialize:function serialize(){var e=this,t=e.scheme,i=e.username,r=e.password,n=e.host,o=e.port,a=e.path,s=e.query,u=e.fragment,l=t+":";return null!==n?(l+="//",e.includesCredentials()&&(l+=i+(r?":"+r:"")+"@"),l+=RT(n),null!==o&&(l+=":"+o)):"file"===t&&(l+="//"),l+=e.cannotBeABaseURL?a[0]:a.length?"/"+hT(a,"/"):"",null!==s&&(l+="?"+s),null!==u&&(l+="#"+u),l;},setHref:function setHref(e){var t=this.parse(e);if(t)throw new oT(t);this.searchParams.update();},getOrigin:function getOrigin(){var e=this.scheme,t=this.port;if("blob"===e)try{return new vI(e.path[0]).origin;}catch(e){return"null";}return"file"!==e&&this.isSpecial()?e+"://"+RT(this.host)+(null!==t?":"+t:""):"null";},getProtocol:function getProtocol(){return this.scheme+":";},setProtocol:function setProtocol(e){this.parse(GV(e)+":",qT);},getUsername:function getUsername(){return this.username;},setUsername:function setUsername(e){var t=XV(GV(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<t.length;i++)this.username+=HT(t[i],WT);}},getPassword:function getPassword(){return this.password;},setPassword:function setPassword(e){var t=XV(GV(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<t.length;i++)this.password+=HT(t[i],WT);}},getHost:function getHost(){var e=this.host,t=this.port;return null===e?"":null===t?RT(e):RT(e)+":"+t;},setHost:function setHost(e){this.cannotBeABaseURL||this.parse(e,iI);},getHostname:function getHostname(){var e=this.host;return null===e?"":RT(e);},setHostname:function setHostname(e){this.cannotBeABaseURL||this.parse(e,rI);},getPort:function getPort(){var e=this.port;return null===e?"":GV(e);},setPort:function setPort(e){this.cannotHaveUsernamePasswordPort()||(""===(e=GV(e))?this.port=null:this.parse(e,nI));},getPathname:function getPathname(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+hT(e,"/"):"";},setPathname:function setPathname(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,uI));},getSearch:function getSearch(){var e=this.query;return e?"?"+e:"";},setSearch:function setSearch(e){""===(e=GV(e))?this.query=null:("?"===lT(e,0)&&(e=pT(e,1)),this.query="",this.parse(e,hI)),this.searchParams.update();},getSearchParams:function getSearchParams(){return this.searchParams.facade;},getHash:function getHash(){var e=this.fragment;return e?"#"+e:"";},setHash:function setHash(e){""!==(e=GV(e))?("#"===lT(e,0)&&(e=pT(e,1)),this.fragment="",this.parse(e,dI)):this.fragment=null;},update:function update(){this.query=this.searchParams.serialize()||null;}};var vI=function vI(e){var t=FV(this,gI),i=$V(arguments.length,1)>1?arguments[1]:void 0,r=eT(t,new _fI(e,!1,i));AV||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash());},gI=vI.prototype,mI=function mI(e,t){return{get:function get(){return tT(this)[e]();},set:t&&function(e){return tT(this)[t](e);},configurable:!0,enumerable:!0};};if(AV&&(HV(gI,"href",mI("serialize","setHref")),HV(gI,"origin",mI("getOrigin")),HV(gI,"protocol",mI("getProtocol","setProtocol")),HV(gI,"username",mI("getUsername","setUsername")),HV(gI,"password",mI("getPassword","setPassword")),HV(gI,"host",mI("getHost","setHost")),HV(gI,"hostname",mI("getHostname","setHostname")),HV(gI,"port",mI("getPort","setPort")),HV(gI,"pathname",mI("getPathname","setPathname")),HV(gI,"search",mI("getSearch","setSearch")),HV(gI,"searchParams",mI("getSearchParams")),HV(gI,"hash",mI("getHash","setHash"))),WV(gI,"toJSON",function(){return tT(this).serialize();},{enumerable:!0}),WV(gI,"toString",function(){return tT(this).serialize();},{enumerable:!0}),nT){var yI=nT.createObjectURL,pI=nT.revokeObjectURL;yI&&WV(vI,"createObjectURL",NV(yI,nT)),pI&&WV(vI,"revokeObjectURL",NV(pI,nT));}KV(vI,"URL"),UV({global:!0,constructor:!0,forced:!RV,sham:!AV},{URL:vI});var wI=Mi,bI=a,kI=Bm,SI=To,xI=Bx,CI=ne("URL"),VI=xI&&bI(function(){CI.canParse();}),TI=bI(function(){return 1!==CI.canParse.length;});wI({target:"URL",stat:!0,forced:!VI||TI},{canParse:function canParse(e){var t=kI(arguments.length,1),i=SI(e),r=t<2||void 0===arguments[1]?void 0:SI(arguments[1]);try{return!!new CI(i,r);}catch(e){return!1;}}});var II=Mi,EI=Bm,PI=To,BI=Bx,DI=ne("URL");II({target:"URL",stat:!0,forced:!BI},{parse:function parse(e){var t=EI(arguments.length,1),i=PI(e),r=t<2||void 0===arguments[1]?void 0:PI(arguments[1]);try{return new DI(i,r);}catch(e){return null;}}});var MI=Q.URL;!function(e){e.exports=MI;}(wx);var zI=t(px),UI={},AI={get exports(){return UI;},set exports(e){UI=e;}};!function(e){e.exports=qd;}(AI);var RI=t(UI),LI={},NI={get exports(){return LI;},set exports(e){LI=e;}};!function(e){e.exports=kf;}(NI);var OI=t(LI),WI={},HI={get exports(){return WI;},set exports(e){WI=e;}},FI=E,jI=Xn,YI=TypeError,XI=Object.getOwnPropertyDescriptor,qI=FI&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1;}catch(e){return e instanceof TypeError;}}()?function(e,t){if(jI(e)&&!XI(e,"length").writable)throw new YI("Cannot set read only .length");return e.length=t;}:function(e,t){return e.length=t;},ZI=Ie,_I=TypeError,GI=function GI(e,t){if(!delete e[t])throw new _I("Cannot delete property "+ZI(t)+" of "+ZI(e));},KI=Mi,$I=Je,JI=Br,QI=Tr,eE=Ar,tE=qI,iE=Zn,rE=no,nE=$n,oE=GI,aE=uo("splice"),sE=Math.max,uE=Math.min;KI({target:"Array",proto:!0,forced:!aE},{splice:function splice(e,t){var i,r,n,o,a,s,u=$I(this),l=eE(u),c=JI(e,l),h=arguments.length;for(0===h?i=r=0:1===h?(i=0,r=l-c):(i=h-2,r=uE(sE(QI(t),0),l-c)),iE(l+i-r),n=rE(u,r),o=0;o<r;o++)(a=c+o)in u&&nE(n,o,u[a]);if(n.length=r,i<r){for(o=c;o<l-r;o++)s=o+i,(a=o+r)in u?u[s]=u[a]:oE(u,s);for(o=l;o>l-r+i;o--)oE(u,o-1);}else if(i>r)for(o=l-r;o>c;o--)s=o+i-1,(a=o+r-1)in u?u[s]=u[a]:oE(u,s);for(o=0;o<i;o++)u[o+c]=arguments[o+2];return tE(u,l-r+i),n;}});var lE=Wd("Array","splice"),cE=oe,hE=lE,dE=Array.prototype,fE=function fE(e){var t=e.splice;return e===dE||cE(dE,e)&&t===dE.splice?hE:t;},vE=fE;!function(e){e.exports=vE;}(HI);var gE=t(WI),mE={},yE={get exports(){return mE;},set exports(e){mE=e;}},pE=Mi,wE=Ua.findIndex,bE="findIndex",kE=!0;bE in[]&&Array(1)[bE](function(){kE=!1;}),pE({target:"Array",proto:!0,forced:kE},{findIndex:function findIndex(e){return wE(this,e,arguments.length>1?arguments[1]:void 0);}});var SE=Wd("Array","findIndex"),xE=oe,CE=SE,VE=Array.prototype,TE=function TE(e){var t=e.findIndex;return e===VE||xE(VE,e)&&t===VE.findIndex?CE:t;},IE=TE;!function(e){e.exports=IE;}(yE);var EE=t(mE),PE={},BE={get exports(){return PE;},set exports(e){PE=e;}},DE=Mi,ME=Math.hypot,zE=Math.abs,UE=Math.sqrt;DE({target:"Math",stat:!0,arity:2,forced:!!ME&&ME(1/0,NaN)!==1/0},{hypot:function hypot(e,t){for(var i,r,n=0,o=0,a=arguments.length,s=0;o<a;)s<(i=zE(arguments[o++]))?(n=n*(r=s/i)*r+1,s=i):n+=i>0?(r=i/s)*r:i;return s===1/0?1/0:s*UE(n);}});var AE=Q.Math.hypot;!function(e){e.exports=AE;}(BE);var RE=t(PE),LE={},NE={get exports(){return LE;},set exports(e){LE=e;}},OE=Math.sign||function(e){var t=+e;return 0===t||t!=t?t:t<0?-1:1;};Mi({target:"Math",stat:!0},{sign:OE});var WE=Q.Math.sign;!function(e){e.exports=WE;}(NE);var HE=t(LE),FE={},jE={get exports(){return FE;},set exports(e){FE=e;}},YE=Ua.map;Mi({target:"Array",proto:!0,forced:!uo("map")},{map:function map(e){return YE(this,e,arguments.length>1?arguments[1]:void 0);}});var XE=Wd("Array","map"),qE=oe,ZE=XE,_E=Array.prototype,GE=function GE(e){var t=e.map;return e===_E||qE(_E,e)&&t===_E.map?ZE:t;},KE=GE;!function(e){e.exports=KE;}(jE);var $E=t(FE),JE={},QE={get exports(){return JE;},set exports(e){JE=e;}},eP=Je,tP=Br,iP=Ar,rP=function rP(e){for(var t=eP(this),i=iP(t),r=arguments.length,n=tP(r>1?arguments[1]:void 0,i),o=r>2?arguments[2]:void 0,a=void 0===o?i:tP(o,i);a>n;)t[n++]=e;return t;};Mi({target:"Array",proto:!0},{fill:rP});var nP=Wd("Array","fill"),oP=oe,aP=nP,sP=Array.prototype,uP=function uP(e){var t=e.fill;return e===sP||oP(sP,e)&&t===sP.fill?aP:t;},lP=uP;!function(e){e.exports=lP;}(QE);var cP=t(JE),hP={},dP={get exports(){return hP;},set exports(e){hP=e;}},fP=Mi,vP=Ua.find,gP="find",mP=!0;gP in[]&&Array(1)[gP](function(){mP=!1;}),fP({target:"Array",proto:!0,forced:mP},{find:function find(e){return vP(this,e,arguments.length>1?arguments[1]:void 0);}});var yP=Wd("Array","find"),pP=oe,wP=yP,bP=Array.prototype,kP=function kP(e){var t=e.find;return e===bP||pP(bP,e)&&t===bP.find?wP:t;},SP=kP;!function(e){e.exports=SP;}(dP);var xP=t(hP),CP={},VP={get exports(){return CP;},set exports(e){CP=e;}},TP=o,IP=d,EP=T,PP=vm,BP=ue,DP=zi,MP=Bm,zP=TP.Function,UP=/MSIE .\./.test(BP)||"BUN"===PP&&function(){var e=TP.Bun.version.split(".");return e.length<3||"0"===e[0]&&(e[1]<3||"3"===e[1]&&"0"===e[2]);}(),AP=function AP(e,t){var i=t?2:1;return UP?function(r,n){var o=MP(arguments.length,1)>i,a=EP(r)?r:zP(r),s=o?DP(arguments,i):[],u=o?function(){IP(a,this,s);}:a;return t?e(u,n):e(u);}:e;},RP=Mi,LP=o,NP=AP(LP.setInterval,!0);RP({global:!0,bind:!0,forced:LP.setInterval!==NP},{setInterval:NP});var OP=Mi,WP=o,HP=AP(WP.setTimeout,!0);OP({global:!0,bind:!0,forced:WP.setTimeout!==HP},{setTimeout:HP});var FP=Q.setTimeout;!function(e){e.exports=FP;}(VP);var jP=t(CP),YP={},XP={get exports(){return YP;},set exports(e){YP=e;}},qP=E,ZP=a,_P=y,GP=al,KP=$r,$P=K,JP=_P(M.f),QP=_P([].push),eB=qP&&ZP(function(){var e=Object.create(null);return e[2]=2,!JP(e,2);}),tB=function tB(e){return function(t){for(var i,r=$P(t),n=KP(r),o=eB&&null===GP(r),a=n.length,s=0,u=[];a>s;)i=n[s++],qP&&!(o?i in r:JP(r,i))||QP(u,e?[i,r[i]]:r[i]);return u;};},iB={entries:tB(!0),values:tB(!1)},rB=iB.entries;Mi({target:"Object",stat:!0},{entries:function entries(e){return rB(e);}});var nB=Q.Object.entries;!function(e){e.exports=nB;}(XP);var oB=t(YP),aB={},sB={get exports(){return aB;},set exports(e){aB=e;}};!function(e){e.exports=Gw;}(sB);var uB=t(aB),lB={},cB={get exports(){return lB;},set exports(e){lB=e;}},hB=Wr.includes;Mi({target:"Array",proto:!0,forced:a(function(){return!Array(1).includes();})},{includes:function includes(e){return hB(this,e,arguments.length>1?arguments[1]:void 0);}});var dB=Wd("Array","includes"),fB=J,vB=k,gB=gt("match"),mB=function mB(e){var t;return fB(e)&&(void 0!==(t=e[gB])?!!t:"RegExp"===vB(e));},yB=TypeError,pB=function pB(e){if(mB(e))throw new yB("The method doesn't accept regular expressions");return e;},wB=gt("match"),bB=function bB(e){var t=/./;try{"/./"[e](t);}catch(i){try{return t[wB]=!1,"/./"[e](t);}catch(e){}}return!1;},kB=Mi,SB=pB,xB=Z,CB=To,VB=bB,TB=y("".indexOf);kB({target:"String",proto:!0,forced:!VB("includes")},{includes:function includes(e){return!!~TB(CB(xB(this)),CB(SB(e)),arguments.length>1?arguments[1]:void 0);}});var IB=Wd("String","includes"),EB=oe,PB=dB,BB=IB,DB=Array.prototype,MB=String.prototype,zB=function zB(e){var t=e.includes;return e===DB||EB(DB,e)&&t===DB.includes?PB:"string"==typeof e||e===MB||EB(MB,e)&&t===MB.includes?BB:t;},UB=zB;!function(e){e.exports=UB;}(cB);var AB=t(lB),RB={},LB={get exports(){return RB;},set exports(e){RB=e;}};!function(e){e.exports=md;}(LB);var NB=t(RB),OB={},WB={get exports(){return OB;},set exports(e){OB=e;}},HB=Wd("Array","keys"),FB=Qi,jB=tt,YB=oe,XB=HB,qB=Array.prototype,ZB={DOMTokenList:!0,NodeList:!0},_B=function _B(e){var t=e.keys;return e===qB||YB(qB,e)&&t===qB.keys||jB(ZB,FB(e))?XB:t;};!function(e){e.exports=_B;}(WB);var GB=t(OB),KB={},$B={get exports(){return KB;},set exports(e){KB=e;}},JB={},QB={get exports(){return JB;},set exports(e){JB=e;}},eD=a(function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8});}}),tD=a,iD=J,rD=k,nD=eD,oD=Object.isExtensible,aD=tD(function(){oD(1);})||nD?function(e){return!!iD(e)&&(!nD||"ArrayBuffer"!==rD(e))&&(!oD||oD(e));}:oD,sD=!a(function(){return Object.isExtensible(Object.preventExtensions({}));}),uD=Mi,lD=y,cD=Hr,hD=J,dD=tt,fD=ti.f,vD=Io,gD=Bo,mD=aD,yD=sD,pD=!1,wD=at("meta"),bD=0,kD=function kD(e){fD(e,wD,{value:{objectID:"O"+bD++,weakData:{}}});},SD=QB.exports={enable:function enable(){SD.enable=function(){},pD=!0;var e=vD.f,t=lD([].splice),i={};i[wD]=1,e(i).length&&(vD.f=function(i){for(var r=e(i),n=0,o=r.length;n<o;n++)if(r[n]===wD){t(r,n,1);break;}return r;},uD({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:gD.f}));},fastKey:function fastKey(e,t){if(!hD(e))return"symbol"==_typeof(e)?e:("string"==typeof e?"S":"P")+e;if(!dD(e,wD)){if(!mD(e))return"F";if(!t)return"E";kD(e);}return e[wD].objectID;},getWeakData:function getWeakData(e,t){if(!dD(e,wD)){if(!mD(e))return!0;if(!t)return!1;kD(e);}return e[wD].weakData;},onFreeze:function onFreeze(e){return yD&&pD&&mD(e)&&!dD(e,wD)&&kD(e),e;}};cD[wD]=!0;var xD=Mi,CD=o,VD=JB,TD=a,ID=bi,ED=Hg,PD=xm,BD=T,DD=J,MD=Y,zD=ca,UD=ti.f,AD=Ua.forEach,RD=E,LD=Ta.set,ND=Ta.getterFor,OD=xn,WD=Wo,HD=Mx,FD=ei,jD=xm,YD=Y,XD=Hg,qD=$l,ZD=Jl,_D=bm,GD=E,KD=JB.fastKey,$D=Ta.set,JD=Ta.getterFor,QD={getConstructor:function getConstructor(e,t,i,r){var n=e(function(e,n){jD(e,o),$D(e,{type:t,index:OD(null),first:null,last:null,size:0}),GD||(e.size=0),YD(n)||XD(n,e[r],{that:e,AS_ENTRIES:i});}),o=n.prototype,a=JD(t),s=function s(e,t,i){var r,n,o=a(e),s=u(e,t);return s?s.value=i:(o.last=s={index:n=KD(t,!0),key:t,value:i,previous:r=o.last,next:null,removed:!1},o.first||(o.first=s),r&&(r.next=s),GD?o.size++:e.size++,"F"!==n&&(o.index[n]=s)),e;},u=function u(e,t){var i,r=a(e),n=KD(t);if("F"!==n)return r.index[n];for(i=r.first;i;i=i.next)if(i.key===t)return i;};return HD(o,{clear:function clear(){for(var e=a(this),t=e.first;t;)t.removed=!0,t.previous&&(t.previous=t.previous.next=null),t=t.next;e.first=e.last=null,e.index=OD(null),GD?e.size=0:this.size=0;},delete:function _delete(e){var t=this,i=a(t),r=u(t,e);if(r){var n=r.next,o=r.previous;delete i.index[r.index],r.removed=!0,o&&(o.next=n),n&&(n.previous=o),i.first===r&&(i.first=n),i.last===r&&(i.last=o),GD?i.size--:t.size--;}return!!r;},forEach:function forEach(e){for(var t,i=a(this),r=FD(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:i.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous;},has:function has(e){return!!u(this,e);}}),HD(o,i?{get:function get(e){var t=u(this,e);return t&&t.value;},set:function set(e,t){return s(this,0===e?0:e,t);}}:{add:function add(e){return s(this,e=0===e?0:e,e);}}),GD&&WD(o,"size",{configurable:!0,get:function get(){return a(this).size;}}),n;},setStrong:function setStrong(e,t,i){var r=t+" Iterator",n=JD(t),o=JD(r);qD(e,t,function(e,t){$D(this,{type:r,target:e,state:n(e),kind:t,last:null});},function(){for(var e=o(this),t=e.kind,i=e.last;i&&i.removed;)i=i.previous;return e.target&&(e.last=i=i?i.next:e.state.first)?ZD("keys"===t?i.key:"values"===t?i.value:[i.key,i.value],!1):(e.target=null,ZD(void 0,!0));},i?"entries":"values",!i,!0),_D(t);}},eM=function eM(e,t,i){var r,n=-1!==e.indexOf("Map"),o=-1!==e.indexOf("Weak"),a=n?"set":"add",s=CD[e],u=s&&s.prototype,l={};if(RD&&BD(s)&&(o||u.forEach&&!TD(function(){new s().entries().next();}))){var c=(r=t(function(t,i){LD(PD(t,c),{type:e,collection:new s()}),MD(i)||ED(i,t[a],{that:t,AS_ENTRIES:n});})).prototype,h=ND(e);AD(["add","clear","delete","forEach","get","has","set","keys","values","entries"],function(e){var t="add"===e||"set"===e;!(e in u)||o&&"clear"===e||ID(c,e,function(i,r){var n=h(this).collection;if(!t&&o&&!DD(i))return"get"===e&&void 0;var a=n[e](0===i?0:i,r);return t?this:a;});}),o||UD(c,"size",{configurable:!0,get:function get(){return h(this).collection.size;}});}else r=i.getConstructor(t,e,n,a),VD.enable();return zD(r,e,!1,!0),l[e]=r,xD({global:!0,forced:!0},l),o||i.setStrong(r,e,n),r;};eM("Set",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0);};},QD);var tM=Ie,iM=TypeError,rM=function rM(e){if("object"==_typeof(e)&&"size"in e&&"has"in e&&"add"in e&&"delete"in e&&"keys"in e)return e;throw new iM(tM(e)+" is not a set");},nM=function nM(e,t){return 1===t?function(t,i){return t[e](i);}:function(t,i,r){return t[e](i,r);};},oM=ne("Set"),aM=oM.prototype,sM={Set:oM,add:nM("add",1),has:nM("has",1),remove:nM("delete",1),proto:aM},uM=D,lM=function lM(e,t,i){for(var r,n,o=i?e:e.iterator,a=e.next;!(r=uM(a,o)).done;)if(void 0!==(n=t(r.value)))return n;},cM=lM,hM=function hM(e,t,i){return i?cM(e.keys(),t,!0):e.forEach(t);},dM=hM,fM=sM.Set,vM=sM.add,gM=function gM(e){var t=new fM();return dM(e,function(e){vM(t,e);}),t;},mM=function mM(e){return e.size;},yM=De,pM=ai,wM=D,bM=Tr,kM=function kM(e){return{iterator:e,next:e.next,done:!1};},SM="Invalid size",xM=RangeError,CM=TypeError,VM=Math.max,TM=function TM(e,t){this.set=e,this.size=VM(t,0),this.has=yM(e.has),this.keys=yM(e.keys);};TM.prototype={getIterator:function getIterator(){return kM(pM(wM(this.keys,this.set)));},includes:function includes(e){return wM(this.has,this.set,e);}};var IM=function IM(e){pM(e);var t=+e.size;if(t!=t)throw new CM(SM);var i=bM(t);if(i<0)throw new xM(SM);return new TM(e,i);},EM=rM,PM=gM,BM=mM,DM=IM,MM=hM,zM=lM,UM=sM.has,AM=sM.remove,RM=function RM(){return!1;},LM=function LM(e){var t=EM(this),i=DM(e),r=PM(t);return BM(t)<=i.size?MM(t,function(e){i.includes(e)&&AM(r,e);}):zM(i.getIterator(),function(e){UM(t,e)&&AM(r,e);}),r;};Mi({target:"Set",proto:!0,real:!0,forced:!RM()},{difference:LM});var NM=rM,OM=mM,WM=IM,HM=hM,FM=lM,jM=sM.Set,YM=sM.add,XM=sM.has,qM=a,ZM=function ZM(e){var t=NM(this),i=WM(e),r=new jM();return OM(t)>i.size?FM(i.getIterator(),function(e){XM(t,e)&&YM(r,e);}):HM(t,function(e){i.includes(e)&&YM(r,e);}),r;};Mi({target:"Set",proto:!0,real:!0,forced:!RM()||qM(function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))));})},{intersection:ZM});var _M=rM,GM=sM.has,KM=mM,$M=IM,JM=hM,QM=lM,ez=Nh,tz=function tz(e){var t=_M(this),i=$M(e);if(KM(t)<=i.size)return!1!==JM(t,function(e){if(i.includes(e))return!1;},!0);var r=i.getIterator();return!1!==QM(r,function(e){if(GM(t,e))return ez(r,"normal",!1);});};Mi({target:"Set",proto:!0,real:!0,forced:!RM()},{isDisjointFrom:tz});var iz=rM,rz=mM,nz=hM,oz=IM,az=function az(e){var t=iz(this),i=oz(e);return!(rz(t)>i.size)&&!1!==nz(t,function(e){if(!i.includes(e))return!1;},!0);};Mi({target:"Set",proto:!0,real:!0,forced:!RM()},{isSubsetOf:az});var sz=rM,uz=sM.has,lz=mM,cz=IM,hz=lM,dz=Nh,fz=function fz(e){var t=sz(this),i=cz(e);if(lz(t)<i.size)return!1;var r=i.getIterator();return!1!==hz(r,function(e){if(!uz(t,e))return dz(r,"normal",!1);});};Mi({target:"Set",proto:!0,real:!0,forced:!RM()},{isSupersetOf:fz});var vz=rM,gz=gM,mz=IM,yz=lM,pz=sM.add,wz=sM.has,bz=sM.remove,kz=function kz(e){var t=vz(this),i=mz(e).getIterator(),r=gz(t);return yz(i,function(e){wz(t,e)?bz(r,e):pz(r,e);}),r;};Mi({target:"Set",proto:!0,real:!0,forced:!RM()},{symmetricDifference:kz});var Sz=rM,xz=sM.add,Cz=gM,Vz=IM,Tz=lM,Iz=function Iz(e){var t=Sz(this),i=Vz(e).getIterator(),r=Cz(t);return Tz(i,function(e){xz(r,e);}),r;};Mi({target:"Set",proto:!0,real:!0,forced:!RM()},{union:Iz});var Ez=Q.Set;!function(e){e.exports=Ez;}($B);var Pz=t(KB),Bz={},Dz={get exports(){return Bz;},set exports(e){Bz=e;}},Mz=Xn,zz=Ar,Uz=Zn,Az=ei,_Rz=function Rz(e,t,i,r,n,o,a,s){for(var u,l,c=n,h=0,d=!!a&&Az(a,s);h<r;)h in i&&(u=d?d(i[h],h,t):i[h],o>0&&Mz(u)?(l=zz(u),c=_Rz(e,t,u,l,c,o-1)-1):(Uz(c+1),e[c]=u),c++),h++;return c;},Lz=_Rz,Nz=Je,Oz=Ar,Wz=Tr,Hz=no;Mi({target:"Array",proto:!0},{flat:function flat(){var e=arguments.length?arguments[0]:void 0,t=Nz(this),i=Oz(t),r=Hz(t,0);return r.length=Lz(r,t,t,i,0,void 0===e?1:Wz(e)),r;}});var Fz=Wd("Array","flat"),jz=oe,Yz=Fz,Xz=Array.prototype,qz=function qz(e){var t=e.flat;return e===Xz||jz(Xz,e)&&t===Xz.flat?Yz:t;},Zz=qz;!function(e){e.exports=Zz;}(Dz);var _z=t(Bz),Gz={},Kz={get exports(){return Gz;},set exports(e){Gz=e;}},$z=o.isFinite,Jz=Number.isFinite||function(e){return"number"==typeof e&&$z(e);};Mi({target:"Number",stat:!0},{isFinite:Jz});var Qz=Q.Number.isFinite;!function(e){e.exports=Qz;}(Kz);var eU=t(Gz),tU={},iU={get exports(){return tU;},set exports(e){tU=e;}},rU=o,nU=a,oU=To,aU=CS.trim,sU=mS,uU=y("".charAt),lU=rU.parseFloat,cU=rU.Symbol,hU=cU&&cU.iterator,dU=1/lU(sU+"-0")!=-1/0||hU&&!nU(function(){lU(Object(hU));})?function(e){var t=aU(oU(e)),i=lU(t);return 0===i&&"-"===uU(t,0)?-0:i;}:lU;Mi({global:!0,forced:parseFloat!==dU},{parseFloat:dU});var fU=Q.parseFloat;!function(e){e.exports=fU;}(iU);var vU=t(tU),gU={},mU={get exports(){return gU;},set exports(e){gU=e;}},yU=Mi,pU=C;I.f;var wU=zr,bU=To,kU=pB,SU=Z,xU=bB,CU=pU("".slice),VU=Math.min;yU({target:"String",proto:!0,forced:!xU("startsWith")},{startsWith:function startsWith(e){var t=bU(SU(this));kU(e);var i=wU(VU(arguments.length>1?arguments[1]:void 0,t.length)),r=bU(e);return CU(t,i,i+r.length)===r;}});var TU=Wd("String","startsWith"),IU=oe,EU=TU,PU=String.prototype,BU=function BU(e){var t=e.startsWith;return"string"==typeof e||e===PU||IU(PU,e)&&t===PU.startsWith?EU:t;},DU=BU;!function(e){e.exports=DU;}(mU);var MU=t(gU),zU={},UU={get exports(){return zU;},set exports(e){zU=e;}},AU=gV;Mi({target:"Object",stat:!0,arity:2,forced:Object.assign!==AU},{assign:AU});var RU=Q.Object.assign;!function(e){e.exports=RU;}(UU);var LU=t(zU),NU={},OU={get exports(){return NU;},set exports(e){NU=e;}},WU=ue.match(/firefox\/(\d+)/i),HU=!!WU&&+WU[1],FU=/MSIE|Trident/.test(ue),jU=ue.match(/AppleWebKit\/(\d+)\./),YU=!!jU&&+jU[1],XU=Mi,qU=y,ZU=De,_U=Je,GU=Ar,KU=GI,$U=To,JU=a,QU=Rx,eA=cf,tA=HU,iA=FU,rA=ge,nA=YU,oA=[],aA=qU(oA.sort),sA=qU(oA.push),uA=JU(function(){oA.sort(void 0);}),lA=JU(function(){oA.sort(null);}),cA=eA("sort"),hA=!JU(function(){if(rA)return rA<70;if(!(tA&&tA>3)){if(iA)return!0;if(nA)return nA<603;var e,t,i,r,n="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2;}for(r=0;r<47;r++)oA.push({k:t+r,v:i});}for(oA.sort(function(e,t){return t.v-e.v;}),r=0;r<oA.length;r++)t=oA[r].k.charAt(0),n.charAt(n.length-1)!==t&&(n+=t);return"DGBEFHACIJK"!==n;}});XU({target:"Array",proto:!0,forced:uA||!lA||!cA||!hA},{sort:function sort(e){void 0!==e&&ZU(e);var t=_U(this);if(hA)return void 0===e?aA(t):aA(t,e);var i,r,n=[],o=GU(t);for(r=0;r<o;r++)r in t&&sA(n,t[r]);for(QU(n,function(e){return function(t,i){return void 0===i?-1:void 0===t?1:void 0!==e?+e(t,i)||0:$U(t)>$U(i)?1:-1;};}(e)),i=GU(n),r=0;r<i;)t[r]=n[r++];for(;r<o;)KU(t,r++);return t;}});var dA=Wd("Array","sort"),fA=oe,vA=dA,gA=Array.prototype,mA=function mA(e){var t=e.sort;return e===gA||fA(gA,e)&&t===gA.sort?vA:t;},yA=mA;!function(e){e.exports=yA;}(OU);var pA=t(NU),wA={},bA={get exports(){return wA;},set exports(e){wA=e;}},kA={},SA={get exports(){return kA;},set exports(e){kA=e;}},xA=o;Mi({global:!0,forced:xA.globalThis!==xA},{globalThis:xA});var CA={},VA={get exports(){return CA;},set exports(e){CA=e;}};!function(e){e.exports=o;}(VA);var TA=CA;!function(e){e.exports=TA;}(SA),function(e){e.exports=kA;}(bA);var IA=t(wA),EA={},PA={get exports(){return EA;},set exports(e){EA=e;}};!function(e){e.exports=hb;}(PA);var BA=t(EA),DA={},MA={get exports(){return DA;},set exports(e){DA=e;}},zA=Mi,UA=Date,AA=y(UA.prototype.getTime);zA({target:"Date",stat:!0},{now:function now(){return AA(new UA());}});var RA=Q.Date.now;!function(e){e.exports=RA;}(MA);var LA=t(DA),NA={},OA={get exports(){return NA;},set exports(e){NA=e;}},WA=Tr,HA=To,FA=Z,jA=RangeError,YA=y,XA=zr,qA=To,ZA=function ZA(e){var t=HA(FA(this)),i="",r=WA(e);if(r<0||r===1/0)throw new jA("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(t+=t))1&r&&(i+=t);return i;},_A=Z,GA=YA(ZA),KA=YA("".slice),$A=Math.ceil,JA=function JA(e){return function(t,i,r){var n,o,a=qA(_A(t)),s=XA(i),u=a.length,l=void 0===r?" ":qA(r);return s<=u||""===l?a:((o=GA(l,$A((n=s-u)/l.length))).length>n&&(o=KA(o,0,n)),e?a+o:o+a);};},QA=y,eR=a,tR={start:JA(!1),end:JA(!0)}.start,iR=RangeError,rR=isFinite,nR=Math.abs,oR=Date.prototype,aR=oR.toISOString,sR=QA(oR.getTime),uR=QA(oR.getUTCDate),lR=QA(oR.getUTCFullYear),cR=QA(oR.getUTCHours),hR=QA(oR.getUTCMilliseconds),dR=QA(oR.getUTCMinutes),fR=QA(oR.getUTCMonth),vR=QA(oR.getUTCSeconds),gR=eR(function(){return"0385-07-25T07:06:39.999Z"!==aR.call(new Date(-50000000000001));})||!eR(function(){aR.call(new Date(NaN));})?function(){if(!rR(sR(this)))throw new iR("Invalid time value");var e=this,t=lR(e),i=hR(e),r=t<0?"-":t>9999?"+":"";return r+tR(nR(t),r?6:4,0)+"-"+tR(fR(e)+1,2,0)+"-"+tR(uR(e),2,0)+"T"+tR(cR(e),2,0)+":"+tR(dR(e),2,0)+":"+tR(vR(e),2,0)+"."+tR(i,3,0)+"Z";}:aR,mR=D,yR=Je,pR=xt,wR=gR,bR=k;Mi({target:"Date",proto:!0,forced:a(function(){return null!==new Date(NaN).toJSON()||1!==mR(Date.prototype.toJSON,{toISOString:function toISOString(){return 1;}});})},{toJSON:function toJSON(e){var t=yR(this),i=pR(t,"number");return"number"!=typeof i||isFinite(i)?"toISOString"in t||"Date"!==bR(t)?t.toISOString():mR(wR,t):null;}});var kR=Q,SR=d;kR.JSON||(kR.JSON={stringify:JSON.stringify});var xR=function xR(e,t,i){return SR(kR.JSON.stringify,null,arguments);},CR=xR;!function(e){e.exports=CR;}(OA);var VR=t(NA),TR={},IR={get exports(){return TR;},set exports(e){TR=e;}},ER=iB.values;Mi({target:"Object",stat:!0},{values:function values(e){return ER(e);}});var PR=Q.Object.values;!function(e){e.exports=PR;}(IR);var BR=t(TR),DR={},MR={get exports(){return DR;},set exports(e){DR=e;}};!function(e){e.exports=Yf;}(MR);var zR=t(DR),UR={},AR={get exports(){return UR;},set exports(e){UR=e;}},RR=Ua.some;Mi({target:"Array",proto:!0,forced:!cf("some")},{some:function some(e){return RR(this,e,arguments.length>1?arguments[1]:void 0);}});var LR=Wd("Array","some"),NR=oe,OR=LR,WR=Array.prototype,HR=function HR(e){var t=e.some;return e===WR||NR(WR,e)&&t===WR.some?OR:t;},FR=HR;!function(e){e.exports=FR;}(AR);var jR=t(UR),YR={},XR={get exports(){return YR;},set exports(e){YR=e;}};!function(e){e.exports=wv;}(XR);var qR,ZR,_R,GR,KR,$R,JR,QR,eL,tL=t(YR),iL=["style"],rL=["style"],nL=["style"],oL=["style"],aL=["style"],sL=["style"],uL=["style"],lL=["style"];function cL(e,t,i){return t=pb(t),function(e,t){if(t&&("object"===ch(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return yb(e);}(e,av()?On(t,i||[],pb(e).constructor):t.apply(e,i));}function hL(e,t,i,r){var n=Zb(pb(1&r?e.prototype:e),t,i);return 2&r&&"function"==typeof n?function(e){return n.apply(i,e);}:n;}var dL={code:0,message:"ok."},fL={code:8e4,message:"The parameter type is wrong."},vL={code:80002,message:"The parameter is out of range."},gL={code:80003,message:"The image does not exist."},mL={code:80013,message:"The parameter is invalid."},yL={code:80021,message:"The size is invalid."},pL=function pL(e){return e.replace(/[A-Z]/g,function(e){return"-".concat(e.toLowerCase());});},wL=function wL(e){return Object.prototype.toString.call(e);},bL=function bL(e){return _k?_k(e):"[object Array]"===wL(e);},kL=function kL(e){return null!==e&&"[object Object]"===wL(e);},_SL=function SL(e){var t,i=null;return bL(e)&&(i||(i=[]),$k(e).call(e,function(e){i.push(_SL(e));})),kL(e)&&(i||(i={}),$k(t=eS(e)).call(t,function(t){i[t]=_SL(e[t]);})),i||e;};function xL(e,t){for(var i in t)e[i]=e[i]&&"[object Object]"===e[i].toString()?xL(e[i],t[i]):e[i]=t[i];return e;}var CL=function CL(e){return void 0===e;},VL=function VL(e,t){var i,r;e=null!==(i=e)&&void 0!==i?i:"yyyy-MM-dd hh:mm:ss";var n=CL(t)?new Date():new Date(t),o={"M+":(n.getMonth()+1).toString(),"d+":n.getDate().toString(),"h+":n.getHours().toString(),"m+":n.getMinutes().toString(),"s+":n.getSeconds().toString(),"q+":Math.floor((n.getMonth()+3)/3).toString(),S:n.getMilliseconds().toString()};return /(y+)/.test(e)&&(e=e.replace(RegExp.$1,"".concat(n.getFullYear()).substring(4-RegExp.$1.length))),$k(r=eS(o)).call(r,function(t){new RegExp("(".concat(t,")")).test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?o[t]:"00".concat(o[t]).substring("".concat(o[t]).length)));}),e;},TL=function TL(e){return"string"==typeof e;};function IL(e,t){return Math.pow(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2),.5);}function EL(e){var t=e.type,i=e.value;return"hex"===t?"#".concat(i):"literal"===t?i:"rgb"===t?"rgb(".concat(i.join(","),")"):"rgba(".concat(i.join(","),")");}var PL=function(){var e=/^(linear\-gradient)/i,t=/^(repeating\-linear\-gradient)/i,i=/^(radial\-gradient)/i,r=/^(repeating\-radial\-gradient)/i,n=/^(conic\-gradient)/i,o=/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,a=/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,s=/^(left|center|right|top|bottom)/i,u=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,l=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,c=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,h=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,d=/^\(/,f=/^\)/,v=/^,/,g=/^\#([0-9a-fA-F]+)/,m=/^([a-zA-Z]+)/,y=/^rgb/i,p=/^rgba/i,w=/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/,b="";function k(e){var t;throw new Error(lS(t="".concat(b,": ")).call(t,e));}function S(){return x("linear-gradient",e,V)||x("repeating-linear-gradient",t,V)||x("radial-gradient",i,T)||x("repeating-radial-gradient",r,T)||x("conic-gradient",n,T);}function x(e,t,i){return C(t,function(t){var r=i();return r&&(L(v)||k("Missing comma before color stops")),{type:e,orientation:r,colorStops:D(M)};});}function C(e,t){var i=L(e);if(i){L(d)||k("Missing (");var r=t(i);return L(f)||k("Missing )"),r;}}function V(){return R("directional",o,1)||R("angular",h,1);}function T(){var e,t,i=I();return i&&((e=[]).push(i),t=b,L(v)&&((i=I())?e.push(i):b=t)),e;}function I(){var e=function(){var e=R("shape",/^(circle)/i,0);return e&&(e.style=A()||E()),e;}()||function(){var e=R("shape",/^(ellipse)/i,0);return e&&(e.style=U()||E()),e;}();if(e)e.at=P();else{var t=E();if(t){e=t;var i=P();i&&(e.at=i);}else{var r=B();r&&(e={type:"default-radial",at:r});}}return e;}function E(){return R("extent-keyword",a,1);}function P(){if(R("position",/^at/,0)){var e=B();return e||k("Missing positioning value"),e;}}function B(){var e={x:U(),y:U()};if(e.x||e.y)return{type:"position",value:e};}function D(e){var t=e(),i=[];if(t)for(i.push(t);L(v);)(t=e())?i.push(t):k("One extra comma");return i;}function M(){var e=R("hex",g,1)||C(p,function(){return{type:"rgba",value:D(z)};})||C(y,function(){return{type:"rgb",value:D(z)};})||R("literal",m,0);return e||k("Expected color definition"),e.length=U(),e;}function z(){return L(w)[1];}function U(){return R("%",l,1)||R("position-keyword",s,1)||A();}function A(){return R("px",u,1)||R("em",c,1);}function R(e,t,i){var r=L(t);if(r)return{type:e,value:r[i]};}function L(e){var t=/^[\n\r\t\s]+/.exec(b);t&&N(t[0].length);var i=e.exec(b);return i&&N(i[0].length),i;}function N(e){b=b.substring(e);}return function(e){return b=e,function(){var e=D(S);return b.length>0&&k("Invalid input not EOF"),e;}();};}(),BL=function BL(e){return"number"==typeof e&&!fS(e);},DL=function DL(e){return"[object Boolean]"===wL(e);},ML=function ML(e){return"function"==typeof e;},zL=function zL(){return void 0!==document.documentMode;},UL=function UL(){return"ontouchstart"in document.documentElement;};function AL(e){return null==e;}var RL=function RL(e,t){return e in t;},LL=function LL(e,t){for(var i=[];e;){var r=e.match(t);if(!r)break;i.push(r),e=e.substring(r.index+r[0].length);}return i;};function NL(e,t){var i;return $k(i=eS(e)).call(i,function(i){CL(t[i])?t[i]=e[i]:kL(e[i])?NL(e[i],t[i]):t[i]=e[i];}),t;}var OL=0,WL=function WL(){var e;return OL+=1,lS(e="".concat(new Date().getTime().toString(36))).call(e,OL.toString(36));},HL=function HL(e,t,i){return Math.min(Math.max(e,t),i);},FL="\\s*([+-]?\\d+)\\s*",jL="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",YL="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",XL=/^#([0-9a-f]{3,8})$/,qL=new RegExp(lS(qR="^rgb\\(".concat(FL,",").concat(FL,",")).call(qR,FL,"\\)$")),ZL=new RegExp(lS(ZR="^rgb\\(".concat(YL,",").concat(YL,",")).call(ZR,YL,"\\)$")),_L=new RegExp(lS(_R=lS(GR="^rgba\\(".concat(FL,",").concat(FL,",")).call(GR,FL,",")).call(_R,jL,"\\)$")),GL=new RegExp(lS(KR=lS($R="^rgba\\(".concat(YL,",").concat(YL,",")).call($R,YL,",")).call(KR,jL,"\\)$")),KL=new RegExp(lS(JR="^hsl\\(".concat(jL,",").concat(YL,",")).call(JR,YL,"\\)$")),$L=new RegExp(lS(QR=lS(eL="^hsla\\(".concat(jL,",").concat(YL,",")).call(eL,YL,",")).call(QR,jL,"\\)$")),JL={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},QL=Yk(function e(t,i,r,n){Xk(this,e),Wk(this,"r",void 0),Wk(this,"g",void 0),Wk(this,"b",void 0),Wk(this,"opacity",void 0),this.r=t,this.g=i,this.b=r,this.opacity=n;});function eN(e){return new QL(e>>16&255,e>>8&255,255&e,1);}function tN(e,t,i,r){return r<=0&&(e=NaN,t=NaN,i=NaN),new QL(e,t,i,r);}function iN(e,t,i,r){return r<=0?(e=NaN,t=NaN,i=NaN):i<=0||i>=1?(e=NaN,t=NaN):t<=0&&(e=NaN),{h:e,s:t,l:i,opacity:r};}function rN(e,t,i){return e<60?(t+(i-t)*e)/60*255:e<180?255*i:e<240?(t+(i-t)*(240-e))/60*255:255*t;}function nN(e){var t=e.h<0?e.h%360+360:e.h%360,i=fS(t)||fS(e.s)?0:e.s,r=e.l,n=r+(r<.5?r:1-r)*i,o=2*r-n;return new QL(rN(t>=240?t-240:t+120,o,n),rN(t,o,n),rN(t<120?t+240:t-120,o,n),e.opacity);}function oN(e){var t,i;return e?vx(t=yx(i=eS(e)).call(i,function(t){return null!==e[t]&&void 0!==e[t];})).call(t,function(t,i){return Fk(Fk({},t),{},Wk({},i,e[i]));},{}):{};}var aN,sN={"&amp;":"&","&gt;":">","&lt;":"<","&nbsp;":" ","&quot;":'"',"&#x27;":"'"},uN={};function lN(e,t){for(var i=eS(e),r=0;r<i.length;r++){var n=i[r];if(!1===t.call(null,e[n],n,e))break;}}function cN(e){return 0===e.length?"":e.replace(function(){if(aN)return aN;var e="";return lN(uN,function(t){e+="".concat(t,"|");}),e+="&#(\\d{1,5});",aN=new RegExp(e,"g");}(),function(e,t){return sN[e]||String.fromCharCode(+t);});}lN(sN,function(e,t){uN[e]=t;}),function(e,t){for(var i=eS(e),r=0;r<i.length;r++){var n=i[r];if(!1===t.call(null,e[n],n,e))break;}}({"&amp;":"&","&gt;":">","&lt;":"<","&nbsp;":" ","&quot;":'"',"&#x27;":"'"},function(e,t){});var hN=function hN(e,t,i){void 0===t?i.appendChild(e):i.insertBefore(e,t);},dN=function dN(e,t){var i=t.parentNode;i.lastChild===t?i.appendChild(e):hN(e,t.nextSibling,i);},fN=function fN(e){e&&(e.stopPropagation?e.stopPropagation():e.cancelBubble=!0);},vN=function vN(e){var t=zI||window.webkitURL,i="string";return TL(e)?i="string":"[object Blob]"===wL(e)?(i="blob",e=t.createObjectURL(e)):("[object ArrayBuffer]"===wL(e)||bL(e))&&(i="blob",e=t.createObjectURL(new Blob([e]))),{type:i,data:e};},gN=function gN(){var e=window;if(e){if(e.devicePixelRatio)return e.devicePixelRatio;if(e.screen.deviceXDPI&&e.screen.logicalXDPI)return e.screen.deviceXDPI/e.screen.logicalXDPI;}return 1;},mN=function mN(e){var t=zI||window.webkitURL;/^blob:/.test(e)&&t.revokeObjectURL(e);},yN=function yN(){return{scrollX:void 0===window.scrollX?window.pageXOffset:window.scrollX,scrollY:void 0===window.scrollY?window.pageYOffset:window.scrollY};},pN=function pN(e){return(e/=.5)<1?Math.pow(e,3):.5*(Math.pow(e-2,3)+2);},wN=function wN(e){return Math.pow(e-1,3)+1;},bN=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";Xk(this,e),Wk(this,"prefix",void 0),Wk(this,"postfix",void 0),Wk(this,"isDestroyed",!1),Wk(this,"uid",WL()),Wk(this,"cacheEvents",void 0),Wk(this,"events",void 0),Wk(this,"isCached",void 0),this.cacheEvents=[],this.events={},this.isCached=!1,this.prefix=t,this.postfix=i;}return Yk(e,[{key:"save",value:function value(){this.isCached=!0;}},{key:"restore",value:function value(){var e,t=this;this.isCached=!1,$k(e=this.cacheEvents).call(e,function(e){var i,r=e.eventName,n=e.param;t.emit.apply(t,lS(i=[r]).call(i,Kb(n)));}),this.cacheEvents.length=0;}},{key:"destroy",value:function value(){var e=this;if(!this.isDestroyed){for(var t in this.events)if(Object.prototype.hasOwnProperty.call(this.events,t)){var i,r=this.events[t];r&&$k(i=RI(r).call(r)).call(i,function(t){var i=t.name,r=t.fn,n=t.context,o=t.once;e.off(i,r,n,o);});}this.events={},this.isDestroyed=!0;}}},{key:"on",value:function value(e,t,i){var r,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=this.events,a={name:e=this.format(e),uid:WL(),context:i,once:n,fn:t};return o[e]||(o[e]=[]),OI(r=o[e]).call(r,a)<0&&o[e].push(a),a;}},{key:"once",value:function value(e,t,i){return this.on(e,t,i,!0);}},{key:"emit",value:function value(e){for(var t,i,r=this,n=arguments.length,o=new Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];if(this.isCached)return this.cacheEvents.push({eventName:e,param:o}),!0;var s=this.events[e=this.format(e)];return!(!s||!s.length||($k(t=RI(s).call(s)).call(t,function(e){var t,i=e.fn,r=e.context;i.call.apply(i,lS(t=[r||null]).call(t,o));}),$k(i=RI(s).call(s)).call(i,function(t){var i=t.fn,n=t.context,o=t.once;o&&r.off(e,i,n,o);}),0));}},{key:"off",value:function value(e,t,i,r){var n=this.events[e=this.format(e)];if(!n)return!1;if(!arguments.length)return n.length=0,!0;for(var o=n.length-1;o>=0;o--){var a=n[o];t&&a.fn!==t||i&&a.context!==i||r&&a.once!==r||gE(n).call(n,o,1);}return!0;}},{key:"removeAllEventListeners",value:function value(e){if(e){var t,i;e=this.format(e);var r=EE(t=this.cacheEvents).call(t,function(t){return t.eventName===e;});r>-1&&gE(i=this.cacheEvents).call(i,r,1),this.events[e]&&delete this.events[e];}else this.cacheEvents=[],this.events={};}},{key:"getAllEvents",value:function value(){return this.events;}},{key:"format",value:function value(e){var t,i;return lS(t=lS(i="".concat(this.prefix||"")).call(i,e)).call(t,this.postfix||"");}}],[{key:"create",value:function value(t,i){return new e(t,i);}}]);}(),kN="default",SN=function(){function e(){Xk(this,e),Wk(this,"emitter",new bN());}return Yk(e,[{key:"on",value:function value(e){this.emitter.on(kN,e);}},{key:"emit",value:function value(){for(var e,t,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];(e=this.emitter).emit.apply(e,lS(t=[kN]).call(t,r));}},{key:"off",value:function value(e){this.emitter.off(kN,e);}}],[{key:"create",value:function value(){return new e();}}]);}(),xN=function xN(e){return e/180*Math.PI;},CN=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Xk(this,e),Wk(this,"x",void 0),Wk(this,"y",void 0),Wk(this,"z",void 0),this.x=t,this.y=i,this.z=r;}return Yk(e,[{key:"setFromVector",value:function value(e){var t;this.x=e.x,this.y=e.y,this.z=null!==(t=e.z)&&void 0!==t?t:0;}},{key:"clone",value:function value(){return new e(this.x,this.y,this.z);}},{key:"norm",value:function value(){return RE(this.x,this.y,this.z);}},{key:"dot",value:function value(e){var t;return this.x*e.x+this.y*e.y+this.z*(null!==(t=e.z)&&void 0!==t?t:0);}},{key:"projectionTo",value:function value(e){var t=RE(e.x,e.y,e.z);return this.dot(e)/t;}},{key:"angle",value:function value(e){var t=this.norm()*RE(e.x,e.y,e.z),i=t&&this.dot(e)/t;return Math.acos(HL(i,-1,1));}},{key:"equals",value:function value(e){var t;return this.x===e.x&&this.y===e.y&&this.z===(null!==(t=e.z)&&void 0!==t?t:0);}},{key:"distance",value:function value(e){var t;return RE(this.x-e.x,this.y-e.y,this.z-(null!==(t=e.z)&&void 0!==t?t:0));}},{key:"lerp",value:function value(t){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=this.x,o=this.y,a=this.z;return new e(n+r*(t.x-n),o+r*(t.y-o),a+r*((null!==(i=t.z)&&void 0!==i?i:0)-a));}},{key:"normalize",value:function value(){var e=this,t=e.norm();return e.x/=t,e.y/=t,e.z/=t,this;}},{key:"negate",value:function value(){return this.x*=-1,this.y*=-1,this.z*=-1,this;}},{key:"cross",value:function value(e){var t=this;return{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x};}},{key:"add",value:function value(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this;}},{key:"multiply",value:function value(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this;}}],[{key:"fromPoint",value:function value(t){return new e(t.x,t.y,t.z);}},{key:"fromTwoPoint",value:function value(t,i){var r,n,o,a,s,u;return new e((null!==(r=i.x)&&void 0!==r?r:0)-(null!==(n=t.x)&&void 0!==n?n:0),(null!==(o=i.y)&&void 0!==o?o:0)-(null!==(a=t.y)&&void 0!==a?a:0),(null!==(s=i.z)&&void 0!==s?s:0)-(null!==(u=t.z)&&void 0!==u?u:0));}},{key:"fromValue",value:function value(t,i,r){return new e(t,i,r);}}]);}();function VN(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return BL(e)?CN.fromValue(e,t,i):CN.fromPoint(e);}function TN(e,t){return CN.fromTwoPoint(e,t);}var IN=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Xk(this,e),Wk(this,"x",void 0),Wk(this,"y",void 0),Wk(this,"z",void 0),this.x=t,this.y=i,this.z=r;}return Yk(e,[{key:"matrixTransform",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.x,i=this.y,r=this.z,n=e.m11,o=e.m21,a=e.m31,s=e.m41,u=e.m12,l=e.m22,c=e.m32,h=e.m42,d=e.m13,f=e.m23,v=e.m33,g=e.m43,m=e.m14*t+e.m24*i+e.m34*r+e.m44;return EN({x:(n*t+o*i+a*r+s)/m,y:(u*t+l*i+c*r+h)/m,z:(d*t+f*i+v*r+g)/m});}},{key:"setFromPoint",value:function value(e){return this.x=e.x||0,this.y=e.y||0,this.z=e.z||0,this;}},{key:"clone",value:function value(){return EN(this);}},{key:"equals",value:function value(e){var t=e.x,i=void 0===t?0:t,r=e.y,n=void 0===r?0:r,o=e.z,a=void 0===o?0:o,s=this;return s.x===i&&s.y===n&&s.z===a;}},{key:"distanceTo",value:function value(e){var t=e.x,i=void 0===t?0:t,r=e.y,n=void 0===r?0:r,o=e.z,a=void 0===o?0:o,s=this;return RE(s.x-i,s.y-n,s.z-a);}},{key:"lerpTo",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,i=e.x,r=void 0===i?0:i,n=e.y,o=void 0===n?0:n,a=e.z,s=void 0===a?0:a,u=this;return EN({x:u.x+t*(r-u.x),y:u.y+t*(o-u.y),z:u.z+t*(s-u.z)});}},{key:"footPointInSegment",value:function value(e,t){var i=TN(e,this),r=TN(e,t),n=r.norm(),o=EN(e);if(0===n)return o;var a=i.projectionTo(r)/n;return o.lerpTo(t,a);}},{key:"perpendicularToSegment",value:function value(e,t){var i=this.footPointInSegment(e,t);return this.distanceTo(i);}}],[{key:"fromPoint",value:function value(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new e(t.x,t.y,t.z);}}]);}();function EN(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return BL(e)?new IN(e,t,i):new IN(e.x,e.y,e.z);}var PN=function PN(e){return e/Math.PI*180;},BN=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Xk(this,e),Wk(this,"x",void 0),Wk(this,"y",void 0),Wk(this,"z",void 0),Wk(this,"w",void 0),this.x=t,this.y=i,this.z=r,this.w=n;}return Yk(e,[{key:"clone",value:function value(){var t=new e();return t.setFromQuat(this),t;}},{key:"setFromQuat",value:function value(e){var t,i,r,n,o=this;return o.x=null!==(t=e.x)&&void 0!==t?t:0,o.y=null!==(i=e.y)&&void 0!==i?i:0,o.z=null!==(r=e.z)&&void 0!==r?r:0,o.w=null!==(n=e.w)&&void 0!==n?n:1,this;}},{key:"toEuler",value:function value(){var e=this.x,t=this.y,i=this.z,r=this.w,n=.4990234375,o=this.w*this.y-this.x*this.z;if(o<-n||o>n){var a=HE(o);return{z:-2*a*Math.atan2(this.x,this.w),y:a*(Math.PI/2),x:0};}return{x:PN(Math.atan2(2*(t*i+r*e),r*r-e*e-t*t+i*i)),y:PN(Math.asin(-2*(e*i-r*t))),z:PN(Math.atan2(2*(e*t+r*i),r*r+e*e-t*t-i*i))};}},{key:"invert",value:function value(){var e=this.x,t=this.y,i=this.z,r=this.w,n=e*e+t*t+i*i+r*r,o=n?1/n:0;return this.x=-e*o,this.y=-t*o,this.z=-i*o,this.w=r*o,this;}},{key:"multiply",value:function value(e){var t=this.x,i=this.y,r=this.z,n=this.w,o=e.x,a=e.y,s=e.z,u=e.w;return this.x=t*u+n*o+i*s-r*a,this.y=i*u+n*a+r*o-t*s,this.z=r*u+n*s+t*a-i*o,this.w=n*u-t*o-i*a-r*s,this;}},{key:"normalize",value:function value(){var e=this.x,t=this.y,i=this.z,r=this.w,n=e*e+t*t+i*i+r*r;return this.x/=n,this.y/=n,this.z/=n,this.w/=n,this;}}],[{key:"fromQuat",value:function value(t){return new e().setFromQuat(t);}},{key:"fromEuler",value:function value(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t=xN(t)/2,i=xN(i)/2,r=xN(r)/2;var n=Math.sin(t),o=Math.cos(t),a=Math.sin(i),s=Math.cos(i),u=Math.sin(r),l=Math.cos(r),c=new e();return c.setFromQuat({x:n*s*l-o*a*u,y:o*a*l+n*s*u,z:o*s*u-n*a*l,w:o*s*l+n*a*u}),c;}}]);}();function DN(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return BL(e)?new BN(e,t,i,r):BN.fromQuat(e);}function MN(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return BN.fromEuler(e,t,i);}var zN=function(){return Yk(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Xk(this,e),Wk(this,"x",void 0),Wk(this,"y",void 0),Wk(this,"z",void 0),Wk(this,"w",void 0),this.x=t,this.y=i,this.z=r,this.w=n;},[{key:"negate",value:function value(){this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1;}},{key:"normalize",value:function value(){var e=this.norm();this.x/=e,this.y/=e,this.z/=e,this.w/=e;}},{key:"norm",value:function value(){return RE(this.x,this.y,this.z,this.w);}}]);}();function UN(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return BL(e)?new zN(e,t,i,r):new zN(e.x,e.y,e.z,e.w);}var AN=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],RN=function(){function e(t){if(Xk(this,e),Wk(this,"a",1),Wk(this,"b",0),Wk(this,"c",0),Wk(this,"d",1),Wk(this,"e",0),Wk(this,"f",0),Wk(this,"m11",1),Wk(this,"m12",0),Wk(this,"m13",0),Wk(this,"m14",0),Wk(this,"m21",0),Wk(this,"m22",1),Wk(this,"m23",0),Wk(this,"m24",0),Wk(this,"m31",0),Wk(this,"m32",0),Wk(this,"m33",1),Wk(this,"m34",0),Wk(this,"m41",0),Wk(this,"m42",0),Wk(this,"m43",0),Wk(this,"m44",1),Wk(this,"is2D",void 0),t||(t=AN),TL(t));else{if(!bL(t))throw new Error("DefaultMatrix error.");WN(t,this);}}return Yk(e,[{key:"isIdentity",get:function get(){for(var e=this.toArray(),t=0;t<16;t++)if(e[t]!==AN[t])return!1;return!0;}},{key:"translate",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.clone().translateSelf(e,t,i);}},{key:"scale",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return CL(t)&&(t=e),this.clone().scaleSelf(e,t,i,r,n,o);}},{key:"scale3d",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.clone().scale3dSelf(e,t,i,r);}},{key:"rotate",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;return this.clone().rotateSelf(e,t,i);}},{key:"rotateFromVector",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.clone().rotateFromVectorSelf(e,t);}},{key:"rotateAxisAngle",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.clone().rotateAxisAngleSelf(e,t,i,r);}},{key:"skewX",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.clone().skewXSelf(e);}},{key:"skewY",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.clone().skewYSelf(e);}},{key:"multiply",value:function value(e){return this.clone().multiplySelf(e);}},{key:"flipX",value:function value(){return this.clone().multiplySelf(new e([-1,0,0,1,0,0]));}},{key:"flipY",value:function value(){return this.clone().multiplySelf(new e([1,0,0,-1,0,0]));}},{key:"inverse",value:function value(){return this.clone().invertSelf();}},{key:"transformPoint",value:function value(){return EN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).matrixTransform(this);}},{key:"toFloat32Array",value:function value(){var e=this.toArray();return new Float32Array(e);}},{key:"toFloat64Array",value:function value(){var e=this.toArray();return new Float64Array(e);}},{key:"toJSON",value:function value(){}},{key:"multiplySelf",value:function value(){var e=HN(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return this.setFromMatrix(e),this;}},{key:"preMultiplySelf",value:function value(){var e=HN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},this);return this.setFromMatrix(e),this;}},{key:"translateSelf",value:function value(){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=function(){return{m11:1,m21:0,m31:0,m41:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,m12:0,m22:1,m32:0,m42:arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m13:0,m23:0,m33:1,m43:arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,m14:0,m24:0,m34:0,m44:1};}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e);return this.multiplySelf(t),e&&(this.is2D=!1),this;}},{key:"scaleSelf",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.translateSelf(r,n,o),CL(t)&&(t=e);var a=function(){return{m11:arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,m21:0,m31:0,m41:0,m12:0,m22:arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m32:0,m42:0,m13:0,m23:0,m33:arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,m43:0,m14:0,m24:0,m34:0,m44:1};}(e,t,i);return this.multiplySelf(a),this.translateSelf(-r,-n,-o),1!==i&&(this.is2D=!1),this;}},{key:"scale3dSelf",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.scaleSelf(e,e,e,t,i,r);}},{key:"rotateSelf",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;CL(t)&&CL(i)&&(i=e,e=0,t=0),CL(t)&&(t=0),CL(i)&&(i=0),0===e&&0===t||(this.is2D=!1);var r=FN(i,[0,0,1]),n=FN(t,[0,1,0]),o=FN(e,[1,0,0]);return this.multiplySelf(r),this.multiplySelf(n),this.multiplySelf(o),this;}},{key:"rotateFromVectorSelf",value:function value(){var e=VN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),t=VN(1,0),i=FN(e.angle(t),[0,0,1]);return this.multiplySelf(i),this;}},{key:"rotateAxisAngleSelf",value:function value(){var e=FN(arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,[arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0]);return this.multiplySelf(e),this;}},{key:"skewXSelf",value:function value(){var e=jN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,0);return this.multiplySelf(e),this;}},{key:"skewYSelf",value:function value(){var e=jN(0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:0);return this.multiplySelf(e),this;}},{key:"invertSelf",value:function value(){var e=function(e){if(e[0].length!==e.length)throw new Error();for(var t=NN(e),i=function(e,t,i){if(e[0].length!==e.length)throw new Error("Not square matrix.");for(var r=e.length,n=$E(t=cP(i=new Array(r)).call(i,0)).call(t,function(e){var t;return cP(t=new Array(r)).call(t,0);}),o=0;o<r;o++)for(var a=0;a<r;a++)n[o][a]=ON(e,o,a);return function(e,t,i){for(var r=$E(t=cP(i=new Array(e.length)).call(i,0)).call(t,function(t){var i;return cP(i=new Array(e[0].length)).call(i,0);}),n=0;n<r.length;n++)for(var o=0;o<r[0].length;o++)r[n][o]=e[o][n];return r;}(n);}(e),r=0;r<i.length;r++)for(var n=0;n<i.length;n++)i[r][n]/=t;return i;}(this.toTwoDimensionalArray());return this.setFromTwoDimensionalArray(e),this;}},{key:"setMatrixValue",value:function value(e){}},{key:"setFromMatrix",value:function value(e){var t=this;t.m11=e.m11,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m21=e.m21,t.m22=e.m22,t.m23=e.m23,t.m24=e.m24,t.m31=e.m31,t.m32=e.m32,t.m33=e.m33,t.m34=e.m34,t.m41=e.m41,t.m42=e.m42,t.m43=e.m43,t.m44=e.m44,t.a=e.m11,t.b=e.m12,t.c=e.m21,t.d=e.m22,t.e=e.m41,t.f=e.m42,!1===e.is2D&&(t.is2D=!1);}},{key:"setFromTwoDimensionalArray",value:function value(e){var t=Gb(e,4),i=Gb(t[0],4),r=i[0],n=i[1],o=i[2],a=i[3],s=Gb(t[1],4),u=s[0],l=s[1],c=s[2],h=s[3],d=Gb(t[2],4),f=d[0],v=d[1],g=d[2],m=d[3],y=Gb(t[3],4),p=y[0],w=y[1],b=y[2],k=y[3];this.setFromMatrix({m11:r,m21:n,m31:o,m41:a,m12:u,m22:l,m32:c,m42:h,m13:f,m23:v,m33:g,m43:m,m14:p,m24:w,m34:b,m44:k});}},{key:"clone",value:function value(){return e.fromMatrix(this);}},{key:"determinant",value:function value(){return NN(this.toTwoDimensionalArray());}},{key:"toTwoDimensionalArray",value:function value(){var e=this;return[[e.m11,e.m21,e.m31,e.m41],[e.m12,e.m22,e.m32,e.m42],[e.m13,e.m23,e.m33,e.m43],[e.m14,e.m24,e.m34,e.m44]];}},{key:"toArray",value:function value(){var e=this;return[e.m11,e.m12,e.m13,e.m14,e.m21,e.m22,e.m23,e.m24,e.m31,e.m32,e.m33,e.m34,e.m41,e.m42,e.m43,e.m44];}},{key:"decompose",value:function value(){if(0===this.m44)return{};var e=UN(0,0,0,1),t=DN(0,0,0,1),i=VN(0,0,0),r=VN(0,0,0),n=VN(0,0,0),o=this;o.normalize();var a=o.clone();if(a.m14=0,a.m24=0,a.m34=0,a.m44=1,0===a.determinant())return!1;if(0!==o.m14||0!==o.m24||0!==o.m34){var s={x:o.m14,y:o.m24,z:o.m34,w:o.m44};e=a.invertSelf().transposeSelf().multiplyVector(s);}else e.x=0,e.y=0,e.z=0,e.w=1;n.x=o.m41,n.y=o.m42,n.z=o.m43;var u=[VN(o.m11,o.m12,o.m13),VN(o.m21,o.m22,o.m23),VN(o.m31,o.m32,o.m33)];i.x=u[0].norm(),u[0].normalize(),r.x=u[0].dot(u[1]),u[1]=VN(LN(u[1],u[0],1,-r.x)),i.y=u[1].norm(),u[1].normalize(),r.x/=i.y,r.y=u[0].dot(u[2]),u[2]=VN(LN(u[2],u[0],1,-r.y)),r.z=u[1].dot(u[2]),u[2]=VN(LN(u[2],u[1],1,-r.z)),i.z=u[2].norm(),u[2].normalize(),r.y/=i.z,r.z/=i.z;var l,c=u[1].cross(u[2]);if(u[0].dot(c)<0&&(i.negate(),u[0].negate(),u[1].negate(),u[2].negate()),t.x=.5*Math.pow(Math.max(1+u[0].x-u[1].y-u[2].z,0),.5),t.y=.5*Math.pow(Math.max(1-u[0].x+u[1].y-u[2].z,0),.5),t.z=.5*Math.pow(Math.max(1-u[0].x-u[1].y+u[2].z,0),.5),t.w=.5*Math.pow(Math.max(1+u[0].x+u[1].y+u[2].z,0),.5),u[2].y>u[1].z&&(t.x*=-1),u[0].z>u[2].x&&(t.y*=-1),u[1].x>u[0].y&&(t.z*=-1),t.x<.001&&t.x>=0&&t.y<.001&&t.y>=0){var h=Math.atan2(u[0].y,u[0].x);l={x:0,y:0,z:Number(PN(h).toFixed(3))};}else l=t.toEuler();return{rotation:l,scale:i,translation:n,skew:r,quaternion:t,perspective:e};}},{key:"multiplyVector",value:function value(e){var t=this,i=e.x,r=e.y,n=e.z,o=e.w;return{x:t.m11*i+t.m21*r+t.m31*n+t.m41*o,y:t.m12*i+t.m22*r+t.m32*n+t.m42*o,z:t.m13*i+t.m23*r+t.m33*n+t.m43*o,w:t.m14*i+t.m24*r+t.m34*n+t.m44*o};}},{key:"transpose",value:function value(){var e=this.clone();return e.transposeSelf(),e;}},{key:"transposeSelf",value:function value(){var e=this.m11,t=this.m21,i=this.m31,r=this.m41,n=this.m12,o=this.m22,a=this.m32,s=this.m42,u=this.m13,l=this.m23,c=this.m33,h=this.m43,d=this.m14,f=this.m24,v=this.m34,g=this.m44;return this.setFromMatrix({m11:e,m21:n,m31:u,m41:d,m12:t,m22:o,m32:l,m42:f,m13:i,m23:a,m33:c,m43:v,m14:r,m24:s,m34:h,m44:g}),this;}},{key:"normalize",value:function value(){var e=this,t=e.m44;e.m11/=t,e.m12/=t,e.m13/=t,e.m14/=t,e.m21/=t,e.m22/=t,e.m23/=t,e.m24/=t,e.m31/=t,e.m32/=t,e.m33/=t,e.m34/=t,e.m41/=t,e.m42/=t,e.m43/=t,e.m44/=t;}},{key:"getTranslation",value:function value(){return VN(this.m41,this.m42,this.m43);}},{key:"getRotation",value:function value(){var e=this,t=.5*Math.pow(e.m11+e.m22+e.m33+1,.5);return DN(.25*(e.m23-e.m32)/t,.25*(e.m31-e.m13)/t,.25*(e.m12-e.m21)/t,t);}},{key:"getScaling",value:function value(){var e=this;return VN(RE(e.m11,e.m12,e.m13),RE(e.m21,e.m22,e.m23),RE(e.m31,e.m32,e.m33));}},{key:"toEuler",value:function value(){var e=this.getRotation().toEuler();return VN(e.x,e.y,e.z);}}],[{key:"fromQuat",value:function value(t){var i=t.x,r=t.y,n=t.z,o=t.w,a=new e();return a.m11=1-2*(r*r+n*n),a.m12=2*(i*r+n*o),a.m13=2*(i*n-r*o),a.m21=2*(i*r-n*o),a.m22=1-2*(i*i+n*n),a.m23=2*(r*n+i*o),a.m31=2*(i*n+r*o),a.m32=2*(r*n-i*o),a.m33=1-2*(i*i+r*r),a.setFromMatrix(a),a;}},{key:"fromMatrix",value:function value(t){var i=new e();return i.setFromMatrix(t),i.is2D=!!t.is2D,i;}},{key:"fromFloat32Array",value:function value(t){var i=new e();return WN(t,i),i;}},{key:"fromFloat64Array",value:function value(t){var i=new e();return WN(t,i),i;}}]);}();function LN(e,t,i,r){return{x:i*e.x+r*t.x,y:i*e.y+r*t.y,z:i*e.z+r*t.z};}function NN(e){var t;if(e.length!==e[0].length)throw new Error();var i=e.length,r=0;if(i>3)for(var n=0;n<i;n++)r+=e[0][n]*ON(e,0,n);else 3===i?r=e[0][0]*e[1][1]*e[2][2]+e[0][1]*e[1][2]*e[2][0]+e[0][2]*e[1][0]*e[2][1]-e[0][2]*e[1][1]*e[2][0]-e[0][1]*e[1][0]*e[2][2]-e[0][0]*e[1][2]*e[2][1]:2===i?r=e[0][0]*e[1][1]-e[0][1]*e[1][0]:1===i&&(t=Gb(e,1),r=Gb(t[0],1)[0]);return r;}function ON(e){for(var t,i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=e.length,a=$E(t=cP(i=new Array(o-1)).call(i,0)).call(t,function(e){var t;return cP(t=new Array(o-1)).call(t,0);}),s=0;s<o-1;s++)for(var u=0;u<o-1;u++){var l=s<r?s:s+1,c=u<n?u:u+1;a[s][u]=e[l][c];}return Math.pow(-1,r+n)*NN(a);}function WN(e,t){var i=Gb(e,16),r=i[0],n=i[1],o=i[2],a=i[3],s=i[4],u=i[5],l=i[6],c=i[7],h=i[8],d=i[9],f=i[10],v=i[11],g=i[12],m=i[13],y=i[14],p=i[15];if(6===e.length)t.m11=r,t.m12=n,t.m21=o,t.m22=a,t.m41=s,t.m42=u,t.m13=0,t.m14=0,t.m23=0,t.m24=0,t.m31=0,t.m32=0,t.m34=0,t.m33=1,t.m44=1,t.is2D=!0;else{if(16!==e.length)throw new Error();t.m11=r,t.m12=n,t.m13=o,t.m14=a,t.m21=s,t.m22=u,t.m23=l,t.m24=c,t.m31=h,t.m32=d,t.m33=f,t.m34=v,t.m41=g,t.m42=m,t.m43=y,t.m44=p,t.is2D=!1;}}function HN(e,t){var i={},r=e.m11,n=e.m21,o=e.m31,a=e.m41,s=e.m12,u=e.m22,l=e.m32,c=e.m42,h=e.m13,d=e.m23,f=e.m33,v=e.m43,g=e.m14,m=e.m24,y=e.m34,p=e.m44,w=t.m11,b=t.m21,k=t.m31,S=t.m41,x=t.m12,C=t.m22,V=t.m32,T=t.m42,I=t.m13,E=t.m23,P=t.m33,B=t.m43,D=t.m14,M=t.m24,z=t.m34,U=t.m44;return i.m11=r*w+n*x+o*I+a*D,i.m21=r*b+n*C+o*E+a*M,i.m31=r*k+n*V+o*P+a*z,i.m41=r*S+n*T+o*B+a*U,i.m12=s*w+u*x+l*I+c*D,i.m22=s*b+u*C+l*E+c*M,i.m32=s*k+u*V+l*P+c*z,i.m42=s*S+u*T+l*B+c*U,i.m13=h*w+d*x+f*I+v*D,i.m23=h*b+d*C+f*E+v*M,i.m33=h*k+d*V+f*P+v*z,i.m43=h*S+d*T+f*B+v*U,i.m14=g*w+m*x+y*I+p*D,i.m24=g*b+m*C+y*E+p*M,i.m34=g*k+m*V+y*P+p*z,i.m44=g*S+m*T+y*B+p*U,i;}function FN(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,1];e=xN(e);var i=Math.sin(e/2)*Math.cos(e/2),r=Math.pow(Math.sin(e/2),2),n=Gb(t,3),o=n[0],a=n[1],s=n[2];return{m11:1-2*(Math.pow(a,2)+Math.pow(s,2))*r,m21:2*(o*a*r-s*i),m31:2*(o*s*r+a*i),m41:0,m12:2*(o*a*r+s*i),m22:1-2*(Math.pow(o,2)+Math.pow(a,2))*r,m32:2*(a*s*r-o*i),m42:0,m13:2*(o*s*r-a*i),m23:2*(a*s*r+o*i),m33:1-2*(Math.pow(o,2)+Math.pow(a,2))*r,m43:0,m14:0,m24:0,m34:0,m44:1};}function jN(e,t){var i=new RN();return e&&(i.m21=Math.tan(xN(e))),t&&(i.m12=Math.tan(xN(t))),i;}function YN(e,t,i){var r=e.x-t.x,n=e.y-t.y,o=(i.x-e.x)*r+(i.y-e.y)*n;return o/=r*r+n*n,new IN(e.x+o*r,e.y+o*n);}function XN(e,t){return Math.pow(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2),.5);}function qN(e,t,i){return(i.x-e.x)*(t.y-e.y)==(t.x-e.x)*(i.y-e.y)&&Math.min(e.x,t.x)<=i.x&&i.x<=Math.max(e.x,t.x)&&Math.min(e.y,t.y)<=i.y&&i.y<=Math.max(e.y,t.y);}var ZN=function(){return Yk(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Xk(this,e),Wk(this,"x",0),Wk(this,"y",0),Wk(this,"left",0),Wk(this,"top",0),Wk(this,"right",0),Wk(this,"bottom",0),Wk(this,"width",0),Wk(this,"height",0),this.update(t,i,r,n);},[{key:"update",value:function value(e,t,i,r){this.x=e,this.y=t,this.left=e,this.top=t,this.right=e+i,this.bottom=t+r,this.width=i,this.height=r;}},{key:"toJSON",value:function value(){}}]);}();function _N(e,t,i,r,n){var o=Math.cos,a=Math.sin;return{x:(e-i)*o(n)-(t-r)*a(n)+i,y:(e-i)*a(n)+(t-r)*o(n)+r};}var GN=function(){return Yk(function e(t){Xk(this,e),Wk(this,"uid",void 0),Wk(this,"children",void 0),this.uid=t.uid,this.children=t.children||[];},[{key:"append",value:function value(e){var t=this.children;return OI(t).call(t,e)<0&&(t.push(e),!0);}},{key:"insert",value:function value(e,t){var i=this.children;return!(t<0||(t>i.length&&(t=i.length),gE(i).call(i,t,0,e),0));}},{key:"remove",value:function value(e){var t=this.children,i=OI(t).call(t,e);return!(i<0||(gE(t).call(t,i,1),0));}},{key:"clear",value:function value(){return this.children=[],!0;}},{key:"move",value:function value(e,t){if(e===t)return!0;var i=this.children,r=Gb(gE(i).call(i,e,1),1)[0];return gE(i).call(i,t,0,r),!0;}},{key:"switch",value:function value(e,t){if(e===t)return!0;var i=this.children,r=i[e];return i[e]=i[t],i[t]=r,!0;}},{key:"reorder",value:function value(e){var t=this.children,i=e.length,r=[],n=0;if(t.length!==i||0===i)return!1;for(var o=0;o<i;o++)e[o]===o&&(n+=1);if(n===i)return!0;for(var a=0;a<i;a++)r[a]=t[e[a]];for(var s=0;s<i;s++)t[s]=r[s];return!0;}}]);}(),KN=function(){return Yk(function e(){Xk(this,e),Wk(this,"strategies",{});},[{key:"executeStrategy",value:function value(e){for(var t,i,r,n=arguments.length,o=new Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];return null===(t=(i=this.strategies)[e])||void 0===t?void 0:t.call.apply(t,lS(r=[i]).call(r,o));}},{key:"addStrategy",value:function value(e,t){var i=this.strategies;return!i[e]&&(i[e]=t,!0);}}]);}(),$N=new(function(){return Yk(function e(){Xk(this,e),Wk(this,"tasks",[]);},[{key:"createTimer",value:function value(e,t){var i=WL();return this.tasks.push({uid:i,callback:e,time:t}),this.executeTimer(i),i;}},{key:"executeTimer",value:function value(e){var t,i=xP(t=this.tasks).call(t,function(t){return t.uid===e;});if(i){var _r2=function r(){i.callback(),null!==i.timer&&(i.timer=jP(_r2,i.time));};i.timer=jP(_r2,i.time);}}},{key:"clearTimer",value:function value(e){var t,i,r=EE(t=this.tasks).call(t,function(t){return t.uid===e;});r>-1&&(clearTimeout(this.tasks[r].timer),this.tasks[r].timer=null,gE(i=this.tasks).call(i,r,1));}}]);}())(),JN=function(){return Yk(function e(t,i){Xk(this,e),Wk(this,"isDestroyed",!1),Wk(this,"data",void 0),Wk(this,"table",["database","table","item"]),Wk(this,"dbName",void 0),Wk(this,"tableName",void 0),this.data={},this.dbName=t,this.tableName=i,this.createDatabase(t,i);},[{key:"destroy",value:function value(){if(!this.isDestroyed){for(var e=0,t=oB(this.data);e<t.length;e++){var i=Gb(t[e],2),r=i[0];i[1],this.data[r]=null;}this.data=null,this.isDestroyed=!0;}}},{key:"createDatabase",value:function value(e,t){this.data[e]={},this.data[e][t]={};}},{key:"set",value:function value(e,t){var i=this,r=this.dbName,n=this.tableName;return new uB(function(o,a){i.checkId(e)?a(new Error("The ".concat(e," already exists."))):(i.data[r][n][e]=t,o("Save ".concat(e," to database successful.")));});}},{key:"get",value:function value(e){var t=this,i=this.dbName,r=this.tableName;return new uB(function(n,o){t.checkId(e)?n(t.data[i][r][e]):o(t.erMsg(2,e));});}},{key:"remove",value:function value(e){var t=this,i=this.dbName,r=this.tableName;return new uB(function(n,o){delete t.data[i][r][e],n("Remove ".concat(e," successful."));});}},{key:"update",value:function value(e,t){var i=this,r=this.dbName,n=this.tableName;return new uB(function(o,a){i.checkId(e)?(i.data[r][n][e]=t,o("Update ".concat(e," successful."))):a(i.erMsg(2,e));});}},{key:"checkId",value:function value(e){var t=this.dbName,i=this.tableName;return void 0!==this.data[t][i][e];}},{key:"erMsg",value:function value(e,t){var i;return lS(i="The ".concat(this.table[e]," ")).call(i,t," does not exist.");}}]);}(),QN=function(){return Yk(function e(){Xk(this,e),Wk(this,"isDestroyed",!1),Wk(this,"data",void 0),this.data={};},[{key:"destroy",value:function value(){if(!this.isDestroyed){for(var e=0,t=oB(this.data);e<t.length;e++){var i,r=Gb(t[e],2),n=r[0];r[1],null!==(i=this.data[n])&&void 0!==i&&i.destroy(),this.data[n]=null;}this.data=null,this.isDestroyed=!0;}}},{key:"set",value:function value(e,t){return!this.check(e)&&(this.data[e]=t,!0);}},{key:"get",value:function value(e){return this.data[e];}},{key:"remove",value:function value(e){return!!this.check(e)&&(delete this.data[e],!0);}},{key:"update",value:function value(e,t){return!!this.check(e)&&(this.data[e]=t,!0);}},{key:"check",value:function value(e){return void 0!==this.data[e];}}]);}(),eO=function(e){function t(e){var i;return Xk(this,t),Wk(yb(i=cL(this,t,[e])),"name",void 0),Wk(yb(i),"type",void 0),Wk(yb(i),"fileType",void 0),Wk(yb(i),"createdDate",void 0),Wk(yb(i),"modifiedDate",void 0),Wk(yb(i),"parent",void 0),Wk(yb(i),"isRoot",!1),i.name=e.name,i.type=e.type,i.fileType=e.fileType,i.parent=e.parent||null,i.isRoot=e.isRoot||!1,i.createdDate=VL(),i.modifiedDate=i.createdDate,i;}return _b(t,e),Yk(t,[{key:"updateDate",value:function value(){this.modifiedDate=VL();}},{key:"setName",value:function value(e){this.name=e;}},{key:"reorder",value:function value(e){var i=this.type;return("file"===i||"default"===i)&&hL(t,"reorder",this,3)([e]);}}]);}(GN),tO=function(){return Yk(function e(){Xk(this,e),Wk(this,"root",void 0),Wk(this,"currentNode",void 0),Wk(this,"selectedUid",void 0),Wk(this,"defaultNode",void 0),Wk(this,"hooks",{fileChanged:SN.create(),beforeRemoveFile:SN.create(),removeFile:SN.create(),afterRemoveFile:SN.create(),afterRenameFile:SN.create(),destroy:SN.create()}),this.root=new eO({uid:WL(),children:[],name:"root",type:"file",fileType:"folder",parent:void 0,isRoot:!0}),this.defaultNode=this.root,this.currentNode=this.root;},[{key:"appendChildrenToFile",value:function value(e,t,i){var r=i,n=iO(this.defaultNode,e);return n||(n=this.createFile(e),this.hooks.fileChanged.emit(this.defaultNode)),$k(t).call(t,function(e){CL(r)?n.append(e):(n.insert(e,r),r+=1);}),n;}},{key:"removeChildFromFile",value:function value(e,t){TL(t)&&(t=[t]);var i=this.getFileByUid(e);i&&$k(t).call(t,function(e){i.remove(e);});}},{key:"findChild",value:function value(e,t){var i;return xP(i=e.children).call(i,function(e){return e.name===t;});}},{key:"createFile",value:function value(e){var t=this.defaultNode;t||(t=this.root);var i=iO(t,e);return i&&"file"===i.type||(i=new eO({uid:WL(),children:[],name:e,type:"file",fileType:"file",parent:t,isRoot:!1}),this.currentNode.append(i),this.hooks.fileChanged.emit(this.currentNode.children)),i;}},{key:"removeFile",value:function value(e){for(var t=this.defaultNode.children,i=0;i<t.length;i++){var r=t[i];if(r.name===e)return this.hooks.beforeRemoveFile.emit(r),gE(t).call(t,i,1),this.hooks.afterRemoveFile.emit(r),this.hooks.fileChanged.emit(r),!0;}return!1;}},{key:"renameFile",value:function value(e,t){var i=this.findChild(this.defaultNode,e),r=this.findChild(this.defaultNode,t);return!!i&&!r&&(i.name=t,this.hooks.afterRenameFile.emit(i),this.hooks.fileChanged.emit(this.currentNode.children),!0);}},{key:"getFile",value:function value(e){return this.findChild(this.defaultNode,e);}},{key:"getFileByUid",value:function value(e){return xP(this).call(this,e,this.root);}},{key:"getCurrentFileList",value:function value(){return this.currentNode.children;}},{key:"isFileExist",value:function value(e){return!!this.findChild(this.defaultNode,e);}},{key:"createFolder",value:function value(){}},{key:"find",value:function value(e,t){for(var i=t.children,r=i.length,n=0;n<r;n++){if(i[n].uid===e)return i[n];if(i[n].children){var o=xP(this).call(this,e,i[n]);if(o)return o;}}return null;}}]);}();function iO(e,t){var i,r=yx(i=e.children).call(i,function(e){return e.name===t;});return 0===r.length?null:r[0];}var rO,nO=function(e){function t(e){var i;return Xk(this,t),Wk(yb(i=cL(this,t,[e])),"name",void 0),Wk(yb(i),"type","tag"),i.name=e.name,i.uid=e.uid||WL(),i.type="tag",i;}return _b(t,e),Yk(t);}(GN),oO=function(){return Yk(function e(){Xk(this,e),Wk(this,"tags",void 0),Wk(this,"defaultName",void 0),Wk(this,"defaultUid",void 0),Wk(this,"selectedUid",void 0),Wk(this,"emptyItem",void 0),Wk(this,"hooks",{beforeRemoveTag:SN.create(),afterRenameTag:SN.create(),destroy:SN.create(),load:SN.create()}),this.tags=[],this.defaultName=null,this.defaultUid=null,this.selectedUid=null,this.emptyItem=new nO({name:"defaultTag",children:[]});},[{key:"appendChildToTag",value:function value(e,t){var i=this.createTag(e);TL(t)&&(t=[t]);var r=!1;return $k(t).call(t,function(e){i.append(e)&&(r=!0);}),r;}},{key:"removeChildFromTag",value:function value(e,t){var i=this.getTag(e);return!!i&&(TL(t)&&(t=[t]),$k(t).call(t,function(e){i.remove(e);}),!0);}},{key:"createTag",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=this.getTag(e);return i||(i=new nO({name:e,children:t}),this.tags.push(i)),i;}},{key:"removeTag",value:function value(e){var t,i,r=this.getTag(e);if(!r)return!1;this.hooks.beforeRemoveTag.emit(r);var n=EE(t=this.tags).call(t,function(t){return t.name===e;});return e===this.defaultName&&(this.defaultName=null,this.selectedUid=null),gE(i=this.tags).call(i,n,1),!0;}},{key:"renameTag",value:function value(e,t){if(!TL(e)||!TL(t))return!1;var i=this.isTagExisted(t),r=this.getTag(e);return!(!r||i||(r.name=t,this.hooks.afterRenameTag.emit(r),0));}},{key:"getTag",value:function value(e){var t;return xP(t=this.tags).call(t,function(t){return t.name===e;});}},{key:"getTagByUid",value:function value(e){var t;return xP(t=this.tags).call(t,function(t){return t.uid===e;});}},{key:"getTagList",value:function value(){var e;return RI(e=this.tags).call(e);}},{key:"setDefaultTag",value:function value(e){if(!e)return this.defaultName=null,this.defaultUid=null,!0;var t=this.getTag(e);return!!t&&(this.defaultName=e,this.defaultUid=t.uid,!0);}},{key:"getDefaultTag",value:function value(){return this.defaultName;}},{key:"isTagExisted",value:function value(e){return!!this.getTag(e);}}]);}(),aO=function(){return Yk(function e(){Xk(this,e);},[{key:"apply",value:function value(e){var t=e.hooks,i={beforeStatus:null,afterStatus:null,operation:null,docUid:null},r=function r(e){i.beforeStatus={uids:e.uids,selectedUids:[],currentUid:"",modifiedUid:e.modifiedUid,removedUids:e.removedUids};},n=function n(t){i.afterStatus={uids:t.uids,selectedUids:[],currentUid:"",modifiedUid:t.modifiedUid,removedUids:t.removedUids},i.docUid=t.docUid,i.operation=t.operation,i.docType=t.docType,i.docName=t.docName,e.emit("bufferChanged",Fk({},i)),i={beforeStatus:null,afterStatus:null,operation:null,docUid:null};};t.beforeBufferChanged.on(r),t.afterBufferChanged.on(n),t.destroy.on(function(){t.beforeBufferChanged.off(r),t.afterBufferChanged.off(n);});}}]);}(),sO=function(){return Yk(function e(){Xk(this,e);},[{key:"apply",value:function value(e){var t=e.hooks;e.customStore=new QN();var i=function i(t){var i=t.data;$k(i).call(i,function(t){var i=t.customData;i||(i={}),e.customStore.set(t.uid,i);});},r=function r(t){var i=t.removedUids;$k(i).call(i,function(t){e.customStore.remove(t);});},n=function n(t){var i=t.data.customData;i&&e.customStore.update(t.modifiedUid,i);};t.loadSource.on(i),t.removeSource.on(r),t.updateSource.on(n),t.destroy.on(function(){t.loadSource.off(i),t.removeSource.off(r),t.updateSource.off(n);});}}]);}(),uO=function(e){function t(){var e;return Xk(this,t),Wk(e=cL(this,t,[{uid:WL(),children:[]}]),"name","dvs-default"),Wk(e,"isDestroyed",!1),Wk(e,"type",void 0),e;}return _b(t,e),Yk(t,[{key:"destroy",value:function value(){this.isDestroyed||(this.isDestroyed=!0);}}]);}(GN),lO=function(){return Yk(function e(){Xk(this,e);},[{key:"apply",value:function value(e){e.defaultFile=new uO();var t=e.hooks,i=function i(t){var i,r,n,o=t.filename,a=t.index,s=t.data;if(CL(o)){var u=$E(s).call(s,function(e){return e.uid;});void 0===a?(i=e.defaultFile.children).push.apply(i,Kb(u)):gE(r=e.defaultFile.children).apply(r,lS(n=[a,0]).call(n,Kb(u)));var l={docUid:e.defaultFile.uid,sourceUids:u,type:"default",index:a};e.hooks.loadToDoc.emit(l);}},r=function r(t){var i=t.removedUids,r=[];$k(i).call(i,function(t){var i=e.statusStore.get(t);i&&i.ownerDefaultFile&&(e.defaultFile.remove(t),r.push(t));}),r.length&&e.hooks.removeFromDoc.emit({docUid:e.defaultFile.uid,sourceUids:i,type:"default"});};t.loadSource.on(i),t.removeSource.on(r),t.destroy.on(function(){t.loadSource.off(i),t.removeSource.off(r);});}}]);}(),cO=function(){return Yk(function e(){Xk(this,e);},[{key:"apply",value:function value(e){e.dir=new tO(),this.listenDirectoryHooks(e),this.listenSpaceHooks(e);}},{key:"listenDirectoryHooks",value:function value(e){var t=e.dir.hooks,i=function i(t){var i;$k(i=t.children).call(i,function(i){var r=e.statusStore.get(i);r&&r.ownerFiles.remove(t.uid);}),e.hooks.removeDoc.emit(t);},r=function r(t){e.hooks.renameDoc.emit(t);};t.beforeRemoveFile.on(i),t.afterRenameFile.on(r),t.destroy.on(function(){t.beforeRemoveFile.off(i),t.afterRenameFile.off(r);});}},{key:"listenSpaceHooks",value:function value(e){var t=e.hooks,i=function i(t){var i=t.data,r=t.filename,n=t.index;if(!CL(r)){var o=e.dir.getFile(r);e.hooks.beforeBufferChanged.emit({docType:"file",docUid:null==o?void 0:o.uid,uids:Kb((null==o?void 0:o.children)||[]),operation:"add"});var a=$E(i).call(i,function(e){return e.uid;}),s=e.dir.appendChildrenToFile(r,a,n),u={docUid:s.uid,sourceUids:a,type:"file",index:n};e.hooks.loadToDoc.emit(u),e.hooks.afterBufferChanged.emit({docType:"file",docName:r,docUid:null==s?void 0:s.uid,uids:Kb((null==s?void 0:s.children)||[]),operation:"add"});}},r=function r(t){var i=t.removedUids,r={};$k(i).call(i,function(t){var i,n,o=e.statusStore.get(t);o&&$k(i=RI(n=o.ownerFiles.children).call(n)).call(i,function(e){r[e]||(r[e]=[]),r[e].push(t);});});for(var n=0,o=oB(r);n<o.length;n++){var a=Gb(o[n],2),s=a[0],u=a[1],l=e.dir.getFileByUid(s);l&&(e.hooks.beforeBufferChanged.emit({docUid:s,uids:Kb(l.children),removedUids:Kb(u),operation:"remove"}),e.dir.removeChildFromFile(s,u),e.hooks.afterBufferChanged.emit({docType:"file",docName:l.name,docUid:s,uids:Kb(l.children),removedUids:Kb(u),operation:"remove"})),e.hooks.removeFromDoc.emit({docUid:s,sourceUids:u});}},n=function n(t){var i,r,n=e.statusStore.get(t.modifiedUid);n&&$k(i=RI(r=n.ownerFiles.children).call(r)).call(i,function(i){var r=e.dir.getFileByUid(i);r&&(e.hooks.beforeBufferChanged.emit({uids:Kb(r.children),modifiedUid:t.modifiedUid,operation:"modify"}),e.hooks.afterBufferChanged.emit({docType:"file",docName:r.name,docUid:i,uids:Kb(r.children),modifiedUid:t.modifiedUid,operation:"modify"}));});};t.loadSource.on(i),t.removeSource.on(r),t.updateSource.on(n),t.destroy.on(function(){t.loadSource.off(i),t.removeSource.off(r),t.updateSource.off(n);});}}]);}(),hO=function(){return Yk(function e(){Xk(this,e);},[{key:"apply",value:function value(e){var t=e.hooks;e.metadataStore=new QN();var i=function i(t){var i=t.data;$k(i).call(i,function(t){var i=t.metadata;i||(i={width:void 0,height:void 0}),e.metadataStore.set(t.uid,i);});},r=function r(t){var i=t.removedUids;$k(i).call(i,function(t){e.metadataStore.remove(t);});},n=function n(t){var i=t.data.metadata;i&&e.metadataStore.update(t.modifiedUid,i);};t.loadSource.on(i),t.removeSource.on(r),t.updateSource.on(n),t.destroy.on(function(){t.loadSource.off(i),t.removeSource.off(r),t.updateSource.off(n);});}}]);}(),dO=function(){return Yk(function e(t){Xk(this,e),Wk(this,"uid",null),Wk(this,"minData",null),Wk(this,"oriData",null),Wk(this,"customData",{}),Wk(this,"activeOri",!1),Wk(this,"activeMin",!1),Wk(this,"minTask",null),Wk(this,"oriTask",null),Wk(this,"load",!1),Wk(this,"preload",[]),Wk(this,"visible",[]),Wk(this,"overlays",[]),Wk(this,"img",null),Wk(this,"minImg",null),Wk(this,"imageScale",1),Wk(this,"owners",[]),Wk(this,"oriType",null),Wk(this,"minType",null),Wk(this,"metadata",null),Wk(this,"realTimeWidth",0),Wk(this,"realTimeHeight",0),Wk(this,"isFromFile",!1),Wk(this,"isCached",!1),Wk(this,"isDestroyed",!1),Wk(this,"isLoading",!1),Wk(this,"isMinLoading",!1),Wk(this,"isSaving",!1),Wk(this,"annotations",void 0),Wk(this,"ownerFiles",new GN({children:[]})),Wk(this,"ownerTags",new GN({children:[]})),Wk(this,"ownerDefaultFile",void 0),Wk(this,"operations",[]),Wk(this,"useFillColor",!1),this.uid=t.uid,this.metadata=Fk({},t.metadata),this.setRealTimeSize(this.metadata.width,this.metadata.height);},[{key:"setRealTimeSize",value:function value(e,t){this.realTimeWidth=e,this.realTimeHeight=t;}},{key:"destroy",value:function value(){this.isDestroyed||(this.customData=null,this.img=null,this.owners=null,this.metadata=null,this.isDestroyed=!0);}},{key:"addOwner",value:function value(e){var t=this.owners;OI(t).call(t,e)<0&&t.push(e);}},{key:"removeOwner",value:function value(e){var t=this.owners,i=OI(t).call(t,e);i>-1&&gE(t).call(t,i,1);}},{key:"removeViewer",value:function value(e){var t=this.owners,i=OI(t).call(t,e);i>-1&&gE(t).call(t,i,1);}},{key:"setVisible",value:function value(e){var t;OI(t=this.visible).call(t,e)<0&&this.visible.push(e);}},{key:"cancelVisible",value:function value(e){var t,i,r=OI(t=this.visible).call(t,e);r>-1&&gE(i=this.visible).call(i,r,1);}},{key:"setPreload",value:function value(e){var t;OI(t=this.preload).call(t,e)<0&&this.preload.push(e);}},{key:"cancelPreload",value:function value(e){var t,i,r=OI(t=this.preload).call(t,e);r>-1&&gE(i=this.preload).call(i,r,1);}},{key:"reset",value:function value(){this.minData=null,this.oriData=null,this.img=null,this.activeOri=!1,this.activeMin=!1,this.minTask=null,this.oriTask=null,this.operations=[];}}]);}(),fO=function(){return Yk(function e(){Xk(this,e);},[{key:"apply",value:function value(e){var t=e.hooks;e.statusStore=new QN();var i=function i(t){var i=t.data;t.filename,t.index,$k(i).call(i,function(t){var i=new dO(t);e.statusStore.set(t.uid,i);});},r=function r(t){var i=t.removedUids;$k(i).call(i,function(t){var i,r,n=e.statusStore.get(t);n&&(mN(n.minData),mN(n.oriData),n.ownerFiles.clear(),n.ownerTags.clear(),n.ownerDefaultFile=!1,null!==(i=n.img)&&void 0!==i&&i.src&&(n.img.src=""),null!==(r=n.minImg)&&void 0!==r&&r.src&&(n.minImg.src=""),n.img=null,n.minImg=null),e.statusStore.remove(t);});},n=function n(t){var i=t.modifiedUid,r=t.data,n=t.revoke,o=e.statusStore.get(i);if(o){o.img=null,o.minImg=null;var a=r.metadata;a&&(o.metadata=Fk({},a),o.setRealTimeSize(a.width,a.height)),n&&(mN(o.oriData),mN(o.minData)),o.reset(),e.statusStore.update(i,o);}},o=function o(t){var i;$k(i=t.children).call(i,function(i){var r=e.statusStore.get(i);r&&("file"===t.type?r.ownerFiles.remove(t.uid):"tag"===t.type&&r.ownerTags.remove(t.uid));});},a=function a(t){var i=t.docUid,r=t.sourceUids,n=t.type;$k(r).call(r,function(t){var r=e.statusStore.get(t);r&&("file"===n?r.ownerFiles.append(i):"tag"===n?r.ownerTags.append(i):"default"===n&&(r.ownerDefaultFile=!0));});},s=function s(t){var i=t.docUid,r=t.sourceUids,n=t.type;$k(r).call(r,function(t){var r=e.statusStore.get(t);r&&("file"===n?r.ownerFiles.remove(i):"tag"===n?r.ownerTags.remove(i):"default"===n&&(r.ownerDefaultFile=!0));});};t.loadSource.on(i),t.afterRemoveSource.on(r),t.updateSource.on(n),t.removeDoc.on(o),t.loadToDoc.on(a),t.removeFromDoc.on(s),t.destroy.on(function(){t.loadSource.off(i),t.afterRemoveSource.off(r),t.updateSource.off(n),t.removeDoc.off(o),t.loadToDoc.off(a),t.removeFromDoc.off(s);});}}]);}(),vO=function(){return Yk(function e(){Xk(this,e);},[{key:"apply",value:function value(e){var t=e.hooks;e.store=new JN("space_db","space_doc");var i=function i(t){var i=t.data;i&&$k(i).call(i,function(t){e.store.set(t.uid,t);});},r=function r(t){var i;$k(i=t.removedUids).call(i,function(t){e.store.remove(t);});},n=function n(t){e.store.update(t.modifiedUid,t.data);};t.loadSource.on(i),t.removeSource.on(r),t.updateSource.on(n),t.destroy.on(function(){t.loadSource.off(i),t.removeSource.off(r),t.updateSource.off(n);});}}]);}(),gO=function(){return Yk(function e(){Xk(this,e);},[{key:"apply",value:function value(e){e.tag=new oO(),this.listenSpaceHooks(e),this.listenTagHooks(e);}},{key:"listenTagHooks",value:function value(e){var t=e.tag.hooks,i=function i(t){var i;$k(i=t.children).call(i,function(i){var r=e.statusStore.get(i);r&&r.ownerFiles.remove(t.uid);}),e.hooks.removeDoc.emit(t);},r=function r(t){e.hooks.renameDoc.emit(t);};t.beforeRemoveTag.on(i),t.afterRenameTag.on(r),t.destroy.on(function(){t.beforeRemoveTag.off(i),t.afterRenameTag.off(r);});}},{key:"listenSpaceHooks",value:function value(e){var t=e.hooks,i=function i(t){var i=t.data,r=e.tag.defaultName;$k(i).call(i,function(e){var t;(e.tags||(e.tags=[]),r)&&OI(t=e.tags).call(t,r)<0&&e.tags.push(r);});},r=function r(t){var i=t.data;$k(i).call(i,function(t){var i;null!==(i=t.tags)&&void 0!==i&&$k(i).call(i,function(i){var r=e.tag.getTag(i);e.hooks.beforeBufferChanged.emit({uids:Kb((null==r?void 0:r.children)||[]),operation:"add"}),e.tag.appendChildToTag(i,t.uid);var n=e.tag.getTag(i),o={docUid:n.uid,sourceUids:[t.uid],type:"tag"};e.hooks.loadToDoc.emit(o),e.hooks.afterBufferChanged.emit({docType:"tag",docName:i,docUid:null==n?void 0:n.uid,uids:Kb((null==n?void 0:n.children)||[]),operation:"add"});}),t.tags.length=0;});},n=function n(t){var i=t.removedUids,r={};$k(i).call(i,function(t){var i,n,o=e.statusStore.get(t);o&&$k(i=RI(n=o.ownerTags.children).call(n)).call(i,function(e){r[e]||(r[e]=[]),r[e].push(t);});});for(var n=0,o=oB(r);n<o.length;n++){var a=Gb(o[n],2),s=a[0],u=a[1],l=e.tag.getTagByUid(s);l&&(e.hooks.beforeBufferChanged.emit({uids:Kb(l.children),removedUids:Kb(u),operation:"remove"}),e.tag.removeChildFromTag(l.name,u),e.hooks.afterBufferChanged.emit({docType:"tag",docName:l.name,docUid:s,uids:Kb(l.children),removedUids:Kb(u),operation:"remove"})),e.hooks.removeFromDoc.emit({docUid:s,sourceUids:u,type:"tag"});}},o=function o(e){"tag"!==e.type&&n({removedUids:e.children});},a=function a(t){var i=t.docUid,r=t.sourceUids;if("tag"===t.type){var n=e.tag.getTagByUid(i);n&&$k(r).call(r,function(){var t=mb(vb().mark(function t(i){var r,o;return vb().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.store.get(i);case 3:if(o=t.sent,t.t0=o&&OI(r=o.tags).call(r,n.name)<0,!t.t0){t.next=9;break;}return o.tags.push(n.name),t.next=9,e.store.update(i,o);case 9:t.next=14;break;case 11:t.prev=11,t.t1=t.catch(0),console.log();case 14:case"end":return t.stop();}},t,null,[[0,11]]);}));return function(e){return t.apply(this,arguments);};}());}},s=function s(t){var i=t.docUid,r=t.sourceUids;if("tag"===t.type){var n=e.tag.getTagByUid(i);n&&$k(r).call(r,function(){var t=mb(vb().mark(function t(i){var r,o,a,s;return vb().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.store.get(i);case 3:if(!(r=t.sent)){t.next=9;break;}return(s=OI(o=r.tags).call(o,n.name))>-1&&gE(a=r.tags).call(a,s,1),t.next=9,e.store.update(i,r);case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),console.log();case 14:case"end":return t.stop();}},t,null,[[0,11]]);}));return function(e){return t.apply(this,arguments);};}());}},u=function u(t){var i,r,n=e.statusStore.get(t.modifiedUid);n&&$k(i=RI(r=n.ownerTags.children).call(r)).call(i,function(i){var r=e.tag.getTagByUid(i);r&&(e.hooks.beforeBufferChanged.emit({uids:Kb(r.children),modifiedUid:t.modifiedUid,operation:"modify"}),e.hooks.afterBufferChanged.emit({docType:"tag",docName:r.name,docUid:i,uids:Kb(r.children),modifiedUid:t.modifiedUid,operation:"modify"}));});};t.beforeLoadSource.on(i),t.loadSource.on(r),t.removeSource.on(n),t.removeDoc.on(o),t.loadToDoc.on(a),t.removeFromDoc.on(s),t.updateSource.on(u),t.destroy.on(function(){t.beforeLoadSource.off(i),t.loadSource.off(r),t.removeSource.off(n),t.removeDoc.off(o),t.loadToDoc.off(a),t.removeFromDoc.off(s),t.updateSource.off(u);});}}]);}(),mO=function(e){function t(){var e;return Xk(this,t),Wk(yb(e=cL(this,t)),"uid",WL()),Wk(yb(e),"hooks",{init:SN.create(),destroy:SN.create(),beforeLoadSource:SN.create(),loadSource:SN.create(),afterLoadSource:SN.create(),beforeRemoveSource:SN.create(),removeSource:SN.create(),afterRemoveSource:SN.create(),beforeUpdateSource:SN.create(),updateSource:SN.create(),afterUpdateSource:SN.create(),beforeBufferChanged:SN.create(),afterBufferChanged:SN.create(),directoryChanged:SN.create(),tagChanged:SN.create(),openDoc:SN.create(),loadToDoc:SN.create(),removeFromDoc:SN.create(),removeDoc:SN.create(),renameDoc:SN.create(),move:SN.create(),afterMove:SN.create(),switch:SN.create(),afterSwitch:SN.create(),reorder:SN.create(),afterReorder:SN.create()}),Wk(yb(e),"dir",void 0),Wk(yb(e),"tag",void 0),Wk(yb(e),"store",void 0),Wk(yb(e),"customStore",void 0),Wk(yb(e),"metadataStore",void 0),Wk(yb(e),"statusStore",void 0),Wk(yb(e),"defaultFile",void 0),Wk(yb(e),"plugins",[]),Wk(yb(e),"imageLoader",void 0),e.initPlugins(),e.hooks.init.emit(),e;}return _b(t,e),Yk(t,[{key:"destroy",value:function value(){this.hooks.destroy.emit();}},{key:"initPlugins",value:function value(){new vO().apply(this),new fO().apply(this),new sO().apply(this),new hO().apply(this),new aO().apply(this),new lO().apply(this),new cO().apply(this),new gO().apply(this);}},{key:"setImageLoader",value:function value(e){this.imageLoader=e;}},{key:"getCustomData",value:function value(e){return this.customStore.get(e);}},{key:"setCustomData",value:function value(e,t){return this.customStore.set(e,t);}},{key:"getMetadata",value:function value(e){return this.metadataStore.get(e);}},{key:"setMetadata",value:function value(e,t){return this.metadataStore.set(e,t);}},{key:"createStore",value:function value(e){var t=e.type,i=void 0===t?"sync":t,r=e.tableName,n=e.dbName;return"sync"===i?new QN():n&&r?new JN(n,r):null;}},{key:"loadSource",value:function value(e,t){if(CL(e))return[];var i=e.data;if(!bL(i))return[];var r=[];return $k(i).call(i,function(e){e.uid=WL(),r.push(e.uid);}),ML(t)&&t(r),this.hooks.beforeLoadSource.emit(e),this.hooks.loadSource.emit(e),this.hooks.afterLoadSource.emit(e),r;}},{key:"removeSource",value:function value(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];TL(e)&&(e=[e]);var i={removedUids:e,docUid:"",trigger:this.uid,operation:"remove"};return this.hooks.beforeRemoveSource.emit(i),this.hooks.removeSource.emit(i),t&&this.hooks.afterRemoveSource.emit(i),!0;}},{key:"updateSource",value:function value(e,t){var i={modifiedUid:e,data:t,revoke:!(arguments.length>2&&void 0!==arguments[2])||arguments[2],operation:"modify"};return this.hooks.beforeUpdateSource.emit(i),this.hooks.updateSource.emit(i),this.hooks.afterUpdateSource.emit(i),!0;}},{key:"getSource",value:function value(e){return this.store.get(e);}},{key:"openDefault",value:function value(e){var t={node:this.defaultFile,type:"default",config:e};this.hooks.openDoc.emit(t);}},{key:"createFile",value:function value(e){return this.dir.createFile(e);}},{key:"removeFile",value:function value(e){return this.dir.removeFile(e);}},{key:"renameFile",value:function value(e,t){return this.dir.renameFile(e,t);}},{key:"openFile",value:function value(e,t){var i=this.getFile(e);if(!i)return!1;var r={node:i,type:"file",config:t};return this.hooks.openDoc.emit(r),!0;}},{key:"movePagesToFile",value:function value(e,t,i,r){var n=this,o=this.getFile(e),a=this.getFile(i);if(!o||!a)return!1;for(var s=0;s<t.length;s++)if(t[s]<0||t[s]>=o.children.length)return!1;if(r<0)return!1;var u=$E(t).call(t,function(e){return o.children[e];});$k(u).call(u,function(e){var t=n.statusStore.get(e);t&&t.ownerFiles.remove(o.uid);}),this.dir.removeChildFromFile(o.uid,u),this.hooks.removeFromDoc.emit({docUid:o.uid,sourceUids:u}),r>a.children.length&&(r=a.children.length);var l=this.dir.appendChildrenToFile(i,u,r),c={docUid:l.uid,sourceUids:u,type:"file",index:r,isSameDoc:e===i};return $k(u).call(u,function(e){var t=n.statusStore.get(e);t&&t.ownerFiles.append(l.uid);}),this.hooks.loadToDoc.emit(c),!0;}},{key:"getFile",value:function value(e){return this.dir.getFile(e);}},{key:"getFileList",value:function value(){return this.dir.getCurrentFileList();}},{key:"isFileExisted",value:function value(e){return this.dir.isFileExist(e);}},{key:"createTag",value:function value(e){return this.tag.createTag(e);}},{key:"removeTag",value:function value(e){for(var t=this.getTag(e).children||[],i=0;i<t.length;i++)this.store.get(t[i]).then(function(t){var i,r,n=OI(i=(null==t?void 0:t.tags)||[]).call(i,e);-1!==n&&gE(r=t.tags).call(r,n,1);});return this.tag.removeTag(e);}},{key:"renameTag",value:function value(e,t){var i=this.getTag(e).children||[],r=this.tag.renameTag(e,t);if(r)for(var n=0;n<i.length;n++)this.store.get(i[n]).then(function(i){var r,n,o=OI(r=(null==i?void 0:i.tags)||[]).call(r,e);-1!==o&&gE(n=i.tags).call(n,o,1,t);});return r;}},{key:"openTag",value:function value(e,t){var i=this.getTag(e);if(!i)return!1;var r={node:i,type:"tag",config:t};return this.hooks.openDoc.emit(r),!0;}},{key:"getTag",value:function value(e){return this.tag.getTag(e);}},{key:"getTagList",value:function value(){return this.tag.getTagList();}},{key:"setDefaultTag",value:function value(e){return this.tag.setDefaultTag(e);}},{key:"getDefaultTag",value:function value(){return this.tag.getDefaultTag();}},{key:"isTagExisted",value:function value(e){return this.tag.isTagExisted(e);}},{key:"addTagToSource",value:function value(e,t){if(this.statusStore.get(e)){TL(t)&&(t=[t]);for(var i=0;i<t.length;i++)if(!this.addSourceToTag(t[i],e))return!1;return!0;}return!1;}},{key:"removeTagFromSource",value:function value(e,t){if(this.statusStore.get(e)){var i;CL(t)?t=$E(i=this.tag.tags).call(i,function(e){return e.name;}):TL(t)&&(t=[t]);for(var r=0;r<t.length;r++)if(!this.removeSourceFromTag(t[r],e))return!1;return!0;}return!1;}},{key:"addSourceToTag",value:function value(e,t){var i=this.tag.getTag(e);if(i&&this.tag.appendChildToTag(e,t)){TL(t)&&(t=[t]);for(var r=0;r<t.length;r++)this.store.get(t[r]).then(function(t){var i;t&&(bL(t.tags)||(t.tags=[]),AB(i=t.tags).call(i,e)||t.tags.push(e));});var n={sourceUids:t,docUid:i.uid,type:"tag"};return this.hooks.loadToDoc.emit(n),!0;}return!1;}},{key:"removeSourceFromTag",value:function value(e,t){var i=this.tag.getTag(e);if(i){this.tag.removeChildFromTag(e,t),TL(t)&&(t=[t]);for(var r=0;r<t.length;r++)this.store.get(t[r]).then(function(t){var i,r,n=OI(i=(null==t?void 0:t.tags)||[]).call(i,e);-1!==n&&gE(r=t.tags).call(r,n,1);});var n={docUid:i.uid,sourceUids:t,type:"tag"};return this.hooks.removeFromDoc.emit(n),!0;}return!1;}},{key:"getSourceTags",value:function value(e){var t,i=this,r=this.statusStore.get(e);return r?$E(t=r.ownerTags.children).call(t,function(e){return i.tag.getTagByUid(e).name;}):[];}},{key:"switch",value:function value(e){var t=e.one,i=e.other,r=e.type,n=e.docUid,o=e.emit,a=this.getDocNode(n,r);if(a){if(a.switch(t,i),o||CL(o)){var s={one:t,other:i,docUid:n,type:a.type,trigger:this.uid,operation:"shift"};this.hooks.switch.emit(s);}return!0;}return!1;}},{key:"move",value:function value(e){var t=e.from,i=e.to,r=e.type,n=e.docUid,o=e.emit,a=this.getDocNode(n,r);if(a){if(a.move(t,i),o||CL(o)){var s={from:t,to:i,docUid:n,type:a.type,trigger:this.uid,operation:"shift"};this.hooks.move.emit(s);}return!0;}return!1;}},{key:"reorder",value:function value(e){var t=e.indexes,i=e.type,r=e.docUid,n=e.emit,o=this.getDocNode(r,i);if(o&&(o.reorder(t),n||CL(n))){var a={indexes:t,docUid:r,type:o.type,trigger:this.uid,operation:"shift"};this.hooks.move.emit(a);}}},{key:"getDocNode",value:function value(e,t){switch(t){case"default":return this.defaultFile;case"file":return this.dir.getFileByUid(e);case"tag":return this.tag.getTagByUid(e);default:return e===this.defaultFile.uid?this.defaultFile:this.tag.getTagByUid(e)||this.dir.getFileByUid(e)||null;}}}]);}(bN),yO={Successful:{errorCode:0,errorString:"Successful."},InvalidIndex:{errorCode:-1033,errorString:"Invalid index."},InvalidValue:{errorCode:-1034,errorString:"Invalid value."},NoImage:{errorCode:-1035,errorString:"There is no image."},UnBindViewer:{errorCode:-2210,errorString:"You cannot call this method on this WebTwain instance because it does not use the default viewer."},AlReadyBindViewer:{errorCode:-2211,errorString:"The element is already bound to the viewer."},ParameterCannotEmpty:{errorCode:-2314,errorString:"The parameter cannot be empty."},IndicesNotArray:{errorCode:-2358,errorString:"The type of the parameter indices must be an Array."},IndexOutOfRange:{errorCode:-2359,errorString:"The index is out of range."},InvalidTagName:{errorCode:-2394,errorString:"Invalid tag name."},InvalidLeftOrTopOrRightOrBottom:{errorCode:-2417,errorString:"The left or top or right or bottom you entered is invalid."},InvalidWidth:{errorCode:-2418,errorString:"The width you entered is invalid."},InvalidHeight:{errorCode:-2419,errorString:"The height you entered is invalid."},WidthOrHeightOutOfImageSize:{errorCode:-2420,errorString:"The width or height is out of image size."},MobileServer_InvalidIndex:{errorCode:-2423,errorString:"The index is invalid."},ImageEditorExist:{errorCode:-2500,errorString:"An ImageEditor already exists."},ThumbnailViewerExist:{errorCode:-2501,errorString:"A ThumbnailViewer already exists."},CustomElementExist:{errorCode:-2502,errorString:"A CustomElement already exists."},ImageEditorDispose:{errorCode:-2504,errorString:"The ImageEditor object has been disposed."},ThumbnailViewerNotExist:{errorCode:-2505,errorString:"This ThumbnailViewer doesn't exist."},ThumbnailViewerDispose:{errorCode:-2506,errorString:"The ThumbnailViewer object has been disposed."},CallbackNotAFunction:{errorCode:-2510,errorString:"The callback is not a function."},ElementRequired:{errorCode:-2511,errorString:"Parameter 'element' is required."},ElementNotExist:{errorCode:-2512,errorString:"Parameter 'element' doesn't instanceof HTMLDivElement."},InvalidPropertyValue:{errorCode:-2514,errorString:"Invalid property value."},CursorInvalidMode:{errorCode:-2519,errorString:"The current mode does not support setting the cursor to zoom."},OldTagNameRequired:{errorCode:-2517,errorString:"Old tag name is required."},NewTagNameRequired:{errorCode:-2518,errorString:"New tag name is required."},FileNameCannotEmpty:{errorCode:-2530,errorString:"Document name cannot be empty."},FileNameNotString:{errorCode:-2531,errorString:"Document name is not a string."},FileNotExist:{errorCode:-2540,errorString:"The document does not exist."},FileExist:{errorCode:-2541,errorString:"The document already exists."},CustomElementDispose:{errorCode:-2508,errorString:"The CustomElement object has been disposed."},CustomElementNotExist:{errorCode:-2507,errorString:"This CustomElement doesn't exist."},ParameterOutRange:{errorCode:80002,errorString:"The parameter is out of range."},TagNotExist:{errorCode:80009,errorString:"Tag does not exist."},TagExist:{errorCode:80010,errorString:"The tag already exists."},OperationError:{errorCode:80022,errorString:"The operation mode is wrong."}},pO={visibility:"hidden",width:"24px",height:"24px",background:"#ffffff",borderWidth:"1px",borderColor:"#a79898",borderRadius:"50%",opacity:1,color:"#000000",fontFamily:"sans-serif",fontSize:12,left:"",top:"",right:1,bottom:1,translateX:"",translateY:""},wO={visibility:"hidden",width:"24px",height:"24px",borderWidth:"1px",borderColor:"#000000",checkMarkColor:"#000000",checkMarkLineWidth:"2px",right:1,top:1},bO={visibility:"hidden",width:"24px",height:"24px",background:"#ffffff",borderWidth:"2px",borderColor:"#000000",checkMarkColor:"#000000",checkMarkLineWidth:"2px",borderRadius:0,opacity:1,left:1,top:1,right:"",bottom:"",translateX:"",translateY:""},kO=["topPageChanged","click","rightclick","dblclick","mousemove","pageAreaSelected","pageAreaUnselected","dragdone","onDrop","bufferChanged","removeBtnClick"];!function(e){e[e.Normal=0]="Normal",e[e.Balance=1]="Balance";}(rO||(rO={}));var SO={rows:1,columns:1,show:!1,enableDragPage:!1,enableSlide:!0,enableZoomWithCtrl:!0,enableSelectWithCtrl:!0,enableSelectWithShift:!0,scrollDirection:"vertical",displayMode:"multiple",fitType:"window",tabMode:"single",autoSelectTopPage:!1,autoScroll:!0,autoSelectLatest:!0,margin:0,gap:10,enableOptimizeImage:!0,enableDWT1x1:!0,viewerStyle:{background:"rgb(255, 255, 255)",border:""},canvasStyle:{background:"rgb(255, 255, 255)",border:"",cursor:"crosshair"},pageStyle:{border:"1px solid rgb(204, 204, 204)",background:"rgba(0,0,0,0)"},selectedPageStyle:{border:"1px solid rgb(125, 162, 206)",background:"rgb(199, 222, 252)"},hoveredPageStyle:{border:"1px solid rgb(204, 204, 204)",background:"rgb(239, 246, 253)"},placeholderStyle:{background:"rgb(251, 236, 136)"},checkboxStyle:Fk({},bO),pageNumberStyle:Fk({},pO),removeBtnStyle:Fk({},wO)},xO={size:"30%",columns:1,rows:3,show:!1,scrollDirection:"vertical",gap:10,margin:10,autoChangeIndex:!1,autoSelectTopPage:!1,autoSelectLatest:!0,autoScroll:!0,enableKeyboardControl:!0,enableDragPage:!0,enableResizing:!1,enableDWT1x1:!0,enableOptimizeImage:!0,canvasStyle:{border:"",background:""},thumbnailStyle:{border:"",background:"rgb(255, 255, 255)"},pageStyle:{border:"1px solid rgb(238, 238, 238)",background:"transparent"},selectedPageStyle:{border:"1px solid rgb(125, 162, 206)",background:"rgb(199, 222, 252)"},hoveredPageStyle:{border:"1px solid rgb(238, 238, 238)",background:"rgb(239, 246, 253)"},pageNumberStyle:Fk({},pO),checkboxStyle:Fk({},bO),removeBtnStyle:Fk({},wO),placeholderStyle:{background:"rgb(251, 236, 136)"}},CO={dlgRotateAnyAngle:["Angle :","Interpolation:","Keep size","  OK  ","Cancel"],dlgChangeImageSize:["New Height :","New Width :","Interpolation:","  OK  ","Cancel"],saveChangedImage:["You have changed the image, do you want to keep the change(s)?","  Yes  ","  No  "],selectSource:["Select Source:","Select","Cancel","There is no source available!"]},VO={background:"#434246",innerBorder:"",topMenuBorder:"",border:"1px solid rgb(204, 204, 204)",width:"100%",height:"100%",zoomOrigin:{x:"center",y:"center"},promptToSaveChange:!0,workMode:rO.Normal,selectionRectAspectRatio:1,buttons:{titles:{previous:"Previous Image",next:"Next Image",print:"Print Image",scan:"Acquire new Image(s)",load:"Load local Image(s)",rotateleft:"Rotate Left",rotate:"Rotate",rotateright:"Rotate Right",deskew:"Deskew",crop:"Crop Selected Area",cut:"Cut Selected Area",changeimagesize:"Change Image Size",flip:"Flip Image",mirror:"Mirror Image",zoomin:"Zoom In",originalsize:"Show Original Size",zoomout:"Zoom Out",stretch:"Stretch Mode",fit:"Fit Window",fitw:"Fit Horizontally",fith:"Fit Vertically",hand:"Hand Mode",rectselect:"Select Mode",zoom:"Click to Zoom In",restore:"Restore Original Image",save:"Save Changes",close:"Close the Editor",removeall:"Remove All Images",removeselected:"Remove All Selected Images"},visibility:{scan:!0,load:!0,print:!0,removeall:!0,removeselected:!0,rotateleft:!0,rotate:!0,rotateright:!0,deskew:!0,crop:!0,cut:!0,changeimagesize:!0,flip:!0,mirror:!0,zoomin:!0,originalsize:!0,zoomout:!0,stretch:!0,fit:!0,fitw:!0,fith:!0,hand:!0,rectselect:!0,zoom:!0,restore:!0,save:!0,close:!0}},dialogText:CO},TO={borderColor:"rgba(0,0,0,1)",borderWidth:1,ctrlBorderColor:"rgba(0,0,0,1)",ctrlBorderRadius:1,ctrlBorderWidth:1,ctrlWidth:9,ctrlHeight:9,ctrlSize:9,keepAspectRatio:!1,aspectRatio:1},IO=function(){return Yk(function e(){Xk(this,e),Wk(this,"errCode",void 0),Wk(this,"errorString",void 0);},[{key:"setError",value:function value(e,t){this.errCode=e,this.errorString=t;}},{key:"getError",value:function value(){return{errCode:this.errCode,errorString:this.errorString};}}]);}(),EO=function(){return Yk(function e(t){var i=this;Xk(this,e),Wk(this,"space",void 0),Wk(this,"webViewer",void 0),Wk(this,"isActiveFile",!1),Wk(this,"isActiveTag",!1),Wk(this,"currentFileName",""),Wk(this,"currentTagName",""),Wk(this,"bufferConfig",null),Wk(this,"currentSelected",[]),Wk(this,"lastCurrentSelected",[]),this.space=new mO(),t&&(this.bufferConfig=t),this.space.on("bufferChanged",function(e,t){var r;if(!i.webViewer&&ML(null===(r=i.bufferConfig)||void 0===r?void 0:r.bufferChanged)){var n,o,a,s,u,l,c=[],h=[],d=i.getCurrentDataSet().children;$k(n=i.currentSelected).call(n,function(e){d&&d[e]&&c.push(d[e]);}),$k(o=i.lastCurrentSelected).call(o,function(e){d&&d[e]&&h.push(d[e]);});var f={afterStatus:{uids:e.afterStatus.uids,selectedUids:c,modifiedUid:(null==e||null===(a=e.afterStatus)||void 0===a?void 0:a.modifiedUid)||"",removedUids:(null==e||null===(s=e.afterStatus)||void 0===s?void 0:s.removedUids)||[],currentUid:e.afterStatus.uids[e.afterStatus.uids.length-1]||""},beforeStatus:{uids:e.beforeStatus.uids,selectedUids:h,removedUids:(null==e||null===(u=e.beforeStatus)||void 0===u?void 0:u.removedUids)||[],modifiedUid:(null==e||null===(l=e.beforeStatus)||void 0===l?void 0:l.modifiedUid)||"",currentUid:e.beforeStatus.uids[e.beforeStatus.uids.length-1]||""},operation:e.operation,docUid:e.docUid,total:e.afterStatus.uids.length,curIndex:e.afterStatus.uids.length-1};i.lastCurrentSelected=Kb(i.currentSelected),i.bufferConfig.bufferChanged(f,t);}});},[{key:"e",value:function value(){this.setError("Successful");}},{key:"IsFileNameExist",value:function value(e){var t=this.space.getFileList();if("dynamsoft-default-document"===e)return!0;if(t)for(var i=0;i<t.length;i++)if(t[i].name===e)return!0;return!1;}},{key:"getCurrentDataSet",value:function value(){if(this.webViewer){var e=this.webViewer.myViewer.getCurrentTab();if(void 0===e)return!1;var t=e.type;this.isActiveFile="file"===t,this.isActiveTag="tag"===t;}if(this.isActiveFile){var i=this.getCurrentFileName(),r=this.space.getFile(i);if(r)return r;}if(this.isActiveTag){var n=this.space.getTag(this.currentTagName);if(n)return n;}return!1;}},{key:"setError",value:function value(e){var t;if("Default"!==e){if(this.webViewer)this.webViewer.setError(e);else if(this.bufferConfig&&this.bufferConfig.viewerError){var i=yO[e],r=i.errorCode,n=i.errorString;this.bufferConfig.viewerError.setError(r,n);}}else null==this||null===(t=this.webViewer)||void 0===t||t.setDefaultError();}},{key:"emitViewerEvent",value:function value(){var e,t;this.webViewer&&0===this.getHowManyImagesInBuffer()&&(null===(e=this.webViewer)||void 0===e||null===(t=e.myViewer)||void 0===t||t.emit("pageRendered",-1));}},{key:"bindViewer",value:function value(e){this.webViewer=e;}},{key:"getCurrentTag",value:function value(){return this.currentTagName;}},{key:"getCurrentDocument",value:function value(){return this.currentFileName;}},{key:"getCurrentFileName",value:function value(){var e=this,t=this.space.getFileList(),i="";return t&&$k(t).call(t,function(t){t.name===e.currentFileName&&(i=e.currentFileName);}),i;}},{key:"getCurrentIndex",value:function value(){if(this.webViewer)return this.webViewer.getCurrentIndex();var e=this.getSelectedImagesIndices().length;if(e<=0){var t=this.getCurrentDataSet();return!!t&&t.children.length-1;}return this.getSelectedImagesIndices()[e-1];}},{key:"getHowManyImagesInBuffer",value:function value(){if(this.webViewer)return this.webViewer.getHowManyImagesInBuffer();var e=this.getCurrentDataSet();return e?e.children.length:0;}},{key:"getSelectedImagesIndices",value:function value(){return this.webViewer?this.webViewer.getSelectedImagesIndices():this.currentSelected;}},{key:"getIndexByUid",value:function value(e){if(!TL(e)||!e)return this.setError("InvalidValue"),!1;if(this.webViewer)return this.webViewer.myViewer.getIndexByUid(e);var t=this.getCurrentDataSet(),i=t.children;return!!(t&&i&&bL(i))&&OI(i).call(i,e);}},{key:"getUidByIndex",value:function value(e){if(e<0||e>=this.getHowManyImagesInBuffer())return this.setError("IndexOutOfRange"),!1;if(this.webViewer)return this.webViewer.myViewer.getUidByIndex(e);var t=this.getCurrentDataSet().children;return!(t&&t.length<e)&&t[e];}},{key:"getDataByUid",value:function value(e){return this.space.getSource(e);}},{key:"updateDataByUid",value:function value(e,t){return this.space.store.set(e,t);}},{key:"setCustomDataByUid",value:function value(e,t){return TL(e)&&""!==e?this.space.setCustomData(e,t):(this.setError("InvalidValue"),!1);}},{key:"getCustomDataByUid",value:function value(e){return this.space.getCustomData(e);}},{key:"setMetadataByUid",value:function value(e,t){return TL(e)&&""!==e?this.space.setMetadata(e,t):(this.setError("InvalidValue"),!1);}},{key:"getMetadataByUid",value:function value(e){return this.space.getMetadata(e);}},{key:"addImage",value:function value(e,t,i){var r,n,o={},a=this.currentFileName,s="";!CL(i)&&TL(i)?(this.IsFileNameExist(i)||this.createDocument(i),s=i):CL(a)||""===a?(this.space.isFileExisted("dynamsoft-default-document")||this.createDocument("dynamsoft-default-document"),this.webViewer&&(this.webViewer.bEmitBufferChanged=!1),this.openDocument("dynamsoft-default-document"),this.webViewer&&(this.webViewer.bEmitBufferChanged=!0),s="dynamsoft-default-document"):s=a,t&&(delete(n=Fk({},t)).oriBlobData,t.oriBlobData&&(r=t.oriBlobData));var u=e.imageUrl,l=e.minImageUrl,c=e.imageId,h=e.serverId,d=e.uidFromServer,f=e.index;r&&(o=Fk({},r)),c&&(o.imageId=c),h&&(o.serverId=h),d&&(o.uidFromServer=d);var v=this.getDocumentContents(s).length;!CL(f)&&BL(f)?f>=v&&(f=v):f=v,this.isActiveFile&&(this.currentSelected=[f]);var g=this.space.loadSource({data:[{oriData:u,minData:l,metadata:n,customData:o}],filename:s,index:f},function(t){var i=Gb(t,1)[0];e.uuid=i;}),m=this.getHowManyImagesInBuffer();return this.isActiveTag&&(this.currentSelected=m>0?[m-1]:[]),g;}},{key:"insertImage",value:function value(e,t,i){var r;if(i&&i>=0)this.currentSelected=[i],r=this.space.loadSource({data:[e],filename:t,index:i});else{r=this.space.loadSource({data:[e],filename:t});var n=this.getHowManyImagesInBuffer();this.currentSelected=n>0?[n-1]:[];}return r[0];}},{key:"updateImage",value:function value(e,t){var i=e.imageUrl,r=e.minImageUrl,n=e.imageId,o=e.serverId,a=e.uidFromServer,s=e.uuid,u=Fk({},t);return s&&""!==s&&-1!==s?(this.space.updateSource(s,{oriData:i,minData:r,metadata:u,customData:{imageId:n,serverId:o,uidFromServer:a}}),s):(this.setError("IndexOutOfRange"),!1);}},{key:"removeImageByUid",value:function value(e){if(this.e(),this.webViewer){var t=this.webViewer.removePageByUid(e);return this.webViewer.resized(),this.emitViewerEvent(),t;}return this.space.removeSource(e);}},{key:"removeImageByIndex",value:function value(e){if(this.e(),e<0||e>=this.getHowManyImagesInBuffer())return this.setError("IndexOutOfRange"),!1;var t=this.getCurrentIndex(),i=!1;if(this.currentSelected=e===t&&0===e?this.getHowManyImagesInBuffer()>0?[0]:[]:e<=t?[t-1]:[t],this.webViewer)i=this.webViewer.removePageByIndexes(e),this.webViewer.resized(),this.emitViewerEvent();else{var r=this.getCurrentDataSet();if(!r)return!1;i=this.space.removeSource(r.children[e]);}return i||this.setError("Default"),i;}},{key:"removeSelectedImages",value:function value(e){this.e();var t=this.getSelectedImagesIndices();bL(e)&&e.length>0&&(t=e);var i=!1;if(this.webViewer)i=this.webViewer.removePageByIndexes(t),this.webViewer.resized(),this.emitViewerEvent();else{var r=[],n=this.getCurrentDataSet();if(!n)return!1;$k(t).call(t,function(e){n.children[e]&&n.children[e]&&r.push(n.children[e]);}),i=this.space.removeSource(r);}i||this.setError("Default");var o=this.getHowManyImagesInBuffer();return this.currentSelected=o>0?[o-1]:[],i;}},{key:"removeImageByIndexArr",value:function value(e){if(this.e(),!bL(e))return!1;var t=this.getCurrentDataSet();if(!t)return!1;var i,r=[];$k(e).call(e,function(e){var i=t.children[e];i&&r.push(i);}),(i=this.space.removeSource(r))||this.setError("Default"),this.webViewer&&(this.webViewer.resized(),this.emitViewerEvent());var n=this.getHowManyImagesInBuffer();return this.currentSelected=n>0?[n-1]:[],i;}},{key:"removeAllImages",value:function value(){this.e();var e=!1;if(this.currentSelected=[],this.webViewer)e=this.webViewer.removeAllPages(),this.webViewer.resized(),this.emitViewerEvent();else{var t=this.getCurrentDataSet();t&&(e=this.space.removeSource(Kb(t.children)));}return e||this.setError("Default"),e;}},{key:"tagImages",value:function value(e,t){this.e();var i=this.getHowManyImagesInBuffer();if(!bL(e))return this.setError("IndicesNotArray"),!1;if(!TL(t)||""===t)return this.setError("InvalidTagName"),!1;for(var r=0;r<i;r++){var n=e[r];if(fS(n)||n<0||n>=i)return this.setError("IndexOutOfRange"),!1;}this.space.createTag(t);for(var o=0;o<e.length;o++){var a=e[o];if(a>=0){var s=this.getUidByIndex(a);s&&""!==s&&-1!==$S(s,10)&&this.space.addTagToSource(s,t);}}return!0;}},{key:"removeImageTag",value:function value(e,t){if(this.e(),!BL(e))return this.setError("InvalidValue"),!1;if(e<0||e>this.getHowManyImagesInBuffer())return this.setError("IndexOutOfRange"),!1;var i=this.getUidByIndex(e),r=!1;return i&&""!==i&&-1!==i&&(r=this.space.removeTagFromSource(i,t)),r||this.setError("Default"),r;}},{key:"getDefaultTag",value:function value(){return this.space.getDefaultTag();}},{key:"setDefaultTag",value:function value(e){if(this.e(),!TL(e))return this.setError("InvalidValue"),!1;if(""===e)return this.space.setDefaultTag(null),!0;var t;return this.space.createTag(e),(t=this.space.setDefaultTag(e))||this.setError("Default"),t;}},{key:"removeTag",value:function value(e,t){var i=this;if(this.e(),!TL(e))return this.setError("InvalidValue"),!1;if(!CL(t)&&!bL(t))return this.setError("IndicesNotArray"),!1;if(!this.space.isTagExisted(e))return this.setError("TagNotExist"),!1;var r=this.currentTagName,n=!1,o=!1;if(r&&(n=r===e),CL(t))o=this.space.removeTag(e),n&&this.clearFilter();else{var a=[];$k(t).call(t,function(e){var t=i.getUidByIndex(e);-1!==t&&a.push(t);});for(var s=0;s<(null==a?void 0:a.length);s++)if(!(o=this.space.removeTagFromSource(a[s],e)))return!1;}return o||this.webViewer.setDefaultError(),o;}},{key:"renameTag",value:function value(e,t){if(this.e(),CL(e)||""===e)return this.setError("OldTagNameRequired"),!1;if(CL(t)||""===t)return this.setError("NewTagNameRequired"),!1;if(!this.space.isTagExisted(e))return this.setError("TagNotExist"),!1;if(this.space.isTagExisted(t))return this.setError("TagExist"),!1;var i;return e===this.currentTagName&&(this.currentTagName=t),(i=this.space.renameTag(e,t))?this.space.setDefaultTag(t):this.setError("Default"),i;}},{key:"getTagContents",value:function value(e){return this.e(),e&&TL(e)&&""!==e?this.space.getTag(e).children:[];}},{key:"getTagList",value:function value(){var e=this;this.e();var t=this.space.getTagList(),i=[];return t?$k(t).call(t,function(t){var r,n=[];$k(r=t.children).call(r,function(t){var i=e.getCustomDataByUid(t);if(i){var r=i.uidFromServer;n.push(r);}}),i.push({name:t.name,imageIds:n});}):i=[],i;}},{key:"getTagListByIndex",value:function value(e){if(!BL(e))return!1;var t=this.getUidByIndex(e);return this.space.getSourceTags(t);}},{key:"clearFilter",value:function value(){this.e(),this.currentTagName="",this.space.setDefaultTag(null);var e,t=this.getCurrentFileName();return""===t&&(t="dynamsoft-default-document"),(e=this.openDocument(t))||this.setError("Default"),e;}},{key:"filterImagesByTag",value:function value(e,t,i){this.e();var r=!1;if(CL(e)||null===e||""===e){this.currentTagName="";var n=this.getCurrentFileName();""===n&&(n="dynamsoft-default-document"),(r=this.openDocument(n))?ML(t)&&t():(this.setError("Default"),ML(i)&&i());}else{var o,a;if(!this.space.isTagExisted(e))return this.setError("TagNotExist"),ML(i)&&i(),!1;if(this.isActiveTag=!0,this.isActiveFile=!1,this.currentTagName=e,this.setDefaultTag(e),r=this.space.openTag(e,null==this||null===(o=this.webViewer)||void 0===o||null===(a=o.myViewer)||void 0===a?void 0:a.uid)){var s=this.space.getTag(e);if(s){var u,l=(null==s||null===(u=s.children)||void 0===u?void 0:u.length)||0;this.currentSelected=l>0?[l-1]:[];}ML(t)&&t();}else this.setError("Default"),ML(i)&&i();}return this.webViewer&&this.webViewer.render(),r;}},{key:"createDocument",value:function value(e){if(this.e(),!e||""===e){var t=BL(e)?"FileNameNotString":"FileNameCannotEmpty";return this.setError(t),!1;}return TL(e)?this.space.isFileExisted(e)?(this.setError("FileExist"),!1):!!this.space.createFile(e)||(this.setError("Default"),!1):(this.setError("FileNameNotString"),!1);}},{key:"openDocument",value:function value(e,t){var i,r;if(this.e(),!e||""===e){var n=BL(e)?"FileNameNotString":"FileNameCannotEmpty";return this.setError(n),!1;}if(!TL(e))return this.setError("FileNameNotString"),!1;if(!this.space.isFileExisted(e))return this.setError("FileNotExist"),!1;var o=t&&""!==t?t:null==this||null===(i=this.webViewer)||void 0===i||null===(r=i.myViewer)||void 0===r?void 0:r.uid,a=this.space.getFile(e);if(a){var s,u=null==a||null===(s=a.children)||void 0===s?void 0:s.length;this.currentSelected=u>0?[u-1]:[];}return this.space.openFile(e,{viewerUid:o})?(this.currentFileName=e,this.isActiveFile=!0,this.isActiveTag=!1,!0):(this.setError("Default"),!1);}},{key:"getDocumentContents",value:function value(e){return this.e(),e&&TL(e)&&""!==e?this.space.getFile(e).children:[];}},{key:"renameDocument",value:function value(e,t){return this.e(),TL(e)&&TL(t)?(e&&""!==e&&t&&""!==t||this.setError("FileNameCannotEmpty"),this.space.isFileExisted(e)?this.space.isFileExisted(t)?(this.setError("FileExist"),!1):this.space.renameFile(e,t)?(this.currentFileName===e&&(this.currentFileName=t),!0):(this.setError("Default"),!1):(this.setError("FileNotExist"),!1)):(this.setError("FileNameNotString"),!1);}},{key:"removeDocument",value:function value(e){if(this.e(),!e||!TL(e))return this.setError("FileNameNotString"),!1;if(!this.space.isFileExisted(e))return this.setError("FileNotExist"),!1;var t=this.space.removeFile(e);return t?(t&&this.webViewer&&this.webViewer.resized(),this.currentFileName===e&&(this.currentFileName=""),!0):(this.setError("Default"),!1);}},{key:"getDocumentInfoList",value:function value(){var e=this;this.e();var t=this.space.getFileList(),i=[];return t?($k(t).call(t,function(t){if(t.children){for(var r=[],n=0;n<t.children.length;n++){var o=t.children[n],a=e.getCustomDataByUid(o);if(a){var s=a.uidFromServer;r.push(s);}}i.push({imageIds:r,name:t.name});}}),i):[];}},{key:"getDocumentInfo",value:function value(e){this.e();var t=this.space.getFile(e);if(!t)return{imageIds:[],length:0};for(var i=[],r=0;r<t.children.length;r++){var n=t.children[r],o=this.getCustomDataByUid(n);if(o){var a=o.uidFromServer;i.push(a);}}return{imageIds:i,length:i.length};}},{key:"selectImages",value:function value(e){this.e();var t=!0;if(!e||!bL(e))return!1;if(this.webViewer){var i=this.webViewer.getIfAutoScroll();!1===i&&this.webViewer.setIfAutoScroll(!0),t=this.webViewer.selectPages(e),!1===i&&this.webViewer.setIfAutoScroll(!1);}else{for(var r=this.getHowManyImagesInBuffer(),n=0;n<e.length;n++)if(!BL(e[n])||e[n]<0||e[n]>=r)return this.setError("ParameterOutRange"),!1;t=!0;}return t?this.currentSelected=e:this.setError("Default"),t;}},{key:"selectAllImages",value:function value(){this.e();var e=!0;if(this.webViewer)e=this.webViewer.myViewer.selectAll(),this.currentSelected=this.webViewer.getSelectedImagesIndices();else{var t,i=this.getCurrentDataSet();this.currentSelected=NB(GB(t=new Array(i.children.length)).call(t));}return e||this.setError("Default"),e;}},{key:"moveImage",value:function value(e,t){this.e();var i=$S(e,10),r=$S(t,10);if(fS(e)||fS(t))return this.setError("InvalidIndex"),!1;var n=this.getHowManyImagesInBuffer();if(i<0||i>=n||r<0||r>n)return this.setError("IndexOutOfRange"),!1;var o=!1;if(this.webViewer)o=this.webViewer.myViewer.movePage(e,t);else{var a=this.getCurrentDataSet();if(!a)return!1;a.children.length>t&&(this.currentSelected=[t]),o=this.space.move({docUid:a.uid,type:a.type,from:e,to:t});}return o||this.setError("Default"),o;}},{key:"switchImage",value:function value(e,t){this.e();var i=$S(e,10),r=$S(t,10);if(fS(e)||fS(t))return this.setError("InvalidIndex"),!1;var n=this.getHowManyImagesInBuffer(),o=this.getCurrentIndex();if(i<0||i>=n||r<0||r>n)return this.setError("IndexOutOfRange"),!1;var a=!1;if(this.webViewer)a=this.webViewer.myViewer.switchPage(e,t);else{var s=this.getCurrentDataSet();if(!s)return!1;a=this.space.switch({docUid:s.uid,type:s.type,one:e,other:t});}a||this.setError("Default");var u=o;return i===o?u=r:r===o&&(u=i),this.currentSelected=[u],a;}},{key:"moveImageToFile",value:function value(e,t,i,r){if(!this.space.isFileExisted(e)||!this.space.isFileExisted(i))return this.setError("FileNotExist"),!1;t=Kb(new Pz(t));var n=this.getDocumentInfo(e).length;if(!bL(t)||t.length>n)return this.setError("ParameterOutRange"),!1;var o=this.getDocumentInfo(i).length,a=this.space.movePagesToFile(e,t,i,r);if(!this.webViewer&&this.isActiveFile){var s=this.getHowManyImagesInBuffer();e===this.currentFileName&&(this.currentSelected=s>0?[s-1]:[]),i===this.currentFileName&&(BL(r)&&r<o&&r>=0?this.currentSelected=[r+t.length-1]:this.currentSelected=s>0?[s-1]:[]);}return a;}}]);}(),PO=function(){return Yk(function e(t){var i,r,n,o,a=this;Xk(this,e),Wk(this,"uid",null),Wk(this,"mode","default"),Wk(this,"vertexes",[]),Wk(this,"midpoints",[]),Wk(this,"probePoints",[]),Wk(this,"slopeRatio",[]),Wk(this,"sensorRadius",4),Wk(this,"isPointSelected",!1),Wk(this,"activeProbePoint",null),Wk(this,"isConvex",!0),Wk(this,"isMoveBox",!1),Wk(this,"width",0),Wk(this,"height",0),Wk(this,"zoom",1),Wk(this,"keepAspectRatio",!1),Wk(this,"aspectRatio",0),Wk(this,"startX",null),Wk(this,"startY",null),Wk(this,"lastX",null),Wk(this,"lastY",null),Wk(this,"lastWhr",1),Wk(this,"b1",void 0),Wk(this,"b2",void 0),Wk(this,"k1",void 0),Wk(this,"k2",void 0),this.uid=WL(),$k(i=eS(t)).call(i,function(e){a[e]=t[e];}),this.midpoints=BO(this.vertexes),this.probePoints=lS(r=RI(n=this.vertexes).call(n)).call(r,RI(o=this.midpoints).call(o)),this.slopeRatio=DO(this.vertexes);},[{key:"getRect",value:function value(){if("free"===this.mode)return null;var e=this.getBounds(),t=e.minX,i=e.maxX,r=e.minY;return{x:t,y:r,width:i-t||1,height:e.maxY-r||1};}},{key:"isBoxSelected",value:function value(e,t){var i=this.isPointOnBox(e,t),r=this.isCtrlPointSelected(e,t);return null!==r?r:i?8:-1;}},{key:"isCtrlPointSelected",value:function value(e,t){for(var i=gN(),r=this.sensorRadius,n=this.zoom,o=this.probePoints,a=this.width,s=this.height,u=r/n,l=HL(u,0,3*u)*i,c=HL(u,0,3*u)*i,h=0;h<8;h++){var d=o[2*h],f=o[2*h+1];if(e<=d+l&&e>=d-l&&t<=f+c&&t>=f-c&&e>=0-l&&e<=a+l&&t>=0-c&&t<=s+c)return h;}return null;}},{key:"checkOrientation",value:function value(e){if(e<0||e>7)return null;var t=this.getBounds(),i=t.minX,r=t.maxX,n=t.minY,o=t.maxY,a=this.probePoints,s=a[2*e],u=a[2*e+1],l=null,c=null;return s===r?l="e":s===i&&(l="w"),u===o?c="s":u===n&&(c="n"),e<4?c+l:c||l;}},{key:"onStartHandler",value:function value(e,t,i){if(void 0===i&&(i=this.isBoxSelected(e,t)),!(i<0)){this.startX=e,this.startY=t,this.lastX=e,this.lastY=t,8===i?(this.isPointSelected=!1,this.activeProbePoint=null,this.isMoveBox=!0):(this.isPointSelected=!0,this.activeProbePoint=i,this.isMoveBox=!1);var r=this.mode,n=this.probePoints,o=this.slopeRatio;if("free"===r&&i>3&&i<8){var a=i-4;this.k1=o[(a+1)%4],this.b1=n[(2*a+3)%8]-this.k1*n[(2*a+2)%8],this.k2=o[(a+3)%4],this.b2=n[(2*a+1)%8]-this.k2*n[(2*a+0)%8];}}}},{key:"onMoveHandler",value:function value(e,t,i){var r,n,o=this.isPointSelected,a=this.isMoveBox,s=this.probePoints,u=this.activeProbePoint,l=this.lastX,c=this.lastY,h=this.mode;if(o||a){var d=e-l,f=t-c;if(0!==d||0!==f){var v=RI(s).call(s);o?(void 0===i&&(i=u),"default"===h?v=this.movePointNormal(v,i,e,t):(v=this.movePointFree(v,i,e,t),this.slopeRatio=RI(r=DO(s)).call(r,0,4),this.isConvex=this.checkConvexity(v))):a&&(v=this.moveBox(v,d,f));var g=BO(v);this.probePoints=lS(n=RI(v).call(v,0,8)).call(n,g),this.midpoints=g,this.lastX=e,this.lastY=t;}}}},{key:"onEndHandler",value:function value(){var e,t,i,r,n=this.isPointSelected,o=this.isMoveBox,a=this.startX,s=this.startY,u=this.vertexes,l=this.midpoints,c=this.lastX,h=this.lastY;if(this.startX=0,this.startY=0,n||o){this.isPointSelected=!1,this.isMoveBox=!1,this.activeProbePoint=null;var d=RI(e=this.probePoints).call(e),f=this.checkConvexity(d);(a===c&&s===h||!f)&&(d=lS(t=RI(u).call(u)).call(t,l)),this.isConvex=!0,this.vertexes=RI(d).call(d,0,8),this.midpoints=BO(d),this.probePoints=lS(i=RI(d).call(d,0,8)).call(i,this.midpoints),this.slopeRatio=RI(r=DO(d)).call(r,0,4);}}},{key:"getBounds",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.probePoints;return{minX:Math.min(e[0],e[2],e[4],e[6]),maxX:Math.max(e[0],e[2],e[4],e[6]),minY:Math.min(e[1],e[3],e[5],e[7]),maxY:Math.max(e[1],e[3],e[5],e[7])};}},{key:"movePointNormal",value:function value(e,t,i,r){i=Math.max(0,Math.min(this.width,i)),r=Math.max(0,Math.min(this.height,r));var n=0,o=0;if(this.keepAspectRatio){var a=this.getBounds(),s=a.minX,u=a.maxX,l=a.minY,c=a.maxY,h=this.checkOrientation(t),d=(u-s)/(c-l);0===d||d===1/0||d===-1/0||fS(d)?d=this.lastWhr:this.lastWhr=d,n=0,o=0;var f="w";if(t<4){if(n=i-e[2*t],o=r-e[2*t+1],0===n||0===o)return e;f="w";}else{var v=t-4;if("e"===h?(t=(v+1)%4,f="w"):"s"===h?(t=v,f="h"):"w"===h?(t=v,f="w"):"n"===h&&(t=(v+1)%4,f="h"),n=i-e[2*v],o=r-e[2*v+1],0===n||0===o)return e;}"h"===f?(n=o*d,"ne"!==h&&"sw"!==h&&"n"!==h&&"w"!==h||(n=-n)):(o=n/d,"ne"!==h&&"sw"!==h&&"n"!==h&&"w"!==h||(o=-o));var g=e[2*t]+n,m=e[2*t+1]+o,y=this.width,p=this.height;g<0?(n=0-e[2*t],o=0):g>y?(n=y-e[2*t],o=0):m<0?(o=0-e[2*t+1],n=0):m>p&&(o=p-e[2*t+1],n=0),e[2*t]+=n,e[2*t+1]+=o;var w=(t+1)%4,b=(t+3)%4;t%2?(e[2*w]+=n,e[2*b+1]+=o):(e[2*w+1]+=o,e[2*b]+=n);}else if(t<4){if(n=i-e[2*t],o=r-e[2*t+1],0===n&&0===o)return e;e[2*t]=i,e[2*t+1]=r;var k=(t+1)%4,S=(t+3)%4;t%2?(e[2*k]=i,e[2*S+1]=r):(e[2*k+1]=r,e[2*S]=i);}else{var x=t-4,C=this.slopeRatio[x%4];0===C?(e[(2*x+3)%8]=r,e[(2*x+1)%8]=r):C!==1/0&&C!==-1/0||(e[(2*x+2)%8]=i,e[(2*x+0)%8]=i);}return e;}},{key:"movePointFree",value:function value(e,t,i,r){i=Math.max(0,Math.min(this.width,i)),r=Math.max(0,Math.min(this.height,r));var n=RI(e).call(e);if(t<4){var o=i-e[2*t],a=r-e[2*t+1];if(0===o&&0===a)return e;e[2*t]=i,e[2*t+1]=r;}else{var s=t-4,u=this.slopeRatio[s%4],l=r-u*i,c=-l/u,h=l,d=e[(2*s+9)%8]-u*e[(2*s+8)%8],f=-d/u,v=this.k1,g=this.b1,m=this.k2,y=this.b2;0===u?(e[(2*s+3)%8]=r,v!==1/0&&v!==-1/0&&(e[(2*s+2)%8]=(r-g)/v),e[(2*s+1)%8]=r,m!==1/0&&m!==-1/0&&(e[(2*s+0)%8]=(r-y)/m)):u===1/0||u===-1/0?(e[(2*s+2)%8]=i,e[(2*s+3)%8]=v*i+g,e[(2*s+0)%8]=i,e[(2*s+1)%8]=m*i+y):(0===v?e[(2*s+2)%8]+=c-f:v===1/0||v===-1/0?e[(2*s+3)%8]+=h-d:(e[(2*s+2)%8]=(g-l)/(u-v),e[(2*s+3)%8]=(u*g-v*l)/(u-v)),0===m?e[(2*s+0)%8]+=c-f:m===1/0||m===-1/0?e[(2*s+1)%8]+=h-d:(e[(2*s+0)%8]=(y-l)/(u-m),e[(2*s+1)%8]=(u*y-m*l)/(u-m)));for(var p=0;p<4;p++){var w=e[2*p],b=e[2*p+1];if(w<0||w>this.width||b<0||b>this.height)return n;}}return e;}},{key:"moveBox",value:function value(e,t,i){var r=this.getBounds(e),n=r.minX,o=r.maxX,a=r.minY,s=r.maxY,u=this.width,l=this.height;n+t<0&&(t=0-n),o+t>u&&(t=u-o),a+i<0&&(i=0-a),s+i>l&&(i=l-s);for(var c=0;c<4;c++)e[2*c]+=t,e[2*c+1]+=i;return e;}},{key:"isPointOnBox",value:function value(e,t){var i=this.getBounds(),r=i.minX,n=i.maxX,o=i.minY,a=i.maxY;if(e<r||e>n||t<o||t>a)return!1;if("free"===this.mode){for(var s=Kb(this.vertexes),u=Kb(this.midpoints),l=[],c=0;c<4;c++)l.push(gE(s).call(s,0,2)),l.push(gE(u).call(u,0,2));var h=function(e,t){var i,r,n,o,a=0,s=t.length;for(n=Gb(t,1)[0],i=1;i<=s;i++){o=t[i%s],e[0]>Math.min(n[0],o[0])&&e[0]<=Math.max(n[0],o[0])&&e[1]<=Math.max(n[1],o[1])&&n[0]!==o[0]&&(r=(e[0]-n[0])*(o[1]-n[1])/(o[0]-n[0])+n[1],(n[1]===o[1]||e[1]<=r)&&(a+=1)),n=o;}return a%2!=0;}([e,t],l);return h;}return!0;}},{key:"checkConvexity",value:function value(e){var t,i=Gb(e,8),r=i[0],n=i[1],o=i[2],a=i[3],s=i[4],u=i[5],l=i[6],c=i[7],h=(l-r)*(a-n)-(c-n)*(o-r),d=(r-o)*(u-a)-(n-a)*(s-o),f=(o-s)*(c-u)-(a-u)*(l-s),v=(s-l)*(n-c)-(u-c)*(r-l);if(h*d*f*v<0)return!1;var g=lS(t=RI(e).call(e)).call(t,RI(e).call(e,0,2)),m=this.slopeRatio;if(m.length)for(var y=0;y<2;y++)if(m[y]!==m[y+2]&&MO(RI(g).call(g,2*y,2*y+2),RI(g).call(g,2*y+2,2*y+4),RI(g).call(g,2*y+4,2*y+6),RI(g).call(g,2*y+6,2*y+8)))return!1;return h*d*f*v>0;}}]);}();function BO(e){for(var t,i=lS(t=RI(e).call(e,0,8)).call(t,e[0],e[1]),r=[],n=0;n<4;n++){var o=(i[2*n]+i[2*n+2])/2,a=(i[2*n+1]+i[2*n+3])/2;r.push(o,a);}return r;}function DO(e){for(var t,i=[],r=null,n=lS(t=RI(e).call(e,0,8)).call(t,e[0],e[1]),o=0;o<4;o++)r=n[2*o+3]-n[2*o+1]==0&&n[2*o+2]-n[2*o]==0?0:(n[2*o+3]-n[2*o+1])/(n[2*o+2]-n[2*o]),i.push(r);return i;}function MO(e,t,i,r){if(function(e,t,i,r){var n=Math.min,o=Math.max;return n(e[0],t[0])<=o(i[0],r[0])&&n(i[0],r[0])<=o(e[0],t[0])&&n(e[1],t[1])<=o(i[1],r[1])&&n(i[1],r[1])<=o(e[1],t[1]);}(e,t,i,r)&&function(e,t,i,r){var n=e[0]*(i[1]-t[1])+t[0]*(e[1]-i[1])+i[0]*(t[1]-e[1]),o=e[0]*(r[1]-t[1])+t[0]*(e[1]-r[1])+r[0]*(t[1]-e[1]);return!((n^o)>=0&&0!==n&&0!==o||(n=i[0]*(e[1]-r[1])+r[0]*(i[1]-e[1])+e[0]*(r[1]-i[1]),o=i[0]*(t[1]-r[1])+r[0]*(i[1]-t[1])+t[0]*(r[1]-i[1]),(n^o)>=0&&0!==n&&0!==o));}(e,t,i,r)){var n=(r[0]-i[0])*(e[1]-t[1])-(t[0]-e[0])*(i[1]-r[1]),o=(e[1]-i[1])*(t[0]-e[0])*(r[0]-i[0])+i[0]*(r[1]-i[1])*(t[0]-e[0])-e[0]*(t[1]-e[1])*(r[0]-i[0]);if(0===n||0===o){var a=zO(e,t),s=zO(i,r),u=a[0],l=a[1],c=s[0],h=s[1];if(l[0]===c[0]&&l[1]===c[1])return l;if(u[0]===h[0]&&u[1]===h[1])return u;if(UO(l,s)&&UO(c,a))return[c,l];if(UO(u,s)&&UO(h,a))return[u,h];if(UO(u,s)&&UO(l,s))return[u,l];if(UO(c,s)&&UO(h,s))return[c,h];}var d=o/n;return n=(e[0]-t[0])*(r[1]-i[1])-(t[1]-e[1])*(i[0]-r[0]),[d,(o=t[1]*(e[0]-t[0])*(r[1]-i[1])+(r[0]-t[0])*(r[1]-i[1])*(e[1]-t[1])-r[1]*(i[0]-r[0])*(t[1]-e[1]))/n];}return!1;}function zO(e,t){return e[0]===t[0]?e[1]<t[1]?[e,t]:[t,e]:e[0]<t[0]?[e,t]:[t,e];}function UO(e,t){return t[0][0]===t[1][0]?e[1]>=t[0][1]&&e[1]<=t[1][1]:e[0]>=t[0][0]&&e[0]<=t[1][0];}var AO={aspectRatio:1,keepAspectRatio:!1,keepAspectRatioEdit:!1,keepAspectRatioWithShift:!0,multipleCropping:!0,enableCreateBoxByPointer:!0,enableCursor:!0,enableMagnifier:!0,borderColor:"orange",borderWidth:2,background:"rgba(255,255,255,0)",dashLine:[5,2],ctrlSize:16,ctrlBorderWidth:2,ctrlBorderRadius:4,ctrlBorderColor:"orange",ctrlBackground:"rgba(255,0,0,0)",invalidCtrlBorderColor:"red",invalidBorderColor:"red",magnifier:{fixed:!1,fixedTop:0,fixedLeft:0,size:50,magnification:2}},RO=function(){return Yk(function e(t,i){Xk(this,e),Wk(this,"activeBoxId",null),Wk(this,"startX",null),Wk(this,"startY",null),Wk(this,"addNewFlag",null),Wk(this,"drawingFlag",!1),Wk(this,"lastKeepAspectRatio",!1),Wk(this,"area",null),Wk(this,"canvasItem",null),Wk(this,"cropBoxes",[]),Wk(this,"width",0),Wk(this,"height",0),Wk(this,"scrollTop",0),Wk(this,"scrollLeft",0),Wk(this,"zoom",1),Wk(this,"aspectRatio",0),Wk(this,"keepAspectRatio",!1),Wk(this,"keepAspectRatioEdit",!1),Wk(this,"mouseDown",!1),Wk(this,"cropSetting",{}),Wk(this,"currentBoxId",void 0),Wk(this,"unselectedCallback",null),Wk(this,"selectedCallback",null),this.width=t,this.height=i,this.cropSetting=_SL(AO);},[{key:"count",value:function value(){return this.cropBoxes.length;}},{key:"setCanvas",value:function value(e){this.canvasItem=e;}},{key:"setCanvasSize",value:function value(e,t){this.width=e,this.height=t,this.area||this.setArea(0,0,e,t);}},{key:"setKeepAspectRatio",value:function value(e){var t;this.keepAspectRatio=e,this.drawingFlag||$k(t=this.cropBoxes).call(t,function(t){t.keepAspectRatio=e;});}},{key:"setAspectRatio",value:function value(e){this.aspectRatio=e;}},{key:"setZoom",value:function value(e){var t;this.zoom=e,$k(t=this.cropBoxes).call(t,function(t){t.zoom=e;});}},{key:"setScrollTop",value:function value(e){this.scrollTop=e;}},{key:"setScrollLeft",value:function value(e){this.scrollLeft=e;}},{key:"setCropSetting",value:function value(){var e=NL(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_SL(this.cropSetting));this.cropSetting=e;var t=this.cropSetting,i=t.keepAspectRatioEdit,r=t.keepAspectRatio;return this.keepAspectRatioEdit=i,r?(this.setKeepAspectRatio(!0),this.setAspectRatio(this.cropSetting.aspectRatio)):this.setKeepAspectRatio(!1),!0;}},{key:"getCropBoxes",value:function value(){var e,t=[];return $k(e=this.cropBoxes).call(e,function(e,i){var r=e.getRect();null!==r&&t.push({index:i,left:r.x,top:r.y,width:r.width,height:r.height});}),t;}},{key:"getRectArr",value:function value(){var e;return $E(e=this.cropBoxes).call(e,function(e,t){return Fk({index:t},e.getRect());});}},{key:"clear",value:function value(){var e;this.cropBoxes.length>0&&null!==(e=this.unselectedCallback)&&void 0!==e&&e.call(this),this.cropBoxes=[];}},{key:"addFreeBox",value:function value(e){var t=this.cropSetting,i=t.ctrlSize,r=t.ctrlHeight,n=t.ctrlWidth,o=i;(n||r)&&(o=Math.max(n,r));var a=new PO({vertexes:RI(e).call(e),width:this.area.width,height:this.area.height,sensorRadius:o/2,mode:"free"});return this.cropBoxes.push(a),a;}},{key:"addBox",value:function value(e){var t=this.cropSetting,i=t.ctrlSize,r=t.ctrlHeight,n=t.ctrlWidth,o=i;(n||r)&&(o=Math.max(n,r));var a=new PO({vertexes:RI(e).call(e),width:this.area.width,height:this.area.height,mode:"default",aspectRatio:this.aspectRatio,keepAspectRatio:this.keepAspectRatio,sensorRadius:o/2,zoom:this.zoom});return a.isScaled=!1,this.cropBoxes.push(a),a;}},{key:"removeBox",value:function value(e){var t=this.cropBoxes;return CL(e)?(this.clear(),!0):!(e<0||e>=t.length||(gE(t).call(t,e,1),0));}},{key:"getBoxByUid",value:function value(e){var t;return xP(t=this.cropBoxes).call(t,function(t){return t.uid===e;});}},{key:"setArea",value:function value(e,t,i,r){var n;this.area={left:e,top:t,width:i,height:r},$k(n=this.cropBoxes).call(n,function(e){e.width=i,e.height=r;});}},{key:"isInArea",value:function value(e,t){var i=this.area,r=i.width,n=i.height;return!(e<0||e>r||t<0||t>n);}},{key:"checkSelect",value:function value(e,t){var i;return EE(i=this.cropBoxes).call(i,function(i){return i.isBoxSelected(e,t)>-1;});}},{key:"checkSelectForCursor",value:function value(e,t){for(var i=this.cropBoxes.length-1;i>=0;i--){var r=this.cropBoxes[i],n=r.isBoxSelected(e,t);if(n>-1){var o="move";return n<8&&(o=r.checkOrientation(n)),{part:n,position:o,mode:r.mode};}}return null;}},{key:"checkSelectVertex",value:function value(e,t){for(var i=this.cropBoxes.length-1;i>=0;i--){var r=this.cropBoxes[i].isBoxSelected(e,t);if(r>-1&&r<4)return!0;}return!1;}},{key:"onStartHandler",value:function value(e,t,i){var r=this.area,n=r.width,o=r.height,a=this.checkSelect(e,t);if(e=HL(e,0,n),t=HL(t,0,o),this.startX=e,this.startY=t,this.mouseDown=!0,a<0)return i||this.clear(),this.activeBoxId=null,void(this.lastKeepAspectRatio&&!this.keepAspectRatio&&this.setKeepAspectRatio(!0));var s=this.cropBoxes[a].uid;this.currentBoxId=s,this.activeBoxId=s,this.getBoxByUid(s).onStartHandler(e,t),!this.keepAspectRatioEdit&&this.keepAspectRatio&&(this.lastKeepAspectRatio=this.keepAspectRatio,this.setKeepAspectRatio(!1));}},{key:"onMoveHandler",value:function value(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.mouseDown){var r=null,n=this.activeBoxId,o=this.startX,a=this.startY,s=this.aspectRatio,u=this.area,l=u.width,c=u.height;e=HL(e,0,l);var h=(t=HL(t,0,c))-a,d=e-o,f=2/this.zoom,v=null;if(n||(d<-f&&h<-f?v=0:d>f&&h<-f?v=1:d>f&&h>f?v=2:d<-f&&h>f&&(v=3),null!==v&&s>0&&(h=d/s,v%2&&(h=-d/s))),null!==v&&i){for(var g=[],m=v%2?[o,a,o,a+h,e,a+h,e,a]:[e,a+h,o,a+h,o,a,e,a],y=0;y<4;y++)g.push(m[2*(v+y)%8]),g.push(m[(2*(v+y)+1)%8]);return(r=this.addBox(g)).keepAspectRatio=this.keepAspectRatio&&s>0,this.drawingFlag=!0,this.addNewFlag=this.keepAspectRatio,this.currentBoxId=r.uid,this.activeBoxId=r.uid,r.onStartHandler(this.startX,this.startY,v),r.onMoveHandler(e,t,v),void(v=null);}this.activeBoxId&&(r=this.getBoxByUid(this.activeBoxId)),r&&r.onMoveHandler(e,t);}}},{key:"onEndHandler",value:function value(){var e;if(this.mouseDown&&this.activeBoxId){this.mouseDown=!1,this.drawingFlag=!1;var t=this.getBoxByUid(this.activeBoxId);t&&(null!==this.addNewFlag&&(t.keepAspectRatio=this.addNewFlag,this.addNewFlag=null),t.onEndHandler(),this.cropBoxes.length>0&&null!==(e=this.selectedCallback)&&void 0!==e&&e.call(this,this.getRectArr()),this.activeBoxId=null);}}}]);}(),LO=function(){return Yk(function e(){Xk(this,e),Wk(this,"cropMng",void 0),Wk(this,"originalBoxes",[]),Wk(this,"mouseDown",!1),Wk(this,"imgData",null),this.cropMng=new RO(0,0);},[{key:"getBoxesData",value:function value(e,t){for(var i=e.length,r=[],n=[],o=0;o<i;o++){var a=e[o];if(BL(a.left)&&BL(a.top)&&BL(a.width)&&BL(a.height)){var s=a.left,u=a.top,l=a.width,c=a.height;r.push(Fk({},a)),t.width>0&&t.height>0&&(s=s<0||s>t.width?0:s,u=u<0||u>t.height?0:u,c=c<=0?1:c,(l=l<=0?1:l)+s>t.width&&(l=t.width-s),c+u>t.height&&(c=t.height-u));var h={left:s,top:u,width:l,height:c};n.push(h);}}return{oriBoxes:r,newBoxes:n};}},{key:"resetBoxes",value:function value(){if(this.originalBoxes.length<1)return!1;var e=this.cropMng;e.removeBox();for(var t=this.getBoxesData(this.originalBoxes,e.area).newBoxes,i=t.length,r=0;r<i;r++){var n=t[r],o=n.left,a=n.top,s=n.width,u=n.height;this.cropMng.addBox([o,a,o+s,a,o+s,a+u,o,a+u]);}return!0;}},{key:"initCrop",value:function value(e,t,i,r){this.cropMng.setCanvas(i),this.cropMng.setCanvasSize(e,t),this.cropMng.setCropSetting(r);}},{key:"setCropArea",value:function value(e,t,i,r){this.cropMng.setArea(e,t,i,r);}},{key:"setCropConfig",value:function value(e){var t=e.zoom,i=e.scrollTop,r=e.scrollLeft;t&&this.cropMng.setZoom(t),CL(i)||this.cropMng.setScrollTop(i),CL(r)||this.cropMng.setScrollLeft(r);}},{key:"updateCropSetting",value:function value(e){return this.cropMng.setCropSetting(e),!0;}},{key:"setFreeBox",value:function value(e){var t,i;if(!this.cropMng.canvasItem)return!1;if(!e){var r=this.cropMng.area,n=r.width,o=r.height;e=[0,0,n,0,n,o,0,o];}return this.cropMng.addFreeBox(e),null!==(t=(i=this.cropMng).selectedCallback)&&void 0!==t&&t.call(i,this.cropMng.getRectArr()),!0;}},{key:"setNormalBoxes",value:function value(e){var t,i,r,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.cropMng,s=a.canvasItem,u=a.area;if(!s)return!1;var l=null;if(bL(e)){if(0===(l=e).length)return!1;}else{if(!kL(e))return!1;l=[e];}var c=this.getBoxesData(l,u),h=c.oriBoxes,d=c.newBoxes,f=d.length;n||this.cropMng.count()>0&&this.clearBox();for(var v=0;v<f;v++){var g=d[v],m=g.left,y=g.top,p=g.width,w=g.height;this.cropMng.addBox([m,y,m+p,y,m+p,y+w,m,y+w],o);}return(t=this.originalBoxes).push.apply(t,Kb(h)),null!==(i=(r=this.cropMng).selectedCallback)&&void 0!==i&&i.call(r,this.cropMng.getRectArr()),!0;}},{key:"clearSelectedBoxes",value:function value(e){var t,i=this.cropMng;return!!i.canvasItem&&(gE(t=this.originalBoxes).call(t,e,1),i.removeBox(e),this.render(),!0);}},{key:"clearBox",value:function value(){var e=this.cropMng;return!(!e.canvasItem||e.cropBoxes.length&&0!==e.cropBoxes.length&&(this.originalBoxes=[],e.canvasItem.style.cursor="crosshair",e.removeBox(),this.render(),0));}},{key:"getCropBoxes",value:function value(){return this.cropMng.getCropBoxes();}},{key:"getBoxCount",value:function value(){var e=this.cropMng;return e.cropBoxes.length?e.cropBoxes.length:0;}},{key:"getCropCoordinate",value:function value(e){var t=this.cropMng;return!(!t.canvasItem||0===t.cropBoxes.length)&&(void 0!==e?!!(BL(e)&&e<t.cropBoxes.length)&&t.cropBoxes[e].probePoints:t.getBoxByUid(t.currentBoxId).probePoints);}},{key:"setMagnifier",value:function value(e){this.imgData=e;}},{key:"render",value:function value(){var e,t=this,i=this.cropMng,r=i.canvasItem,n=i.zoom,o=i.area,a=i.scrollTop,s=i.scrollLeft,u=i.cropSetting;if(r&&i.cropBoxes.length){var l=r.getContext("2d"),c=u.dashLine,h=u.borderColor,d=u.borderWidth,f=u.ctrlBorderColor,v=u.ctrlBackground,g=u.ctrlBorderWidth,m=u.ctrlBorderRadius,y=u.background,p=u.invalidBorderColor,w=u.invalidCtrlBorderColor,b=u.ctrlSize,k=u.ctrlWidth,S=u.ctrlHeight;l.setTransform(1,0,0,1,0,0),$k(e=i.cropBoxes).call(e,function(e){for(var i,r,u=RI(i=e.probePoints).call(i,0,8),x=RI(r=e.midpoints).call(r,0,8),C=0;C<4;C++)u[2*C]=u[2*C]*n+o.left-s,u[2*C+1]=u[2*C+1]*n+o.top-a,x[2*C]=x[2*C]*n+o.left-s,x[2*C+1]=x[2*C+1]*n+o.top-a;l.save();var V=gN();try{l.setLineDash([c[0]*V,c[1]*V]);}catch(e){console.error("your browser does not support setLineDash().");}l.strokeStyle=e.isConvex?h:p,l.fillStyle=y,l.lineWidth=d*V,l.beginPath(),l.moveTo(u[0]*V,u[1]*V);for(var T=1;T<4;T++)l.lineTo(u[2*T]*V,u[2*T+1]*V);l.closePath(),cP(l).call(l),l.stroke(),l.strokeStyle=e.isConvex?f:w,l.fillStyle=v,l.lineWidth=g*V;var I=b,E=b;I=BL(k)?k*V:BL(S)?S*V:b*V,BL(S)?E=S*V:I=BL(k)?k*V:b*V;for(var P=0;P<4;P++){l.setLineDash([0,0]),l.beginPath();for(var B=u[2*P],D=u[2*P+1],M=0;M<4;M++)t.drawRoundedRectangle(l,{x:B*V,y:D*V,width:I,height:E,radius:Math.min(m*V,b*V/2)});l.closePath(),cP(l).call(l),l.stroke();}for(var z=0;z<4;z++){l.beginPath();for(var U=x[2*z],A=x[2*z+1],R=0;R<4;R++)t.drawRoundedRectangle(l,{x:U*V,y:A*V,width:I,height:E,radius:Math.min(m*V,b*V/2)});l.closePath(),cP(l).call(l),l.stroke();}l.restore();});}}},{key:"drawRoundedRectangle",value:function value(e,t){var i=t.width,r=t.height,n=t.radius,o=t.x,a=t.y,s=[{x:o-i/2+n,y:a-r/2+n,start:Math.PI,end:3*Math.PI/2},{x:o+i/2-n,y:a-r/2+n,start:3*Math.PI/2,end:2*Math.PI},{x:o+i/2-n,y:a+r/2-n,start:0,end:Math.PI/2},{x:o-i/2+n,y:a+r/2-n,start:Math.PI/2,end:Math.PI}];if(e.beginPath(),e.arc)for(var u=0;u<4;u++){var l=s[u];e.arc(l.x,l.y,n,l.start,l.end);}else e.rect(o-i/2,a-r/2,i,r);e.closePath();}},{key:"toCanvas",value:function value(e){var t=window.TouchEvent&&e instanceof window.TouchEvent?e.targetTouches[0]:e,i=this.cropMng.canvasItem.getBoundingClientRect(),r=yN(),n=r.scrollX,o=r.scrollY;return{offsetX:t.pageX-n-i.left,offsetY:t.pageY-o-i.top};}},{key:"onStartHandler",value:function value(e){var t=this.cropMng.cropSetting.multipleCropping,i=this.toCanvas(e),r=this.toAreaCoordinate(i.offsetX,i.offsetY);this.mouseDown=!0,this.cropMng.onStartHandler(r.x,r.y,e.ctrlKey&&t);}},{key:"onMoveHandler",value:function value(e){var t=this.cropMng,i=t.canvasItem,r=t.cropSetting,n=t.cropBoxes;if(this.mouseDown||0!==n.length){var o=r.enableCreateBoxByPointer,a=r.keepAspectRatioWithShift,s=r.keepAspectRatio,u=r.enableCursor,l=r.enableMagnifier,c=this.toCanvas(e),h=this.toAreaCoordinate(c.offsetX,c.offsetY);if(!this.mouseDown&&u){var d=this.cropMng.checkSelectForCursor(h.x,h.y);if(null===d)return void(i.style.cursor="crosshair");"default"===d.mode?i.style.cursor="move"===d.position?"move":"".concat(d.position,"-resize"):i.style.cursor=["move","nw-resize","ne-resize","se-resize","sw-resize","sw-resize","n-resize","e-resize","s-resize","w-resize"][d.part+1];}if(this.mouseDown){this.cropMng.onMoveHandler(h.x,h.y,o),e.shiftKey&&a?this.cropMng.setKeepAspectRatio(!0):s||this.cropMng.setKeepAspectRatio(!1);var f=this.cropMng.isInArea(h.x,h.y),v=this.cropMng.checkSelectVertex(h.x,h.y);this.mouseDown&&l&&f&&v&&this.renderMagnifier(e,h.x,h.y);}}else"crosshair"!==i.style.cursor&&(i.style.cursor="crosshair");}},{key:"onEndHandler",value:function value(e){this.mouseDown=!1,this.cropMng.onEndHandler();}},{key:"renderMagnifier",value:function value(e,t,i){var r=this.cropMng;if(this.imgData&&r.canvasItem){var n=r.cropSetting,o=n.dashLine,a=n.borderColor,s=n.borderWidth,u=n.magnifier,l=u.fixed,c=u.fixedLeft,h=u.fixedTop,d=u.size,f=u.magnification,v=this.cropMng.canvasItem.getContext("2d"),g=this.toCanvas(e),m=2*d*f,y=g.offsetX,p=g.offsetY,w=f*d,b=g.offsetX-w,k=g.offsetY-w;l&&(y=h+d,p=c+d,b=h-(w=(f-1)*d),k=c-w),v.save(),v.beginPath(),v.arc(y,p,d,0,2*Math.PI),v.closePath(),v.clip(),v.drawImage(this.imgData,t-d,i-d,2*d,2*d,b,k,m,m),v.lineWidth=s,v.strokeStyle=a,v.setLineDash([o[0],o[1]]);var S=l?h+d:g.offsetX,x=l?c+d:g.offsetY;v.beginPath(),v.moveTo(S,x-d),v.lineTo(S,x+d),v.moveTo(S-d,x),v.lineTo(S+d,x),v.stroke(),v.restore();}}},{key:"toAreaCoordinate",value:function value(e,t){var i=this.cropMng,r=i.area,n=i.scrollLeft,o=i.scrollTop,a=i.zoom;return{x:e=(e-r.left+n)/a,y:t=(t-r.top+o)/a};}}]);}(),NO=function(){return Yk(function e(){Xk(this,e);},[{key:"init",value:function value(e){var t=e.rendererService.canvasDom,i=new LO();e.boxRenderer=i,i.cropMng.selectedCallback=function(){var t=e.getCurrentTab(),r=i.cropMng.getRectArr(),n=e.getStatus(t.currentPage.uid).imageScale;"single"===e.config.displayMode&&(n=1);var o=[];$k(r).call(r,function(e){var i={index:t.current,x:Math.floor(e.x*n),y:Math.floor(e.y*n),width:Math.floor(e.width*n),height:Math.floor(e.height*n)};o.push(i);}),e.emit("pageAreaSelected",t.current,o);},i.cropMng.unselectedCallback=function(){var t=e.getCurrentTab();e.emit("pageAreaUnselected",t.current);},i.initCrop(t.width,t.height,t,{}),this.listenNativeEvents(e),this.listenViewerHooks(e);}},{key:"listenNativeEvents",value:function value(e){var t=e.rendererService.canvasDom,i=!1,r=function r(t){var r=Gb(e.formatTouches(t),1)[0];if("crop"===e.config.toolType){e.getPointerOverPageInfo(r.pageX,r.pageY).pageInfo.obj;var n=e.getCurrentTab();n&&n.currentPage&&(i=!0,e.boxRenderer.onStartHandler(t));}},n=function n(t){if("crop"===e.config.toolType&&(e.boxRenderer.onMoveHandler(t),i)){var r=e.getCurrentTab();e.rendererService.render(r);}},o=function o(t){if("crop"===e.config.toolType&&(e.boxRenderer.onEndHandler(t),i)){i=!1;var r=e.getCurrentTab();e.rendererService.render(r);}},a=function a(e){e.cancelable&&e.preventDefault();};t.addEventListener("touchmove",a,{passive:!1}),window.PointerEvent?(t.addEventListener("pointerdown",r),document.addEventListener("pointermove",n),document.addEventListener("pointerup",o)):window.MSPointerEvent&&(t.addEventListener("MSPointerDown",r),document.addEventListener("MSPointerMove",n),document.addEventListener("MSPointerUp",o)),e.hooksService.hooks.destroy.on(function(){t.removeEventListener("touchmove",a),window.PointerEvent?(t.removeEventListener("pointerdown",r),document.removeEventListener("pointermove",n),document.removeEventListener("pointerup",o)):window.MSPointerEvent&&(t.removeEventListener("MSPointerDown",r),document.removeEventListener("MSPointerMove",n),document.removeEventListener("MSPointerUp",o));});}},{key:"listenViewerHooks",value:function value(e){var t=function t(_t3,i){if("min"===i&&"multiple"===e.config.displayMode){var r=e.getCurrentTab();if(r){var n=r.currentPage;if(n&&n.uid===_t3){var o=e.getStatus(n.uid).imageScale,a=e.boxRenderer.cropMng.cropBoxes;e.boxRenderer.clearBox(),$k(a).call(a,function(t){var i=t.getRect();if(!t.isScaled){var r=i.x,n=i.y,a=i.width,s=i.height,u=r/o,l=n/o;a/=o,s/=o,e.boxRenderer.cropMng.addBox([u,l,u+a,l,u+a,l+s,u,l+s]).isScaled=!0;}}),e.renderOnly();}}}},i=e.hooksService.hooks,r=function r(){if("crop"===e.config.toolType){var t=e.getCurrentTab();t&&t.isTopPageChanged&&!t.isLoadPage&&e.config.autoSelectTopPage&&e.boxRenderer.clearBox();}},n=function n(){if("crop"===e.config.toolType){var t=e.getCurrentTab();if(t){var i=t.currentPage;if(i){var r,n,o,a=i.imageContainer.getPosition(),s=i.imageContainer.parsedStyle,u=s.width,l=s.height;null!==(r=e.boxRenderer)&&void 0!==r&&r.setCropArea(a.x,a.y,u.value,l.value),null!==(n=e.boxRenderer)&&void 0!==n&&n.setCropConfig({zoom:(null==i?void 0:i.zoom)||1}),null===(o=e.boxRenderer)||void 0===o||o.render();}}}},o=function o(){e.viewer.clearCropBox();};e.rendererService.hooks.beforeRender.on(r),e.rendererService.hooks.afterRender.on(n),i.afterBufferChanged.on(o),e.dvsContext.hooksService.hooks.afterLoadImage.on(t),e.hooksService.hooks.destroy.on(function(){e.rendererService.hooks.beforeRender.off(r),e.rendererService.hooks.afterRender.off(n),i.afterBufferChanged.off(o),e.dvsContext.hooksService.hooks.afterLoadImage.off(t);});}}]);}(),OO={name:"dvsBoxRenderer",install:function install(e){var t=e.getClassStore(),i=t.Viewer;if(i){var r=function(e,t){return t=function(e){function t(e){var i;return Xk(this,t),Wk(yb(i=cL(this,t,[e])),"boxRenderer",void 0),i.context.config.pure||new NO().init(i.context),i.context.configService.registerHandler("cropBoxConfig",function(e,t){kL(t)&&(i.context.boxRenderer.updateCropSetting(t),i.context.renderOnly());}),i.context.config.cropBoxConfig||(i.context.config.cropBoxConfig=i.cropBoxConfig),i;}return _b(t,e),Yk(t,[{key:"cropBoxConfig",get:function get(){return this.context.boxRenderer.cropMng.cropSetting;},set:function set(e){kL(e)&&(this.context.boxRenderer.updateCropSetting(e),this.context.renderOnly());}},{key:"setFreeCropBox",value:function value(e){var t=this.getCurrentTab();if(t){var i=t.currentPage;if(i){var r=this.context.getStatus(i.uid);r&&this.context.boxRenderer.setCropArea(0,0,r.realTimeWidth||0,r.realTimeHeight||0);}}var n=this.context.boxRenderer.setFreeBox(_z(e).call(e));return n&&this.context.renderOnly(),n;}},{key:"setCropBox",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.getCurrentTab(),r=!1;if(i){var n=i.currentPage;if(n){var o=this.context.getStatus(n.uid);if(o&&(this.context.boxRenderer.setCropArea(0,0,n.realTimeWidth||0,n.realTimeHeight||0),"multiple"===this.context.config.displayMode&&this.context.config.useMinImage)){var a=o.imageScale;bL(e)||(e=[e]);var s=[];$k(e).call(e,function(e){var t={left:e.left/a,top:e.top/a,width:e.width/a,height:e.height/a};s.push(t);}),e=s,r=!0;}}}var u=this.context.boxRenderer.setNormalBoxes(e,t,r);return u&&this.context.renderOnly(),u;}},{key:"clearCropBox",value:function value(){var e=this.context.boxRenderer.clearBox();return e&&this.context.boxRenderer.getBoxCount()>0&&this.context.renderOnly(),e;}},{key:"getCropBoxes",value:function value(){var e=this.context.boxRenderer.getCropBoxes(),t=this.getCurrentTab();if(t){var i=t.currentPage;if(i){var r=this.context.getStatus(i.uid);if(r&&"multiple"===this.context.config.displayMode&&this.context.config.useMinImage){var n=r.imageScale;e=$E(e).call(e,function(e){return{left:e.left*n,top:e.top*n,width:e.width*n,height:e.height*n};});}}}return e;}}]);}(e),Wk(t,"use",e.use),t;}(i);t.Viewer=r;}}};function WO(e,t){if(fS(t))return{unit:"px",value:0};if(AL(t))return{unit:"px",value:0};if(BL(t))return{unit:"px",value:t};if(t=AS(t).call(t).toLowerCase(),eU(Number(t))&&"px".search(e)>=0)return{unit:"px",value:Number(t)};var i=[];t=t.replace(e,function(e){return i.push(e),"U".concat(e);});var r="U(".concat(e.source,")");return $E(i).call(i,function(e){return{unit:e,value:Number(t.replace(new RegExp("U".concat(e),"g"),"").replace(new RegExp(r,"g"),"*0"))};})[0];}var HO=function HO(e){return WO(/px/g,e);},FO=function FO(e){return WO(/px|%|em/g,e);},jO=function jO(e){return WO(/deg|rad|grad|turn/g,e);},YO=function(){function e(t,i,r){var n,o,a,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,u=arguments.length>4&&void 0!==arguments[4]&&arguments[4];Xk(this,e),Wk(this,"r",void 0),Wk(this,"g",void 0),Wk(this,"b",void 0),Wk(this,"alpha",void 0),Wk(this,"isNone",void 0),Wk(this,"formatted",""),this.r=t,this.g=i,this.b=r,this.alpha=s,this.isNone=u,this.formatted=lS(n=lS(o=lS(a="rgba(".concat(t,", ")).call(a,i,", ")).call(o,r,", ")).call(n,s,")");}return Yk(e,[{key:"clone",value:function value(){return new e(this.r,this.g,this.b,this.alpha);}}]);}(),XO=function(){function e(t,i){Xk(this,e),Wk(this,"type",void 0),Wk(this,"value",void 0),this.type=t,this.value=i;}return Yk(e,[{key:"clone",value:function value(){return new e(this.type,this.value);}}]);}(),qO={left:180,top:-90,bottom:90,right:0,"left top":225,"top left":225,"left bottom":135,"bottom left":135,"right top":-45,"top right":-45,"right bottom":45,"bottom right":45},ZO=function ZO(e){return{value:"angular"===e.type?Number(e.value):qO[e.value]||0,unit:"deg"};};function _O(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(AL(e))return null;if("currentColor"===e&&(e="black"),"transparent"===e)return new YO(0,0,0,0);var t=function(e){var t;if(OI(e).call(e,"linear")>-1||OI(e).call(e,"radial")>-1)return $E(t=PL(e)).call(t,function(e){var t=e.type,i=e.orientation,r=e.colorStops;!function(e,t,i){var r=e.length;e[r-1].length=null!==(t=e[r-1].length)&&void 0!==t?t:{type:"%",value:"100"},r>1&&(e[0].length=null!==(i=e[0].length)&&void 0!==i?i:{type:"%",value:"0"});for(var n=0,o=Number(e[0].length.value),a=1;a<r;a++){var s,u=null===(s=e[a].length)||void 0===s?void 0:s.value;if(!AL(u)&&!AL(o)){for(var l=1;l<a-n;l++)e[n+l].length={type:"%",value:"".concat(o+(Number(u)-o)*l/(a-n))};n=a,o=Number(u);}}}(r);var n=$E(r).call(r,function(e){return{offset:{value:e.length.value,unit:"%"},color:EL(e)};});if("linear-gradient"===t)return new XO(1,{angle:i?ZO(i):{value:0,unit:"deg"},steps:n});if("radial-gradient"===t&&(i||(i=[{type:"shape",value:"circle"}]),"shape"===i[0].type&&"circle"===i[0].value)){var o,a=function(e){var t=50,i=50,r="%",n="%";if("position"===(null==e?void 0:e.type)){var o=e.value,a=o.x,s=o.y;"position-keyword"===(null==a?void 0:a.type)&&("left"===a.value?t=0:"center"===a.value?t=50:"right"===a.value?t=100:"top"===a.value?i=0:"bottom"===a.value&&(i=100)),"position-keyword"===(null==s?void 0:s.type)&&("left"===s.value?t=0:"center"===s.value?i=50:"right"===s.value?t=100:"top"===s.value?i=0:"bottom"===s.value&&(i=100)),"px"!==(null==a?void 0:a.type)&&"%"!==(null==a?void 0:a.type)&&"em"!==(null==a?void 0:a.type)||(r=null==a?void 0:a.type,t=Number(a.value)),"px"!==(null==s?void 0:s.type)&&"%"!==(null==s?void 0:s.type)&&"em"!==(null==s?void 0:s.type)||(n=null==s?void 0:s.type,i=Number(s.value));}return{cx:{value:t,unit:r},cy:{value:i,unit:n}};}(i[0].at),s=a.cx,u=a.cy;if(i[0].style){var l=i[0].style,c=l.type,h=l.value;o="extent-keyword"===c?h:{value:h,unit:c};}return new XO(2,{cx:s,cy:u,size:o,steps:n});}});}(e);if(t)return t;var i=function(e){var t,i,r;if(e=AS(t="".concat(e)).call(t).toLowerCase(),XL.exec(e))switch(i=XL.exec(e),r=i[1].length,i=$S(i[1],16),r){case 6:return eN(i);case 3:return new QL(i>>8&15|i>>4&240,i>>4&15|240&i,(15&i)<<4|15&i,1);case 8:return tN(i>>24&255,i>>16&255,i>>8&255,(255&i)/255);case 4:return tN(i>>12&15|i>>8&240,i>>8&15|i>>4&240,i>>4&15|240&i,((15&i)<<4|15&i)/255);default:return null;}return qL.exec(e)?(i=qL.exec(e),new QL(i[1],i[2],i[3],1)):ZL.exec(e)?(i=ZL.exec(e),new QL(255*i[1]/100,255*i[2]/100,255*i[3]/100,1)):_L.exec(e)?tN((i=_L.exec(e))[1],i[2],i[3],i[4]):GL.exec(e)?tN(255*(i=GL.exec(e))[1]/100,255*i[2]/100,255*i[3]/100,i[4]):KL.exec(e)?nN(iN((i=KL.exec(e))[1],i[2]/100,i[3]/100,1)):$L.exec(e)?nN(iN((i=$L.exec(e))[1],i[2]/100,i[3]/100,i[4])):JL.hasOwnProperty(e)?eN(JL[e]):"transparent"===e?new QL(NaN,NaN,NaN,0):null;}(e),r=[0,0,0,0];return null!==i&&(r[0]=$S(i.r,10)||0,r[1]=$S(i.g,10)||0,r[2]=$S(i.b,10)||0,r[3]=vU(i.opacity)),sv(YO,r);}function GO(e){var t=null;bL(e)&&(t=e),TL(e)&&(t=e.split(" "));for(var i=0;i<3;i++)t[i]?t[i]=HO(t[i]).value:t[i]=0;var r=_O(t[3]);return t[3]=r?r.formatted:"black",RI(t).call(t,0,4);}function KO(e){var t,i=[];return TL(e)?$k(t=e.split(" ")).call(t,function(e){var t=HO(e);t&&i.push(t.value);}):i.push.apply(i,Kb(e)),1===i.length?[i[0],i[0]]:i;}var $O=function $O(e){var t=e;if(TL(e)){var i=FO(e);"%"===i.unit&&(t=i.value/100),"px"===i.unit&&(t=i.value);}return t>1&&(t=1),t;};function JO(e,t,i){var r=i.parsedStyle,n=r.x,o=void 0===n?0:n,a=r.y,s=void 0===a?0:a;r.z,e!==t&&i.setLocalPosition(o,s);}var QO=function(){return Yk(function e(t){Xk(this,e),Wk(this,"bubbles",!0),Wk(this,"cancelBubble",!0),Wk(this,"cancelable",!1),Wk(this,"composed",!1),Wk(this,"currentTarget",void 0),Wk(this,"defaultPrevented",!1),Wk(this,"eventPhase",e.prototype.NONE),Wk(this,"isTrusted",void 0),Wk(this,"returnValue",void 0),Wk(this,"srcElement",void 0),Wk(this,"target",void 0),Wk(this,"timeStamp",void 0),Wk(this,"type",void 0),Wk(this,"detail",void 0),Wk(this,"view",void 0),Wk(this,"which",void 0),Wk(this,"path",void 0),Wk(this,"immediatePropagationStopped",!1),Wk(this,"propagationStopped",!1),Wk(this,"nativeEvent",void 0),Wk(this,"originalEvent",void 0),Wk(this,"eventService",void 0),Wk(this,"AT_TARGET",1),Wk(this,"BUBBLING_PHASE",2),Wk(this,"CAPTURING_PHASE",3),Wk(this,"NONE",0),this.eventService=t;},[{key:"initUIEvent",value:function value(e,t,i,r,n){}},{key:"composedPath",value:function value(){var e=this.path,t=this.eventService,i=this.target;return!t||e&&e[this.path.length-1]===i||(this.path=i?t.getPropagationPath(i):[]),this.path;}},{key:"initEvent",value:function value(e,t,i){}},{key:"preventDefault",value:function value(){var e=this.nativeEvent;e instanceof Event&&e.cancelable&&e.preventDefault(),this.defaultPrevented=!0;}},{key:"stopImmediatePropagation",value:function value(){this.immediatePropagationStopped=!0;}},{key:"stopPropagation",value:function value(){this.propagationStopped=!0;}}]);}(),eW=function(e){function t(e,i){var r;return Xk(this,t),(r=cL(this,t,[null])).type=e,r.detail=i,r;}return _b(t,e),Yk(t);}(QO),tW=function(){return Yk(function e(){Xk(this,e),Wk(this,"pubsub",bN.create());},[{key:"addEventListener",value:function value(e,t,i){var r,n=DL(i)&&i;kL(i)&&(n=i.capture,r=i.once),e=n?"".concat(e,":capture"):e,t=ML(t)?t:t.handleEvent,this.pubsub.on(e,t,this,r);}},{key:"dispatchEvent",value:function value(e){var t,i=this.ownerDocument||this.document;return i&&(e.eventService=(null===(t=i.defaultView)||void 0===t?void 0:t.eventService)||null,e.defaultPrevented=!1,e.path=[],e.target=this,function(e,t,i){if(t=null!==(i=t)&&void 0!==i?i:e.type,e.propagationStopped=!1,e.immediatePropagationStopped=!1,e.target){var r=e.composedPath(),n=r.length;e.eventPhase=e.CAPTURING_PHASE;for(var o=0;o<n-1;o++)if(e.currentTarget=r[o],iW(e,"".concat(t,":capture")),rW(e))return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,iW(e,t),!rW(e)){e.eventPhase=e.BUBBLING_PHASE;for(var a=n-2;a>=0;a--)if(e.currentTarget=r[a],iW(e,t),rW(e))return;}}}(e)),!e.defaultPrevented;}},{key:"removeEventListener",value:function value(e,t,i){var r=DL(i)&&i;kL(i)&&(r=i.capture),e=r?"".concat(e,":capture"):e,t=ML(t)?t:t.handleEvent,this.pubsub.off(e,t,context);}},{key:"removeAllEventListeners",value:function value(){this.pubsub.removeAllEventListeners();}},{key:"getAllEvents",value:function value(){return this.pubsub.getAllEvents();}}]);}();function iW(e,t){for(var i=e.currentTarget.getAllEvents()[t]||[],r=0,n=i.length;r<n;r++){if(e.immediatePropagationStopped)return;var o=i[r],a=o.context;o.fn.call(a,e);}}function rW(e){return e.propagationStopped||e.immediatePropagationStopped;}var nW=function(e){function t(e,i,r,n,o,a,s,u){var l;return Xk(this,t),Wk(yb(l=cL(this,t,[null])),"relatedNode",void 0),Wk(yb(l),"prevValue",void 0),Wk(yb(l),"newValue",void 0),Wk(yb(l),"attrName",void 0),Wk(yb(l),"attrChange",void 0),Wk(yb(l),"prevParsedValue",void 0),Wk(yb(l),"newParsedValue",void 0),l.type=e,l.relatedNode=i,l.prevValue=r,l.newValue=n,l.attrName=o,l.attrChange=a,l.prevParsedValue=s,l.newParsedValue=u,l;}return _b(t,e),Yk(t);}(QO);Wk(nW,"ADDITION",2),Wk(nW,"MODIFICATION",1),Wk(nW,"REMOVAL",3);var oW=new(function(){return Yk(function e(){Xk(this,e);},[{key:"querySelector",value:function value(e,t){return MU(e).call(e,"#")?xP(t).call(t,function(t){return t.id===e.substring(1);}):null;}},{key:"querySelectorAll",value:function value(e,t){return[];}}]);}())(),aW=new(function(){return Yk(function e(t){Xk(this,e),Wk(this,"selector",void 0),this.selector=t;},[{key:"recursiveUpdateHierarchy",value:function value(e){var t=this,i=e.transform,r=e.childNodes;i.frozen||(i.frozen=!0,(i.localDirty||i.worldDirty)&&this.updateHierarchy(e),$k(r).call(r,function(e){t.recursiveUpdateHierarchy(e);}));}},{key:"querySelector",value:function value(e,t){return this.selector.querySelector(e,t);}},{key:"querySelectorAll",value:function value(e,t){return this.selector.querySelectorAll(e,t);}},{key:"append",value:function value(e,t,i){e.parentNode&&this.remove(e),e.parentNode=t;var r=t.childNodes,n=t.sortable;void 0!==i?gE(r).call(r,i,0,e):r.push(e),n&&(n.dirty=!0);var o=e.transform;o&&this.dirtyWorld(e,o),o.frozen&&this.unfreezeParentToRoot(e);}},{key:"remove",value:function value(e){var t=e.parentNode,i=!0;if(!t)return i=!1;var r=t.sortable;r&&(r.dirty=!0);var n=t.childNodes,o=OI(n).call(n,e);o>-1?(i=!0,gE(n).call(n,o,1)):i=!1;var a=e.transform;return a&&this.dirtyWorld(e,a),e.parentNode=null,i;}},{key:"isChildExist",value:function value(e){var t=e.parentNode;if(!t)return!1;var i=t.childNodes;return!(OI(i).call(i,e)<0);}},{key:"setOrigin",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;BL(t)&&(t=CN.fromValue(t,i));var r=e.transform;r.origin.equals(t)||(r.origin.setFromVector(t),this.dirtyLocal(e,r));}},{key:"getOrigin",value:function value(e){return e.transform.origin;}},{key:"setPosition",value:function value(e,t){var i=e.transform;t=CN.fromValue(t.x,t.y,t.z||0);var r=this.getPosition(e);if(!t.equals(r)){var n=this.getWorldTransform(e),o=this.getPosition(e),a=t.x-o.x,s=t.y-o.y,u=t.z-o.z;if(i.position=t,e.hasParentTransform()){n=new RN().translateSelf(a,s,u).multiply(n);var l=e.parentNode.transform.worldTransform,c=this.getWorldTransform(e);c.m41=t.x,c.m42=t.y,c.m43=t.z;var h=l.inverse().multiply(n),d=this.getOrigin(e),f=h.getScaling(),v=this.createScaleMatrix(f.x,f.y,f.z),g=RN.fromMatrix(v).inverse(),m=h.translate(d.x,d.y,d.z).multiply(g),y=m.getRotation(),p=RN.fromQuat(y).inverse(),w=m.multiply(p).getTranslation();w.x-=d.x,w.y-=d.y,w.z-=d.z,i.localPosition.setFromVector(w);}else i.localPosition=t;this.dirtyLocal(e,i);}}},{key:"setLocalPosition",value:function value(e,t){var i=e.transform;(t=CN.fromValue(t.x,t.y,t.z||0)).equals(i.localPosition)||(i.localPosition=t,this.dirtyLocal(e,i));}},{key:"getPosition",value:function value(e){var t=this.getWorldTransform(e),i=e.transform,r=t.getTranslation();return i.position.setFromVector(r),e.transform.position;}},{key:"getLocalPosition",value:function value(e){return e.transform.localPosition;}},{key:"translate",value:function value(e,t){if(!t.equals(new CN())){var i=this.getPosition(e),r=this.getWorldTransform(e),n=r.getScaling(),o=this.createScaleMatrix(n.x,n.y,n.z),a=r.multiply(RN.fromMatrix(o).inverse()).getRotation(),s=RN.fromQuat(a).transformPoint(t);i.add(s),this.setPosition(e,i);}}},{key:"translateLocal",value:function value(e,t){var i=e.transform;if(!t.equals(new CN())){t.multiply(i.localScale);var r=RN.fromQuat(i.localRotation).transformPoint(t);i.localPosition.add(r),this.dirtyLocal(e,i);}}},{key:"scaleLocal",value:function value(e,t){var i=e.transform;i.localScale.multiply(t),this.dirtyLocal(e,i);}},{key:"setLocalScale",value:function value(e,t){var i=e.transform,r=CN.fromValue(t.x,t.y,t.z||i.localScale.z);r.equals(i.localScale)||(i.localScale=r,this.dirtyLocal(e,i));}},{key:"getScale",value:function value(e){var t=e.transform,i=this.getWorldTransform(e).getScaling();return t.scale.setFromVector(i),t.scale;}},{key:"getLocalScale",value:function value(e){return e.transform.localScale;}},{key:"getRotation",value:function value(e){var t=e.transform,i=this.getWorldTransform(e),r=i.getScaling(),n=this.createScaleMatrix(r.x,r.y,r.z),o=i.multiply(RN.fromMatrix(n).inverse()).getRotation();return t.rotation.setFromQuat(o),t.rotation;}},{key:"getLocalRotation",value:function value(e){return e.transform.localRotation;}},{key:"rotate",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=e.transform;if(BL(t)&&(t=VN(t,i,r)),e.hasParentTransform()){var o=MN(t.x,t.y,t.z),a=this.getRotation(e),s=this.getRotation(e.parentNode).clone().invert().multiply(o).multiply(a).normalize();n.localRotation.setFromQuat(s),this.dirtyLocal(e,n);}else this.rotateLocal(e,t);}},{key:"rotateLocal",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;BL(t)&&(t=VN(t,i,r));var n=e.transform,o=MN(t.x,t.y,t.z);n.localRotation.multiply(o),this.dirtyLocal(e,n);}},{key:"setAngle",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;BL(t)&&(t=VN(t,i,r));var n=e.transform;if(e.hasParentTransform()){var o=MN(t.x,t.y,t.z);n.localRotation.setFromQuat(o);var a=this.getRotation(e.parentNode);a.invert(),n.localRotation.setFromQuat(a.multiply(n.localRotation)),this.dirtyLocal(e,n);}else this.setLocalAngle(e,t);}},{key:"setLocalAngle",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;BL(t)&&(t=VN(t,i,r));var n=e.transform,o=MN(t.x,t.y,t.z);n.localRotation.setFromQuat(o),this.dirtyLocal(e,n);}},{key:"setRotation",value:function value(e,t){var i=e.transform;if(e.hasParentTransform()){var r=this.getRotation(e.parentNode);r=r.clone().invert().multiply(t).normalize(),i.localRotation.setFromQuat(r),this.dirtyLocal(e,i);}else this.setLocalRotation(e,t);}},{key:"setLocalRotation",value:function value(e,t){var i=e.transform;i.localRotation.setFromQuat(t),this.dirtyLocal(e,i);}},{key:"getAngle",value:function value(e){var t=this.getWorldTransform(e);return BN.fromQuat(t.decompose().quaternion).toEuler();}},{key:"getLocalAngle",value:function value(e){return this.getLocalTransform(e),this.getLocalRotation(e).toEuler();}},{key:"setLocalTransform",value:function value(e,t){var i=this.getOrigin(e),r=t.decompose();r.quaternion;var n=r.rotation,o=r.scale,a=this.createScaleMatrix(o.x,o.y,o.z),s=RN.fromMatrix(a).inverse(),u=t.translate(i.x,i.y,i.z).multiply(s).getTranslation();u.x-=i.x,u.y-=i.y,u.z-=i.z,this.setLocalPosition(e,u),this.setLocalAngle(e,n.x,n.y,n.z),this.setLocalScale(e,o);}},{key:"createScaleMatrix",value:function value(){return{m11:arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,m21:0,m31:0,m41:0,m12:0,m22:arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m32:0,m42:0,m13:0,m23:0,m33:arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,m43:0,m14:0,m24:0,m34:0,m44:1};}},{key:"resetLocalTransform",value:function value(e){this.setLocalScale(e,new CN(1,1,1)),this.setLocalPosition(e,new CN(0,0,0)),this.setLocalAngle(e,0);}},{key:"getWorldTransform",value:function value(e){var t=e.transform;if(!t.worldDirty&&!t.localDirty)return t.worldTransform;var i=e.parentNode;return i&&i.transform&&this.getWorldTransform(i),this.updateHierarchy(e),t.worldTransform;}},{key:"getLocalTransform",value:function value(e){var t=e.transform;return t.localDirty&&t.updateLocalTransform(),t.localTransform;}},{key:"getBounds",value:function value(e,t){var i=this,r=e.renderable,n=e.childNodes;if(t&&!r.renderBoundsDirty&&r)return r.renderBounds;if(!t&&!r.boundsDirty&&r.bounds)return r.bounds;var o=this.getTransformedGeometryBounds(e,t);$k(n).call(n,function(e){var r=i.getBounds(e,t);r&&(o?o.addBounds(r):o=qW.fromBounds(r));});var a=e.style.clipPath;if(a){var s=this.getTransformedGeometryBounds(a,!0),u=null;s&&(u=qW.create()).setFromTransformedBounds(this.getWorldTransform(e),s),o?u&&(o=u.intersection(o)):o=u;}return t?(r.renderBoundsDirty=!1,o&&(r.renderBounds=o)):(r.boundsDirty=!1,o&&(r.bounds=o)),o||qW.create();}},{key:"getLocalBounds",value:function value(e){var t=e.parentNode;if(t){var i=new RN();t.transform&&(i=this.getWorldTransform(t).inverse());var r=this.getBounds(e);if(!qW.isEmpty(r)){var n=qW.create();return n.setFromTransformedBounds(i,r),n;}}return this.getBounds(e);}},{key:"getGeometryBounds",value:function value(e,t){var i=e.geometry;return(t?i.renderBounds:i.contentBounds)||qW.create();}},{key:"getBoundingClientRect",value:function value(e){var t,i,r=this.getGeometryBounds(e);qW.isEmpty(r)||(i=qW.create()).setFromTransformedBounds(this.getWorldTransform(e),r);var n=null===(t=e.ownerDocument)||void 0===t?void 0:t.defaultView.getContextService().getBoundingClientRect();return i?{x:i.minX+((null==n?void 0:n.left)||0),y:i.minY+((null==n?void 0:n.top)||0),width:i.maxX-i.minX,height:i.maxY-i.minY}:{x:(null==n?void 0:n.left)||0,y:(null==n?void 0:n.top)||0,width:0,height:0};}},{key:"updateHierarchy",value:function value(e){var t=e.transform;if(t.localDirty&&t.updateLocalTransform(),t.worldDirty){var i,r=null==e||null===(i=e.parentNode)||void 0===i?void 0:i.transform;e.parentNode&&r||(r=new hW()),t.updateWorldTransform(r);}}},{key:"getTransformedGeometryBounds",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.getGeometryBounds(e,t);if(!qW.isEmpty(i)){var r=qW.create();return this.getWorldTransform(e),r.setFromTransformedBounds(this.getWorldTransform(e),i),r;}return null;}},{key:"dirtyLocal",value:function value(e,t){t.localDirty||(t.localDirty=!0,t.worldDirty||this.dirtyWorld(e,t));}},{key:"dirtyWorld",value:function value(e,t){t.worldDirty||this.unfreezeParentToRoot(e),this.recursiveDirtyWorld(e,t),function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e;i;){var r=i.renderable;r&&(r.boundsDirty=!0,r.renderBoundsDirty=!0),i=i.parentNode;}e.dispatchEvent(new eW("bounds-changed",{affectChildren:t}));}(e,!0);}},{key:"recursiveDirtyWorld",value:function value(e,t){var i,r=this;if(!t.worldDirty){t.worldDirty=!0,t.frozen=!1,$k(i=e.childNodes).call(i,function(e){var t=e.transform;t.worldDirty||r.recursiveDirtyWorld(e,t);});var n=e.renderable;n&&(n.boundsDirty=!0,n.renderBoundsDirty=!0);var o=new nW("DOMAttrModified",e,null,null,"modelMatrix",nW.MODIFICATION,null,null);e.dispatchEvent(o);}}},{key:"unfreezeParentToRoot",value:function value(e){for(var t=e;t;){var i=t.transform;i&&(i.frozen=!1),t=t.parentNode;}}}]);}())(oW),sW=function(e){function t(){var e,i;Xk(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return Wk(i=cL(this,t,lS(e=[]).call(e,n)),"baseURI",""),Wk(i,"childNodes",[]),Wk(i,"nodeName",""),Wk(i,"nodeType",0),Wk(i,"nodeValue",null),Wk(i,"ownerDocument",null),Wk(i,"parentNode",null),Wk(i,"isConnected",!1),Wk(i,"textContent",void 0),i;}return _b(t,e),Yk(t,[{key:"firstChild",get:function get(){return this.childNodes.length>0?this.childNodes[0]:null;}},{key:"lastChild",get:function get(){var e=this.childNodes;return e.length>0?e[e.length-1]:null;}},{key:"nextSibling",get:function get(){var e=this.parentNode;if(e){var t,i=OI(t=e.childNodes).call(t,this);return e.childNodes[i+1];}return null;}},{key:"parentElement",get:function get(){return this.parentNode;}},{key:"previousSibling",get:function get(){var e=this.parentNode;if(e){var t,i=OI(t=e.childNodes).call(t,this);return e.childNodes[i-1];}return null;}},{key:"contains",value:function value(e){for(var t=e;t&&this!==t;)t=t.parentNode;return!!t;}},{key:"getRootNode",value:function value(e){return this.parentNode?this.parentNode.getRootNode(e):this;}},{key:"hasChildNodes",value:function value(){return this.childNodes.length>0;}},{key:"isEqualNode",value:function value(e){return this===e;}},{key:"isSameNode",value:function value(e){return this.isEqualNode(e);}},{key:"compareDocumentPosition",value:function value(e){throw new Error("Method to be implemented");}},{key:"isDefaultNamespace",value:function value(e){throw new Error("Method to be implemented");}},{key:"lookupNamespaceURI",value:function value(e){throw new Error("Method to be implemented");}},{key:"lookupPrefix",value:function value(e){throw new Error("Method to be implemented");}},{key:"normalize",value:function value(){throw new Error("Method to be implemented");}},{key:"recursiveCall",value:function value(e){var t;e(this)||$k(t=this.childNodes).call(t,function(t){t.recursiveCall(e);});}},{key:"hasParentTransform",value:function value(){return!(!this.parentNode||!this.parentNode.transform);}}],[{key:"isNode",value:function value(e){return!!e.childNodes;}}]);}(tW);Wk(sW,"ELEMENT_NODE",1),Wk(sW,"ATTRIBUTE_NODE",2),Wk(sW,"TEXT_NODE",3),Wk(sW,"CDATA_SECTION_NODE",4),Wk(sW,"ENTITY_REFERENCE_NODE",5),Wk(sW,"ENTITY_NODE",6),Wk(sW,"PROCESSING_INSTRUCTION_NODE",7),Wk(sW,"COMMENT_NODE",8),Wk(sW,"DOCUMENT_NODE",9),Wk(sW,"DOCUMENT_TYPE_NODE",10),Wk(sW,"DOCUMENT_FRAGMENT_NODE",11),Wk(sW,"NOTATION_NODE",12),Wk(sW,"DOCUMENT_POSITION_DISCONNECTED",1),Wk(sW,"DOCUMENT_POSITION_PRECEDING",2),Wk(sW,"DOCUMENT_POSITION_FOLLOWING",4),Wk(sW,"DOCUMENT_POSITION_CONTAINS",8),Wk(sW,"DOCUMENT_POSITION_CONTAINED_BY",16),Wk(sW,"DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC",32);var uW=Yk(function e(){Xk(this,e),Wk(this,"contentBounds",void 0),Wk(this,"renderBounds",void 0);}),lW=function(){return Yk(function e(){Xk(this,e),Wk(this,"boundsDirty",!0),Wk(this,"bounds",void 0),Wk(this,"renderBoundsDirty",!0),Wk(this,"renderBounds",void 0);},[{key:"isRenderable",value:function value(){return this.boundsDirty||this.renderBoundsDirty;}},{key:"toRenderable",value:function value(){this.boundsDirty=!0,this.renderBoundsDirty=!0;}}]);}(),cW=Yk(function e(){Xk(this,e),Wk(this,"renderOrder",0),Wk(this,"lastSortedIndex",void 0),Wk(this,"sorted",void 0),Wk(this,"dirty",!1);}),hW=function(){return Yk(function e(){Xk(this,e),Wk(this,"frozen",!0),Wk(this,"worldDirty",!1),Wk(this,"localDirty",!1),Wk(this,"localRotation",DN(0,0,0,1)),Wk(this,"rotation",DN(0,0,0,1)),Wk(this,"localScale",VN(1,1,1)),Wk(this,"scale",VN(1,1,1)),Wk(this,"localPosition",VN(0,0,0)),Wk(this,"position",VN(0,0,0)),Wk(this,"localSkew",VN(0,0,0)),Wk(this,"skew",VN(0,0,0)),Wk(this,"origin",VN(0,0,0)),Wk(this,"worldTransform",new RN()),Wk(this,"localTransform",new RN());},[{key:"updateLocalTransform",value:function value(){var e=this.origin,t=this.localScale,i=this.localPosition,r=this.localRotation,n=this.localSkew,o=new RN();o.translateSelf(e.x,e.y,e.z);var a=UN(0,0,0,1),s=this.compose(a,i,r,n,t);o.multiplySelf(s),o.translateSelf(-e.x,-e.y,-e.z),this.localTransform.setFromMatrix(o),this.localDirty=!1;}},{key:"updateWorldTransform",value:function value(e){var t=e.worldTransform.clone();t.multiplySelf(this.localTransform),this.worldTransform.setFromMatrix(t),this.worldDirty=!1;}},{key:"compose",value:function value(e,t,i,r,n){var o=new RN();o.m14=e.x,o.m24=e.y,o.m34=e.z,o.m44=e.w,o.translateSelf(t.x,t.y,t.z);var a=RN.fromQuat(i);o.multiplySelf(a);var s=new RN();return r.z&&(s.m32=r.z,o.multiplySelf(s)),r.y&&(s.m32=0,s.m31=r.y,o.multiplySelf(s)),r.x&&(s.m31=0,s.m21=r.x,o.multiplySelf(s)),o.scaleSelf(n.x,n.y,n.z),o;}}]);}(),dW=function(e){function t(){var e,i;Xk(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return Wk(i=cL(this,t,lS(e=[]).call(e,n)),"attributes",{}),Wk(i,"id",void 0),Wk(i,"pageUid",void 0),Wk(i,"index",void 0),Wk(i,"name",void 0),Wk(i,"scrollLeft",void 0),Wk(i,"scrollTop",void 0),Wk(i,"scrollWidth",void 0),Wk(i,"scrollHeight",void 0),Wk(i,"renderable",new lW()),Wk(i,"sortable",new cW()),Wk(i,"geometry",new uW()),Wk(i,"transform",new hW()),Wk(i,"parsedStyle",{}),Wk(i,"style",void 0),Wk(i,"isDestroyed",!1),i;}return _b(t,e),Yk(t,[{key:"className",get:function get(){return this.getAttribute("class")||"";},set:function set(e){this.setAttribute("class",e);}},{key:"classList",get:function get(){var e;return yx(e=this.className.split(" ")).call(e,function(e){return""!==e;});}},{key:"tagName",get:function get(){return this.nodeName;}},{key:"children",get:function get(){return this.childNodes;}},{key:"childElementCount",get:function get(){return this.childNodes.length;}},{key:"firstElementChild",get:function get(){return this.firstChild;}},{key:"lastElementChild",get:function get(){return this.lastChild;}},{key:"getAttribute",value:function value(e){var t=this.attributes[e];return null==t?null:t;}},{key:"getElementsByName",value:function value(e){return aW.querySelectorAll('[name="'.concat(e,'"]'),this);}},{key:"getElementsByClassName",value:function value(e){return aW.querySelectorAll(".".concat(e),this);}},{key:"getElementsByTagName",value:function value(e){return aW.querySelectorAll(e,this);}},{key:"hasAttribute",value:function value(e){var t;return OI(t=eS(this.attributes)).call(t,e)>-1;}},{key:"removeAttribute",value:function value(e){this.setAttribute(e,null),delete this.attributes[e];}},{key:"setAttribute",value:function value(e,t){this.attributes[e]=t;}},{key:"appendChild",value:function value(e,t){aW.append(e,this,t);var i=new eW("child-inserted",{child:e});this.dispatchEvent(i);var r=new nW("DOMNodeInserted",this,"","","",0,"","");return e.dispatchEvent(r),e;}},{key:"cloneNode",value:function value(e){return null;}},{key:"insertBefore",value:function value(e,t){if(t){var i,r=OI(i=this.childNodes).call(i,t);this.appendChild(e,r-1);}else this.appendChild(e);return e;}},{key:"removeChild",value:function value(e){var t=new nW("removed",this,"","","",0,"","");e.dispatchEvent(t);var i=new eW("child-removed",{child:e});return this.dispatchEvent(i),aW.remove(e),e;}},{key:"isChildExist",value:function value(e){return aW.isChildExist(e);}},{key:"replaceChild",value:function value(e,t){var i,r=OI(i=this.childNodes).call(i,t);return this.removeChild(t),this.appendChild(e,r),t;}},{key:"destroy",value:function value(){var e=new eW("destroy",{});this.dispatchEvent(e),this.remove(),this.removeAllEventListeners(),this.isDestroyed=!0;}},{key:"after",value:function value(){var e=this.parentNode;if(e){for(var t,i=OI(t=e.childNodes).call(t,this),r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];$k(n).call(n,function(t,r){null==e||e.appendChild(t,i+r+1);});}}},{key:"before",value:function value(){var e=this.parentNode;if(e){for(var t,i=OI(t=e.childNodes).call(t,this),r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];$k(n).call(n,function(t,r){null==e||e.appendChild(t,i+r);});}}},{key:"remove",value:function value(){this.parentNode&&this.parentNode.removeChild(this);}},{key:"replaceWith",value:function value(){this.after.apply(this,arguments),this.remove();}},{key:"append",value:function value(){for(var e=this,t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];$k(i).call(i,function(t){e.appendChild(t);});}},{key:"prepend",value:function value(){for(var e=this,t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];$k(i).call(i,function(t,i){e.appendChild(t,i);});}},{key:"querySelector",value:function value(e){return aW.querySelector(e,this);}},{key:"querySelectorAll",value:function value(e){return aW.querySelectorAll(e,this);}},{key:"find",value:function value(e){var t=this,i=null;return this.recursiveCall(function(r){return!(r!==t||!e(r)||(i=r,0));}),i;}},{key:"findAll",value:function value(e){var t=this,i=[];return this.recursiveCall(function(r){r===t&&e(r)&&i.push(r);}),i;}},{key:"getGeometryBounds",value:function value(){return aW.getGeometryBounds(this);}},{key:"getRenderBounds",value:function value(){return aW.getBounds(this,!0);}},{key:"getBounds",value:function value(){return aW.getBounds(this);}},{key:"getLocalBounds",value:function value(){return aW.getLocalBounds(this);}},{key:"getBoundingClientRect",value:function value(){return aW.getBoundingClientRect(this);}}]);}(sW),fW=function(){return Yk(function e(t){Xk(this,e),Wk(this,"lineAlign",void 0),Wk(this,"owner",void 0),this.owner=t,this.reset();},[{key:"reset",value:function value(){this.lineAlign=.5;}},{key:"x",get:function get(){return this.owner.getAttribute("x");},set:function set(e){this.owner.setAttribute("x",e);}},{key:"y",get:function get(){return this.owner.getAttribute("y");},set:function set(e){this.owner.setAttribute("y",e);}},{key:"r",get:function get(){return this.owner.getAttribute("r");},set:function set(e){this.owner.setAttribute("r",e);}},{key:"width",get:function get(){return this.owner.getAttribute("width");},set:function set(e){this.owner.setAttribute("width",e);}},{key:"height",get:function get(){return this.owner.getAttribute("height");},set:function set(e){this.owner.setAttribute("height",e);}},{key:"points",get:function get(){return this.owner.getAttribute("points");},set:function set(e){this.owner.setAttribute("points",e);}},{key:"selectable",get:function get(){return this.owner.getAttribute("selectable");},set:function set(e){this.owner.setAttribute("selectable",e);}},{key:"origin",get:function get(){return this.owner.getAttribute("origin");},set:function set(e){this.owner.setAttribute("origin",e);}},{key:"anchor",get:function get(){return this.owner.getAttribute("anchor");},set:function set(e){this.owner.setAttribute("anchor",e);}},{key:"visibility",get:function get(){return this.owner.getAttribute("visibility");},set:function set(e){this.owner.setAttribute("visibility",e);}},{key:"zIndex",get:function get(){return this.owner.getAttribute("zIndex");},set:function set(e){this.owner.setAttribute("zIndex",e);}},{key:"transformOrigin",get:function get(){return this.owner.getAttribute("transformOrigin");},set:function set(e){this.owner.setAttribute("transformOrigin",e);}},{key:"borderWidth",get:function get(){return this.owner.getAttribute("borderWidth");},set:function set(e){this.owner.setAttribute("borderWidth",e);}},{key:"borderColor",get:function get(){return this.owner.getAttribute("borderColor");},set:function set(e){this.owner.setAttribute("borderColor",e);}},{key:"opacity",get:function get(){return this.owner.getAttribute("opacity");},set:function set(e){this.owner.setAttribute("opacity",e);}},{key:"fillOpacity",get:function get(){return this.owner.getAttribute("fillOpacity");},set:function set(e){this.owner.setAttribute("fillOpacity",e);}},{key:"borderOpacity",get:function get(){return this.owner.getAttribute("borderOpacity");},set:function set(e){this.owner.setAttribute("borderOpacity",e);}},{key:"background",get:function get(){return this.owner.getAttribute("background");},set:function set(e){this.owner.setAttribute("background",e);}},{key:"clipPath",get:function get(){return this.owner.getAttribute("clipPath");},set:function set(e){this.owner.setAttribute("clipPath",e);}},{key:"cursor",get:function get(){return this.owner.getAttribute("cursor");},set:function set(e){this.owner.setAttribute("cursor",e);}},{key:"hitArea",get:function get(){return this.owner.getAttribute("hitArea");},set:function set(e){this.owner.setAttribute("hitArea",e);}},{key:"pointerEvents",get:function get(){return this.owner.getAttribute("pointerEvents");},set:function set(e){this.owner.setAttribute("pointerEvents",e);}},{key:"miterLimit",get:function get(){return this.owner.getAttribute("miterLimit");},set:function set(e){this.owner.setAttribute("miterLimit",e);}},{key:"lineCap",get:function get(){return this.owner.getAttribute("lineCap");},set:function set(e){this.owner.setAttribute("lineCap",e);}},{key:"lineJoin",get:function get(){return this.owner.getAttribute("lineJoin");},set:function set(e){this.owner.setAttribute("lineJoin",e);}},{key:"lineDash",get:function get(){return this.owner.getAttribute("lineDash");},set:function set(e){this.owner.setAttribute("lineDash",e);}},{key:"lineDashOffset",get:function get(){return this.owner.getAttribute("lineDashOffset");},set:function set(e){this.owner.setAttribute("lineDashOffset",e);}},{key:"shadow",get:function get(){return this.owner.getAttribute("shadow");},set:function set(e){this.owner.setAttribute("shadow",e);}},{key:"shadowOffsetX",get:function get(){return this.owner.getAttribute("shadowOffsetX");},set:function set(e){this.owner.setAttribute("shadowOffsetX",e);}},{key:"shadowOffsetY",get:function get(){return this.owner.getAttribute("shadowOffsetY");},set:function set(e){this.owner.setAttribute("shadowOffsetY",e);}},{key:"shadowBlur",get:function get(){return this.owner.getAttribute("shadowBlur");},set:function set(e){this.owner.setAttribute("shadowBlur",e);}},{key:"shadowColor",get:function get(){return this.owner.getAttribute("shadowColor");},set:function set(e){this.owner.setAttribute("shadowColor",e);}},{key:"startAngle",get:function get(){return this.owner.getAttribute("startAngle");},set:function set(e){this.owner.setAttribute("startAngle",e);}},{key:"endAngle",get:function get(){return this.owner.getAttribute("endAngle");},set:function set(e){this.owner.setAttribute("endAngle",e);}},{key:"rx",get:function get(){return this.owner.getAttribute("rx");},set:function set(e){this.owner.setAttribute("rx",e);}},{key:"ry",get:function get(){return this.owner.getAttribute("ry");},set:function set(e){this.owner.setAttribute("ry",e);}},{key:"img",get:function get(){return this.owner.getAttribute("img");},set:function set(e){this.owner.setAttribute("img",e);}},{key:"src",get:function get(){return this.owner.getAttribute("src");},set:function set(e){this.owner.setAttribute("src",e);}},{key:"x1",get:function get(){return this.owner.getAttribute("x1");},set:function set(e){this.owner.setAttribute("x1",e);}},{key:"y1",get:function get(){return this.owner.getAttribute("y1");},set:function set(e){this.owner.setAttribute("y1",e);}},{key:"x2",get:function get(){return this.owner.getAttribute("x2");},set:function set(e){this.owner.setAttribute("x2",e);}},{key:"y2",get:function get(){return this.owner.getAttribute("y2");},set:function set(e){this.owner.setAttribute("y2",e);}},{key:"text",get:function get(){return this.owner.getAttribute("text");},set:function set(e){this.owner.setAttribute("text",e);}},{key:"wordWarp",get:function get(){return this.owner.getAttribute("wordWarp");},set:function set(e){this.owner.setAttribute("wordWarp",e);}},{key:"wordBreak",get:function get(){return this.owner.getAttribute("wordBreak");},set:function set(e){this.owner.setAttribute("wordBreak",e);}},{key:"underline",get:function get(){return this.owner.getAttribute("underline");},set:function set(e){this.owner.setAttribute("underline",e);}},{key:"strikeout",get:function get(){return this.owner.getAttribute("strikeout");},set:function set(e){this.owner.setAttribute("strikeout",e);}},{key:"textMaxWidth",get:function get(){return this.owner.getAttribute("textMaxWidth");},set:function set(e){this.owner.setAttribute("textMaxWidth",e);}},{key:"letterSpacing",get:function get(){return this.owner.getAttribute("letterSpacing");},set:function set(e){this.owner.setAttribute("letterSpacing",e);}},{key:"textAlign",get:function get(){return this.owner.getAttribute("textAlign");},set:function set(e){this.owner.setAttribute("textAlign",e);}},{key:"textBaseLine",get:function get(){return this.owner.getAttribute("textBaseLine");},set:function set(e){this.owner.setAttribute("textBaseLine",e);}},{key:"textTransform",get:function get(){return this.owner.getAttribute("textTransform");},set:function set(e){this.owner.setAttribute("textTransform",e);}},{key:"color",get:function get(){return this.owner.getAttribute("color");},set:function set(e){this.owner.setAttribute("color",e);}},{key:"fontStyle",get:function get(){return this.owner.getAttribute("fontStyle");},set:function set(e){this.owner.setAttribute("fontStyle",e);}},{key:"fontVariant",get:function get(){return this.owner.getAttribute("fontVariant");},set:function set(e){this.owner.setAttribute("fontVariant",e);}},{key:"fontWeight",get:function get(){return this.owner.getAttribute("fontWeight");},set:function set(e){this.owner.setAttribute("fontWeight",e);}},{key:"fontSize",get:function get(){return this.owner.getAttribute("fontSize");},set:function set(e){this.owner.setAttribute("fontSize",e);}},{key:"lineHeight",get:function get(){return this.owner.getAttribute("lineHeight");},set:function set(e){this.owner.setAttribute("lineHeight",e);}},{key:"fontFamily",get:function get(){return this.owner.getAttribute("fontFamily");},set:function set(e){this.owner.setAttribute("fontFamily",e);}},{key:"startPoint",get:function get(){return this.owner.getAttribute("startPoint");},set:function set(e){this.owner.setAttribute("startPoint",e);}},{key:"endPoint",get:function get(){return this.owner.getAttribute("endPoint");},set:function set(e){this.owner.setAttribute("endPoint",e);}},{key:"lineEnding",get:function get(){return this.owner.getAttribute("lineEnding");},set:function set(e){this.owner.setAttribute("lineEnding",e);}},{key:"stampPoints",get:function get(){return this.owner.getAttribute("stampPoints");},set:function set(e){this.owner.setAttribute("stampPoints",e);}}]);}(),vW={},gW={},mW=function(e){function t(e){var i;return Xk(this,t),Wk(yb(i=cL(this,t)),"shapeType",void 0),Wk(yb(i),"config",void 0),Wk(yb(i),"path",void 0),Wk(yb(i),"steps",void 0),Wk(yb(i),"externalMatrixes",[]),Wk(yb(i),"clippable",!1),Wk(yb(i),"imageData",null),i.config=e,i.id=e.id||e.uid||"",i.name=e.name||"",i.index=e.index,i.nodeName=e.type||"container",i.pageUid=e.pageUid||"",(e.className||e.class)&&(i.className=e.className||e.class),i.style=new fW(yb(i)),i.initAttributes(e),i;}return _b(t,e),Yk(t,[{key:"isVisible",get:function get(){return"visible"===this.parsedStyle.visibility;}},{key:"isInteractive",get:function get(){return"none"!==this.parsedStyle.pointerEvents;}},{key:"width",get:function get(){return this.parsedStyle.width.value*Math.abs(this.getScale().x);}},{key:"height",get:function get(){return this.parsedStyle.height.value*Math.abs(this.getScale().y);}},{key:"initAttributes",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var t in e)if(RL(t,e)){if("style"===t)continue;this.attributes[t]=e[t];}for(var i in e.style)RL(i,e.style)&&(this.parseStyleProperty(i,e.style[i]),this.attributes[i]=e.style[i]);this.renderable.toRenderable();}},{key:"setAttribute",value:function value(e,i){if(!CL(i)&&i!==this.attributes[e]){var r=this.attributes[e];hL(t,"setAttribute",this,3)([e,i]),this.config.hasOwnProperty(e)||(this.parseStyleProperty(e,i),this.updateStyleProperty(e,r,i));}}},{key:"parseStyleProperty",value:function value(e,t){var i=vW[e];this.parsedStyle[e]=i?i(t,this,e):t;}},{key:"updateStyleProperty",value:function value(e,t,i){var r=this,n=gW[e];n&&$k(n).call(n,function(n){n(t,i,r,e);});}},{key:"toFront",value:function value(){var e=this.parentNode;if(e){var t,i=Math.max.apply(Math,Kb($E(t=e.children).call(t,function(e){return e.style.zIndex;})));this.style.zIndex=i+1;}return this;}},{key:"toBack",value:function value(){var e=this.parentNode;if(e){var t,i=Math.min.apply(Math,Kb($E(t=e.children).call(t,function(e){return e.style.zIndex;})));this.style.zIndex=i-1;}return this;}},{key:"setOrigin",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return aW.setOrigin(this,e,t),this;}},{key:"getOrigin",value:function value(){return aW.getOrigin(this);}},{key:"setPosition",value:function value(e){return aW.setPosition(this,e),this;}},{key:"setLocalPosition",value:function value(e){var t=VN(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0);return aW.setLocalPosition(this,t),this;}},{key:"getPosition",value:function value(){return aW.getPosition(this);}},{key:"getLocalPosition",value:function value(){return aW.getLocalPosition(this);}},{key:"translate",value:function value(e){var t=VN(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0);return aW.translate(this,t),this;}},{key:"translateLocal",value:function value(e){var t=VN(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0);return aW.translateLocal(this,t),this;}},{key:"scale",value:function value(e,t,i){return this.scaleLocal(e,t,i);}},{key:"scaleLocal",value:function value(e,t,i){return BL(e)&&(e=VN(e,t=t||e,i=i||e)),aW.scaleLocal(this,e),this;}},{key:"setLocalScale",value:function value(e,t,i){return BL(e)&&(e=VN(e,t=t||e,i=i||e)),aW.setLocalScale(this,e),this;}},{key:"getScale",value:function value(){return aW.getScale(this);}},{key:"getLocalScale",value:function value(){return aW.getLocalScale(this);}},{key:"rotate",value:function value(e,t,i){return CL(t)&&CL(i)?aW.rotate(this,0,0,e):aW.rotate(this,e,t,i),this;}},{key:"rotateLocal",value:function value(e,t,i){return CL(t)&&CL(i)?aW.rotateLocal(this,0,0,e):aW.rotateLocal(this,e,t,i),this;}},{key:"setAngle",value:function value(e){return aW.setAngle(this,0,0,e),this;}},{key:"setLocalAngle",value:function value(e){return aW.setLocalAngle(this,0,0,e),this;}},{key:"getAngle",value:function value(){return aW.getAngle(this).z;}},{key:"getLocalAngle",value:function value(){return aW.getLocalAngle(this).z;}},{key:"getLocalTransform",value:function value(){return aW.getLocalTransform(this);}},{key:"getWorldTransform",value:function value(){return aW.getWorldTransform(this);}},{key:"setLocalTransform",value:function value(e){return aW.setLocalTransform(this,e),this;}},{key:"resetLocalTransform",value:function value(){aW.resetLocalTransform(this);}},{key:"getPath",value:function value(){}},{key:"getConfig",value:function value(){}},{key:"getBoundingRect",value:function value(){}},{key:"getBoundingRectObject",value:function value(){}},{key:"updateStyle",value:function value(e){}},{key:"isPointInPath",value:function value(e){}}]);}(dW);function yW(e,t){return{type:e,data:t};}function pW(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=[],r=Gb(e,1)[0];i.push(yW("moveTo",[r]));for(var n=1;n<e.length;n++)r=e[n],i.push(yW("lineTo",[r]));return t&&e.length>2&&(r=Gb(e,1)[0],i.push(yW("lineTo",[r]))),i;}function wW(e,t){var i=t.data,r=t.type,n=Gb(i,3),o=n[0],a=n[1],s=n[2];switch(r){case"moveTo":e.moveTo(o.x,o.y);break;case"lineTo":e.lineTo(o.x,o.y);break;case"bezierCurveTo":e.bezierCurveTo(o.x,o.y,a.x,a.y,s.x,s.y);break;case"quadraticCurveTo":e.quadraticCurveTo(o.x,o.y,a.x,a.y);}}function bW(e){for(var t=Math.min,i=Math.max,r=e[0],n=r.x,o=r.y,a=n,s=o,u=n,l=o,c=1;c<e.length;c++){var h=e[c];a=t(a,h.x),u=i(u,h.x),s=t(s,h.y),l=i(l,h.y);}return{left:a,top:s,right:u,bottom:l,width:u-a,height:l-s};}var kW={opacity:1,fillOpacity:1,borderOpacity:1,lineJoin:"miter",lineCap:"butt",zIndex:0,visibility:"visible",anchor:[0,0],borderColor:"black",miterLimit:10,lineDash:[0,0],lineDashOffset:0};function SW(e){if(e.length<1)return[];for(var t=[],i=[],r=0;r<e.length;r++){var n=e[r];if(0===n.step)r>0&&t.push({step:i,close:e[r-1].close}),(i=[]).push(yW("moveTo",[{x:n.x,y:n.y}]));else if(1===n.step)i.push(yW("lineTo",[{x:n.x,y:n.y}]));else if(2===n.step&&r+2<e.length&&2===e[r+1].step&&2===e[r+2].step){var o=e[r+1],a=e[r+2];i.push(yW("bezierCurveTo",[n,o,a])),r+=2;}}return t.push({step:i,close:e[e.length-1].close}),t;}function xW(e,t,i,r){var n=0,o=0,a=0,s=0,u=[e,t],l=bW(u),c=function(e,t,i,r){var n=r/2,o=r/2,a=t.y-e.y,s=t.x-e.x;if(0===a||0===s)return[s,a];var u=-1/((t.y-e.y)/(t.x-e.x)),l=Math.atan(u);return"square"===i?(n=Math.sqrt(2)*r/2,o=Math.sqrt(2)*r/2):"round"===i?(n=r/2,o=r/2):(n=Math.abs(Math.cos(l)*r)/2,o=Math.abs(Math.sin(l)*r)/2),[n,o];}(u[0],u[1],r,i||0);return 0===c[1]?(n=l.left,o=l.top-i/2,a=l.width,s=l.height+i,"square"!==r&&"round"!==r||(n-=i/2,a+=i)):0===c[0]?(n=l.left-i/2,o=l.top,a=l.width+i,s=l.height,"square"!==r&&"round"!==r||(o-=i/2,s+=i)):(n=l.left-c[0],o=l.top-c[1],a=l.width+2*c[0],s=l.height+2*c[1]),{x:n,y:o,width:a,height:s};}function CW(e){return Math.abs(e)<1e-6?0:e<0?-1:1;}function VW(e,t,i,r){var n=e.x,o=e.y,a=t.x,s=t.y,u=r.x,l=r.y,c=Math.min(n,a),h=Math.max(n,a),d=Math.min(o,s),f=Math.max(o,s),v=i/2;return u>=c-v&&u<=h+v&&l>=d-v&&l<=f+v&&function(e,t,i,r,n,o){var a=[i-e,r-t];if(new CN(a[0],a[1]).equals({x:0,y:0}))return Math.sqrt((n-e)*(n-e)+(o-t)*(o-t));var s=[-a[1],a[0]],u=new CN(s[0],s[1]);u.normalize();var l=[n-e,o-t],c=new CN(l[0],l[1]);return Math.abs(c.dot(u));}(n,o,a,s,u,l)<=i/2;}function TW(e,t,i,r,n){var o=e.length;if(o<2)return!1;for(var a=0;a<o-1;a++)if(VW(e[a],e[a+1],t,{x:i,y:r}))return!0;return!(!n||!VW(e[0],e[o-1],t,{x:i,y:r}));}function IW(e,t,i,r,n,o){return n>=e&&n<=e+i&&o>=t&&o<=t+r;}function EW(e,t,i,r,n,o){var a=o,s=r.x,u=r.y,l=n.x,c=n.y;0===t&&(s=n.x,u=n.y,l=r.x,c=r.y);var h=Math.PI/2,d=l-s>=0?1:-1,f=c-u>=0?1:-1;s!==l&&(h=Math.atan(Math.abs(c-u)/Math.abs(l-s)));var v=Math.cos(h),g=Math.sin(h),m=i?1:-1,y={x:l+9*m*a*v*d-4.5*a*g*d,y:c+9*m*a*g*f+4.5*a*v*f,step:0,close:!1},p={x:l+m*a*v*d,y:c+m*a*g*f,step:1,close:!1},w={x:l+9*m*a*v*d+4.5*a*g*d,y:c+9*m*a*g*f-4.5*a*v*f,step:1,close:!1};e.push(y,p,w);}function PW(e,t,i,r,n,o){var a=o,s=r.x,u=r.y,l=n.x,c=n.y;0===t&&(s=n.x,u=n.y,l=r.x,c=r.y);var h=Math.PI/2,d=l-s>=0?1:-1,f=c-u>=0?1:-1;s!==l&&(h=Math.atan(Math.abs(c-u)/Math.abs(l-s)));var v=Math.cos(h),g=Math.sin(h),m=i?1:-1,y={x:l+9*m*a*v*d-4.5*a*g*d,y:c+9*m*a*g*f+4.5*a*v*f,step:0,close:!1},p={x:l+m*a*v*d,y:c+m*a*g*f,step:1,close:!1},w={x:l+9*m*a*v*d+4.5*a*g*d,y:c+9*m*a*g*f-4.5*a*v*f,step:1,close:!0};e.push(y,p,w);}function BW(e,t,i,r,n){var o=n,a=i.x,s=i.y,u=r.x,l=r.y;0===t&&(a=r.x,s=r.y,u=i.x,l=i.y);var c=Math.PI/2,h=u-a>=0?1:-1,d=l-s>=0?1:-1;a!==u&&(c=Math.atan(Math.abs(l-s)/Math.abs(u-a)));var f=Math.cos(c),v=Math.sin(c),g={x:u-3*o*v*h,y:l+3*o*f*d,step:0,close:!1},m={x:u+3*o*v*h,y:l-3*o*f*d,step:1,close:!1};e.push(g,m);}function DW(e,t,i,r,n){var o=n,a=i.x,s=i.y,u=r.x,l=r.y;0===t&&(a=r.x,s=r.y,u=i.x,l=i.y);var c=Math.PI/2,h=u-a>=0?1:-1,d=l-s>=0?1:-1,f=l>=s&&u>=a||l<=s&&u<=a?-1:1;a!==u&&(c=Math.atan(Math.abs(l-s)/Math.abs(u-a)));var v=Math.cos(c),g=Math.sin(c),m=4.5*Math.sqrt(3)*o,y={x:u+4.5*o*v*h-m*g*h*f,y:l+4.5*o*g*d+m*v*d*f,step:0,close:!1},p={x:u-4.5*o*v*h+m*g*h*f,y:l-4.5*o*g*d-m*v*d*f,step:1,close:!1};e.push(y,p);}function MW(e,t,i,r,n){var o=n,a=r.x,s=r.y;0===t&&(a=i.x,s=i.y);var u={x:a-3*o,y:s,step:0,close:!1},l={x:a,y:s-3*o,step:1,close:!1},c={x:a+3*o,y:s,step:1,close:!1},h={x:a,y:s+3*o,step:1,close:!0};e.push(u,l,c,h);}function zW(e,t,i,r,n){var o=n,a=r.x,s=r.y;0===t&&(a=i.x,s=i.y);var u=3*o-0*o,l=function(e,t,i,r){var n=e-i,o=e+i,a=t-r,s=t+r,u=.551915024494,l=u*i,c=u*r,h=[];return h.push({x:o,y:t}),h.push({x:o,y:t+c},{x:e+l,y:s},{x:e,y:s}),h.push({x:e-l,y:s},{x:n,y:t+c},{x:n,y:t}),h.push({x:n,y:t-c},{x:e-l,y:a},{x:e,y:a}),h.push({x:e+l,y:a},{x:o,y:t-c},{x:o,y:t}),h;}(a,s,u,u);$k(l).call(l,function(t,i){var r=0===i?0:2,n=i===l.length-1,o={x:t.x,y:t.y,step:r,close:n};e.push(o);});}function UW(e,t){if(CL(e)||""===e)return null;var i=FO(e);return"%"===i.unit?.01*t*i.value:i.value;}var AW=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=i.style,n=zf(i,iL);Xk(this,t),Wk(e=cL(this,t,[Fk({type:"rect",style:Fk(Fk({},kW),{},{x:0,y:0,width:0,height:0},r)},n)]),"shapeType","rect");var o=e.parsedStyle,a=o.x,s=o.y;return e.setLocalPosition(a,s),e.updateOrigin(),e;}return _b(t,e),Yk(t,[{key:"updateStyle",value:function value(e){var t,i=this;$k(t=eS(e)).call(t,function(t){RL(t,e)&&(i.style[t]=e[t]);});}},{key:"updateOrigin",value:function value(){var e=this.parsedStyle,t=e.width,i=e.height;this.setOrigin(t.value/2,i.value/2);}},{key:"updatePosition",value:function value(e,t){this.style.x=e,this.style.y=t;}},{key:"getPath",value:function value(){var e=this.parsedStyle,t=e.width,i=e.height,r=e.borderWidth,n=.5*((null==r?void 0:r.value)||0),o=0,a=0;o+=n,a+=n;var s=t.value-2*n,u=i.value-2*n;return this.path=[{x:o,y:a},{x:o+s,y:a},{x:o+s,y:a+u},{x:o,y:a+u}],this.steps=pW(this.path),this.path;}},{key:"getBoundingRect",value:function value(){var e=this.parsedStyle,t=e.x,i=e.y,r=e.width,n=e.height;return e.borderWidth,{x:t,y:i,width:r.value,height:n.value};}},{key:"getBoundingRectObject",value:function value(){var e=this.getBoundingRect();return new t({style:{x:e.x,y:e.y,width:e.width,height:e.height,borderWidth:1,background:"rgba(0,0,0,0)"}});}},{key:"isPointInPath",value:function value(e){var t=this.parsedStyle,i=t.x,r=t.y,n=t.background,o=t.borderWidth,a=t.width,s=t.height,u=o&&o.value,l=((null==o?void 0:o.value)||0)/2;return n&&u?IW(i-l,r-l,a.value+l,s.value+l,e.x,e.y):n?IW(i,r,a.value,s.value,e.x,e.y):!!u&&function(e,t,i,r,n,o,a){var s=n/2;return IW(e-s,t-s,i,n,o,a)||IW(e+i-s,t-s,n,r,o,a)||IW(e+s,t+r-s,i,n,o,a)||IW(e-s,t+s,n,r,o,a);}(i-l,r-l,a.value,s.value,o.value,e.x,e.y);}}]);}(mW);function RW(e,t,i,r,n){for(var o=n||[],a=e[t],s=e[i-1],u=0,l=1,c=t+1;c<i-1;c++){var h=XN(YN(a,s,e[c]),e[c]);h>u&&(u=h,l=c);}return u>=r?(RW(e,t,l,r,o),RW(e,l,i,r,o)):(o.length||o.push(a),o.push(s)),o;}var LW=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=i.style,n=zf(i,rL);Xk(this,t),Wk(yb(e=cL(this,t,[Fk({type:"image",style:Fk(Fk({},kW),{},{x:0,y:0,width:0,height:0,img:""},r)},n)])),"shapeType","image"),Wk(yb(e),"meteData",void 0),e.meteData=(null==n?void 0:n.meteData)||null;var o=e.parsedStyle,a=o.x,s=o.y;return e.setLocalPosition(a,s),e.updateOrigin(),e;}return _b(t,e),Yk(t,[{key:"updateStyle",value:function value(e){var t,i=this;$k(t=eS(e)).call(t,function(t){RL(t,e)&&(i.style[t]=e[t]);});}},{key:"updateOrigin",value:function value(){var e=this.parsedStyle,t=e.width,i=e.height;this.setOrigin(t.value/2,i.value/2);}},{key:"updatePosition",value:function value(e,t){this.style.x=e,this.style.y=t;}},{key:"getBoundingRect",value:function value(){var e=this.parsedStyle,t=e.x,i=e.y,r=e.width,n=e.height;return{x:t,y:i,width:r.value,height:n.value};}},{key:"getBoundingRectObject",value:function value(){var e=this.getBoundingRect(),t=e.x,i=e.y,r=e.width,n=e.height;return new AW({style:{x:t,y:i,width:r,height:n,borderWidth:1,background:"rgba(0,0,0,0)"}});}},{key:"isPointInPath",value:function value(e){return this.getBoundingRectObject().isPointInPath(e);}}]);}(mW),NW=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=i.style,n=zf(i,nL);Xk(this,t),Wk(e=cL(this,t,[Fk({type:"line",style:Fk(Fk({},kW),{},{x1:0,y1:0,x2:0,y2:0,borderWidth:2},r)},n)]),"shapeType","line"),Wk(e,"renderPath",void 0);var o=e.getBoundingRect(),a=o.x,s=o.y;return e.updatePosition(a,s),e.updateOrigin(),e;}return _b(t,e),Yk(t,[{key:"updateOrigin",value:function value(){var e=this.getBoundingRect(),t=e.width,i=e.height;this.setOrigin(t/2,i/2);}},{key:"updatePoints",value:function value(){var e=this.renderPath,t=this.getLocalPosition(),i=[];$k(e).call(e,function(e){i.push({x:e.x+t.x,y:e.y+t.y});}),this.updateStyle({x1:i[0].x||0,y1:i[0].y||0,x2:i[1].x||0,y2:i[1].y||0});}},{key:"updateStyle",value:function value(e){var t,i=this;$k(t=eS(e)).call(t,function(t){RL(t,e)&&(i.style[t]=e[t]);});}},{key:"updatePosition",value:function value(e,t){this.style.x=e,this.style.y=t;}},{key:"getPath",value:function value(){var e=this.renderable,t=this.parsedStyle,i=t.x1,r=t.x2,n=t.y1,o=t.y2,a=this.getBoundingRect(),s=a.x,u=a.y;return this.path&&!e.isRenderable()||(this.renderPath=[{x:i-s,y:n-u},{x:r-s,y:o-u}],this.path=[{x:i,y:n},{x:r,y:o}],this.steps=pW(this.renderPath,!1),e.toRenderable()),this.path;}},{key:"getBoundingRect",value:function value(){var e=this.parsedStyle,t=e.x1,i=e.x2,r=e.y1,n=e.y2,o=e.borderWidth,a=e.lineCap;return xW({x:t,y:r},{x:i,y:n},o.value,a);}},{key:"getBoundingRectObject",value:function value(){var e=this.getBoundingRect(),t=e.x,i=e.y,r=e.width,n=e.height;return new AW({style:{x:t,y:i,width:r,height:n,borderWidth:1,background:"rgba(0,0,0,0)"}});}},{key:"isPointInPath",value:function value(e){if(!this.getBoundingRectObject().isPointInPath(e))return!1;var t=this.parsedStyle,i=t.x1,r=t.x2,n=t.y1,o=t.y2,a=t.borderWidth;return VW({x:i,y:n},{x:r,y:o},a.value<20?10:a.value/2,e);}}]);}(mW),OW=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=i.style,n=zf(i,oL);return Xk(this,t),Wk(yb(e=cL(this,t,[Fk({type:"path",style:Fk(Fk({},kW),{},{points:[],lineJoin:"miter",lineCap:"butt",borderWidth:2,miterLimit:4},r)},n)])),"shapeType","path"),Wk(yb(e),"renderPath",void 0),Wk(yb(e),"pointArray",[]),Wk(yb(e),"pointLength",0),Wk(yb(e),"initialRect",void 0),e.getPath(),e.initialRect=e.getBoundingRect(),e.updatePosition(e.initialRect.x,e.initialRect.y),e.setOrigin(e.initialRect.width,e.initialRect.height),e;}return _b(t,e),Yk(t,[{key:"addPoint",value:function value(e){var t=Kb(this.style.points);t.push(e),this.style.points=t;}},{key:"updateStyle",value:function value(e){var t,i=this;$k(t=eS(e)).call(t,function(t){RL(t,e)&&(i.style[t]=e[t]);});}},{key:"updateOrigin",value:function value(){var e=this.getBoundingRect(),t=e.width,i=e.height;this.setOrigin(t/2,i/2);}},{key:"updatePosition",value:function value(e,t){this.style.x=e,this.style.y=t;}},{key:"getPath",value:function value(){var e,t,i=$E(e=this.parsedStyle.points).call(e,function(e){return new IN(e.x,e.y);});return i=lS(t=this.pointArray).call(t,RW(i,this.pointLength,i.length,2)),this.parsedStyle.points.length-this.pointLength==30&&(this.pointArray=_SL(i),this.pointLength=this.parsedStyle.points.length),i.length<=3&&i.push(i[i.length-1].clone()),i=function(e){var t=e.length;if(t<3)return e;var i=[];if(3===t)i.push(e[0].clone(),e[1].clone(),e[2].clone(),e[2].clone());else{var r=RI(e).call(e);i.push(r[0]);for(var n=0;n+2<r.length;n++){var o=r[n+1],a=r[n+2],s=o,u=new IN(((null==o?void 0:o.x)+(null==a?void 0:a.x))/2,((null==o?void 0:o.y)+(null==a?void 0:a.y))/2);i.push(s),n+3===r.length?i.push(a):i.push(u);}}return i;}(i),this.path=i,this.renderPath=this.getRenderPath(this.path),this.steps=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e.length;if(i<=1)return[];var r=[],n=Gb(e,1)[0];r.push(yW("moveTo",[n]));for(var o=0;o+2<i;o+=2){var a=e[o+1],s=e[o+2];r.push(yW("quadraticCurveTo",[a,s]));}return t&&e.length>2&&r.push(yW("lineTo",[n])),r;}(this.renderPath),this.path;}},{key:"getRenderPath",value:function value(e){var t=this.getBoundingRect(),i=t.x,r=t.y,n=[];return $k(e).call(e,function(e){!e||fS(e.x)||fS(e.y)||n.push({x:e.x-i,y:e.y-r});}),n;}},{key:"getBoundingRect",value:function value(){var e=this.parsedStyle,t=e.borderWidth,i=e.points,r=e.lineCap,n=$E(i).call(i,function(e){return new IN(e.x,e.y);}),o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=e.length;if(i<3)return e;var r=[];if(3===i)r.push(e[0].clone(),e[1].clone(),e[2].clone(),e[2].clone());else{var n=RI(e).call(e);n.unshift(e[0]),n.push(e[e.length-1]);var o=[],a=1-t;r.push(_SL(n[0]));for(var s=1;s+2<n.length;s++){var u=n[s],l=n[s-1],c=n[s+1],h=n[s+2];o[0]=_SL(u),o[1]=new IN(u.x+a*(c.x-l.x)/8,u.y+a*(c.y-l.y)/8),o[2]=new IN(c.x-a*(h.x-u.x)/8,c.y-a*(h.y-u.y)/8),o[3]=_SL(c),r.push(o[1],o[2],o[3]);}}return r;}(RW(n,0,n.length,1)),a=bW(o);if(2===i.length)return xW(i[0],i[1],t.value,r);var s=t.value/2;return{x:a.left-s,y:a.top-s,width:a.width+2*s,height:a.height+2*s};}},{key:"getBoundingRectObject",value:function value(){var e=this.getBoundingRect(),t=e.x,i=e.y,r=e.width,n=e.height;return new AW({style:{x:t,y:i,width:r,height:n,borderWidth:1,background:"rgba(0,0,0,0)"}});}},{key:"isPointInPath",value:function value(e){if(!this.getBoundingRectObject().isPointInPath(e))return!1;var t=this.parsedStyle.borderWidth,i=t.value<20?10:t.value/2;return function(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=0;r<t.length;r++)if(XN(e,t[r])<=i)return!0;return!1;}(e,this.style.points,i);}}]);}(mW),WW=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=i.style,n=zf(i,aL);Xk(this,t),Wk(yb(e=cL(this,t,[Fk({type:"polygon",style:Fk(Fk({},kW),{},{points:[{x:0,y:0},{x:10,y:10}],miterLimit:4,borderWidth:2},r)},n)])),"shapeType","polygon"),Wk(yb(e),"renderPath",void 0),0===e.parsedStyle.points.length&&(e.style.points=[{x:0,y:0},{x:10,y:10}]);var o=e.getBoundingRect(),a=o.x,s=o.y,u=o.width,l=o.height;return e.updatePosition(a,s),e.setOrigin(u/2,l/2),e;}return _b(t,e),Yk(t,[{key:"addPoint",value:function value(e){var t=Kb(this.style.points);t.push(e),this.style.points=t;}},{key:"updatePoints",value:function value(){var e=this.renderPath,t=this.getLocalPosition(),i=[];$k(e).call(e,function(e){i.push({x:e.x+t.x,y:e.y+t.y});}),this.style.points=i;}},{key:"updateStyle",value:function value(e){var t,i=this;$k(t=eS(e)).call(t,function(t){RL(t,e)&&(i.style[t]=e[t]);});}},{key:"updateOrigin",value:function value(){var e=this.getBoundingRect(),t=e.width,i=e.height;this.setOrigin(t/2,i/2);}},{key:"updatePosition",value:function value(e,t){this.style.x=e,this.style.y=t;}},{key:"getPath",value:function value(){var e,t=this.getBoundingRect(),i=t.x,r=t.y;return this.path=this.parsedStyle.points,this.renderPath=$E(e=this.parsedStyle.points).call(e,function(e){return{x:e.x-i,y:e.y-r};}),this.steps=pW(this.renderPath,!0),this.path;}},{key:"getBoundingRect",value:function value(){var e=this.parsedStyle,t=e.borderWidth,i=e.points,r=e.lineCap;if(2===i.length)return xW(i[0],i[1],t.value,r);var n=bW(i),o=t.value/2||0;return{x:n.left-o,y:n.top-o,width:n.width+2*o,height:n.height+2*o};}},{key:"getBoundingRectObject",value:function value(){var e=this.getBoundingRect(),t=e.x,i=e.y,r=e.width,n=e.height;return new AW({style:{x:t,y:i,width:r,height:n,borderWidth:1,background:"rgba(0,0,0,0)"}});}},{key:"isPointInPath",value:function value(e){if(!this.getBoundingRectObject().isPointInPath(e))return!1;var t=this.parsedStyle,i=t.borderWidth,r=t.background,n=t.points,o=i&&i.value,a=i.value<20?10:i.value/2,s=!1;return o&&(s=TW(n,a,e.x,e.y,!0)),!s&&r&&(s=function(e,t,i){var r=!1,n=e.length;if(n<=2)return!1;for(var o=0;o<n;o++){var a=e[o],s=e[(o+1)%n];if(qN(a,s,{x:t,y:i}))return!0;CW(a.y-i)>0!=CW(s.y-i)>0&&CW(t-(i-a.y)*(a.x-s.x)/(a.y-s.y)-a.x)<0&&(r=!r);}return r;}(n,e.x,e.y)),s;}}]);}(mW),HW=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=i.style,n=zf(i,sL);Xk(this,t),Wk(yb(e=cL(this,t,[Fk({type:"polyline",style:Fk(Fk({},kW),{},{points:[{x:0,y:0},{x:0,y:0}],lineEnding:null,borderWidth:2,miterLimit:4},r)},n)])),"shapeType","polyline"),Wk(yb(e),"renderPath",void 0),e.getPath();var o=e.getBoundingRect(),a=o.x,s=o.y;return e.updatePosition(a,s),e.updateOrigin(),e;}return _b(t,e),Yk(t,[{key:"initPath",value:function value(){var e=this.parsedStyle,t=e.points,i=e.lineEnding;t.length;var r=[];if($k(t).call(t,function(e,t){0===t?r.push({x:e.x,y:e.y,step:0,close:!1}):r.push({x:e.x,y:e.y,step:1,close:!1});}),i)for(var n=0;n<i.length;n++)switch(i[n]){case"OpenArrow":this.addOpenArrow(r,n,!1);break;case"ROpenArrow":this.addOpenArrow(r,n,!0);break;case"ClosedArrow":this.addCloseArrow(r,n,!1);break;case"RClosedArrow":this.addCloseArrow(r,n,!0);break;case"Butt":this.addButt(r,n);break;case"Slash":this.addSlash(r,n);break;case"Square":this.addSquare(r,n);break;case"Diamond":this.addDiamond(r,n);break;case"Circle":this.addCircle(r,n);}return r;}},{key:"getRenderPath",value:function value(e){var t=this.getBoundingRect(),i=t.x,r=t.y,n=[];return $k(e).call(e,function(e){!e||fS(e.x)||fS(e.y)||n.push({x:e.x-i,y:e.y-r,step:e.step,close:e.close});}),n;}},{key:"addPoint",value:function value(e){var t=Kb(this.style.points);t.push(e),this.style.points=t;}},{key:"updatePoints",value:function value(){var e,t,i=this.parsedStyle.points.length,r=this.getLocalPosition(),n=[];$k(e=RI(t=this.renderPath).call(t,0,i)).call(e,function(e){n.push({x:e.x+r.x,y:e.y+r.y});}),this.style.points=n;}},{key:"updateStyle",value:function value(e){var t,i=this;$k(t=eS(e)).call(t,function(t){RL(t,e)&&(i.style[t]=e[t]);});}},{key:"updateOrigin",value:function value(){var e=this.getBoundingRect(),t=e.width,i=e.height;this.setOrigin(t/2,i/2);}},{key:"updatePosition",value:function value(e,t){this.style.x=e,this.style.y=t;}},{key:"updatePoint",value:function value(){for(var e=this.getLocalPosition(),t=this.parsedStyle.points.length,i=[],r=0;r<t;r++)i.push({x:this.renderPath[r].x+e.x,y:this.renderPath[r].y+e.y});this.updateStyle({points:i});}},{key:"getPath",value:function value(){this.path=this.initPath(),this.renderPath=this.getRenderPath(this.path),this.steps=SW(this.renderPath);}},{key:"getBoundingRect",value:function value(){var e=this.parsedStyle,t=e.borderWidth,i=e.lineCap;if(2===this.path.length)return xW(this.path[0],this.path[1],t.value,i);var r=bW(this.path),n=t.value/2;return{x:r.left-n,y:r.top-n,width:r.width+2*n,height:r.height+2*n};}},{key:"getBoundingRectObject",value:function value(){var e=this.getBoundingRect(),t=e.x,i=e.y,r=e.width,n=e.height;return new AW({style:{x:t,y:i,width:r,height:n,borderWidth:1,background:"rgba(0,0,0,0)"}});}},{key:"isPointInPath",value:function value(e){if(!this.getBoundingRectObject().isPointInPath(e))return!1;var t=this.parsedStyle,i=t.borderWidth;return TW(t.points,i.value<20?10:i.value/2,e.x,e.y,!1);}},{key:"isLineArrow",value:function value(){var e=this.parsedStyle.lineEnding;return!!e&&("None"!==e[0]||"None"!==e[1]);}},{key:"addOpenArrow",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.parsedStyle,n=r.points,o=r.borderWidth,a=n.length,s=n[a-2],u=n[a-1];0===t&&(s=Fk({},n[1]),u=Fk({},n[0])),EW(e,t,i,s,u,o.value);}},{key:"addCloseArrow",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.parsedStyle,n=r.points,o=r.borderWidth,a=n.length,s=n[a-2],u=n[a-1];0===t&&(s=Fk({},n[1]),u=Fk({},n[0])),PW(e,t,i,s,u,o.value);}},{key:"addCircle",value:function value(e,t){var i=this.parsedStyle,r=i.points,n=i.borderWidth,o=r.length;zW(e,t,r[0],r[o-1],n.value);}},{key:"addDiamond",value:function value(e,t){var i=this.parsedStyle,r=i.points,n=i.borderWidth,o=r.length;MW(e,t,r[0],r[o-1],n.value);}},{key:"addSquare",value:function value(e,t){var i=this.parsedStyle,r=i.points,n=i.borderWidth,o=r.length;DW(e,t,r[0],r[o-1],n.value);}},{key:"addSlash",value:function value(e,t){var i=this.parsedStyle,r=i.points,n=i.borderWidth,o=r.length,a=r[o-2],s=r[o-1];0===t&&(a=Fk({},r[1]),s=Fk({},r[0])),DW(e,t,a,s,n.value);}},{key:"addButt",value:function value(e,t){var i=this.parsedStyle,r=i.points,n=i.borderWidth,o=r.length,a=r[o-2],s=r[o-1];0===t&&(a=Fk({},r[1]),s=Fk({},r[0])),BW(e,t,a,s,n.value);}}]);}(mW),FW=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=i.style,n=zf(i,uL);Xk(this,t),Wk(e=cL(this,t,[Fk({type:"text",style:Fk(Fk({},kW),{},{x:0,y:0,text:"",width:300,wordWarp:!0,wordBreak:!0,underline:!1,strikeout:!1,textAlign:"left",textBaseLine:"top",textTransform:"none",letterSpacing:0,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",fontFamily:"Microsoft YaHei",color:"white",fontSize:12,lineHeight:12},r)},n)]),"shapeType","text"),Wk(e,"lines",[]),Wk(e,"chars",[]),Wk(e,"totalHeight",void 0),Wk(e,"textX",void 0),Wk(e,"textY",void 0),Wk(e,"rowWidth",void 0),Wk(e,"realWidth",void 0),Wk(e,"cacheWidth",void 0),Wk(e,"font",void 0);var o=e.parsedStyle,a=o.x,s=o.y;return e.setFont(),e.calculateTextPosition(),e.lineWrap(),e.saveCharPosition(),e.setLocalPosition(a,s),e.updateOrigin(),e;}return _b(t,e),Yk(t,[{key:"setFont",value:function value(){var e,t,i,r,n,o=this.parsedStyle,a=o.fontStyle,s=o.fontVariant,u=o.fontWeight,l=o.fontFamily,c=o.fontSize;this.font=lS(e=lS(t=lS(i=lS(r=lS(n="".concat(a," ")).call(n,s," ")).call(r,u," ")).call(i,c.value)).call(t,c.unit," ")).call(e,l);}},{key:"updateStyle",value:function value(e){var t,i=this;$k(t=eS(e)).call(t,function(t){RL(t,e)&&(i.style[t]=e[t]);});}},{key:"updateOrigin",value:function value(){if(this.chars[0]){var e=this.getBoundingRect(),t=e.width,i=e.height,r=this.chars[0].height/10||0,n=this.chars[0].height/2||0,o=0;switch(this.parsedStyle.textBaseLine){case"top":o=i/2-r;break;case"hanging":o=i/2;break;case"middle":o=-r+n*(this.lines.length-1);break;case"ideographic":o=1.5*-r+n*(this.lines.length-2);break;case"bottom":o=-r+n*(this.lines.length-2);break;default:o=r+n*(this.lines.length-2);}this.setOrigin(t/2-r,o);}}},{key:"updatePosition",value:function value(e,t){this.style.x=e,this.style.y=t;}},{key:"calculateTextPosition",value:function value(){var e=this.parsedStyle,t=e.x,i=e.y,r=e.width,n=e.letterSpacing,o=e.borderWidth,a=((null==o?void 0:o.value)||0)/2;this.textX=t+a+n.value,this.textY=i+a+n.value,this.rowWidth=r.value-2*a-2*n.value;}},{key:"lineWrap",value:function value(){this.totalHeight=0,this.realWidth=0;var e=this.textX,t=this.rowWidth,i=this.parsedStyle,r=i.lineHeight,n=i.wordWarp,o=i.fontSize,a=i.borderWidth,s=document.createElement("canvas").getContext("2d"),u=0;s.font=this.font;var l=o.value>r?o.value:r,c=this.transformText(this.parsedStyle.text);if(c.length||(this.lines=[],this.totalHeight=0),c.length){for(var h=[],d=this.textY,f="",v=0;v<c.length;v++){var g=c.charAt(v);if("\n"!==g&&"\r"!==g){if(f+=g,s.measureText(f).width>=t&&n){if(""===(f=f.substring(0,f.length-1))){f=g;continue;}u+=f.length;var m=s.measureText(f).width;m>this.realWidth&&(this.realWidth=s.measureText(f).width),h.push({text:f,x:e,y:d,lineWidth:m,length:f.length,sum:u}),f=g,d+=l,this.totalHeight+=l;}}else{var y=s.measureText(f).width;y>this.realWidth&&(this.realWidth=s.measureText(f).width),u+=(f+=g).length,h.push({text:f,x:e,y:d,lineWidth:y,length:f.length,sum:u}),f="",d+=l,this.totalHeight+=l;}}if(""!==f){u+=f.length;var p=s.measureText(f).width;p>this.realWidth&&(this.realWidth=s.measureText(f).width),h.push({text:f,x:e,y:d,lineWidth:p,length:f.length,sum:u});}this.totalHeight+=l,this.lines=h;}1===this.lines.length&&(this.realWidth=s.measureText(this.lines[0].text).width),a&&a.value&&(this.realWidth+=a.value);}},{key:"getBoundingRect",value:function value(){var e=this.parsedStyle,t=e.x,i=e.y,r=e.textBaseLine,n=e.fontSize,o=e.lineHeight,a=n.value>o?n.value:o,s=a/10;return{x:t-s,y:jW(r,i,a)-s,width:this.realWidth+2*s,height:this.totalHeight};}},{key:"getBoundingRectObject",value:function value(){var e=this.getBoundingRect(),t=e.x,i=e.y,r=e.width,n=e.height;return new AW({style:{x:t,y:i,width:r,height:n,borderWidth:1,background:"rgba(0,0,0,0)"}});}},{key:"isPointInPath",value:function value(e){return this.getBoundingRectObject().isPointInPath(e);}},{key:"saveCharPosition",value:function value(){var e=this;this.chars=[];var t=this.lines,i=this.parsedStyle,r=i.fontSize,n=i.textBaseLine,o=document.createElement("canvas").getContext("2d"),a=r.value;o.font=this.font;var s=0;$k(t).call(t,function(t,i){for(var r=t.x,u=0;u<t.text.length;u++){var l=t.text.charAt(u),c=o.measureText(l).width;"\n"!==l&&"\r"!==l||(c=.1),e.chars.push({char:l,index:s+u+1,charIndex:u+1,lineIndex:i,x:r,y:jW(n,t.y,a),width:c,height:a}),r+=1*o.measureText(l).width,u===t.text.length-1&&(s+=t.text.length);}});}},{key:"getCharByPosition",value:function value(e,t){for(var i={x:e,y:t},r=0;r<this.chars.length;r++)if(this.getCharBounding(r).isPointInPath(i))return this.chars[r];return!1;}},{key:"getCharBounding",value:function value(e){var t=this.chars[e],i=t.x,r=t.y,n=t.width,o=t.height;return new AW({style:{x:i,y:r-o/10,width:n,height:o,borderWidth:1,background:"rgba(0,0,0,0)"}});}},{key:"transformText",value:function value(e){var t=this.parsedStyle.textTransform;return"capitalize"===t?e=e[0].toUpperCase()+e.substring(1):"lowercase"===t?e.toLowerCase():"uppercase"===t?e.toUpperCase():e;}}]);}(mW);function jW(e,t,i){var r,n=i/10;switch(e){case"top":r=t-.5*n;break;case"hanging":r=t+.5*n;break;case"middle":r=t-i/2-.5*n;break;case"ideographic":r=t-i-.5*n;break;case"bottom":r=t-i;break;default:r=t+2*n-i;}return r;}var YW=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=i.style,n=zf(i,lL);Xk(this,t),Wk(yb(e=cL(this,t,[Fk({type:"freeline",style:Fk(Fk({},kW),{},{startPoint:{x:0,y:0},endPoint:{x:0,y:0},lineEnding:null,borderWidth:2},r)},n)])),"shapeType","freeline"),Wk(yb(e),"renderPath",void 0),e.getPath();var o=e.getBoundingRect(),a=o.x,s=o.y;return e.updatePosition(a,s),e.updateOrigin(),e;}return _b(t,e),Yk(t,[{key:"initPath",value:function value(){var e=this.parsedStyle,t=e.startPoint,i=e.endPoint,r=e.lineEnding,n=[Fk(Fk({},t),{},{step:0,close:!1}),Fk(Fk({},i),{},{step:1,close:!0})];if(r)for(var o=0;o<r.length;o++)switch(r[o]){case"OpenArrow":this.addOpenArrow(n,o,!1);break;case"ROpenArrow":this.addOpenArrow(n,o,!0);break;case"ClosedArrow":this.addCloseArrow(n,o,!1);break;case"RClosedArrow":this.addCloseArrow(n,o,!0);break;case"Butt":this.addButt(n,o);break;case"Slash":this.addSlash(n,o);break;case"Square":this.addSquare(n,o);break;case"Diamond":this.addDiamond(n,o);break;case"Circle":this.addCircle(n,o);}return n;}},{key:"getRenderPath",value:function value(e){var t=this.getBoundingRect(),i=t.x,r=t.y,n=[];return $k(e).call(e,function(e){!e||fS(e.x)||fS(e.y)||n.push({x:e.x-i,y:e.y-r,step:e.step,close:e.close});}),n;}},{key:"updatePoints",value:function value(){var e=this.getLocalPosition();this.updateStyle({startPoint:{x:this.renderPath[0].x+e.x,y:this.renderPath[0].y+e.y},endPoint:{x:this.renderPath[1].x+e.x,y:this.renderPath[1].y+e.y}});}},{key:"updateOrigin",value:function value(){var e=this.getBoundingRect(),t=e.width,i=e.height;this.setOrigin(t/2,i/2);}},{key:"updateStyle",value:function value(e){var t,i=this;$k(t=eS(e)).call(t,function(t){RL(t,e)&&(i.style[t]=e[t]);});}},{key:"updatePosition",value:function value(e,t){this.style.x=e,this.style.y=t;}},{key:"getPath",value:function value(){this.path=this.initPath(),this.renderPath=this.getRenderPath(this.path),this.steps=SW(this.renderPath);}},{key:"getBoundingRect",value:function value(){var e=this.parsedStyle,t=e.borderWidth,i=e.lineCap,r=bW(this.path);if(2===this.path.length)return xW(this.path[0],this.path[1],t.value,i);var n=t.value/2||0;return{x:r.left-n,y:r.top-n,width:r.width+2*n,height:r.height+2*n};}},{key:"getBoundingRectObject",value:function value(){var e=this.getBoundingRect(),t=e.x,i=e.y,r=e.width,n=e.height;return new AW({style:{x:t,y:i,width:r,height:n,borderWidth:1,background:"rgba(0,0,0,0)"}});}},{key:"isPointInPath",value:function value(e){if(!this.getBoundingRectObject().isPointInPath(e))return!1;var t=this.parsedStyle,i=t.startPoint,r=t.endPoint,n=t.borderWidth;return VW(i,r,n.value<20?10:n.value,e);}},{key:"isLineArrow",value:function value(){var e=this.parsedStyle.lineEnding;return!!e&&("None"!==e[0]||"None"!==e[1]);}},{key:"addCircle",value:function value(e,t){var i=this.parsedStyle;zW(e,t,i.startPoint,i.endPoint,i.borderWidth.value);}},{key:"addDiamond",value:function value(e,t){var i=this.parsedStyle;MW(e,t,i.startPoint,i.endPoint,i.borderWidth.value);}},{key:"addSquare",value:function value(e,t){var i=this.parsedStyle;!function(e,t,i,r,n){var o=n,a=r.x,s=r.y;0===t&&(a=i.x,s=i.y);var u={x:a-3*o,y:s-3*o,step:0,close:!1},l={x:a+3*o,y:s-3*o,step:1,close:!1},c={x:a+3*o,y:s+3*o,step:1,close:!1},h={x:a-3*o,y:s+3*o,step:1,close:!0};e.push(u,l,c,h);}(e,t,i.startPoint,i.endPoint,i.borderWidth.value);}},{key:"addSlash",value:function value(e,t){var i=this.parsedStyle;DW(e,t,i.startPoint,i.endPoint,i.borderWidth.value);}},{key:"addButt",value:function value(e,t){var i=this.parsedStyle;BW(e,t,i.startPoint,i.endPoint,i.borderWidth.value);}},{key:"addOpenArrow",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.parsedStyle;EW(e,t,i,r.startPoint,r.endPoint,r.borderWidth.value);}},{key:"addCloseArrow",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.parsedStyle;PW(e,t,i,r.startPoint,r.endPoint,r.borderWidth.value);}}]);}(mW),XW=1/0,qW=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1/0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1/0;Xk(this,e),Wk(this,"minX",void 0),Wk(this,"maxX",void 0),Wk(this,"minY",void 0),Wk(this,"maxY",void 0),Wk(this,"rect",void 0),Wk(this,"updateId",void 0),this.minX=t,this.maxX=i,this.minY=r,this.maxY=n,this.rect=null,this.updateId=-1;}return Yk(e,[{key:"setFromBounds",value:function value(e){return this.minX=e.minX,this.minY=e.minY,this.maxX=e.maxX,this.maxY=e.maxY,this;}},{key:"clear",value:function value(){return this.minX=XW,this.maxX=-1/0,this.minY=XW,this.maxY=-1/0,this;}},{key:"getRect",value:function value(e){var t=this.minX,i=this.minY,r=this.maxX,n=this.maxY;if(t>r||i>n)return new ZN(0,0,0,0);var o=e||new ZN();return o.update(t,i,r-t,n-i),o;}},{key:"addPoint",value:function value(e){return this.addBounds({minX:e.x,maxX:e.x,minY:e.y,maxY:e.y});}},{key:"addBounds",value:function value(e){var t=_W(this,e);return this.setFromBounds(t);}},{key:"addBoundsMask",value:function value(e,t){var i=ZW(e,t);if(i.minX<=i.maxX&&i.minY<=i.maxY){var r=_W(i,this);this.setFromBounds(r);}return this;}},{key:"intersection",value:function value(t){if(r=t,!((i=this).minX<=r.maxX&&i.maxX>=r.minX&&i.minY<=r.maxY&&i.maxY>=r.minY))return null;var i,r,n=ZW(this,t);return e.fromBounds(n);}},{key:"union",value:function value(t){var i=_W(this,t);return e.fromBounds(i);}},{key:"addBoundsArea",value:function value(e,t){var i=t.x,r=t.y,n={minX:i,minY:r,maxX:i+t.width,maxY:r+t.height};return this.addBoundsMask(e,n);}},{key:"addFrame",value:function value(e,t){return this.setFromTransformedBounds(e.worldTransform,t);}},{key:"setFromTransformedBounds",value:function value(e,t){for(var i=0;i<2;i++){var r=e.transformPoint({x:i?t.maxX:t.minX,y:i?t.maxY:t.minY});this.addPoint(r);}return this;}},{key:"addQuad",value:function value(e){for(var t=0;t<4;t++)this.addPoint({x:e[2*t],y:e[2*t+1]});}}],[{key:"isEmpty",value:function value(e){return e.minX===e.maxX&&e.minY===e.maxY;}},{key:"fromBounds",value:function value(t){return new e().setFromBounds(t);}},{key:"create",value:function value(){return new e();}}]);}();function ZW(e,t){return{minX:e.minX>t.minX?e.minX:t.minX,minY:e.minY>t.minY?e.minY:t.minY,maxX:e.maxX<t.maxX?e.maxX:t.maxX,maxY:e.maxY<t.maxY?e.maxY:t.maxY};}function _W(e,t){return{minX:e.minX<t.minX?e.minX:t.minX,minY:e.minY<t.minY?e.minY:t.minY,maxX:e.maxX>t.maxX?e.maxX:t.maxX,maxY:e.maxY>t.maxY?e.maxY:t.maxY};}var GW=function(e){function t(){var e;return Xk(this,t),Wk(yb(e=cL(this,t)),"defaultView",void 0),Wk(yb(e),"documentElement",void 0),Wk(yb(e),"timeLine",void 0),e.nodeName="document",e.documentElement=new mW({id:"root",style:{visibility:"visible"}}),e.documentElement.ownerDocument=yb(e),e.documentElement.parentNode=yb(e),e.childNodes=[e.documentElement],e;}return _b(t,e),Yk(t,[{key:"children",get:function get(){return this.childNodes;}},{key:"childElementCount",get:function get(){return this.childNodes.length;}},{key:"firstElementChild",get:function get(){return this.firstChild;}},{key:"lastElementChild",get:function get(){return this.lastChild;}},{key:"createElement",value:function value(e,t){var i=this.defaultView.customElements.get(e);return i||console.warn("Unsupported tagName: ",e),new i(t);}},{key:"getElementById",value:function value(e){return null;}},{key:"getElementsByName",value:function value(e){return this.documentElement.getElementsByTagName(e);}},{key:"getElementsByTagName",value:function value(e){return this.documentElement.getElementsByTagName(e);}},{key:"getElementsByClassName",value:function value(e){return this.documentElement.getElementsByClassName(e);}},{key:"append",value:function value(){var e;return(e=this.documentElement).append.apply(e,arguments);}},{key:"prepend",value:function value(){var e;return(e=this.documentElement).prepend.apply(e,arguments);}},{key:"querySelector",value:function value(e){return this.documentElement.querySelector(e);}},{key:"querySelectorAll",value:function value(e){return this.documentElement.querySelectorAll(e);}},{key:"find",value:function value(e){var t;return xP(t=this.documentElement).call(t,e);}},{key:"findAll",value:function value(e){return this.documentElement.findAll(e);}},{key:"appendChild",value:function value(e){return this.documentElement.appendChild(e);}},{key:"cloneNode",value:function value(e){return this.documentElement.cloneNode(e);}},{key:"insertBefore",value:function value(e,t){return this.documentElement.insertBefore(e,t);}},{key:"removeChild",value:function value(e){return this.documentElement.removeChild(e);}},{key:"replaceChild",value:function value(e,t){return this.documentElement.replaceChild(e,t);}},{key:"destroy",value:function value(){}}]);}(sW);function KW(e,t,i){i instanceof FW!=0&&e!==t&&(i.calculateTextPosition(),i.lineWrap(),i.saveCharPosition(),i.updateOrigin());}function $W(e,t,i){if(i instanceof NW!=0&&e!==t){var r=i.getBoundingRect(),n=r.x,o=r.y;i.updatePosition(n,o);}}function JW(e,t,i){if((i instanceof WW||i instanceof HW||i instanceof OW)&&e!==t){i.getPath();var r=i.getBoundingRect(),n=r.x,o=r.y;i.updatePosition(n,o),i.updateOrigin();}}function QW(e,t,i){i instanceof FW!=0&&e!==t&&(i.setFont(),i.calculateTextPosition(),i.lineWrap(),i.saveCharPosition(),i.updateOrigin());}function eH(e,t,i){(i instanceof AW||i instanceof LW)&&e!==t&&i.updateOrigin();}function tH(e,t,i){if(i instanceof YW!=0&&e!==t){i.getPath();var r=i.getBoundingRect(),n=r.x,o=r.y;i.updatePosition(n,o),i.updateOrigin();}}function iH(e,t,i){i instanceof YW==0&&i instanceof HW==0||e!==t&&(i.getPath(),i.updateOrigin());}function rH(e,t,i){t&&(vW[e]=t),i&&(gW[e]||(gW[e]=[]),gW[e].push(i));}function nH(e,t,i){for(var r=0;r<e.length;r++)rH(e[r],t,i);}var oH=function(){return Yk(function e(t){Xk(this,e),Wk(this,"contextService",void 0),Wk(this,"renderingPlugins",[]),Wk(this,"config",{autoRendering:!0}),LU(this.config,t);},[{key:"use",value:function value(e){var t;OI(t=this.renderingPlugins).call(t,e)<0&&this.renderingPlugins.push(e);}},{key:"initPlugins",value:function value(e){var t;$k(t=this.renderingPlugins).call(t,function(t){t.init(e);});}},{key:"destroyPlugins",value:function value(){var e;$k(e=this.renderingPlugins).call(e,function(e){e.destroy();});}},{key:"getPlugins",value:function value(){return this.renderingPlugins;}},{key:"getConfig",value:function value(){return this.config;}}]);}(),aH=function(){return Yk(function e(t){Xk(this,e),Wk(this,"hooks",{init:SN.create(),beginFrame:SN.create(),beforeRender:SN.create(),render:SN.create(),afterRender:SN.create(),putImageData:SN.create(),endFrame:SN.create(),destroy:SN.create(),pointerdown:SN.create(),pointerup:SN.create(),pointermove:SN.create(),pointerout:SN.create(),pointerover:SN.create(),pointerCancel:SN.create(),wheel:SN.create()}),Wk(this,"isInited",!1),Wk(this,"zIndexCounter",0),Wk(this,"renderingContext",void 0),this.renderingContext=t;},[{key:"init",value:function value(){this.hooks.init.emit(),this.isInited=!0;}},{key:"destroy",value:function value(){this.isInited=!1,this.hooks.destroy.emit();}},{key:"render",value:function value(){var e=this.renderingContext.root;this.zIndexCounter=0,aW.recursiveUpdateHierarchy(e),this.isInited&&(this.renderDisplayObject(e),this.renderingContext.dirty&&(this.hooks.endFrame.emit(),this.renderingContext.dirty=!1),this.renderingContext.renderCondition.clear());}},{key:"renderDisplayObject",value:function value(e){var t,i,r=this;if(e.isVisible){var n=e.sortable;if(n.renderOrder=this.zIndexCounter,this.zIndexCounter+=1,this.renderingContext.dirty||(this.renderingContext.dirty=!0,this.hooks.beginFrame.emit()),e.imageData)this.hooks.putImageData.emit(e);else{this.hooks.beforeRender.emit(e),this.hooks.render.emit(e),this.hooks.afterRender.emit(e);var o=!1;n.dirty&&(n.sorted=pA(t=RI(i=e.childNodes).call(i)).call(t,sH),n.dirty=!1,o=!0);var a=n.sorted||e.childNodes;a.length>1&&pA(a).call(a,function(e,t){return e.style.zIndex-t.style.zIndex;}),$k(a).call(a,function(e){r.renderDisplayObject(e);}),pA(a).call(a,function(e,t){return e.index-t.index;}),o&&e.recursiveCall(function(e){var t=new eW("renderOrderChanged",{renderOrder:e.sortable.renderOrder});e.dispatchEvent(t);});}}}},{key:"dirty",value:function value(){this.renderingContext.renderCondition.add(0);}}]);}();function sH(e,t){var i=Number(e.style.zIndex),r=Number(t.style.zIndex);if(i===r&&e.parentNode){var n=e.parentNode.childNodes,o=void 0===n?[]:n;return OI(o).call(o,e)-OI(o).call(o,t);}return i-r;}var uH=function(e){function t(e){var i;Xk(this,t),Wk(i=cL(this,t),"document",void 0),Wk(i,"customElements",void 0),Wk(i,"devicePixelRatio",void 0),Wk(i,"eventService",void 0),Wk(i,"renderingService",void 0),Wk(i,"renderingContext",void 0),Wk(i,"canvasConfig",void 0),Wk(i,"renderer",void 0),Wk(i,"supportTouchEvent",void 0),Wk(i,"supportPointerEvent",void 0),Wk(i,"contextService",void 0);var r=e.renderer,n=e.dpr,o=e.width,a=e.height,s=e.canvas,u=e.supportPointerEvent,l=e.supportTouchEvent;i.supportPointerEvent=null!=u?u:!!IA.PointerEvent,i.supportTouchEvent=null!=l?l:"touchstart"in window;var c=o,h=a,d=n;return s&&(d=n||window.devicePixelRatio||1,c=o||s.width/d,h=a||s.height/d),i.canvasConfig=Fk(Fk({},e),{},{width:c,height:h,dpr:d}),i.canvasConfig=e,i.renderer=r,i.document=new GW(),i.document.defaultView=i,i.initRenderingContext(),i.renderingService=new aH(i.renderingContext),i.initRenderer(r),i;}return _b(t,e),Yk(t,[{key:"initRenderingContext",value:function value(){var e=this;this.renderingContext={root:this.document.documentElement,force:!1,dirty:!1,renderCondition:new Pz()},this.document.documentElement.addEventListener("child-inserted",function(t){e.mountChildren(t.detail.child);}),this.document.documentElement.addEventListener("child-removed",function(t){e.unmountChildren(t.detail.child);});}},{key:"initRenderer",value:function value(e){this.renderingService.init(),e.initPlugins(this),this.contextService.init(),e.getConfig().autoRendering&&this.render(),this.document.documentElement.recursiveCall(function(e){var t=e.renderable;t&&(t.boundsDirty=!0,t.renderBoundsDirty=!0);}),this.mountChildren(this.document.documentElement);}},{key:"render",value:function value(){var e=new eW("beforeRender",{});this.dispatchEvent(e),this.contextService.clearCanvas(),this.renderingService.render();}},{key:"setDPR",value:function value(e){this.canvasConfig.dpr=e,this.contextService.setDPR(e);}},{key:"resize",value:function value(e,t){this.canvasConfig.width=e,this.canvasConfig.height=t,this.contextService.resize(e,t);}},{key:"getContextService",value:function value(){return this.contextService;}},{key:"getEventService",value:function value(){return this.eventService;}},{key:"appendChild",value:function value(e,t){return this.document.documentElement.appendChild(e,t);}},{key:"insertBefore",value:function value(e,t){return this.document.documentElement.insertBefore(e,t);}},{key:"removeChild",value:function value(e){return this.document.documentElement.removeChild(e);}},{key:"getBoundingClientRect",value:function value(){return this.contextService.getBoundingClientRect();}},{key:"mountChildren",value:function value(e){var t=this;e.recursiveCall(function(e){e.isConnected||(e.isConnected=!0,e.ownerDocument=t.document,e.dispatchEvent(new eW("DOMNodeInsertedIntoDocument",{})));});}},{key:"unmountChildren",value:function value(e){var t,i=this,r=[];e.recursiveCall(function(e){e.isConnected&&r.push(e);}),$k(t=BA(r).call(r)).call(t,function(e){e.isConnected=!1,e.dispatchEvent(new eW("DOMNodeRemovedFromDocument",{})),e!==i.document.documentElement&&(e.ownerDocument=null);});}}]);}(tW),lH=Yk(function e(){Xk(this,e);}),cH=function(e){function t(){var e,i;Xk(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return Wk(i=cL(this,t,lS(e=[]).call(e,n)),"close",!0),Wk(i,"shape",void 0),Wk(i,"ctx",void 0),i;}return _b(t,e),Yk(t,[{key:"render",value:function value(e,t){var i=e.parsedStyle,r=i.background,n=i.borderColor;if("hidden"!==i.visibility){this.renderPath(e,t);var o=!AL(r)&&!r.isNone,a=!AL(n)&&!n.isNone;o&&this.renderFill(e,t),a&&this.renderStroke(e,t);}}},{key:"renderPath",value:function value(e,t){var i;e.getPath(),t.beginPath(),$k(i=e.steps).call(i,function(e){wW(t,e);}),this.close&&e.steps.length>2&&t.closePath();}},{key:"renderFill",value:function value(e,t){var i=e.parsedStyle,r=i.background,n=i.opacity,o=i.fillOpacity;if(t.save(),t.globalAlpha=n*o,_k(r)){this.setShapeGradientOrigin(e,t);for(var a=0;a<r.length;a++)0===a&&this.setShadow(e,t),t.fillStyle=this.getColor(e,r[a],t),cP(t).call(t);}else this.setShadow(e,t),t.fillStyle=r.formatted,cP(t).call(t);t.restore();}},{key:"renderStroke",value:function value(e,t){var i=this,r=e.parsedStyle,n=r.borderWidth,o=r.borderColor,a=r.opacity,s=r.lineCap,u=r.lineJoin,l=r.miterLimit,c=r.lineDash,h=r.lineDashOffset,d=r.borderOpacity;n&&n.value>0&&(t.save(),AL(n)||(t.lineWidth=n.value),t.miterLimit=l,t.globalAlpha=a*d,t.lineCap=s,t.lineJoin=u,t.setLineDash(c),t.lineDashOffset=h.value,_k(o)?(this.setShapeGradientOrigin(e,t),$k(o).call(o,function(r){t.strokeStyle=i.getColor(e,r,t),t.stroke();})):(t.strokeStyle=o.formatted,t.stroke()),t.restore());}},{key:"setShadow",value:function value(e,t){var i=e.parsedStyle,r=i.shadow,n=i.shadowOffsetX,o=i.shadowOffsetY,a=i.shadowBlur,s=i.shadowColor;(r||s)&&(t.shadowOffsetX=(null==n?void 0:n.value)||r[0],t.shadowOffsetY=(null==o?void 0:o.value)||r[1],t.shadowBlur=(null==a?void 0:a.value)||r[2],t.shadowColor=(null==s?void 0:s.formatted)||r[3]);}},{key:"getColor",value:function value(e,t,i){var r;if(1===t.type||2===t.type){var n=e.getBoundingRect(),o=n.width,a=n.height;r=function(e,t){var i=e.type,r=e.steps,n=e.width,o=e.height,a=e.angle,s=e.cx,u=e.cy,l=e.size,c=null;if(1===i){var h=function(e,t,i){var r=i*Math.PI/180,n=0+e/2,o=0+t/2,a=Math.abs(e*Math.cos(r))+Math.abs(t*Math.sin(r));return{x1:n-Math.cos(r)*a/2,y1:o-Math.sin(r)*a/2,x2:n+Math.cos(r)*a/2,y2:o+Math.sin(r)*a/2};}(n,o,a.value),d=h.x1,f=h.y1,v=h.x2,g=h.y2;c=t.createLinearGradient(d,f,v,g);}else if(2===i){var m=function(e,t,i,r,n){var o=i.value,a=r.value;"%"===i.unit&&(o=i.value/100*e),"%"===r.unit&&(a=r.value/100*t);var s=Math.max(IL({x:0,y:0},{x:o,y:a}),IL({x:0,y:t},{x:o,y:a}),IL({x:e,y:t},{x:o,y:a}),IL({x:e,y:0},{x:o,y:a}));return n&&(kL(n)?s=n.value:TL(n)&&("closest-side"===n?s=Math.min(o,e-o,a,t-a):"farthest-side"===n?s=Math.max(o,e-o,a,t-a):"closest-corner"===n&&(s=Math.min(IL({x:0,y:0},{x:o,y:a}),IL({x:0,y:t},{x:o,y:a}),IL({x:e,y:t},{x:o,y:a}),IL({x:e,y:0},{x:o,y:a}))))),{x:o,y:a,r:s};}(n,o,s,u,l),y=m.x,p=m.y,w=m.r;c=t.createRadialGradient(y,p,0,y,p,w);}return c&&$k(r).call(r,function(e){var t,i=e.offset,r=e.color;"%"===i.unit&&(null===(t=c)||void 0===t||t.addColorStop(i.value/100,r.toString()));}),c;}(Fk(Fk({type:t.type},t.value),{},{width:o,height:a}),i);}return r;}},{key:"setShapeGradientOrigin",value:function value(e,t){var i=e.config.type,r=e.parsedStyle,n=r.r,o=r.rx,a=r.ry;switch(i){case"circle":case"arc":t.translate(0-n.value,0-n.value);break;case"ellipse":t.translate(0-o.value,0-a.value);break;default:t.translate(0,0);}}}]);}(lH),hH=function(e){function t(){var e;return Xk(this,t),(e=cL(this,t)).close=!1,e;}return _b(t,e),Yk(t);}(cH),dH=function(e){function t(){return Xk(this,t),cL(this,t,arguments);}return _b(t,e),Yk(t);}(cH),fH=function(e){function t(){return Xk(this,t),cL(this,t,arguments);}return _b(t,e),Yk(t);}(cH),vH=function(e){function t(){return Xk(this,t),cL(this,t,arguments);}return _b(t,e),Yk(t,[{key:"render",value:function value(e,t){var i=e.parsedStyle,r=i.width,n=i.height;i.src;var o=i.img,a=i.opacity;"hidden"!==i.visibility&&(TL(o)||o&&(t.save(),t.globalAlpha=a,o instanceof ImageData?t.putImageData(o,0,0):t.drawImage(o,0,0,r.value,n.value),t.restore()));}}]);}(cH),gH=function(e){function t(){var e;return Xk(this,t),(e=cL(this,t)).close=!1,e;}return _b(t,e),Yk(t);}(cH),mH=function(e){function t(){var e;return Xk(this,t),(e=cL(this,t)).close=!1,e;}return _b(t,e),Yk(t);}(cH),yH=function(e){function t(){return Xk(this,t),cL(this,t,arguments);}return _b(t,e),Yk(t);}(cH),pH=function(e){function t(){return Xk(this,t),cL(this,t,arguments);}return _b(t,e),Yk(t,[{key:"render",value:function value(e,t){var i=e.parsedStyle,r=i.background,n=i.borderColor;if("hidden"!==i.visibility){var o=!AL(r)&&!r.isNone,a=!AL(n)&&!n.isNone;e.getPath();for(var s=e.steps.length,u=0;u<s;u++){var l,c=e.steps[u];t.beginPath(),$k(l=c.step).call(l,function(e){wW(t,e);}),c.close&&(t.closePath(),o&&this.renderFill(e,t)),a&&this.renderStroke(e,t);}}}}]);}(cH),wH=function(e){function t(){return Xk(this,t),cL(this,t,arguments);}return _b(t,e),Yk(t);}(cH),bH=function(e){function t(){return Xk(this,t),cL(this,t,arguments);}return _b(t,e),Yk(t,[{key:"render",value:function value(e,t){e&&this.renderText(e,t);}},{key:"renderText",value:function value(e,t){var i,r=this,n=e.parsedStyle,o=e.lines,a=n.color,s=n.borderWidth,u=n.borderColor,l=n.textBaseLine,c=n.opacity,h=n.textAlign,d=n.lineDash,f=n.textMaxWidth,v=n.fillOpacity,g=n.borderOpacity,m=n.letterSpacing;e.setFont(),t.save(),a&&_k(a)?$k(a).call(a,function(i){t.fillStyle=r.getColor(e,i,t);}):t.fillStyle=a.formatted,u&&_k(u)?$k(u).call(u,function(i){t.strokeStyle=r.getColor(e,i,t);}):t.strokeStyle=u.formatted,this.setShadow(e,t),t.font=e.font,t.globalAlpha=c,t.lineWidth=null==s?void 0:s.value,t.textAlign=h,t.textBaseline=l,t.letterSpacing="".concat(m.value,"px"),t.setLineDash(d),t.beginPath();var y=(null===(i=o[0])||void 0===i?void 0:i.y)||0;$k(o).call(o,function(i){var n=i.text,o=i.y-y;n=e.transformText(n),a&&r.fillText(t,n,0,o,v,null==f?void 0:f.value),s&&s.value&&s.value>0&&r.strokeText(t,n,0,o,g,null==f?void 0:f.value);}),t.closePath(),t.restore();}},{key:"fillText",value:function value(e,t,i,r,n,o){var a,s=!AL(n)&&1!==n;s&&(a=e.globalAlpha,e.globalAlpha=n*n),e.fillText(t,i,r,o),s&&(e.globalAlpha=a);}},{key:"strokeText",value:function value(e,t,i,r,n,o){var a,s=!AL(n)&&1!==n;s&&(a=e.globalAlpha,e.globalAlpha=n),e.strokeText(t,i,r,o),s&&(e.globalAlpha=a);}}]);}(cH),kH=function(e){function t(){return Xk(this,t),cL(this,t,arguments);}return _b(t,e),Yk(t);}(cH),SH=function(e){function t(){return Xk(this,t),cL(this,t,arguments);}return _b(t,e),Yk(t,[{key:"render",value:function value(e,t){var i,r=this,n=e.parsedStyle,o=n.background,a=n.borderColor;if("hidden"!==n.visibility){var s=!AL(o)&&!o.isNone,u=!AL(a)&&!a.isNone;e.getPath(),t.beginPath();var l=e.steps.length,c=!0;$k(i=e.steps).call(i,function(i,n){for(var o=0;o<i.step.length;o++)wW(t,i.step[o]);i.close&&(c=!1,t.closePath(),s&&r.renderFill(e,t),u&&r.renderStroke(e,t)),i.close&&n<l-1&&(c=!0,t.beginPath());}),c&&u&&this.renderStroke(e,t);}}}]);}(cH),xH=function(){return Yk(function e(t){Xk(this,e),Wk(this,"canvasConfig",void 0),Wk(this,"container",void 0),Wk(this,"canvas",void 0),Wk(this,"dpr",void 0),Wk(this,"context",void 0),Wk(this,"shapeRenderers",{}),this.canvasConfig=t;},[{key:"init",value:function value(){var e=this.canvasConfig,t=e.container,i=e.canvas,r=e.dpr,n=e.willReadFrequently;if(i){this.canvas=i;var o=i.parentElement;t&&o!==t&&t.appendChild(i),this.container=o,this.canvasConfig.container=o;}else if(t&&(this.container=t,TL(t)&&(this.container=document.getElementById(t)),this.container)){var a=document.createElement("canvas");this.container.appendChild(a),this.canvas=a;}this.context=this.canvas.getContext("2d",{willReadFrequently:n}),this.dpr=r||gN(),this.resize(this.canvasConfig.width,this.canvasConfig.height);}},{key:"registerShapeRenderer",value:function value(e,t){this.shapeRenderers[e]||(this.shapeRenderers[e]=t);}},{key:"getShapeRenderer",value:function value(e){return this.shapeRenderers[e];}},{key:"destroy",value:function value(){var e=this.canvas,t=this.container;t&&(null==e?void 0:e.parentNode)&&t.removeChild(e);}},{key:"resize",value:function value(e,t){var i=this.canvas,r=this.dpr;i&&(i.width=e*r,i.height=t*r,i.style.width="".concat(e,"px"),i.style.height="".concat(t,"px"),this.context.scale(r,r));}},{key:"getDPR",value:function value(){return this.dpr;}},{key:"setDPR",value:function value(e){this.canvasConfig.dpr=e,this.dpr=e;}},{key:"getContext",value:function value(){return this.context;}},{key:"getDomElement",value:function value(){return this.canvas;}},{key:"getCanvas",value:function value(){return this.canvas;}},{key:"setCursor",value:function value(e){var t;(null==this||null===(t=this.container)||void 0===t?void 0:t.style)&&(this.container.style.cursor=e);}},{key:"getBoundingClientRect",value:function value(){var e;return null===(e=this.canvas)||void 0===e?void 0:e.getBoundingClientRect();}},{key:"clearCanvas",value:function value(){this.canvas&&(this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.scale(this.dpr,this.dpr));}}]);}(),CH=function(){return Yk(function e(){Xk(this,e),Wk(this,"restoreStack",[]);},[{key:"init",value:function value(e){var t=this,i=e.renderingService.hooks;i.init.on(function(){}),i.destroy.on(function(){}),i.beginFrame.on(function(){}),i.endFrame.on(function(){var i,r=e.contextService.getContext();$k(i=t.restoreStack).call(i,function(){r.restore();}),t.restoreStack=[];}),i.render.on(function(i){t.renderDisplayObject(i,e);}),i.putImageData.on(function(t){if(t.imageData){var i=t.getPosition(),r=i.x,n=i.y,o=e.contextService.getContext(),a=e.contextService.getDPR();o.putImageData(t.imageData,Math.floor(r*a+1),Math.floor(n*a+1));}});}},{key:"renderDisplayObject",value:function value(e,t){if(e.isVisible){for(var i=t.contextService,r=i.getContext(),n=this.restoreStack[this.restoreStack.length-1];n&&e.parentNode!==n;)r.restore(),this.restoreStack.pop(),n=this.restoreStack[this.restoreStack.length-1];r.save(),this.applyTransform(r,e);var o=e.style.clipPath;o&&(r.save(),this.applyTransform(r,o),r.restore(),r.clip()),this.useAnchor(r,e);var a=i.getShapeRenderer(e.shapeType);a&&(a.render(e,r),e.clippable&&r.clip()),this.restoreStack.push(e);}}},{key:"applyTransform",value:function value(e,t){var i,r,n;t.externalMatrixes.length&&$k(i=BA(r=RI(n=t.externalMatrixes).call(n)).call(r)).call(i,function(t){var i=t.a,r=t.b,n=t.c,o=t.d,a=t.e,s=t.f;e.transform(i,r,n,o,a,s);});var o=t.getLocalTransform(),a=o.a,s=o.b,u=o.c,l=o.d,c=o.e,h=o.f;e.transform(a,s,u,l,c,h);}},{key:"applyAttributes",value:function value(e,t,i){}},{key:"useAnchor",value:function value(e,t){var i=(t.parsedStyle||{}).anchor;if(i&&(0!==i.x||0!==i.y)){var r=t.getGeometryBounds().getRect();e.translate(-(i&&i.x||0)*r.width,-(i&&i.y||0)*r.height);}}},{key:"destroy",value:function value(){}}]);}();Wk(CH,"moduleName",void 0);var VH=function(){return Yk(function e(){Xk(this,e);},[{key:"init",value:function value(e){var t,i=new xH(e.canvasConfig);e.contextService=i,$k(t=[{name:"arc",renderer:new hH()},{name:"circle",renderer:new dH()},{name:"ellipse",renderer:new fH()},{name:"freeline",renderer:new SH()},{name:"image",renderer:new vH()},{name:"line",renderer:new gH()},{name:"path",renderer:new mH()},{name:"polygon",renderer:new yH()},{name:"polyline",renderer:new pH()},{name:"rect",renderer:new wH()},{name:"stampPath",renderer:new kH()},{name:"text",renderer:new bH()}]).call(t,function(e){var t=e.name,r=e.renderer;i.registerShapeRenderer(t,r);});}},{key:"destroy",value:function value(){}}]);}(),TH=function(e){function t(e){var i;return Xk(this,t),(i=cL(this,t,[e])).use(new VH()),i.use(new CH()),i;}return _b(t,e),Yk(t);}(oH),IH=function(e){function t(e){var i;return Xk(this,t),Wk(yb(i=cL(this,t,[e])),"name",void 0),Wk(yb(i),"type",void 0),Wk(yb(i),"owners",[]),Wk(yb(i),"isDestroyed",!1),i.name=e.name,i.type=e.type,i.children=e.children||[],i;}return _b(t,e),Yk(t,[{key:"destroy",value:function value(){this.isDestroyed||(this.children=null,this.owners=null,this.isDestroyed=!0);}},{key:"count",value:function value(){return this.children.length;}},{key:"addOwner",value:function value(e){var t=this.owners;return OI(t).call(t,e)<0&&(t.push(e),!0);}},{key:"removeOwner",value:function value(e){var t=this.owners,i=OI(t).call(t,e);return!(i<0||(gE(t).call(t,i,1),0));}}]);}(GN),EH=function(){return Yk(function e(t){Xk(this,e),Wk(this,"docs",[]),Wk(this,"isDestroyed",!1),this.docs=[];},[{key:"destroy",value:function value(){var e;this.isDestroyed||($k(e=this.docs).call(e,function(e){e.destroy();}),this.docs=[],this.isDestroyed=!0);}},{key:"addDoc",value:function value(e,t){var i=this.getDoc(e.uid);return i||(i=new IH(e),this.docs.push(i)),t&&i.addOwner(t),i;}},{key:"getDoc",value:function value(e){var t;return xP(t=this.docs).call(t,function(t){return t.uid===e;});}},{key:"getIndexByUid",value:function value(e){var t;return EE(t=this.docs).call(t,function(t){return t.uid===e;});}},{key:"removeDoc",value:function value(e){var t,i=this.getIndexByUid(e);return i>-1&&(gE(t=this.docs).call(t,i,1),!0);}},{key:"removePage",value:function value(e,t){var i=this.getDoc(e);return!!i&&i.remove(t);}}]);}(),PH=function(){return Yk(function e(){Xk(this,e),Wk(this,"canvas",void 0),Wk(this,"renderer",void 0),Wk(this,"root",void 0),this.renderer=new TH(),this.canvas=new uH({renderer:this.renderer,width:10,height:10,canvas:document.createElement("canvas"),dpr:1,willReadFrequently:!0}),this.root=this.canvas.document.documentElement;},[{key:"render",value:function value(e){var t,i,r=this;$k(t=RI(i=this.root.children).call(i)).call(t,function(e){r.root.removeChild(e);}),this.root.appendChild(e),this.canvas.resize(e.width,e.height),this.canvas.render();}},{key:"clear",value:function value(){var e,t,i=this;$k(e=RI(t=this.root.children).call(t)).call(e,function(e){i.root.removeChild(e);}),this.root.sortable.sorted=[];}},{key:"getCanvas",value:function value(){return this.canvas.contextService.getDomElement();}}]);}(),BH=function(e){function t(){var e,i;Xk(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return Wk(i=cL(this,t,lS(e=[]).call(e,n)),"next",void 0),i;}return _b(t,e),Yk(t,[{key:"setNext",value:function value(e){this.next=e;}},{key:"getNext",value:function value(){return this.next;}}]);}(KN),DH=function DH(e){if(e.layoutStatus.skipCalcZoom)return e.layoutStatus.skipCalcZoom=!1,!0;var t=e.layoutStatus,i=t.viewWidth,r=t.viewHeight,n=t.calcHeight,o=t.calcViewWidth,a=t.calcViewHeight,s=t.scrollbarWidth;t.validVisualWidth;var u,l=t.validLayoutWidth,c=t.validLayoutHeight,h=t.fixedWidth,d=t.fixedHeight,f=e.layoutStatus,v=f.isScrollbarChanged,g=f.isScrollbarXAppeared,m=e.direction,y=i,p=r,w=0,b=1;(w=l*(b=n<=a?1:a/n))>o?(g||(g=!0,v=!0,b=n<=a-s?1:(a-s)/n),w=l*b):g&&(g=!1,v=!0),u=c*b;var k="vertical"===m?(y-w-h)/2:0,S="vertical"===m?0:(p-u-d)/2;return k<0&&(k=0),S<0&&(S=0),e.updateLayoutStatus({layoutLeft:k,layoutTop:S,zoom:b,visualWidth:y,visualHeight:p,currentLayoutWidth:w+h,currentLayoutHeight:u+d,isScrollbarChanged:v,isScrollbarXAppeared:g}),e.setZoom(b),!v||"break";},MH=function MH(e){if(e.layoutStatus.skipCalcZoom)return e.layoutStatus.skipCalcZoom=!1,!0;var t=e.layoutStatus,i=t.viewWidth,r=t.viewHeight;t.scrollbarWidth;var n,o,a=t.validVisualWidth,s=t.validVisualHeight,u=t.validLayoutWidth,l=t.validLayoutHeight,c=t.fixedWidth,h=t.fixedHeight,d=t.zoom,f=e.layoutStatus,v=f.isScrollbarXAppeared,g=f.isScrollbarYAppeared,m=f.isScrollbarChanged,y=e.direction,p=r,w=i;n=u*d,o=l*d,Math.floor(n)>a?v||(v=!0,m=!0):v&&(v=!1,m=!0),Math.floor(o)>s?g||(g=!0,m=!0):g&&(g=!1,m=!0);var b="vertical"===y?(w-n-c)/2:0,k="vertical"===y?0:(p-o-h)/2;return b<0&&(b=0),k<0&&(k=0),e.updateLayoutStatus({layoutLeft:b,layoutTop:k,visualWidth:w,visualHeight:p,currentLayoutWidth:n+c,currentLayoutHeight:o+h,isScrollbarXAppeared:v,isScrollbarYAppeared:g,isScrollbarChanged:m}),e.setZoom(d),!m||"break";},zH=function zH(e){if(e.layoutStatus.skipCalcZoom)return e.layoutStatus.skipCalcZoom=!1,!0;var t=e.layoutStatus,i=t.viewWidth,r=t.viewHeight,n=t.calcWidth,o=t.calcViewWidth;t.calcViewHeight;var a,s=t.scrollbarWidth,u=t.validVisualHeight,l=t.validLayoutWidth,c=t.validLayoutHeight,h=t.fixedWidth,d=t.fixedHeight,f=e.layoutStatus,v=f.isScrollbarChanged,g=f.isScrollbarYAppeared,m=e.direction,y=r,p=i,w=0,b=1;(w=c*(b=n<=o?1:o/n))>u?(g||(g=!0,v=!0,b=n<=o-s?1:(o-s)/n),w=c*b):g&&(g=!1,v=!0),a=l*b;var k="vertical"===m?0:(p-a-h)/2,S="vertical"===m?(y-w-d)/2:0;return k<0&&(k=0),S<0&&(S=0),e.updateLayoutStatus({layoutLeft:k,layoutTop:S,zoom:b,visualWidth:p,visualHeight:y,currentLayoutWidth:a+h,currentLayoutHeight:w+d,isScrollbarYAppeared:g,isScrollbarChanged:v}),e.setZoom(b),!v||"break";},UH=function UH(e){if(e.layoutStatus.skipCalcZoom)return e.layoutStatus.skipCalcZoom=!1,!0;var t=e.layoutStatus,i=t.calcWidth,r=t.calcHeight;return i/t.calcViewWidth>=r/t.calcViewHeight?zH(e):DH(e);},AH=function(e){function t(){var e;return Xk(this,t),(e=cL(this,t)).addStrategy("width",zH),e.addStrategy("height",DH),e.addStrategy("window",UH),e.addStrategy("none",MH),e;}return _b(t,e),Yk(t,[{key:"layout",value:function value(e){var t=this.next,i=e.fitType;"break"!==this.executeStrategy(i,e)&&t&&t.layout(e);}}]);}(BH),RH=function RH(e){var t=e.currentPage;if(t){var i=e.layoutStatus,r=i.defaultWidth,n=i.defaultHeight,o=i.viewWidth,a=i.viewHeight,s=e.viewer.context.getMargin(),u=e.borderWidth,l=t.image.style.img,c=t.realTimeWidth||(null==l?void 0:l.naturalWidth)||r,h=t.realTimeHeight||(null==l?void 0:l.naturalHeight)||n;e.viewer.context.config.enableSingleModeBorder||(u=0);var d=2*u,f=2*s,v=o-d-f,g=a-d-f;e.updateLayoutStatus({layoutWidth:c,layoutHeight:h,calcWidth:c,calcHeight:h,calcViewWidth:v,calcViewHeight:g,validVisualWidth:v,validVisualHeight:g,validLayoutWidth:c,validLayoutHeight:h,fixedWidth:f+d,fixedHeight:f+d});}},LH=function LH(e){if(!e.total)return!1;var t=e.layoutStatus,i=t.viewWidth,r=t.viewHeight,n=t.isScrollbarAppeared,o=t.isScrollbarChanged,a=e.layoutStatus.scrollbarWidth,s=e.total,u=e.row,l=e.column,c=e.direction,h=e.enableDWT1x1,d=e.viewer.context.getMargin(),f=e.viewer.context.getGap();1===u&&1===l&&h&&(d=0),l*u<s?n||(n=!0,o=!0,"vertical"===c?i-=a:r-=a):n&&(n=!1,o=!0);var v="vertical"===c,g=(i-(l-1)*f-2*d)/l,m=(r-(u+1)*f)/u;1===u&&1===l&&h&&(m=r),v||(m=(r-(u-1)*f-2*d)/u,g=(i-(l+1)*f)/l,1===u&&1===l&&h&&(g=i));var y=Math.max,p=Math.ceil,w=v?y(u,p(s/l)):u,b=v?l:y(l,p(s/u)),k=g*b+(b-1)*f+2*d,S=m*w+(w-1)*f+2*d;return e.updateLayoutStatus({rowHeightArray:[m],columnWidthArray:[g],layoutWidth:k,layoutHeight:S,skipCalcZoom:!0,layoutLeft:0,layoutTop:0,visualWidth:i,visualHeight:r,currentLayoutWidth:k,currentLayoutHeight:S,isScrollbarAppeared:n,isScrollbarChanged:o,realRow:w,realCol:b}),!o||"break";},NH=function NH(e){if(!e.total)return!1;var t=e.layoutStatus,i=t.viewWidth,r=t.viewHeight,n=e.current,o=e.getChildByIndex(n-1),a=e.getChildByIndex(n+1);if(o){var s=OH(e,o),u=s.left,l=s.top;o.updateStyle({x:-i+u,y:l,width:i,height:r});}if(a){var c=OH(e,a),h=c.left,d=c.top;a.updateStyle({x:i+h,y:d,width:i,height:r});}return"break";};function OH(e,t){var i,r,n=e.layoutStatus,o=n.viewWidth,a=n.viewHeight,s=e.borderWidth;e.viewer.context.config.enableSingleModeBorder||(s=0);var u=e.viewer.context.getMargin(),l=t.image.style.img,c=t.realTimeWidth||(null==l?void 0:l.naturalWidth)||e.layoutStatus.defaultWidth,h=t.realTimeHeight||(null==l?void 0:l.naturalHeight)||e.layoutStatus.defaultHeight,d=o-2*u-2*s,f=a-2*u-2*s,v=0,g=0,m=1;c<=d&&h<=f?(v=c,g=h,m=1):c/h>d/f?(v=d,g=h*(m=d/c)):(g=f,v=c*(m=f/h));var y=(d-c*m)/2+s/2+u,p=(f-h*m)/2+s/2+u;y=Math.max(u+s/2,y),p=Math.max(u+s/2,p);var w=c*(1-m)/2,b=h*(1-m)/2;return t.borderBox.updateStyle({x:0,y:0,width:v+2*s,height:g+2*s,borderWidth:s}),t.imageContainer.setLocalScale(1),t.imageContainer.updateStyle({x:s-w,y:s-b,width:c,height:h}),t.imageContainer.setLocalScale(m,m,1),t.zoom=m,t.image.updateStyle({x:0,y:0,width:(null===(i=t.image.style.img)||void 0===i?void 0:i.naturalWidth)||0,height:(null===(r=t.image.style.img)||void 0===r?void 0:r.naturalHeight)||0}),t.updateStyle({visibility:"visible"}),t.imageContainer.updateStyle({visibility:"visible"}),t.borderBox.updateStyle({visibility:"visible"}),t.image.updateStyle({visibility:"visible"}),{left:y-s/2,top:p-s/2};}var WH=function(e){function t(){var e;return Xk(this,t),(e=cL(this,t)).addStrategy("single",RH),e.addStrategy("multiple",LH),e.addStrategy("slide",NH),e;}return _b(t,e),Yk(t,[{key:"layout",value:function value(e){var t=this.next,i=e.displayMode;"break"!==this.executeStrategy(i,e)&&t&&t.layout(e);}}]);}(BH),HH=function HH(e){var t=e.layoutStatus,i=t.zoom,r=t.visualWidth,n=t.visualHeight,o=t.defaultWidth,a=t.defaultHeight,s=t.currentLayoutWidth,u=t.currentLayoutHeight,l=e.currentPage,c=e.viewer.context.getMargin(),h=e.borderWidth;if(l){e.viewer.context.uiService.updateScrollContentSize(s,u);var d=e.viewer.context.uiService.scrollContainer,f=d.scrollLeft,v=d.scrollTop;e.setPosition({x:-f,y:-v}),e.viewer.context.config.enableSingleModeBorder||(h=0);var g=l.image.style.img,m=l.realTimeWidth||(null==g?void 0:g.naturalWidth)||o,y=l.realTimeHeight||(null==g?void 0:g.naturalHeight)||a,p=m*i,w=y*i,b=(r-p)/2-h/2,k=(n-w)/2-h/2;b=Math.max(c+h/2,b),k=Math.max(c+h/2,k);var S=m*(1-i)/2,x=y*(1-i)/2;l.updateStyle({x:b-h/2,y:k-h/2,width:p+2*h,height:w+2*h,borderWidth:h}),l.borderBox.updateStyle({x:0,y:0,width:p+2*h,height:w+2*h,borderWidth:h}),l.image.updateStyle({width:(null==g?void 0:g.naturalWidth)||0,height:(null==g?void 0:g.naturalHeight)||0}),l.imageContainer.setLocalScale(1),l.imageContainer.updateStyle({x:h-S,y:h-x,width:m,height:y}),l.imageContainer.setLocalScale(i),l.zoom=i;}},FH=function FH(e){var t=e.layoutStatus,i=t.rowHeightArray,r=t.columnWidthArray,n=t.currentLayoutWidth,o=t.currentLayoutHeight,a=e.children,s=e.row,u=e.column,l=e.direction,c=e.borderWidth,h=e.hoveredBorderWidth,d=e.selectedBorderWidth,f=e.enableDWT1x1,v=e.viewer.context.getMargin(),g=e.viewer.context.getGap();1===s&&1===u&&f&&(v=0);var m=Gb(r,1)[0],y=Gb(i,1)[0];e.viewer.context.uiService.updateScrollContentSize(n,o);var p=e.viewer.context.uiService.scrollContainer,w=p.scrollLeft,b=p.scrollTop;e.setPosition({x:-w,y:-b}),$k(a).call(a,function(t,i){var r,n=c;t.isHovered&&(n=h),OI(r=e.selected).call(r,t.uid)>-1&&(n=d);var o=i%u,a=Math.floor(i/u);"horizontal"===l&&(o=Math.floor(i/s),a=i%s);var f=v+o*(g+m)+n/2,p=v+a*(g+y)+n/2,w=m-2*n,b=y-2*n,k=t.getImage().style.img,S=t.realTimeWidth||(null==k?void 0:k.naturalWidth)||0,x=t.realTimeHeight||(null==k?void 0:k.naturalHeight)||0,C=0,V=0,T=S,I=x,E=1;(S>w||x>b)&&(S/x>w/b?(T=w,I=x*(E=w/S)):(I=b,T=S*(E=b/x))),C+=(w-T)/2,V+=(b-I)/2,C+=n,V+=n;var P=S*(1-E)/2,B=x*(1-E)/2;t.image.updateStyle({width:(null==k?void 0:k.naturalWidth)||0,height:(null==k?void 0:k.naturalHeight)||0}),t.imageContainer.updateStyle({x:C-P,y:V-B,width:S,height:x}),t.imageContainer.setLocalScale(E,E,1),t.zoom=E,t.updateStyle({x:f-n/2,y:p-n/2,width:m,height:y}),t.borderBox.updateStyle({x:0,y:0,width:m,height:y});});},jH=function(e){function t(){var e;return Xk(this,t),(e=cL(this,t)).addStrategy("single",HH),e.addStrategy("multiple",FH),e;}return _b(t,e),Yk(t,[{key:"layout",value:function value(e){var t=this.next,i=e.displayMode;this.executeStrategy(i,e),t&&t.layout(e);}}]);}(BH);function YH(e){var t,i=e.current,r=e.total,n=e.currentPage,o=e.preloadCount;if(e.topPageUid,n){var a=i-o;a<0&&(a=0);var s=i+o;s>=r&&(s=r-1),e.visibleChildren=[],$k(t=e.children).call(t,function(t,i){var r=t.uid===n.uid,o=i>=a&&i<=s,u=t.isEdited,l=t.isUpdated,c=t.isVisible;((u||l)&&r||!c&&r)&&(t.isPageRendered=!0),r&&e.visibleChildren.push(t),t.updateStyle({visibility:r?"visible":"hidden"}),t.borderBox.updateStyle({visibility:r?"visible":"hidden"}),t.image.updateStyle({visibility:r?"visible":"hidden"}),t.imageContainer.updateStyle({visibility:r?"visible":"hidden"}),t.isPreload=o;});}}function XH(e){var t,i=e.layoutStatus,r=i.rowHeightArray,n=i.columnWidthArray,o=i.viewWidth,a=i.viewHeight,s=e.total,u=e.row,l=e.column,c=e.direction,h=e.preloadCount,d=e.topPageUid,f=e.enableDWT1x1,v=e.viewer.context.getMargin(),g=e.viewer.context.getGap();1===u&&1===l&&f&&(v=0);var m=Math.ceil,y=Math.floor,p="vertical"===c,w=p?l:m(s/u),b=p?m(s/l):u,k=0,S=w-1,x=0,C=b-1;if(p)for(var V=0;V<b;V++){var T=0===V?v:g,I=V===b-1?v:g,E=e.children[V*w],P=Gb(r,1)[0];if(E){var B=E.getPosition().y;if(B-T<=1&&B+P>1&&(x=V),B-a<-1&&B+P+I-a>=-1){C=V;break;}}}else for(var D=0;D<w;D++){var M=0===D?v:g,z=D===w-1?v:g,U=e.children[D*b],A=Gb(n,1)[0];if(U){var R=U.getPosition().x;if(R-M<=1&&R+A>1&&(k=D),R-o<=-1&&R+A+z-o>=-1){S=D;break;}}}var L=null;e.visibleChildren=[],$k(t=e.children).call(t,function(t,i){var r=p?y(i/l):i%u,n=p?i%l:y(i/u),o=r>=x&&r<=C&&n>=k&&n<=S,a=r>=x-h&&r<=C+h&&n>=k-h&&n<=S+h;o&&!L&&(L=t.uid),o&&e.visibleChildren.push(t);var s=t.isEdited,c=t.isUpdated,d=t.isVisible;((s||c)&&o||!d&&o)&&(t.isPageRendered=!0),t.updateStyle({visibility:o?"visible":"hidden"}),t.borderBox.updateStyle({visibility:o?"visible":"hidden"}),t.imageContainer.updateStyle({visibility:o?"visible":"hidden"}),t.image.updateStyle({visibility:o?"visible":"hidden"}),t.isPreload=a;var f={x:n<=k?"ahead":n>=S?"behind":"inside",y:r<=x&&r<C?"ahead":r>=C&&r>=x?"behind":"inside",column:n,row:r};t.viewportPosition=f;}),L&&L!==d&&(e.isTopPageChanged=!0,e.topPageUid=L);}var qH=function(e){function t(){var e;return Xk(this,t),(e=cL(this,t)).addStrategy("single",YH),e.addStrategy("multiple",XH),e;}return _b(t,e),Yk(t,[{key:"layout",value:function value(e){var t=this.next,i=e.displayMode;this.executeStrategy(i,e),t&&t.layout(e);}}]);}(BH),ZH=function(){return Yk(function e(){Xk(this,e),Wk(this,"viewers",void 0),Wk(this,"group",{}),Wk(this,"isDestroyed",!1),this.viewers=[];},[{key:"destroy",value:function value(){this.isDestroyed||(this.viewers=[],this.viewers=null,this.group=null,this.isDestroyed=!0);}},{key:"addViewer",value:function value(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(OI(t=this.viewers).call(t,e)>-1)return!1;var r=[];return this.group[i]?r=this.group[i]:this.group[i]=r,r.push(e.uid),this.viewers.push(e),!0;}},{key:"removeViewer",value:function value(e){var t,i,r=EE(t=this.viewers).call(t,function(t){return t.uid===e.uid;});if(r<0)return!1;var n=this.group[e.groupUid],o=OI(n).call(n,e.uid);return gE(n).call(n,o,1),0===n.length&&delete this.group[e.groupUid],gE(i=this.viewers).call(i,r,1),e.destroy(),!0;}},{key:"getViewer",value:function value(e){var t=this.viewers;return e?xP(t).call(t,function(t){return t.uid===e;}):t[0]||null;}},{key:"getAllViewers",value:function value(){var e;return RI(e=this.viewers).call(e);}},{key:"getGroup",value:function value(e){var t=this.getViewer(e);return t?this.group[t.groupUid]:null;}}]);}();function _H(){onmessage=function onmessage(e){var t=e.data.core,i=e.data.sourceWidth,r=e.data.sourceHeight,n=e.data.width,o=e.data.height,a=e.data.source.data,s=n*o*4,u=new ArrayBuffer(s),l=null;try{l=new Uint8ClampedArray(u,0,s);}catch(e){l=new Uint8Array(u,0,s);}for(var c=0;c<o;c++)for(var h=c*r/o,d=Math.floor(h),f=1-(h-d),v=d,g=(c+1)*r/o,m=Math.floor(g-1e-5),y=g-m,p=m,w=c*n*4,b=0;b<n;b++){var k=b*i/n,S=Math.floor(k),x=1-(k-S),C=S,V=(b+1)*i/n,T=Math.floor(V-1e-5),I=V-T,E=T,P=0,B=0,D=0,M=0,z=0,U=255,A=void 0,R=void 0,L=(v+1)*i*4+4*C;for(A=v+1;A<p;++A){var N=U;P+=a[L+2]*x*N,B+=a[L+1]*x*N,D+=a[L]*x*N,M+=a[L+3]*x*N,z+=U*x,L+=4*i;}var O=(v+1)*i*4+4*E;for(A=v+1;A<p;++A){var W=U;P+=a[O+2]*I*W,B+=a[O+1]*I*W,D+=a[O]*I*W,M+=a[O+3]*I*W,z+=U*I,O+=4*i;}var H=v*i*4+4*(C+1);for(R=C+1;R<E;++R){var F=U;P+=a[H+2]*f*F,B+=a[H+1]*f*F,D+=a[H]*f*F,M+=a[H+3]*f*F,z+=U*f,H+=4;}var j=p*i*4+4*(C+1);for(R=C+1;R<E;++R){var Y=U;P+=a[j+2]*y*Y,B+=a[j+1]*y*Y,D+=a[j]*y*Y,M+=a[j+3]*y*Y,z+=U*y,j+=4;}for(A=v+1;A<p;++A){var X=A*i*4+4*(C+1);for(R=C+1;R<E;++R){var q=U;P+=a[X+2]*q,B+=a[X+1]*q,D+=a[X]*q,M+=a[X+3]*q,z+=q,X+=4;}}var Z=v*i*4+4*C,_=U;P+=a[Z+2]*(f*x)*_,B+=a[Z+1]*(f*x)*_,D+=a[Z]*(f*x)*_,M+=a[Z+3]*(f*x)*_,z+=U*(f*x);var G=U;P+=a[(Z=v*i*4+4*E)+2]*(f*I)*G,B+=a[Z+1]*(f*I)*G,D+=a[Z]*(f*I)*G,M+=a[Z+3]*(f*I)*G,z+=U*(f*I);var K=U;P+=a[(Z=p*i*4+4*C)+2]*(y*x)*K,B+=a[Z+1]*(y*x)*K,D+=a[Z]*(y*x)*K,M+=a[Z+3]*(y*x)*K,z+=U*(y*x);var $=U;P+=a[(Z=p*i*4+4*E)+2]*(y*I)*$,B+=a[Z+1]*(y*I)*$,D+=a[Z]*(y*I)*$;var J=(M+=a[Z+3]*(y*I)*$)/(z+=U*(y*I)),Q=0,ee=0,te=0;0!==J&&(Q=P/z,ee=B/z,te=D/z),Q+=.5,ee+=.5,te+=.5,J+=.5,l[w]=Math.floor(te),l[w+=1]=Math.floor(ee),l[w+=1]=Math.floor(Q),l[w+=1]=Math.floor(J),w+=1;}var ie={core:t,target:l,taskUid:e.data.taskUid,callbackId:e.data.callbackId};try{postMessage(ie,[l.buffer]);}catch(e){postMessage(ie,null);}l=null;};}var GH=function(){return Yk(function e(t,i,r){var n=this;Xk(this,e),Wk(this,"worker",void 0),Wk(this,"id",void 0),Wk(this,"manager",void 0),Wk(this,"callbacks",{}),Wk(this,"busy",!1),Wk(this,"counter",0),Wk(this,"tasks",[]),this.worker=t,this.id=i,this.manager=r,this.worker.addEventListener("message",function(e){n.onMessage(e);},!1);},[{key:"setBusy",value:function value(e){if(this.busy=e,!e)if(this.tasks.length){var t=this.tasks.shift();this.send(t);}else this.worker.terminate(),this.manager.removeActor(this);}},{key:"isBusy",value:function value(){return this.busy;}},{key:"getWorker",value:function value(){return this.worker;}},{key:"onMessage",value:function value(e){this.setBusy(!1);var t=e.data.callbackId,i=t?this.callbacks[t]:null;i&&i(e.data),delete this.callbacks[t];}},{key:"send",value:function value(e,t){var i,r;if(this.busy)this.tasks.push(Fk({},e));else{this.setBusy(!0);var n=lS(i=lS(r="".concat(this.id,"-")).call(r,e.action,"-cb-")).call(i,this.counter);e.callback&&(this.callbacks[n]=e.callback,this.counter+=1),e.callbackId=n;var o=Fk(Fk({},e.data),{},{callbackId:n});t?this.worker.postMessage(o,[t.data.buffer]):this.worker.postMessage(o);}}}]);}(),KH=function(){return Yk(function e(t,i){Xk(this,e),Wk(this,"concurrency",1),Wk(this,"actors",[]),Wk(this,"workerUrl",void 0),this.workerUrl=t,this.concurrency=i;},[{key:"send",value:function value(e,t){this.getActor().send(e,t);}},{key:"getActor",value:function value(){var e,t=yx(e=this.actors).call(e,function(e){return!e.isBusy();})[0];if(t)return t;if(this.actors.length<this.concurrency){var i=new Worker(this.workerUrl),r=new GH(i,this.actors.length,this);return this.actors.push(r),r;}var n=Math.floor(Math.random()*this.concurrency);return this.actors[n];}},{key:"removeActor",value:function value(e){var t,i,r=OI(t=this.actors).call(t,e);gE(i=this.actors).call(i,r,1);}},{key:"clear",value:function value(){var e,t=function(e,t){var i=void 0!==Wc&&Bh(e)||e["@@iterator"];if(!i){if(yh(e)||(i=Kd(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0,n=function n(){};return{s:n,n:function n(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]};},e:function e(_e2){throw _e2;},f:n};}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var o,a=!0,s=!1;return{s:function s(){i=i.call(e);},n:function n(){var e=i.next();return a=e.done,e;},e:function e(_e3){s=!0,o=_e3;},f:function f(){try{a||null==i.return||i.return();}finally{if(s)throw o;}}};}(this.actors);try{for(t.s();!(e=t.n()).done;){e.value.getWorker().terminate();}}catch(e){t.e(e);}finally{t.f();}this.actors=[];}}]);}(),$H=function(){return Yk(function e(){Xk(this,e);},[{key:"apply",value:function value(e){this.listenSpaceHooks(e),this.listenDVSHooks(e);}},{key:"listenDVSHooks",value:function value(e){var t=this,i=e.hooksService.hooks,r=function r(t){var i=e.spaceService.space;t.trigger!==i.uid&&i.removeSource(t.removedUids);},n=function n(t){var i=e.spaceService.space;t.trigger!==i.uid&&i.move(Fk({emit:!1},t));},o=function o(t){var i=e.spaceService.space;t.trigger!==i.uid&&i.switch(Fk({emit:!1},t));},a=function a(t){var i=e.spaceService.space;t.trigger!==i.uid&&i.reorder(Fk({emit:!1},t));},s=function s(){t.listenSpaceHooks(e);};i.remove.on(r),i.move.on(n),i.switch.on(o),i.reorder.on(a),i.afterSetSpace.on(s),e.hooksService.hooks.destroy.on(function(){i.remove.off(r),i.move.off(n),i.switch.off(o),i.reorder.off(a),i.afterSetSpace.off(s);});}},{key:"listenSpaceHooks",value:function value(e){var t=e.spaceService.space.hooks,i=e.hooksService.hooks,r=function r(e){var t=e.uid;i.removeDoc.emit(t);},n=function n(e){var t=e.name,r=e.uid;i.renameDoc.emit(t,r);},o=function o(t){var i=t.node,r=t.config,n=t.type;e.viewerService.openDoc(i,n,null==r?void 0:r.viewerUid);},a=function a(e){i.appendPagesToDoc.emit(e);},s=function s(e){i.removePagesFromDoc.emit(e);},u=function u(e){i.afterUpdate.emit(e);},l=function l(e){i.remove.emit(e);},c=function c(e){i.switch.emit(e);},h=function h(e){i.move.emit(e);},d=function d(e){i.reorder.emit(e);};t.removeDoc.on(r),t.renameDoc.on(n),t.openDoc.on(o),t.loadToDoc.on(a),t.removeFromDoc.on(s),t.afterUpdateSource.on(u),t.afterRemoveSource.on(l),t.switch.on(c),t.move.on(h),t.reorder.on(d);var _f2=function f(){t.removeDoc.off(r),t.renameDoc.off(n),t.openDoc.off(o),t.loadToDoc.off(a),t.removeFromDoc.off(s),t.afterUpdateSource.off(u),t.afterRemoveSource.off(l),t.switch.off(c),t.move.off(h),t.reorder.off(d),e.spaceService.space.hooks.destroy.off(_f2),e.hooksService.hooks.afterSetSpace.off(_f2);};e.spaceService.space.hooks.destroy.on(_f2),e.hooksService.hooks.afterSetSpace.on(_f2);}}]);}(),JH=function(){return Yk(function e(){Xk(this,e);},[{key:"apply",value:function value(e){this.listenDVSHooks(e);}},{key:"listenDVSHooks",value:function value(e){var t=e.hooksService.hooks,i=function i(t){var i=e.viewerService.getDoc(t.docUid);i&&i.move(t.from,t.to);},r=function r(t){var i=e.viewerService.getDoc(t.docUid);i&&i.switch(t.one,t.other);},n=function n(t){var i=e.viewerService.getDoc(t.docUid);i&&i.reorder(t.indexes);},o=function o(t,i){var r=e.viewerService.getDoc(t);r&&r.removeOwner(i);},a=function a(t){var i=t.uid;e.viewerService.removeDoc(i);},s=function s(t){var i=t.name,r=t.uid;e.viewerService.renameDoc(i,r);},u=function u(t){e.viewerService.appendImagesToDoc(t.docUid,t.sourceUids,t.index);},l=function l(t){e.viewerService.removePagesFromDoc(t.docUid,t.sourceUids);},_c2=function c(){e.viewerService.destroy(),t.move.off(i),t.switch.off(r),t.reorder.off(n),t.removeTab.off(o),t.removeDoc.off(a),t.renameDoc.off(s),t.appendPagesToDoc.off(u),t.removePagesFromDoc.off(l),t.destroy.off(_c2);};t.move.on(i),t.switch.on(r),t.reorder.on(n),t.removeTab.on(o),t.removeDoc.on(a),t.renameDoc.on(s),t.appendPagesToDoc.on(u),t.removePagesFromDoc.on(l),t.destroy.on(_c2);}}]);}(),QH=function(){return Yk(function e(t){Xk(this,e),Wk(this,"context",void 0),Wk(this,"errorMessage","ok"),Wk(this,"errorCode",0),this.context=t;},[{key:"updateErrorMessage",value:function value(e){this.errorMessage=e.message,this.errorCode=e.code;}},{key:"err",value:function value(e){this.errorMessage=e.message,this.errorCode=e.code;}},{key:"destroy",value:function value(){this.errorMessage="",this.errorCode=null;}}]);}(),eF=Yk(function e(t){Xk(this,e),Wk(this,"context",void 0),Wk(this,"hooks",{init:SN.create(),destroy:SN.create(),beforeLoad:SN.create(),load:SN.create(),afterLoad:SN.create(),beforeRemove:SN.create(),remove:SN.create(),afterRemove:SN.create(),beforeUpdate:SN.create(),update:SN.create(),afterUpdate:SN.create(),move:SN.create(),switch:SN.create(),reorder:SN.create(),appendPagesToDoc:SN.create(),removePagesFromDoc:SN.create(),removeDoc:SN.create(),renameDoc:SN.create(),openDoc:SN.create(),beforeChangeBuffer:SN.create(),afterChangeBuffer:SN.create(),changePage:SN.create(),selectPage:SN.create(),beforeRender:SN.create(),render:SN.create(),afterRender:SN.create(),createViewer:SN.create(),removeViewer:SN.create(),afterLoadImage:SN.create(),error:SN.create(),log:SN.create(),rotate:SN.create(),scale:SN.create(),flip:SN.create(),mirror:SN.create(),crop:SN.create(),erase:SN.create(),changeSize:SN.create(),reset:SN.create(),overlay:SN.create(),beforeUndo:SN.create(),undo:SN.create(),beforeRedo:SN.create(),redo:SN.create(),layout:SN.create(),beforeSetSpace:SN.create(),afterSetSpace:SN.create(),focusChanged:SN.create(),checkVisibility:SN.create(),removeTab:SN.create()}),this.context=t;}),tF=function(){return Yk(function e(t){Xk(this,e),Wk(this,"imagePool",{}),Wk(this,"tasks",[]),Wk(this,"loaders",3),Wk(this,"loadTimer",null),Wk(this,"context",void 0),Wk(this,"isDestroyed",!1),this.context=t;},[{key:"destroy",value:function value(){this.context=null,this.tasks=[],this.loaders=0,this.isDestroyed=!0;}},{key:"checkVisibility",value:function value(e){return this.context.viewerService.isPageNeedLoad(e);}},{key:"load",value:function value(e){var t,i=this,r=this.context.spaceService.getStatus(e);r&&!r.isLoading&&(OI(t=this.tasks).call(t,e)<0&&(this.tasks.push(e),this.loading()),this.loadTimer||(this.loadTimer=$N.createTimer(function(){i.loading();},20)));}},{key:"loading",value:function value(){if(this.loaders>0)if(this.tasks.length)for(;this.tasks.length;){var e=this.tasks.shift();if(this.context.viewerService.isPageNeedLoad(e).ori&&(this.loaders-=1,this.run(e).catch(function(){})),this.loaders<1)break;}else this.loadTimer&&($N.clearTimer(this.loadTimer),this.loadTimer=null);}},{key:"run",value:(t=mb(vb().mark(function e(t){var i,r,n,o,a,s,u,l,c,h,d;return vb().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.context,r=i.spaceService,n=i.hooksService,o=i.viewerService,!(a=r.getStatus(t))){e.next=49;break;}if(a.isLoading=!0,s=WL(),a.oriTask=s,a.oriData){e.next=33;break;}return e.next=7,r.getOriginalData(t);case 7:if(u=e.sent,a.oriTask===s){e.next=12;break;}return e.next=11,this.run(t);case 11:return e.abrupt("return",void e.sent);case 12:if(o.isPageNeedLoad(t).ori){e.next=14;break;}return e.abrupt("return",(this.loaders+=1,void(a.isLoading=!1)));case 14:if(u&&u.oriData){e.next=24;break;}if(l=r.getExternalImageLoader()){e.next=18;break;}return e.abrupt("return",(this.loaders+=1,void(a.isLoading=!1)));case 18:return e.next=20,l.getImage(t);case 20:if(c=e.sent){e.next=23;break;}return e.abrupt("return",(this.loaders+=1,void(a.isLoading=!1)));case 23:u.oriData=c,r.updateOriginalData(t,u);case 24:if(h="",10!==document.documentMode){e.next=31;break;}return e.next=28,this.convertData(u.oriData);case 28:h=e.sent.data,e.next=32;break;case 31:h=vN(u.oriData).data;case 32:a.oriData=h;case 33:if(a.img&&(!a.img||a.img.src===a.oriData)){e.next=48;break;}if(!this.isDestroyed){e.next=36;break;}return e.abrupt("return");case 36:return e.next=38,this.loadImage(a.oriData);case 38:if(d=e.sent){e.next=41;break;}return e.abrupt("return",(this.loaders+=1,void(a.isLoading=!1)));case 41:if(a.oriTask===s){e.next=45;break;}return e.next=44,this.run(t);case 44:return e.abrupt("return",void e.sent);case 45:if(o.isPageNeedLoad(t).ori){e.next=47;break;}return e.abrupt("return",(this.loaders+=1,void(a.isLoading=!1)));case 47:a.img=d;case 48:a.isLoading=!1,n.hooks.afterLoadImage.emit(t,"ori");case 49:this.loaders+=1;case 50:case"end":return e.stop();}},e,this);})),function(e){return t.apply(this,arguments);})},{key:"convertData",value:function value(e){return new uB(function(t,i){if(kL(e))t(e);else{var r=new XMLHttpRequest();r.onload=function(){var e=vN(r.response);t(e);},r.open("GET",e,!0),r.responseType="blob",r.send();}});}},{key:"loadImage",value:(e=mb(vb().mark(function e(t){return vb().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new uB(function(e,i){var r=new Image();r.crossOrigin="Anonymous",r.onload=function(){r.onload=null,r.onerror=null,e(r);},r.onerror=function(t){r.onload=null,r.onerror=null,e(null);},r.src=t;}));case 1:case"end":return e.stop();}},e);})),function(t){return e.apply(this,arguments);})}]);var e,t;}(),iF=function(){return Yk(function e(t){Xk(this,e),Wk(this,"context",void 0),Wk(this,"layouts",[]),Wk(this,"head",void 0),this.context=t,this.use(new WH()),this.use(new AH()),this.use(new jH()),this.use(new qH()),this.init();},[{key:"use",value:function value(e){var t;OI(t=this.layouts).call(t,e)>-1||this.layouts.push(e);}},{key:"clear",value:function value(){this.layouts=[];}},{key:"layout",value:function value(e){0!==e.total?this.head.layout(e):e.layoutStatus.reset();}},{key:"destroy",value:function value(){this.head=null;}},{key:"init",value:function value(){var e=this.layouts;if(e.length){var t=e[0],i=null;this.head=t;for(var r=1,n=e.length;r<n;r++)i=e[r],t.setNext(i),t=i;}}}]);}(),rF=function(){return Yk(function e(t){Xk(this,e),Wk(this,"imagePool",{}),Wk(this,"tasks",[]),Wk(this,"loaders",3),Wk(this,"loadTimer",null),Wk(this,"context",void 0),Wk(this,"isDestroyed",!1),this.context=t;},[{key:"destroy",value:function value(){this.context=null,this.tasks=[],this.loaders=0,this.isDestroyed=!0;}},{key:"checkVisibility",value:function value(e){return this.context.viewerService.isPageNeedLoad(e);}},{key:"load",value:function value(e){var t,i=this,r=this.context.spaceService.getStatus(e);r&&!r.isMinLoading&&(OI(t=this.tasks).call(t,e)<0&&(this.tasks.push(e),this.loading()),this.loadTimer||(this.loadTimer=$N.createTimer(function(){i.loading();},20)));}},{key:"loading",value:function value(){if(this.loaders>0)if(this.tasks.length)for(;this.tasks.length;){var e=this.tasks.shift();if(this.context.viewerService.isPageNeedLoad(e).min&&(this.loaders-=1,this.run(e).catch(function(){})),this.loaders<1)break;}else this.loadTimer&&($N.clearTimer(this.loadTimer),this.loadTimer=null);}},{key:"run",value:(t=mb(vb().mark(function e(t){var i,r,n,o,a,s,u,l,c,h,d;return vb().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.context,r=i.spaceService,n=i.hooksService,o=i.viewerService,!(a=r.getStatus(t))){e.next=34;break;}if(a.isMinLoading=!0,s=WL(),a.minTask=s,a.minData){e.next=16;break;}return e.next=7,r.getOriginalData(t);case 7:if(u=e.sent,a.minTask===s){e.next=12;break;}return e.next=11,this.run(t);case 11:return e.abrupt("return",void e.sent);case 12:if(o.isPageNeedLoad(t).min){e.next=14;break;}return e.abrupt("return",(this.loaders+=1,void(a.isMinLoading=!1)));case 14:l=vN(u.minData||u.oriData).data,a.minData=l;case 16:if(a.minImg&&(!a.minImg||a.minImg.src===a.minData)){e.next=33;break;}if(!this.isDestroyed){e.next=19;break;}return e.abrupt("return");case 19:return e.next=21,this.loadImage(a.minData);case 21:if(c=e.sent){e.next=24;break;}return e.abrupt("return",(this.loaders+=1,void(a.isMinLoading=!1)));case 24:if(a.minTask===s){e.next=28;break;}return e.next=27,this.run(t);case 27:return e.abrupt("return",void e.sent);case 28:if(o.isPageNeedLoad(t).min){e.next=30;break;}return e.abrupt("return",(this.loaders+=1,void(a.isMinLoading=!1)));case 30:a.minImg=c,(h=r.space.getMetadata(t))&&(d=h.height/c.naturalHeight,a.imageScale=d);case 33:a.isMinLoading=!1,n.hooks.afterLoadImage.emit(t,"min");case 34:this.loaders+=1;case 35:case"end":return e.stop();}},e,this);})),function(e){return t.apply(this,arguments);})},{key:"loadImage",value:(e=mb(vb().mark(function e(t){return vb().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new uB(function(e,i){var r=new Image();r.crossOrigin="Anonymous",r.onload=function(){r.onload=null,r.onerror=null,e(r);},r.onerror=function(t){r.onload=null,r.onerror=null,e(null);},r.src=t;}));case 1:case"end":return e.stop();}},e);})),function(t){return e.apply(this,arguments);})}]);var e,t;}(),nF=function(){return Yk(function e(t){Xk(this,e),Wk(this,"context",void 0),this.context=t;},[{key:"getImageData",value:(e=mb(vb().mark(function e(t,i){var r=this;return vb().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new uB(function(e,n){var o=r.context.spaceService.getStatus(t);o||n(new Error("The page is not exist."));var _a2=function a(n,s){if("min"!==s&&n===t&&o.isSaving){o.isSaving=!1,r.context.hooksService.hooks.afterLoadImage.off(_a2);var u=o.img.naturalWidth,l=o.img.naturalHeight,c=[],h=[];if(r.context.editService){var d={operations:o.operations,width:o.img.naturalWidth,height:o.img.naturalHeight},f=r.context.editService.handle(d);u=f.width,l=f.height,c=f.matrixes,h=f.blanks;}var v=new LW({style:{x:0,y:0,img:o.img,width:o.img.naturalWidth,height:o.img.naturalHeight}});v.externalMatrixes=c;var g=new AW({style:{x:0,y:0,width:u,height:l,background:"#fff"}}),m=new AW();$k(h).call(h,function(e){var t=new WW({id:e.uid,style:{background:e.background,points:e.points,borderWidth:0}});m.appendChild(t);}),v.appendChild(m),g.appendChild(v),r.context.commonCanvas.render(g),r.context.commonCanvas.clear();var y=r.context.commonCanvas.getCanvas(),p=(null==i?void 0:i.type)||"imageData",w=(null==i?void 0:i.mime)||"image/png",b=(null==i?void 0:i.mime)||1,k=Math.max(u,l)||1;if(null!=i&&i.min&&k>720){var S=720/k,x=S*u,C=S*l,V=document.createElement("canvas");V.width=x,V.height=C;var T=V.getContext("2d",{willReadFrequently:!0});if(T.drawImage(y,0,0,Math.floor(u),Math.floor(l),0,0,x,C),"imageData"===p){var I=T.getImageData(0,0,x,C);e(I);}else"blob"===p&&V.toBlob(function(t){e(t);},w,b);}else if("imageData"===p){var E=y.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,u,l);e(E);}else"blob"===p&&y.toBlob(function(t){e(t);},w,b);}};r.context.hooksService.hooks.afterLoadImage.on(_a2),o.isSaving=!0,r.context.imageService.load(t);}));case 1:case"end":return e.stop();}},e);})),function(t,i){return e.apply(this,arguments);})}]);var e;}(),oF=function(){return Yk(function e(t,i){Xk(this,e),Wk(this,"context",void 0),Wk(this,"iSpace",void 0),this.context=t,this.iSpace=i||new mO();},[{key:"space",get:function get(){return this.iSpace;}},{key:"setSpace",value:function value(e){this.iSpace=e;}},{key:"getStatus",value:function value(e){return this.space.statusStore.get(e);}},{key:"getOriginalData",value:function value(e){return this.space.store.get(e);}},{key:"updateOriginalData",value:function value(e,t){return this.space.store.update(e,t);}},{key:"removeOriginalData",value:function value(e){return this.space.store.remove(e);}},{key:"getExternalImageLoader",value:function value(){return this.space.imageLoader;}},{key:"destroy",value:function value(){this.iSpace.destroy(),this.iSpace=null;}}]);}();function aF(e){var t;return lS(t="".concat(VL()," DVS: ")).call(t,e);}var sF=function(){return Yk(function e(t){Xk(this,e),Wk(this,"context",void 0),Wk(this,"logs",[]),Wk(this,"enableLog",!0),this.context=t,this.logs.push(aF("Initialize Log object."));},[{key:"updateLogMessage",value:function value(e){this.enableLog&&(null==this||this.logs.push(aF(e)));}},{key:"log",value:function value(e){this.enableLog&&(null==this||this.logs.push(aF(e)));}},{key:"clear",value:function value(){this.logs=[];}},{key:"destroy",value:function value(){this.logs=null;}}]);}(),uF=function(){return Yk(function e(t){Xk(this,e),Wk(this,"context",void 0),Wk(this,"docManager",void 0),Wk(this,"viewerManager",void 0),Wk(this,"isDestroyed",!1),Wk(this,"scrollbarWidth",0),this.context=t,this.docManager=new EH(),this.viewerManager=new ZH(),this.getScrollbarWidth();},[{key:"isPageNeedLoad",value:function value(e){for(var t={ori:!1,min:!1},i=this.viewerManager.getAllViewers(),r=0,n=i.length;r<n;r++){var o=this.context.spaceService.getStatus(e);o&&o.isSaving&&(t.ori=!0);var a=i[r].checkPageVisibility(e);a.min&&(t.min=!0),a.ori&&(t.ori=!0);}return t;}},{key:"destroy",value:function value(){var e,t=this;this.isDestroyed||($k(e=this.viewerManager.getAllViewers()).call(e,function(e){return t.removeViewer(e);}),this.docManager.destroy(),this.docManager=null,this.isDestroyed=!0);}},{key:"createViewer",value:function value(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=null,r=null,n=t.syncViewerUid;if(n){if(!(r=this.getViewer(n)))return this.context.errorService.err(mL),null;i=r.groupUid;}else i=WL();var o=bN.create(),a=this.context;o.save();var s,u=Fk(Fk({},t),{},{groupUid:i,emitter:o,dvsContext:a}),l=new a.dvs.subClasses.Viewer(u),c=l.uid;(o.restore(),this.context.hooksService.hooks.createViewer.emit({viewer:l}),this.viewerManager.addViewer(l,i),r)&&($k(s=r.getAllTabs()).call(s,function(t){var i;$k(i=t.children).call(i,function(t){var i=e.context.spaceService.getStatus(t.uid);i&&i.addOwner(c);}),e.docManager.getDoc(t.uid).addOwner(c);}),l.context.syncFromViewer(r));return this.context.trackerService.log("Invoking ViewerController#createViewer."),l;}},{key:"removeViewer",value:function value(e){var t,i=this;if(!e)return!1;var r=e;return TL(e)&&(r=this.viewerManager.getViewer(e)),!!r&&(this.viewerManager.removeViewer(r),$k(t=this.docManager.docs).call(t,function(e){var t;e.removeOwner(r.uid)&&$k(t=e.children).call(t,function(e){var t=i.context.spaceService.getStatus(e);t&&t.removeViewer(r.uid);});}),this.context.trackerService.log("Invoking ViewerController#removeViewer."),!0);}},{key:"getViewer",value:function value(e){return this.viewerManager.getViewer(e);}},{key:"openDoc",value:function value(e,t,i){var r,n=this,o=RI(r=e.children).call(r),a=this.docManager.getDoc(e.uid);a||(a=this.docManager.addDoc({uid:e.uid,name:e.name,type:t,children:[]},i)),a.children=o;var s=[];if(i){var u=this.viewerManager.getGroup(i);if(!u)return void this.context.errorService.err(mL);s=$E(u).call(u,function(e){return n.viewerManager.getViewer(e);});}else s=this.viewerManager.getAllViewers();$k(s).call(s,function(e){e&&(a.addOwner(e.uid),e.context.hooksService.hooks.openDoc.emit(a));});}},{key:"removeDoc",value:function value(e){this.docManager.getDoc(e)&&this.docManager.removeDoc(e);}},{key:"renameDoc",value:function value(e,t){var i=this.docManager.getDoc(t);i&&(i.name=e);}},{key:"removePagesFromDoc",value:function value(e,t){var i=this.docManager.getDoc(e);i&&$k(t).call(t,function(e){i.remove(e);});}},{key:"appendImagesToDoc",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=this.docManager.getDoc(e);if(r){var n=i>-1;$k(t).call(t,function(e,t){var o;OI(o=r.children).call(o,e)<0&&(n?r.insert(e,i+t):r.append(e));});}}},{key:"getDoc",value:function value(e){return this.docManager.getDoc(e);}},{key:"getScrollbarWidth",value:function value(){var e,t=document.createElement("div"),i=document.createElement("div");t.appendChild(i),t.style.width="60px",t.style.height="60px",t.style.position="absolute",t.style.overflow="auto",i.style.width="100px",i.style.height="100px",document.body.appendChild(t);var r=t.offsetWidth-t.clientWidth;document.body.removeChild(t),this.scrollbarWidth=r,$k(e=this.viewerManager.getAllViewers()).call(e,function(e){e.context.setScrollbarWidth(r);});}}]);}(),lF=function(){return Yk(function e(t){Xk(this,e),Wk(this,"context",void 0),Wk(this,"hermiteWorkerUrl",void 0),Wk(this,"workers",[]),Wk(this,"concurrency",navigator.hardwareConcurrency||4),Wk(this,"cores",0),this.context=t,this.createWorkerUlr();},[{key:"createWorkerUlr",value:function value(){this.hermiteWorkerUrl=zI.createObjectURL(new Blob(["(",_H.toString(),")()"],{type:"application/javascript"}));}},{key:"run",value:function value(e,t){var i=this;return new uB(function(r,n){var o=i.getWorker();o||n(new Error("There is no idle worker.")),o.running=!0,o.worker.onmessage=function(e){o.running=!1,r(e.data);},o.worker.onerror=function(e){o.running=!1,n(e);},t?o.worker.postMessage(e,[t]):o.worker.postMessage(e);});}},{key:"getWorker",value:function value(){for(var e=this.workers.length,t=0;t<e;t++)if(!this.workers[t].running)return this.workers[t];if(e<this.concurrency){var i={running:!1,worker:new Worker(this.hermiteWorkerUrl)};return this.workers.push(i),i;}return null;}},{key:"isWorkerIdle",value:function value(){for(var e=this.workers.length,t=0;t<e;t++)if(!this.workers[t].running)return!0;return e<this.concurrency;}}]);}(),cF=function(){return Yk(function e(t){Xk(this,e),Wk(this,"actorSystem",void 0),Wk(this,"context",void 0),Wk(this,"hermiteWorkerUrl",void 0),Wk(this,"concurrency",3),this.context=t,this.createWorkerUlr(),this.actorSystem=new KH(this.hermiteWorkerUrl,this.concurrency);},[{key:"createWorkerUlr",value:function value(){this.hermiteWorkerUrl=zI.createObjectURL(new Blob(["(",_H.toString(),")()"],{type:"application/javascript"}));}},{key:"optimize",value:function value(e,t,i,r,n,o){var a=this;return new uB(function(s,u){var l=e.getContext("2d"),c=Math.floor(t)||1,h=Math.floor(i)||1,d=l.getImageData(0,0,c,h),f={action:"optimize",data:{taskUid:o,sourceWidth:c,sourceHeight:h,width:Math.ceil(r)||1,height:Math.ceil(n)||1,source:d},callback:function callback(e){s(e);}};a.actorSystem.send(f,f.data.source);});}}]);}();function hF(e){var t,i=document.createElement("div");i.style.border=e,e=AS(t=i.style.border).call(t),i=null;var r=Gb(e.match(/(^\d+)p?x?\s+(\w+)\s+(.+)/)||[],4),n=r[1],o=r[2],a=r[3];if(CL(n)||CL(o)||CL(a))return{};var s=[];return"dashed"===o&&(s=[2*$S(n,10),$S(n,10)]),{borderWidth:n,lineDash:s,borderColor:a};}function dF(e,t,i){var r={isOver:!1,pointerX:-1,pointerY:-1,obj:e};if(e&&e.isVisible){var n=e.getPosition(),o=n.x,a=n.y,s=e.width,u=e.height;r.isOver=t>=o&&i>=a&&t<=o+s&&i<=a+u;var l=e.getScale();r.pointerX=(t-o)/l.x,r.pointerY=(i-a)/l.y;}return r;}function fF(e,t){return void 0===t&&(t=[e.getCurrentIndex()]),BL(t)&&(t=[t]),t;}function vF(e,t){var i;if(!bL(t))return e.err(fL),!1;if(0===t.length)return e.err(mL),!1;var r=e.getCurrentTab();if(!r)return!1;var n=pA(i=RI(t).call(t)).call(i,function(e,t){return e-t;});return n[0]<0||n[n.length-1]>r.total?(e.err(vL),!1):r;}var gF={tag:"div",id:"dvs-viewer",className:"dvs-viewer",children:[{tag:"div",id:"dvs-viewer-middle",className:"dvs-viewer-middle",children:[{tag:"div",id:"dvs-viewer-main",className:"dvs-viewer-main",children:[{tag:"div",id:"dvs-main-container",className:"dvs-main-container",children:[{tag:"div",id:"dvs-scroller-and-canvas",className:"dvs-scroller-and-canvas",children:[{tag:"div",id:"dvs-scroll-container",className:"dvs-scroll-container",children:[{tag:"div",id:"dvs-scroll-content",className:"dvs-scroll-content"}]},{tag:"div",id:"dvs-canvas-container",className:"dvs-canvas-container",children:[]}]},{tag:"div",id:"dvs-video-container",className:"dvs-video-container",children:[{tag:"img",id:"dvs-video-image",class:"dvs-video-image"}]}]}]}]}]},mF={tag:"div",id:"dvs-viewer",className:"dvs-viewer",children:[{tag:"div",id:"dvs-scroll-container",className:"dvs-scroll-container",children:[{tag:"div",id:"dvs-scroll-content",className:"dvs-scroll-content"}]},{tag:"div",id:"dvs-canvas-container",className:"dvs-canvas-container"}]},yF={viewerStyle:{background:"#434246"},canvasStyle:{cursor:"default"},pageStyle:{border:"4px solid #707070",background:"#e2e2e2"},selectedPageStyle:{background:"#6f76ff",border:"4px solid #e98b1f"},hoveredPageStyle:{background:"#a5a9fb",border:"4px solid #e98b1f"},placeholderStyle:{background:"#b5b5b5",border:"0px solid #f00"},pageNumberStyle:{visibility:"visible",width:24,height:24,background:"#fff",borderWidth:1,borderRadius:0,borderColor:"#000",opacity:.5,color:"#000",fontSize:12,fontFamily:"sans-serif",textAlign:"center",textBaseline:"middle",left:"",top:"",right:0,bottom:0},checkboxStyle:{visibility:"visible",width:24,height:24,background:"#fff",borderWidth:2,borderRadius:0,borderColor:"#000",opacity:.5,left:0,top:0},removeBtnStyle:{visibility:"visible",width:24,height:24,background:"#fff",borderWidth:1,borderRadius:"50%",borderColor:"#515151",opacity:1,left:"",top:-8,right:-8,bottom:"",checkMarkColor:"#ea2e2e"},enableDragPage:!0,enableKeyboardControl:!0,multiselectMode:!1,enableOptimizeImage:!1,zoomOrigin:{x:"center",y:"center"},zoom:1,minZoom:.02,maxZoom:8,enableZoom:!0,enableScrollX:!0,enableScrollY:!0,keepZoom:!0,zoomInDelta:1.2,zoomOutDelta:1.2,wheelZoomDelta:1.2,scrollDirection:"vertical",displayMode:"single",toolType:"default",fitType:"window",enableSlide:!0,show:!0,rows:1,columns:1,pure:!1,margin:10,gap:10,autoScroll:!0,autoChangeIndex:!0,autoSelectLatest:!0,enableSelectWithShift:!0,enableSelectWithCtrl:!0,enableZoomWithCtrl:!0,tabMode:"single",enableSyncSelect:!0,enableSingleModeBorder:!1,blankFillColor:"#fff",dragThreshold:3,slideThreshold:20,maxOptimizationSize:7e3,useMinImage:!0,enableDWT1x1:!1,enableEmitPageRendered:!0,autoSelectTopPage:!1,showVideoContainer:!1},pF=function(){return Yk(function e(){Xk(this,e);},[{key:"init",value:function value(e){this.listenDVSHooks(e),this.listenViewerHooks(e);}},{key:"listenDVSHooks",value:function value(e){var t=e.dvsContext.hooksService.hooks,i=function i(t,_i3){"min"===_i3?e.renderMinPage(t):e.renderPage(t);},r=function r(t){e.tabService.updateTab(t);},n=function n(t){e.tabService.movePage(t);},o=function o(t){e.tabService.switchPage(t);},a=function a(t){e.tabService.reorderPages(t);},s=function s(t){e.tabService.changePage(t);},u=function u(t){e.tabService.selectPage(t);},l=function l(t){e.tabService.appendPagesToDoc(t.docUid,t.sourceUids,t.index,t.isSameDoc);},c=function c(t){e.tabService.removePagesFromDoc(t.docUid,t.sourceUids);},h=function h(t){e.tabService.removeDoc(t);},d=function d(t,i){e.tabService.renameDoc(t,i);},f=function f(){e.tabCleared();},v=function v(t){e.isFocus=t===e.viewerUid;};t.afterLoadImage.on(i),t.afterUpdate.on(r),t.move.on(n),t.switch.on(o),t.reorder.on(a),t.changePage.on(s),t.selectPage.on(u),t.appendPagesToDoc.on(l),t.removePagesFromDoc.on(c),t.removeDoc.on(h),t.renameDoc.on(d),t.afterSetSpace.on(f),t.focusChanged.on(v),e.hooksService.hooks.destroy.on(function(){t.afterLoadImage.off(i),t.afterUpdate.off(r),t.move.off(n),t.switch.off(o),t.reorder.off(a),t.changePage.off(s),t.selectPage.off(u),t.appendPagesToDoc.off(l),t.removePagesFromDoc.off(c),t.removeDoc.off(h),t.renameDoc.off(d),t.afterSetSpace.off(f),t.focusChanged.off(v);});}},{key:"listenViewerHooks",value:function value(e){var t=e.hooksService.hooks,i=e.dvsContext.hooksService,r=function r(e){i.hooks.remove.emit(e);},n=function n(e){i.hooks.move.emit(e);},o=function o(e){i.hooks.switch.emit(e);},a=function a(e){i.hooks.reorder.emit(e);},s=function s(e){i.hooks.changePage.emit(e);},u=function u(e){i.hooks.selectPage.emit(e);},l=function l(e){i.hooks.focusChanged.emit(e);},c=function c(t){i.hooks.focusChanged.emit(t,e.viewerUid);},_h2=function h(){t.remove.off(r),t.move.off(n),t.switch.off(o),t.reorder.off(a),t.changePage.off(s),t.selectPage.off(u),t.focusChanged.off(l),t.removeTab.off(c),e.hooksService.hooks.destroy.off(_h2);};t.remove.on(r),t.move.on(n),t.switch.on(o),t.reorder.on(a),t.changePage.on(s),t.selectPage.on(u),t.focusChanged.on(l),t.removeTab.on(c),e.hooksService.hooks.destroy.on(_h2);}}]);}(),wF=Yk(function e(){Xk(this,e);});function bF(e,t){if(e.tabUid===t.uid)return!0;if("tag"===e.tabType)for(var i=t.total,r=0;r<i;r++){var n;if(OI(n=e.uids).call(n,t.getChildByIndex(r).uid)>-1)return!0;}return!1;}var kF=function(){return Yk(function e(){Xk(this,e),Wk(this,"undoStack",[]),Wk(this,"redoStack",[]);},[{key:"execute",value:function value(e){e.execute(),this.undoStack.push(e),this.redoStack.length>0&&(this.redoStack.length=0);}},{key:"undo",value:function value(e){var t,i=EE(t=this.undoStack).call(t,function(t){return t.uid===e;});if(i>-1){var r,n=this.undoStack[i];gE(r=this.undoStack).call(r,i,1),n.undo(),this.redoStack.push(n);}}},{key:"redo",value:function value(e){var t,i=EE(t=this.redoStack).call(t,function(t){return t.uid===e;});if(i>-1){var r,n=this.redoStack[i];gE(r=this.redoStack).call(r,i,1),n.execute(),this.undoStack.push(n);}}},{key:"removeUidsFromCommand",value:function value(e){this.removeFromStack(this.undoStack,e),this.removeFromStack(this.redoStack,e);}},{key:"removeFromStack",value:function value(e,t){var i;$k(i=RI(e).call(e)).call(i,function(i){var r,n=i.action.uids;if(n&&($k(r=RI(n).call(n)).call(r,function(e){if(OI(t).call(t,e)>-1){var i=OI(n).call(n,e);gE(n).call(n,i,1);}}),!n.length)){var o=OI(e).call(e,i);gE(e).call(e,o,1);}});}},{key:"reset",value:function value(){this.undoStack=[],this.redoStack=[];}}]);}(),SF=function(){return Yk(function e(){Xk(this,e);},[{key:"init",value:function value(e){var t=e.dvsContext.hooksService.hooks,i=t.undo,r=t.redo,n=t.reset,o=t.afterUpdate,a=function a(t){var i,r=t.commandUid;t.trigger,$k(i=e.tabService.getAllTabs()).call(i,function(t){var i=t.commandController.undoStack.length,n=t.commandController.undoStack[i-1];(null==n?void 0:n.uid)===r&&(t.commandController.undo(r),e.tabService.isCurrentTab(t.uid)&&e.render());});},s=function s(t){var i,r=t.commandUid;t.trigger,$k(i=e.tabService.getAllTabs()).call(i,function(t){var i=t.commandController.redoStack.length,n=t.commandController.redoStack[i-1];(null==n?void 0:n.uid)===r&&(t.commandController.redo(r),e.tabService.isCurrentTab(t.uid)&&e.render());});},u=function u(t){var i,r=t.uids;$k(i=e.tabService.getAllTabs()).call(i,function(i){bF(t,i)&&(i.commandController.removeUidsFromCommand(r),e.tabService.isCurrentTab(i.uid)&&e.render());});};i.on(a),r.on(s),n.on(u),e.hooksService.hooks.destroy.on(function(){i.off(a),r.off(s),n.off(u);});var l=e.hooksService.hooks.removePagesFromDoc,c=function c(t,i){var r=e.tabService.getTab(t);r&&r.commandController.removeUidsFromCommand(i);},h=function h(t){var i;$k(i=e.tabService.getAllTabs()).call(i,function(e){e.commandController.removeUidsFromCommand([t.modifiedUid]);});};l.on(c),o.on(h),e.hooksService.hooks.destroy.on(function(){l.off(c),o.off(h);});}}]);}();function xF(e,t){var i,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=-1,o=-1,a=0,s=0,u={canvasOffsetX:-1,canvasOffsetY:-1,containerOffsetX:-1,containerOffsetY:-1},l=e.pageX,c=e.pageY,h=Gb(t.formatTouches(e,r),1)[0],d=t.getPointerOverPageInfo(h.pageX,h.pageY);if((i=d.index)>=0){var f;u.canvasOffsetX=Math.round(10*d.pageInfo.pagePositionX)/10,u.canvasOffsetY=Math.round(10*d.pageInfo.pagePositionY)/10,a=Math.round(10*d.pageInfo.pageWidth)/10,s=Math.round(10*d.pageInfo.pageHeight)/10;var v=t.rendererService,g=t.uiService.container;null!==(f=t.viewer)&&void 0!==f&&f.isThumbnail&&(g=t.viewer.thumbnailObject.viewer.context.uiService.container);var m=v.canvasDom,y=g.getBoundingClientRect(),p=y.left,w=y.top,b=m.getBoundingClientRect(),k=b.left,S=b.top;u.containerOffsetX=Math.round(10*(k-p+d.pageInfo.pagePositionX))/10,u.containerOffsetY=Math.round(10*(S-w+d.pageInfo.pagePositionY))/10;}if(d.imageInfo.isOver){n=d.imageInfo.pointerX,o=d.imageInfo.pointerY;var x=t.getCurrentTab();if(x){var C=x.getChildByIndex(i);if(C){var V=t.getStatus(C.uid);if(V&&"multiple"===t.config.displayMode&&t.config.useMinImage){var T=V.imageScale;n*=T,o*=T;}}}}return{index:i,imageX:n,imageY:o,pageX:l,pageY:c,pageWidth:a,pageHeight:s,position:u};}var CF=function(){return Yk(function e(){Xk(this,e);},[{key:"init",value:function value(e){var t,i,r,n,o=e.rendererService.canvasDom,a=0,s=0,u=0,l=0,c=!1,h=!1,d=null,f=!1,v=null,g=null,m=function m(){g&&(clearTimeout(g),g=null),v?g=jP(function(){e.externalResized();},50):v=jP(function(){e.externalResized(),v=null;},42);},y=function y(t){e.isFocus&&e.emit("keyup",t);},p=function p(t){e.isFocus&&e.emit("keydown",t);},w=function w(t){e.hooksService.hooks.focusChanged.emit("");},b=function b(t){var i=xF(t,e);e.emit("click",i,t),e.hooksService.hooks.focusChanged.emit(e.viewerUid),t.stopPropagation();},k=null,S=function S(i){if(0===i.button){var n=xF(i,e);e.emit("mousedown",n,i),h=!0;var o=i.pointerType;"mouse"===o?e.draggingPrepared=!0:"touch"!==o&&"pen"!==o||"multiple"!==e.config.displayMode||(k=jP(function(){e.draggingPrepared=!0;},300));var c=Gb(e.formatTouches(i),1)[0],d=e.getPointerOverPageInfo(c.pageX,c.pageY).pageInfo.obj,f=e.tabService.getCurrentTab();if(f){var v=e.config;if(d&&"multiple"===v.displayMode&&!i.ctrlKey){var g=f.getChildIndex(d);if(i.shiftKey&&v.enableSelectWithShift||v.multiselectMode){if(i.shiftKey&&v.enableSelectWithShift&&(d!==f.currentPage||1!==f.selected.length)){var m=f.getIndexByUid(f.shiftReference);if(m>-1){var y,p=Math.min(g,m),w=Math.max(g,m)-p+1,b=[];e.isSelectedBorderWidthEqualHovered()||d.clearOptimization();for(var S=0;S<w;S++){var x,C=f.getChildByIndex(p+S);OI(x=f.selected).call(x,C.uid)<0&&C.uid!==d.uid&&!e.isSelectedBorderWidthEqualNormal()&&C.clearOptimization(),b.push(C.uid);}g<m&&BA(b).call(b);var V={selectedUids:b,indexes:[],docUid:f.uid,trigger:e.viewerUid,groupUid:e.groupUid,operation:"shift",updateShiftReference:!1};$k(y=f.selected).call(y,function(t){if(OI(b).call(b,t)<0&&!e.isSelectedBorderWidthEqualNormal()){var i=f.getChildByUid(t);i&&i.clearOptimization();}}),e.hooksService.hooks.selectPage.emit(V);}}}else{var T=f.selected,I=OI(T).call(T,d.uid)>-1;if(f.currentPage!==d&&T.length<2||!I){var E,P={index:g,docUid:f.uid,trigger:e.viewerUid,groupUid:e.groupUid,operation:"shift"};$k(E=f.selected).call(E,function(t){var i=f.getChildByUid(t);i&&(e.isSelectedBorderWidthEqualNormal()||i.clearOptimization());}),e.isSelectedBorderWidthEqualHovered()||d.clearOptimization(),e.hooksService.hooks.changePage.emit(P);}}}if(d){var B;u=c.pageX,l=c.pageY;var D=d.getPosition();a=c.pageX-D.x,s=c.pageY-D.y,t=d,r=RI(B=f.children).call(B);}}}},x=function x(r){var o,v,g=xF(r,e);e.emit("mousemove",g,r),h&&!1===e.draggingPrepared&&k&&(clearTimeout(k),k=null);var m=Gb(e.formatTouches(r),1)[0],y=e.tabService.getCurrentTab();if(y){var p=e.config,w=e.getPointerOverPageInfo(m.pageX,m.pageY).pageInfo.obj,b=y.getChildIndex(d),S=!1,x=!1,C=!1,V=!1;if(w?d?d!==w&&(c||(d.isSelected||e.isBorderWidthEqualHovered()||d.clearOptimization(),w.isSelected||e.isBorderWidthEqualHovered()||w.clearOptimization()),C=!0,S=!0,d=w):(c||w.isSelected||e.isBorderWidthEqualHovered()||w.clearOptimization(),f||(V=!0),S=!0,d=w,f=!1):d&&(c||d.isSelected||e.isBorderWidthEqualHovered()||d.clearOptimization(),C=!0,x=!0,d=null),y&&"multiple"===p.displayMode)if(c){var T,I,E,P;if(w)if(!(OI(P=y.selected).call(P,w.uid)>-1)){var B,D,M,z,U,A=pA(B=$E(D=y.selected).call(D,function(e){return y.getIndexByUid(e);})).call(B,function(e,t){return e-t;}),R=A[0],L=y.getChildIndex(w),N=RI(M=y.children).call(M);$k(z=BA(U=RI(A).call(A)).call(U)).call(z,function(e){gE(N).call(N,e,1);});var O=OI(N).call(N,w);L>R&&(O+=1),$k(n).call(n,function(e,t){var i=y.getChildByUid(e.uid);gE(N).call(N,O+t,0,i);}),i=$E(N).call(N,function(e){return y.getChildIndex(e);}),y.reorder(i),e.layoutService.layout(y);}$k(T=y.selected).call(T,function(e){var t=y.getChildByUid(e);t.borderBox.setPosition({x:m.pageX-a,y:m.pageY-s}),t.isDragging=!0,t.borderBox.updateStyle({visibility:"hidden"});}),null!==(I=t)&&void 0!==I&&I.updateStyle({zIndex:1}),null!==(E=t)&&void 0!==E&&E.borderBox.updateStyle({visibility:"visible"}),e.render();}else if(w&&w===t&&OI(o=y.selected).call(o,w.uid)>-1&&"crop"!==p.toolType&&e.draggingPrepared){var W,H;Math.pow(Math.pow(m.pageX-u,2)+Math.pow(m.pageY-l,2),.5)>=p.dragThreshold&&t&&p.enableDragPage&&(c=!0,n=pA(W=$E(H=y.selected).call(H,function(e){return{uid:e,index:y.getIndexByUid(e)};})).call(W,function(e,t){return e.index-t.index;}));}var F=!1;y&&r instanceof MouseEvent&&$k(v=y.children).call(v,function(e){w&&w.uid===e.uid?(e.isHovered||(F=!0),e.isHovered=!0):(e.isHovered&&(F=!0),e.isHovered=!1);}),F&&"multiple"===p.displayMode&&e.render(),V&&e.emit("mouseout",Fk(Fk({},g),{},{index:-1}),r,"canvas"),C&&e.emit("mouseout",Fk(Fk({},g),{},{index:b}),r,"page"),S&&e.emit("mouseover",Fk({},g),r,"page"),x&&e.emit("mouseover",Fk(Fk({},g),{},{index:-1}),r,"canvas");}},C=function C(t){if(0===t.button){var i=xF(t,e,!0);e.emit("mouseup",i,t);}},V=function V(o){if(0===o.button&&"annotation"!==e.config.toolType&&h){o instanceof MouseEvent?e.draggingPrepared=!1:o instanceof TouchEvent&&(k&&(clearTimeout(k),k=null),e.draggingPrepared=!1);var a=Gb(e.formatTouches(o,!0),1)[0],s=e.tabService.getCurrentTab();if(s){var u=e.getPointerOverPageInfo(a.pageX,a.pageY).pageInfo.obj;if(c){var l;if(i){var d,f=$E(d=s.children).call(d,function(e){return OI(r).call(r,e);});s.childNodes=r;var v={indexes:f,trigger:e.viewerUid,docUid:s.uid,type:s.type,operation:"shift"};e.hooksService.hooks.reorder.emit(v),i=null;}null==s||$k(l=s.selected).call(l,function(e){var t=s.getChildByUid(e);t.borderBox.setLocalPosition({x:0,y:0}),t.isDragging=!1,t.borderBox.updateStyle({visibility:"visible"});});var g=[];$k(n).call(n,function(e){var t=s.getIndexByUid(e.uid);g.push([e.index,t]);}),e.emit("dragdone",g);}else if(u&&t===u&&"multiple"===e.config.displayMode&&!o.shiftKey)if(o.ctrlKey&&e.config.enableSelectWithCtrl||e.config.multiselectMode){var m,y=RI(m=s.selected).call(m),p=OI(y).call(y,u.uid),w=!1;if(p>-1?(o.ctrlKey&&y.length>1||e.config.multiselectMode)&&(gE(y).call(y,p,1),w=!0):(y.push(u.uid),w=!0),w){var b={selectedUids:y,indexes:[],docUid:s.uid,trigger:e.viewerUid,groupUid:e.groupUid,operation:"shift"};e.isSelectedBorderWidthEqualHovered()||u.clearOptimization(),e.hooksService.hooks.selectPage.emit(b);}}else if((!o.ctrlKey||!o.shiftKey)&&s.selected.length>1){var S,x={index:s.getChildIndex(u),docUid:s.uid,trigger:e.viewerUid,groupUid:e.groupUid,operation:"shift"};$k(S=s.selected).call(S,function(t){var i=s.getChildByUid(t);i&&(e.isSelectedBorderWidthEqualNormal()||i.clearOptimization());}),e.isSelectedBorderWidthEqualHovered()||u.clearOptimization(),e.hooksService.hooks.changePage.emit(x);}if(s&&"multiple"===e.config.displayMode){var C;if("visible"===e.config.removeBtnStyle.visibility){var V=e.getHitRemoveBtn(a.pageX,a.pageY);V>-1&&e.emit("removeBtnClick",V);}null!==(C=t)&&void 0!==C&&C.updateStyle({zIndex:0}),t=null,c=!1,e.render();}h=!1,t=null;}}},T=function T(t){f=!0;var i=xF(t,e);e.emit("mouseover",i,t);},I=function I(t){var i=e.tabService.getCurrentTab(),r=xF(t,e);if(i){var n;if(d){var o=i.getChildIndex(d);r.index=o;}d=null,e.emit("mouseout",r,t),i&&($k(n=i.children).call(n,function(e){e.isHovered=!1;}),"multiple"===e.config.displayMode&&e.rendererService.render());}},E=function E(t){var i=xF(t,e);e.emit("dblclick",i,t);},P=function P(t){var i=xF(t,e);e.emit("wheel",i,t);},B=function B(t){t.preventDefault();var i=xF(t,e);e.emit("contextmenu",i,t);},D=function D(e){},M=function M(e){e.preventDefault();},z=function z(t){t.preventDefault(),e.emit("drop",t);},U=function U(t){if(!e.isDestroyed){e.emit("scroll",t);var i=e.getCurrentTab();if(i){var r,n=t.target,o=n.scrollLeft,a=n.scrollTop;if(i.setPosition({x:-o,y:-a}),e.layoutService.layout(i),i.updateLayoutStatus({scrollLeft:o,scrollTop:a}),$k(r=i.children).call(r,function(t){!t.isPreload||t.isLoaded||t.imageContainer.imageData||("multiple"===e.config.displayMode&&e.config.useMinImage?e.dvsContext.minImageService.load(t.uid):e.dvsContext.imageService.load(t.uid));}),e.scrollerService.updateScroller({scrollLeft:o,scrollTop:a}),i&&i.isTopPageChanged&&!i.isLoadPage){var s=i.getIndexByUid(i.topPageUid);if(e.config.autoSelectTopPage){i.current=s,i.select([i.currentUid]);var u={selectedUids:[i.currentUid],indexes:[s],docUid:i.uid,trigger:e.viewerUid,groupUid:e.groupUid,operation:"shift",triggerByScroll:!0};e.getLocalHooks().selectPage.emit(u),e.layoutService.layout(i);}}i.isLoadPage&&(i.isLoadPage=!1),e.render();}}};window.addEventListener("resize",m),document.addEventListener("keydown",p),document.addEventListener("keyup",y),document.addEventListener("click",w),o.addEventListener("click",b),window.PointerEvent?(o.addEventListener("pointerdown",S),o.addEventListener("pointermove",x),o.addEventListener("pointerup",C),document.addEventListener("pointerup",V)):window.MSPointerEvent&&(o.addEventListener("MSPointerDown",S),o.addEventListener("MSPointerMove",x),o.addEventListener("MSPointerUp",C),document.addEventListener("MSPointerUp",V)),o.addEventListener("touchmove",function(e){e.cancelable&&e.preventDefault();},{passive:!1}),o.addEventListener("blur",function(){e.hooksService.hooks.focusChanged.emit("");}),o.addEventListener("focus",function(t){e.hooksService.hooks.focusChanged.emit(e.viewerUid);}),o.addEventListener("mouseover",T),o.addEventListener("mouseout",I),o.addEventListener("dblclick",E),o.addEventListener("wheel",P,{passive:!0}),o.addEventListener("contextmenu",B),o.addEventListener("dragstart",D),o.addEventListener("dragover",M),e.uiService.defaultDom.addEventListener("drop",z),e.uiService.hooks.scroll.on(U);var _A2=function A(){v&&clearTimeout(v),g&&clearTimeout(g),k&&clearTimeout(k),window.removeEventListener("resize",m),document.removeEventListener("keydown",p),document.removeEventListener("keyup",y),document.removeEventListener("click",w),o.removeEventListener("click",b),window.PointerEvent?(o.removeEventListener("pointerdown",S),o.removeEventListener("pointermove",x),o.removeEventListener("pointerup",C),document.removeEventListener("pointerup",V)):window.MSPointerEvent&&(o.removeEventListener("MSPointerDown",S),o.removeEventListener("MSPointerMove",x),o.removeEventListener("MSPointerUp",C),document.removeEventListener("MSPointerUp",V)),o.removeEventListener("pointerdown",S),o.removeEventListener("pointermove",x),o.removeEventListener("pointerup",C),document.removeEventListener("pointerup",V),o.removeEventListener("mouseover",T),o.removeEventListener("mouseout",I),o.removeEventListener("dblclick",E),o.removeEventListener("wheel",P),o.removeEventListener("contextmenu",B),o.removeEventListener("dragstart",D),o.removeEventListener("dragover",M),e.uiService.defaultDom.removeEventListener("drop",z),e.hooksService.hooks.destroy.off(_A2),e.uiService.hooks.scroll.off(U);};e.hooksService.hooks.destroy.on(_A2);}}]);}(),VF={visibility:"hidden",left:0,top:0,right:"",bottom:"",width:"24px",height:"24px",opacity:1,borderWidth:1,borderRadius:0,background:"#ffffff",borderColor:"#000000",checkMarkColor:"#000000",checkMarkLineWidth:"2px",translateX:0,translateY:0},TF=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_SL(VF);return Xk(this,t),Wk(yb(e=cL(this,t,[{style:{visibility:"visible"===i.visibility?"visible":"hidden"}}])),"shapeType","checkbox"),Wk(yb(e),"checkBoxStyle",void 0),Wk(yb(e),"parsedCheckBoxStyle",void 0),Wk(yb(e),"isChecked",!1),e.checkBoxStyle=Fk(Fk({},VF),i),e;}return _b(t,e),Yk(t,[{key:"checked",get:function get(){return this.isChecked;},set:function set(e){this.isChecked=e;}},{key:"updateStyle",value:function value(e){this.checkBoxStyle=Fk(Fk({},this.checkBoxStyle),e),this.style.visibility=this.checkBoxStyle.visibility;}}]);}(mW),IF={visibility:"hidden",left:"",top:"",right:0,bottom:0,width:"24px",height:"24px",opacity:1,borderWidth:1,borderRadius:"50%",background:"#ffffff",borderColor:"#a79898",color:"#a79898",fontFamily:"sans-serif",fontSize:12,translateX:0,translateY:0},EF=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_SL(IF),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0";return Xk(this,t),Wk(yb(e=cL(this,t,[{style:{visibility:"visible"===i.visibility?"visible":"hidden"}}])),"shapeType","pageNumber"),Wk(yb(e),"pageNumberStyle",void 0),Wk(yb(e),"text",void 0),Wk(yb(e),"parsedPageNumberStyle",void 0),e.text=r,e.pageNumberStyle=Fk(Fk({},IF),i),e;}return _b(t,e),Yk(t,[{key:"updateText",value:function value(e){this.text=e;}},{key:"updateStyle",value:function value(e){this.pageNumberStyle=Fk(Fk({},this.pageNumberStyle),e),this.style.visibility="visible"===this.pageNumberStyle.visibility?"visible":"hidden";}}]);}(mW),PF={visibility:"hidden",left:"",top:0,right:0,bottom:"",width:"24px",height:"24px",borderWidth:1,borderRadius:0,background:"#ffffff",borderColor:"#000000",checkMarkColor:"#ff0000",checkMarkLineWidth:"2px",translateX:0,translateY:0},BF=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_SL(PF);return Xk(this,t),Wk(e=cL(this,t,[i]),"shapeType","removeBtn"),e;}return _b(t,e),Yk(t);}(TF),DF=function(e){function t(e){var i;Xk(this,t),Wk(yb(i=cL(this,t,[e])),"uid",void 0),Wk(yb(i),"isSelected",!1),Wk(yb(i),"isPreload",!1),Wk(yb(i),"isMouseover",!1),Wk(yb(i),"isLoaded",!1),Wk(yb(i),"blanks",void 0),Wk(yb(i),"overlays",void 0),Wk(yb(i),"image",void 0),Wk(yb(i),"borderBox",void 0),Wk(yb(i),"imageContainer",void 0),Wk(yb(i),"checkbox",void 0),Wk(yb(i),"pageNumber",void 0),Wk(yb(i),"removeBtn",void 0),Wk(yb(i),"isHovered",!1),Wk(yb(i),"isDragging",!1),Wk(yb(i),"viewportPosition",void 0),Wk(yb(i),"isPageRendered",!1),Wk(yb(i),"isEdited",!1),Wk(yb(i),"isUpdated",!1),Wk(yb(i),"isOptimized",!1),Wk(yb(i),"optimizationUid",null),Wk(yb(i),"optimizedUid",null),Wk(yb(i),"realTimeWidth",void 0),Wk(yb(i),"realTimeHeight",void 0),Wk(yb(i),"zoom",1),Wk(yb(i),"imageScale",1),i.uid=e.uid,i.realTimeWidth=e.realTimeWidth,i.realTimeHeight=e.realTimeHeight,i.updateStyle(e.style);var r=new LW({id:i.uid,style:{x:0,y:0}}),n=new AW({style:{x:0,y:0}});n.clippable=!0;var o=new AW({style:Fk(Fk({},e.style),e.formattedPageStyle)}),a=new TF(Fk({},e.checkboxStyle)),s=new EF(Fk({},e.pageNumberStyle),"0"),u=new BF(Fk({},e.removeBtnStyle)),l=new AW(),c=new AW();return r.appendChild(l),i.appendChild(o),n.appendChild(r),n.appendChild(c),o.appendChild(n),o.appendChild(s),o.appendChild(a),o.appendChild(u),i.pageNumber=s,i.checkbox=a,i.removeBtn=u,i.image=r,i.borderBox=o,i.imageContainer=n,i.blanks=l,i.overlays=c,i.initEvent(),i;}return _b(t,e),Yk(t,[{key:"initEvent",value:function value(){var e=this;this.addEventListener("mouseover",function(){e.isMouseover=!0;}),this.addEventListener("mouseout",function(){e.isMouseover=!1;}),this.addEventListener("mouseup",function(){e.isMouseover=!1;});}},{key:"getImage",value:function value(){return this.image;}},{key:"updateImage",value:function value(e){this.image.style.img=e;}},{key:"clearOptimization",value:function value(){var e;this.isOptimized=!1,null!=this&&null!==(e=this.imageContainer)&&void 0!==e&&e.imageData&&(this.imageContainer.imageData=null),this.optimizationUid=WL();}},{key:"destroy",value:function value(){this.clearOptimization(),this.image.style.img=null,this.image=null,this.imageContainer=null,this.overlays=null,this.blanks=null;}}]);}(AW),MF=function(){return Yk(function e(t,i,r,n){Xk(this,e),Wk(this,"id",void 0),Wk(this,"duration",void 0),Wk(this,"step",void 0),Wk(this,"verify",void 0),Wk(this,"complete",void 0),Wk(this,"active",!1),Wk(this,"effect",void 0),Wk(this,"fps",60),this.id=WL(),this.step=t,this.complete=i,this.duration=r,this.effect=n;},[{key:"play",value:function value(){var e=this,t=LA(),i=t,r=0,_n3=function n(o){var a=LA();if(e.active&&!e.verify(e.id)){var s=!0!==o;if(s)for(var u=Math.round((a-i)/(1e3/e.fps))-1,l=0;l<Math.min(u,4);l++)_n3(!0);e.duration&&(r=(a-t)/e.duration)>1&&(r=1);var c=e.effect(r);!1!==e.step(c,s)&&1!==r||!s?s&&(i=a,requestAnimationFrame(_n3)):(e.active=!1,e.complete(e.id,1===r||null===e.duration));}else e.complete(e.id,!1);};return this.active=!0,requestAnimationFrame(_n3),this.id;}},{key:"cancel",value:function value(){var e=!0===this.active;return e&&(this.active=!1),e;}},{key:"pause",value:function value(){}}]);}(),zF=function(e){function t(){var e;return Xk(this,t),Wk(yb(e=cL(this,t)),"viewportWidth",void 0),Wk(yb(e),"viewportHeight",void 0),Wk(yb(e),"contentWidth",void 0),Wk(yb(e),"contentHeight",void 0),Wk(yb(e),"scrollingX",!0),Wk(yb(e),"scrollingY",!0),Wk(yb(e),"scrollLeft",0),Wk(yb(e),"scrollTop",0),Wk(yb(e),"maxScrollLeft",0),Wk(yb(e),"maxScrollTop",0),Wk(yb(e),"zoom",1),Wk(yb(e),"minZoom",.01),Wk(yb(e),"maxZoom",8),Wk(yb(e),"zooming",!0),Wk(yb(e),"locking",!1),Wk(yb(e),"animating",!1),Wk(yb(e),"animationDuration",300),Wk(yb(e),"moveThreshold",5),Wk(yb(e),"scrollThreshold",3),Wk(yb(e),"moveSpeed",1),Wk(yb(e),"decelerationVelocityThreshold",1),Wk(yb(e),"startX",0),Wk(yb(e),"startY",0),Wk(yb(e),"startZoom",1),Wk(yb(e),"lastX",0),Wk(yb(e),"lastY",0),Wk(yb(e),"lastScale",0),Wk(yb(e),"lastTimeStamp",0),Wk(yb(e),"futureLeft",0),Wk(yb(e),"futureTop",0),Wk(yb(e),"futureZoom",0),Wk(yb(e),"isStart",!1),Wk(yb(e),"isMoving",!1),Wk(yb(e),"originLeft",0),Wk(yb(e),"originTop",0),Wk(yb(e),"decelerationVelocityX",0),Wk(yb(e),"decelerationVelocityY",0),Wk(yb(e),"enableScrollX",!0),Wk(yb(e),"enableScrollY",!0),Wk(yb(e),"interruptedAnimation",!1),Wk(yb(e),"isDecelerating",!1),Wk(yb(e),"decelerationId",void 0),Wk(yb(e),"isAnimating",!1),Wk(yb(e),"animationId",void 0),Wk(yb(e),"isSingleTouch",!1),Wk(yb(e),"isProcessing",!1),Wk(yb(e),"isDecelerationComplete",!1),Wk(yb(e),"isDragging",!1),Wk(yb(e),"positions",[]),Wk(yb(e),"hooks",{zoomComplete:SN.create(),scrollComplete:SN.create(),publish:SN.create(),beforeZoom:SN.create(),zoomTo:SN.create()}),Wk(yb(e),"animations",{}),e.viewportWidth=800,e.viewportHeight=800,e;}return _b(t,e),Yk(t,[{key:"updateScroller",value:function value(e){LU(this,e),this.calcMaxScroll();}},{key:"setOrigin",value:function value(e,t){this.originLeft=e,this.originTop=t;}},{key:"initScroller",value:function value(e){LU(this,e);}},{key:"zoomTo",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(this.zooming){this.zoom;var n=this.minZoom,o=this.maxZoom;this.viewportWidth,this.viewportHeight;var a=this.scrollLeft,s=this.scrollTop;this.maxScrollLeft,this.maxScrollTop,CL(i)&&(i=this.originLeft),CL(r)&&(r=this.originTop),this.hooks.beforeZoom.emit(i,r),e=HL(e,n,o),this.publish(a,s,e,t);}}},{key:"zoomBy",value:function value(e,t,i,r){this.zoomTo(this.zoom*e,t,i,r);}},{key:"scrollTo",value:function value(e,t,i,r){this.enableScrollX&&(this.scrollLeft=e),this.enableScrollY&&(this.scrollTop=t);var n=this.scrollLeft,o=this.scrollTop;this.emit("_scrollChanged",{scrollLeft:n,scrollTop:o});}},{key:"scrollBy",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.scrollTo(e+this.scrollLeft,t+this.scrollTop,i);}},{key:"canScroll",value:function value(){return this.contentWidth>this.viewportWidth||this.contentHeight>this.viewportHeight;}},{key:"onStartHandler",value:function value(e,t){if(this.canScroll()&&!this.isMoving){var i,r;this.isStart=!0,t instanceof Date&&(t=t.valueOf()),this.interruptedAnimation=!0,this.isDecelerating&&(this.cancelAnimate(this.decelerationId),this.isDecelerating=!0),this.isAnimating&&(this.cancelAnimate(this.animationId),this.isAnimating=!1);var n=1===e.length;n?(i=e[0].pageX,r=e[0].pageY):(i=Math.abs(e[0].pageX+e[1].pageX)/2,r=Math.abs(e[0].pageY+e[1].pageY)/2),this.startX=i,this.startY=r,this.startZoom=this.zoom,this.lastX=i,this.lastY=r,this.lastScale=1,this.lastTimeStamp=t,this.enableScrollX=this.scrollingX&&n,this.enableScrollY=this.scrollingY&&n,this.isProcessing=!0,this.isDecelerationComplete=!1,this.isDragging=!n,this.isSingleTouch=n,this.positions=[];}}},{key:"onMoveHandler",value:function value(e,t,i){if(this.canScroll()&&this.isStart){var r,n;t instanceof Date&&(t=t.valueOf());var o=1===e.length,a=this.positions;if(o?(r=e[0].pageX,n=e[0].pageY):(r=Math.abs(e[0].pageX+e[1].pageX)/2,n=Math.abs(e[0].pageY+e[1].pageY)/2),this.isDragging){var s=r-this.lastX,u=n-this.lastY,l=this.scrollLeft,c=this.scrollTop,h=this.zoom;if(!CL(i)&&this.zooming){var d=h;h=h/this.lastScale*i,d!==(h=HL(h,this.minZoom,this.maxZoom))&&(l=(r+l)/d*h-r,c=(n+c)/d*h-n,this.calcMaxScroll(h));}this.enableScrollX&&(l-=s*this.moveSpeed,l=HL(l,0,this.maxScrollLeft)),this.enableScrollY&&(c-=u*this.moveSpeed,c=HL(c,0,this.maxScrollTop)),a.length>60&&gE(a).call(a,0,30),a.push({scrollLeft:l,scrollTop:c,timeStamp:t}),this.publish(l,c,h);}else{var f=this.locking?this.scrollThreshold:0,v=this.moveThreshold,g=Math.abs(r-this.startX),m=Math.abs(n-this.startY);this.enableScrollX=this.scrollingX&&g>=f,this.enableScrollY=this.scrollingY&&m>=f,a.push({scrollLeft:this.scrollLeft,scrollTop:this.scrollTop,timeStamp:t}),this.isDragging=(this.enableScrollX||this.enableScrollY)&&(g>=v||m>=v),this.isDragging&&(this.interruptedAnimation=!1);}this.lastX=r,this.lastY=n,this.lastTimeStamp=t,this.lastScale=i;}}},{key:"onEndHandler",value:function value(e){if(this.canScroll()&&this.isStart&&this.isProcessing){if(e instanceof Date&&(e=e.valueOf()),this.isProcessing=!1,this.isDragging)if(this.isDragging=!1,this.isSingleTouch&&this.animating&&e-this.lastTimeStamp<100){for(var t=this.positions,i=this.decelerationVelocityThreshold,r=t.length-1,n=r,o=r;o>0&&t[o].timeStamp>this.lastTimeStamp-100;o--)n=o;if(n!==r){var a=t[r].timeStamp-t[n].timeStamp,s=this.scrollLeft-t[n].scrollLeft,u=this.scrollTop-this.positions[n].scrollTop;this.decelerationVelocityX=s/a*(1e3/60),this.decelerationVelocityX=u/a*(1e3/60),Math.abs(this.decelerationVelocityX)>i||Math.abs(this.decelerationVelocityY)>i?this.startDeceleration(e):this.hooks.scrollComplete.emit();}else this.hooks.scrollComplete.emit();}else e-this.lastTimeStamp>100&&this.hooks.scrollComplete.emit();this.isDecelerating||((this.interruptedAnimation||this.isDragging)&&this.hooks.scrollComplete.emit(),this.scrollTo(this.scrollLeft,this.scrollTop,!0,this.zoom)),this.isStart=!1,this.isMoving=!1,this.positions.length=0;}}},{key:"onZoomHandler",value:function value(e,t,i){this.zoomTo(this.zoom*e,!1,t,i);}},{key:"onWheelHandler",value:function value(e){if(!e.ctrlKey){var t=this.scrollLeft,i=this.scrollTop;e.shiftKey?t=this.scrollLeft+e.deltaY:i=this.scrollTop+e.deltaY,this.scrollTo(t,i);}}},{key:"publish",value:function value(e,t,i){var r=this,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=this.isAnimating;if(o&&(this.cancelAnimate(this.animationId),this.isAnimating=!1),n&&this.animating){this.futureLeft=e,this.futureTop=t,this.futureZoom=i;var a=this.scrollLeft,s=this.scrollTop,u=this.zoom;this.isAnimating=!0,this.animationId=this.animate(function(n,o){return o&&(r.scrollLeft=a+(e-a)*n,r.scrollTop=s+(t-s)*n,r.zoom=u+(i-u)*n,r.hooks.publish.emit(r.scrollLeft,r.scrollTop,r.zoom)),!0;},function(e,t){r.animationId===e&&(r.isAnimating=!1),(r.isDecelerationComplete||t)&&r.hooks.scrollComplete.emit(),r.zooming&&(r.calcMaxScroll(),r.hooks.zoomComplete.emit());},this.animationDuration,o?wN:pN);}else this.futureLeft=e,this.futureTop=t,this.futureZoom=i,this.scrollLeft=e,this.scrollTop=t,this.zoom=i,this.hooks.publish.emit(e,t,i),this.zooming&&(this.calcMaxScroll(),this.hooks.zoomComplete.emit());}},{key:"startDeceleration",value:function value(e){}},{key:"animate",value:function value(e,t,i,r){var n=new MF(e,t,i,r);return this.animations[n.id]=n,n.play(),n.id;}},{key:"cancelAnimate",value:function value(e){var t=this.animations[e];t&&(t.cancel(),delete this.animations[e]);}},{key:"calcMaxScroll",value:function value(e){e=e||this.zoom,this.maxScrollLeft=Math.max(0,this.contentWidth*e-this.viewportWidth),this.maxScrollTop=Math.max(0,this.contentHeight*e-this.viewportHeight);}}]);}(bN),UF=function(e){function t(){return Xk(this,t),cL(this,t,arguments);}return _b(t,e),Yk(t,[{key:"render",value:function value(e,t){e.parsedCheckBoxStyle=AF(e,e.checkBoxStyle);var i=e.parsedCheckBoxStyle.opacity;t.save(),t.globalAlpha=i,this.renderBox(e,t,"out"),t.clip(),this.renderBox(e,t,"in"),cP(this).call(this,e,t),this.renderBox(e,t,"center"),this.stroke(e,t),this.renderCheckMark(e,t),t.restore();}},{key:"renderBox",value:function value(e,t,i){var r=e.parsedCheckBoxStyle,n=r.x,o=r.y,a=r.width,s=r.height,u=r.borderWidth,l=r.borderRadiusX,c=r.borderRadiusY,h=0;"center"===i?h=u/2:"in"===i&&(h=u);var d=[{x:n+l,y:o+c,start:Math.PI,end:3*Math.PI/2},{x:n+a-l,y:o+c,start:3*Math.PI/2,end:2*Math.PI},{x:n+a-l,y:o+s-c,start:0,end:Math.PI/2},{x:n+l,y:o+s-c,start:Math.PI/2,end:Math.PI}],f=Math.max(l-h,0),v=Math.max(c-h,0);if(t.beginPath(),t.ellipse)for(var g=0;g<4;g++){var m=d[g],y=m.x,p=m.y,w=m.start,b=m.end;t.ellipse(y,p,f,v,0,w,b);}else t.rect(n,o,a,s);t.closePath();}},{key:"fill",value:function value(e,t){var i=e.parsedCheckBoxStyle.background;if(zL()){var r=_O(i);t.fillStyle=r.formatted;}else t.fillStyle=i;cP(t).call(t);}},{key:"stroke",value:function value(e,t){var i=e.parsedCheckBoxStyle,r=i.borderColor,n=i.borderWidth;if(zL()){var o=_O(r);t.strokeStyle=o.formatted;}else t.strokeStyle=r;t.lineWidth=n,n>0&&t.stroke();}},{key:"renderCheckMark",value:function value(e,t){if(e.checked){var i=e.parsedCheckBoxStyle,r=i.x,n=i.y,o=i.width,a=i.height,s=i.borderWidth,u=i.checkMarkLineWidth,l=i.checkMarkColor,c=Math.max(Math.min(o-2*s,a-2*s),0),h=r,d=n;if(0!==c){if(o<a?(h+=s,d=d+s+(a-o)/2):(h=h+s+(o-a)/2,d+=s),t.lineWidth=u,zL()){var f=_O(l);t.strokeStyle=f.formatted;}else t.strokeStyle=l;t.beginPath(),t.moveTo(h+.15*c,d+.5*c),t.lineTo(h+.4*c,d+.8*c),t.lineTo(h+.85*c,d+.2*c),t.stroke();}}}}]);}(lH);function AF(e,t){var i,r,n,o=_SL(t),a=e.parentNode.width||100,s=e.parentNode.height||100;$k(i=["borderWidth","checkMarkLineWidth","opacity","fontSize"]).call(i,function(e){CL(o[e])||(o[e]=HO(o[e]).value||0);}),$k(r=["left","top","right","bottom","width","height"]).call(r,function(e){var t,i=-1!==OI(t=["left","right","width"]).call(t,e)?a:s,r=UW(o[e],i);o[e]=r;}),BL(t.width)||null!==o.width||(BL(o.left)&&BL(o.right)?o.width=a-o.left-o.right:o.width=0),BL(t.height)||null!==o.height||(BL(o.bottom)&&BL(o.top)?o.height=s-o.top-o.bottom:o.height=0),$k(n=["borderRadius","translateX","translateY"]).call(n,function(e){var t=o.width,i=o.height,r=Math.max,n=Math.min;if("borderRadius"===e){var a=UW(o[e],t),s=UW(o[e],i);o.borderRadiusX=r(0,n(a,t/2)),o.borderRadiusY=r(0,n(s,i/2));}"translateX"===e&&(o[e]=UW(o[e],t)),"translateY"===e&&(o[e]=UW(o[e],i));});var u=o.left,l=o.top,c=o.right,h=o.bottom,d=o.translateX,f=o.translateY,v=o.borderWidth,g=u,m=l;return 2*v>o.width&&(o.width=2*v),2*v>o.height&&(o.height=2*v),BL(o.right)&&!BL(o.left)&&(g=a-o.width-c),BL(o.bottom)&&!BL(o.top)&&(m=s-o.height-h),Fk({x:g+d,y:m+f},o);}var RF=function(e){function t(){return Xk(this,t),cL(this,t,arguments);}return _b(t,e),Yk(t,[{key:"render",value:function value(e,t){e.parsedPageNumberStyle=AF(e,e.pageNumberStyle);var i=e.parsedPageNumberStyle.opacity;t.save(),t.globalAlpha=i,this.renderBox(e,t,"out"),t.clip(),this.renderBox(e,t,"in"),cP(this).call(this,e,t),this.renderBox(e,t,"center"),this.stroke(e,t),this.renderFont(e,t),t.restore();}},{key:"renderBox",value:function value(e,t,i){var r=e.parsedPageNumberStyle,n=r.x,o=r.y,a=r.width,s=r.height,u=r.borderWidth,l=r.borderRadiusX,c=r.borderRadiusY,h=0;"center"===i?h=u/2:"in"===i&&(h=u);var d=[{x:n+l,y:o+c,start:Math.PI,end:3*Math.PI/2},{x:n+a-l,y:o+c,start:3*Math.PI/2,end:2*Math.PI},{x:n+a-l,y:o+s-c,start:0,end:Math.PI/2},{x:n+l,y:o+s-c,start:Math.PI/2,end:Math.PI}],f=Math.max(l-h,0),v=Math.max(c-h,0);if(t.beginPath(),t.ellipse)for(var g=0;g<4;g++){var m=d[g],y=m.x,p=m.y,w=m.start,b=m.end;t.ellipse(y,p,f,v,0,w,b);}else t.rect(n,o,a,s);t.closePath();}},{key:"renderFont",value:function value(e,t){var i,r=e.parsedPageNumberStyle,n=r.x,o=r.y,a=r.width,s=r.height,u=r.fontSize,l=r.color,c=r.fontFamily;if(zL()){var h=_O(l);t.fillStyle=h.formatted;}else t.fillStyle=l;t.textAlign="center",t.textBaseline="middle",t.font=lS(i="".concat(u,"px ")).call(i,c),t.fillText(e.text,n+a/2,o+s/2+u/8,a);}},{key:"fill",value:function value(e,t){var i=e.parsedPageNumberStyle.background;if(zL()){var r=_O(i);t.fillStyle=r.formatted;}else t.fillStyle=i;cP(t).call(t);}},{key:"stroke",value:function value(e,t){var i=e.parsedPageNumberStyle,r=i.borderColor,n=i.borderWidth;if(zL()){var o=_O(r);t.strokeStyle=o.formatted;}else t.strokeStyle=r;t.lineWidth=n,n>0&&t.stroke();}}]);}(lH),LF=function(e){function t(){return Xk(this,t),cL(this,t,arguments);}return _b(t,e),Yk(t,[{key:"renderCheckMark",value:function value(e,t){var i=e.parsedCheckBoxStyle,r=i.x,n=i.y,o=i.width,a=i.height,s=i.borderWidth,u=i.checkMarkLineWidth,l=i.checkMarkColor,c=Math.max(Math.min(o-2*s,a-2*s),0),h=r,d=n;0!==c&&(o<a?(h+=s,d=d+s+(a-o)/2):(h=h+s+(o-a)/2,d+=s),t.lineWidth=u,t.strokeStyle=l,t.beginPath(),t.moveTo(h+.3*c,d+.3*c),t.lineTo(h+.7*c,d+.7*c),t.moveTo(h+.3*c,d+.7*c),t.lineTo(h+.7*c,d+.3*c),t.stroke());}}]);}(UF),NF=function(){return Yk(function e(t){Xk(this,e),Wk(this,"isMarginFixed",!0),Wk(this,"isGapFixed",!0),Wk(this,"isBorderFixed",!0),Wk(this,"viewWidth",0),Wk(this,"viewHeight",0),Wk(this,"validVisualWidth",0),Wk(this,"validVisualHeight",0),Wk(this,"visualWidth",0),Wk(this,"visualHeight",0),Wk(this,"layoutWidth",0),Wk(this,"layoutHeight",0),Wk(this,"validLayoutWidth",0),Wk(this,"validLayoutHeight",0),Wk(this,"currentLayoutWidth",0),Wk(this,"currentLayoutHeight",0),Wk(this,"layoutLeft",0),Wk(this,"layoutTop",0),Wk(this,"calcWidth",0),Wk(this,"calcHeight",0),Wk(this,"calcViewWidth",0),Wk(this,"calcViewHeight",0),Wk(this,"fixedWidth",0),Wk(this,"fixedHeight",0),Wk(this,"defaultWidth",600),Wk(this,"defaultHeight",800),Wk(this,"rowHeightArray",[]),Wk(this,"columnWidthArray",[]),Wk(this,"scrollbarWidth",17),Wk(this,"zoom",1),Wk(this,"_scrollLeft",0),Wk(this,"scrollTop",0),Wk(this,"realRow",void 0),Wk(this,"realCol",void 0),Wk(this,"skipCalcZoom",!1),Wk(this,"isScrollbarAppeared",!1),Wk(this,"isScrollbarXAppeared",!1),Wk(this,"isScrollbarYAppeared",!1),Wk(this,"isScrollbarChanged",!1),Wk(this,"resized",!1),Wk(this,"placeholderPages",[]),LU(this,t);},[{key:"scrollLeft",get:function get(){return this._scrollLeft;},set:function set(e){this._scrollLeft=e;}},{key:"resetScrollbarStatus",value:function value(){this.isScrollbarAppeared=!1,this.isScrollbarChanged=!1,this.isScrollbarXAppeared=!1,this.isScrollbarYAppeared=!1;}},{key:"reset",value:function value(){this.validVisualWidth=0,this.validVisualHeight=0,this.visualWidth=0,this.visualHeight=0,this.layoutWidth=0,this.layoutHeight=0,this.validLayoutWidth=0,this.validLayoutHeight=0,this.currentLayoutWidth=0,this.currentLayoutHeight=0,this.layoutLeft=0,this.layoutTop=0,this.calcWidth=0,this.calcHeight=0,this.calcViewWidth=0,this.calcViewHeight=0,this.fixedWidth=0,this.fixedHeight=0;}}]);}(),OF=function(e){function t(e){var i;return Xk(this,t),Wk(yb(i=cL(this,t,[e])),"uid",void 0),Wk(yb(i),"tabName",void 0),Wk(yb(i),"type",void 0),Wk(yb(i),"doc",void 0),Wk(yb(i),"viewer",void 0),Wk(yb(i),"current",-1),Wk(yb(i),"selected",[]),Wk(yb(i),"fitType","window"),Wk(yb(i),"displayMode","single"),Wk(yb(i),"toolType","default"),Wk(yb(i),"keepZoom",!1),Wk(yb(i),"isDirty",!0),Wk(yb(i),"layoutStatus",void 0),Wk(yb(i),"stepPageIdStack",[]),Wk(yb(i),"redoStack",[]),Wk(yb(i),"isDestroyed",!1),Wk(yb(i),"preloadCount",1),Wk(yb(i),"row",3),Wk(yb(i),"column",3),Wk(yb(i),"direction","vertical"),Wk(yb(i),"dpr",1),Wk(yb(i),"gap",20),Wk(yb(i),"margin",10),Wk(yb(i),"borderWidth",0),Wk(yb(i),"hoveredBorderWidth",0),Wk(yb(i),"selectedBorderWidth",0),Wk(yb(i),"enableDWT1x1",!1),Wk(yb(i),"shiftReference",null),Wk(yb(i),"commandController",void 0),Wk(yb(i),"topPageUid",null),Wk(yb(i),"isTopPageChanged",!1),Wk(yb(i),"isLoadPage",!1),Wk(yb(i),"visibleChildren",[]),LU(yb(i),e),i.layoutStatus=new NF({viewWidth:e.viewWidth||0,viewHeight:e.viewHeight||0}),i.commandController=new kF(),i;}return _b(t,e),Yk(t,[{key:"currentPage",get:function get(){return this.children[this.current];}},{key:"currentUid",get:function get(){var e;return null===(e=this.currentPage)||void 0===e?void 0:e.uid;}},{key:"children",get:function get(){return this.childNodes;}},{key:"total",get:function get(){return this.childNodes.length;}},{key:"setZoom",value:function value(e){var t;this.layoutStatus.zoom=e,$k(t=this.children).call(t,function(t){t.zoom=e;});}},{key:"destroy",value:function value(){hL(t,"destroy",this,3)([]),this.viewer=null,this.selected=null,this.isDestroyed=!0;}},{key:"updateShiftReference",value:function value(){this.shiftReference=this.currentUid;}},{key:"insertChild",value:function value(e,t){return this.appendChild(e,t),!0;}},{key:"removeChild",value:function value(e){var i=this.isChildExist(e),r=this.getChildIndex(e);return hL(t,"removeChild",this,3)([e]),i&&this.selected.length&&(0===this.total?(this.current=-1,this.selected=[]):((this.current===r&&r===this.total||r<this.current)&&(this.current-=1),this.selected=[this.currentUid])),e;}},{key:"removeChildByIndex",value:function value(e){if(e>=0||e<this.total)return!1;var t=this.children[e];return this.removeChild(t),!0;}},{key:"removeChildByUid",value:function value(e){var t=this.getChildByUid(e);return!!t&&(this.removeChild(t),!0);}},{key:"move",value:function value(e,t){var i=this.children,r=Gb(gE(i).call(i,e,1),1)[0];return!!r&&(gE(i).call(i,t,0,r),this.select([i[t].uid]));}},{key:"switch",value:function value(e,t){var i=this.children,r=this.current;return e!==t&&(this.swapChild(i[e],i[t]),r===e?this.select([i[t].uid]):r===t&&this.select([i[e].uid])),!0;}},{key:"swapChild",value:function value(e,t){if(!e.isEqualNode(t)){var i=this.getChildIndex(e),r=this.getChildIndex(t);this.children[i]=t,this.children[r]=e;}}},{key:"next",value:function value(){return 0===this.total?-1:(this.total-this.current>1&&(this.current+=1),this.selected=[this.children[this.current].uid],this.current);}},{key:"prev",value:function value(){return this.total<=0||this.current<0?-1:(this.current>0&&(this.current-=1),this.selected=[this.children[this.current].uid],this.current);}},{key:"first",value:function value(){return 0===this.total?-1:(this.current=0,this.selected=[this.children[0].uid],0);}},{key:"last",value:function value(){return 0===this.total?-1:(this.current=this.total-1,this.selected=[this.children[this.current].uid],this.current);}},{key:"goto",value:function value(e){var t,i=this;return 0===this.total?-1:(e!==this.current&&(e=HL(e,0,this.total-1),this.current=e),this.selected=[this.children[this.current].uid],$k(t=this.children).call(t,function(e){var t;e.isSelected=OI(t=i.selected).call(t,e.uid)>-1;}),this.current);}},{key:"select",value:function value(e){var t,i,r=e.length;if(0===r)return this.selected=e,this.current=-1,$k(t=this.children).call(t,function(e){e.isSelected=!1;}),!0;var n=this.getIndexByUid(e[r-1]);return!(n<0||($k(i=this.children).call(i,function(t){t.isSelected=OI(e).call(e,t.uid)>-1;}),this.selected=e,this.current=n,0));}},{key:"getSelected",value:function value(){var e;return RI(e=this.selected).call(e);}},{key:"getChildByIndex",value:function value(e){return this.children[e];}},{key:"getChildByUid",value:function value(e){var t;return xP(t=this.children).call(t,function(t){return t.uid===e;});}},{key:"getIndexByUid",value:function value(e){var t;return EE(t=this.children).call(t,function(t){return t.uid===e;});}},{key:"getUidByIndex",value:function value(e){var t;return null===(t=this.children[e])||void 0===t?void 0:t.uid;}},{key:"getChildIndex",value:function value(e){var t;return OI(t=this.children).call(t,e);}},{key:"getChildUids",value:function value(){var e;return $E(e=this.children).call(e,function(e){return e.uid;});}},{key:"reorder",value:function value(e){var t=this.children,i=e.length,r=[],n=!1;if(t.length!==i)return!1;for(var o=0;o<i;o++)e[o]===o||(n=!0);if(!n)return!0;for(var a=0;a<i;a++)r[a]=t[e[a]];for(var s=0;s<i;s++)t[s]=r[s];if(this.selected.length){var u=this.selected[this.selected.length-1],l=this.getIndexByUid(u);this.current=l;}return!0;}},{key:"updateLayoutStatus",value:function value(e){LU(this.layoutStatus,e);}}]);}(mW),WF=function(){return Yk(function e(t){var i=t.tabMode;Xk(this,e),Wk(this,"tabs",void 0),Wk(this,"mode",void 0),Wk(this,"currentTabUid",void 0),Wk(this,"isDestroyed",!1),Wk(this,"hooks",{removeTab:SN.create()}),Wk(this,"tabSelectionStack",void 0),this.tabs=[],this.mode=i,this.currentTabUid=null,this.tabSelectionStack=[];},[{key:"destroy",value:function value(){var e;$k(e=this.tabs).call(e,function(e){return e.destroy();}),this.tabs=null,this.tabSelectionStack=null,this.isDestroyed=!0;}},{key:"clear",value:function value(){this.tabs=[],this.currentTabUid=null,this.tabSelectionStack=[];}},{key:"createTab",value:function value(e,t){var i,r=this,n=xP(i=this.tabs).call(i,function(t){return e.uid===t.uid;});if(!n){var o,a,s=Fk({uid:e.uid,name:e.name,type:e.type},t);n=new OF(s),"single"===this.mode&&$k(o=RI(a=this.tabs).call(a)).call(o,function(e){r.closeTab(e.uid);}),this.tabs.push(n);}return n;}},{key:"find",value:function value(e){var t;return xP(t=this.tabs).call(t,function(t){return e===t.uid;});}},{key:"findIndex",value:function value(e){var t;return EE(t=this.tabs).call(t,function(t){return e===t.uid;});}},{key:"setCurrentTab",value:function value(e){var t,i;if(EE(this).call(this,e)<0)return!1;var r=OI(t=this.tabSelectionStack).call(t,e);return r>-1&&gE(i=this.tabSelectionStack).call(i,r,1),this.tabSelectionStack.push(e),this.currentTabUid=e,!0;}},{key:"closeTab",value:function value(e){if(!this.removeTab(e))return!1;var t=this.tabs,i=this.tabSelectionStack,r=OI(i).call(i,e);return gE(i).call(i,r,1),t.length?this.currentTabUid=i[i.length-1]:this.currentTabUid=null,!0;}},{key:"removeTab",value:function value(e){var t,i=EE(this).call(this,e);return i>-1&&(gE(t=this.tabs).call(t,i,1),this.hooks.removeTab.emit(e),!0);}},{key:"getCurTab",value:function value(){return xP(this).call(this,this.currentTabUid);}},{key:"getAllTabs",value:function value(){var e;return RI(e=this.tabs).call(e);}},{key:"setMode",value:function value(e){return("single"===e||"multiple"===e)&&(this.mode=e,!0);}}]);}(),HF=function(){return Yk(function e(){Xk(this,e),Wk(this,"lastTopPageIndex",-1);},[{key:"init",value:function value(e){var t=e.uiService,i=e.rendererService,r=t.canvasContainer,n=t.getViewportSize(),o=n.width,a=n.height;i.initCanvas({container:r,width:o,height:a}),i.registerShapeRenderer("checkbox",new UF()),i.registerShapeRenderer("pageNumber",new RF()),i.registerShapeRenderer("removeBtn",new LF()),this.listenHooks(e);}},{key:"listenHooks",value:function value(e){var t=this,i=e.rendererService.hooks;i.beforeRender.on(this.beforeRenderListener),i.afterRender.on(this.afterRenderListener),e.hooksService.hooks.destroy.on(function(){i.beforeRender.off(t.beforeRenderListener),i.afterRender.off(t.afterRenderListener);});}},{key:"beforeRenderListener",value:function value(e){var t=e.tabService,i=e.config,r=t.getCurrentTab();if(r){var n,o="multiple"===i.displayMode;$k(n=r.children).call(n,function(t,n){var a,s=i.pageNumberStyle.visibility,u=i.checkboxStyle.visibility,l=i.removeBtnStyle.visibility;o||(s="hidden",u="hidden",l="hidden"),t.pageNumber.updateText(String(n+1)),t.pageNumber.updateStyle({visibility:s}),t.checkbox.checked=OI(a=r.selected).call(a,t.uid)>-1,t.checkbox.updateStyle({visibility:u}),t.removeBtn.updateStyle({visibility:l});var c=r.selected,h=i.pageStyle;o&&(xP(c).call(c,function(e){return e===t.uid;})?h=i.selectedPageStyle:t.isHovered&&(h=i.hoveredPageStyle));var d=h,f=d.background,v=d.border,g={};v&&(g=hF(v));var m=g.borderWidth;if(i.enableSingleModeBorder||"single"!==i.displayMode&&"slide"!==i.displayMode||(m=0),t.borderBox.updateStyle(Fk(Fk({background:f},g),{},{borderWidth:m})),t.isDragging&&o){g={};var y=i.placeholderStyle,p=y.background,w=y.border;w&&(g=hF(w)),t.updateStyle(Fk({background:p},g));}else t.updateStyle({background:"#ffffff00",borderWidth:0});"slide"!==i.displayMode&&"single"!==i.displayMode&&"doc"!==i.displayMode||t.borderBox.updateStyle({background:"rgba(255,255,255,0)"}),!UL()&&!zL()&&!t.isOptimized&&t.isVisible&&t.isLoaded&&t.zoom<1&&new uB(function(e,t){jP(function(){e(null);},500);}).then(function(){e.optimizePage(t.uid);});});}}},{key:"afterRenderListener",value:function value(e){var t,i=e.tabService,r=e.config,n=e.rendererService,o=i.getCurrentTab();if(o&&(o.isTopPageChanged||-1!==n.lastTopPageIndex&&0===o.total)&&(o.isTopPageChanged=!1,"multiple"===r.displayMode)){var a=o.getIndexByUid(o.topPageUid);a!==n.lastTopPageIndex&&(e.emit("topPageChanged",a),n.lastTopPageIndex=a);}o&&$k(t=o.children).call(t,function(t,i){t.isPageRendered&&t.isVisible&&(t.isPageRendered=!1,t.isUpdated=!1,t.isEdited=!1,r.enableEmitPageRendered&&e.emit("pageRendered",i));});}}]);}(),FF=function(){return Yk(function e(){Xk(this,e);},[{key:"init",value:function value(e){this.listenNativeEvent(e),this.listenViewerHooks(e);}},{key:"listenViewerHooks",value:function value(e){var t=e.hooksService.hooks,i=function i(t){var i,r,n,o=t.tabNode,a=(null==o||null===(i=o.layoutStatus)||void 0===i?void 0:i.currentLayoutWidth)||0,s=(null==o||null===(r=o.layoutStatus)||void 0===r?void 0:r.currentLayoutHeight)||0;a=Math.max(Math.floor(a)-1,0),s=Math.max(Math.floor(s)-1,0),e.uiService.updateScrollContentSize(a,s),e.scrollerService.updateScroller({contentWidth:a,contentHeight:s}),"single"===e.config.displayMode&&(e.config.zoom=o.layoutStatus.zoom),0!==o.layoutStatus.viewWidth&&0!==o.layoutStatus.viewHeight&&$k(n=o.children).call(n,function(t){if(t.isPreload)t.isLoaded||t.imageContainer.imageData||("multiple"===e.config.displayMode&&e.config.useMinImage?e.dvsContext.minImageService.load(t.uid):e.dvsContext.imageService.load(t.uid));else{t.image.style.img=null,t.isLoaded=!1;var i=e.dvsContext.viewerService.isPageNeedLoad(t.uid);if(i.min&&"multiple"===e.config.displayMode&&e.config.useMinImage){var r=e.getStatus(t.uid);r&&(r.minImg=null);}if(i.ori&&"single"===e.config.displayMode){var n=e.getStatus(t.uid);n&&(n.img=null);}}});},r=function r(t){if(!t.isPassive&&e.config.autoScroll&&"single"!==e.config.displayMode&&"slide"!==e.config.displayMode){var i=e.getCurrentTab(),r=i.layoutStatus,n=r.viewWidth,o=r.viewHeight,a=r.rowHeightArray,s=r.columnWidthArray,u=r.placeholderPages,l=r.scrollLeft,c=r.scrollTop,h=r.realRow,d=r.realCol,f=i.currentPage,v=i.current,g=i.row,m=i.column,y=i.enableDWT1x1,p=f.getLocalPosition(),w=p.x,b=p.y,k=f.viewportPosition,S=l,x=c,C=!1,V=0,T=e.getMargin(),I=e.getGap(),E=1===m&&1===g&&y;if("multiple"===e.config.displayMode)"ahead"===k.x?(S=w-(V=0===k.column?T:E?0:I),C=!0):"behind"===k.x&&(V=k.column===d-1?T:E?0:I,S=w+s[0]-n+V,i.total<=i.row*i.column&&(S=i.getChildByIndex(0).getLocalPosition().x-T),C=!0),"ahead"===k.y?(x=b-(V=0===k.row?T:E?0:I),C=!0):"behind"===k.y&&(V=k.row===h-1?T:E?0:I,x=b+a[0]-o+V,i.total<=i.row*i.column&&(x=i.getChildByIndex(0).getLocalPosition().y-T),C=!0);else if("doc"===e.config.displayMode){var P=u[v];if("ahead"===k.x&&P.x<=i.gap?(C=!0,S=P.x-i.gap):"behind"===k.x&&P.x<=i.gap&&(C=!0,S=P.x+P.width-n+i.gap,P.width>n&&(S=P.x-i.gap)),i.getChildByIndex(i.total-1).getLocalPosition(),u[i.total-1].height,i.margin,"ahead"===k.y)C=!0,x=P.y-i.gap;else if("behind"===k.y){C=!0,x=P.y+P.height-o+i.gap;var B=i.layoutStatus;B.validLayoutHeight*B.zoom+B.fixedHeight<=o&&(x=0),P.height>o&&(x=P.y-i.gap);}}C&&(i.setPosition({x:-S,y:-x}),i.updateLayoutStatus({scrollLeft:S,scrollTop:x}),e.scrollerService.updateScroller({scrollLeft:S,scrollTop:x}),0===i.current?e.uiService.scrollTo(S+1,x+100):i.current===i.total-1&&e.uiService.scrollTo(S-100,x-100),e.uiService.scrollTo(S,x));}};e.layoutService.hooks.afterLayout.on(i),t.currentIndexChanged.on(r),e.hooksService.hooks.destroy.on(function(){e.layoutService.hooks.afterLayout.off(i),t.currentIndexChanged.off(r);});}},{key:"listenNativeEvent",value:function value(e){var t=e.rendererService.canvasDom,i=function i(t){e.scrollerService.mousedownListener(t);},r=function r(t){e.scrollerService.mousemoveListener(t);},n=function n(t){e.scrollerService.mouseupListener(t);},o=function o(t){e.scrollerService.mousedownListener(t);},a=function a(t){e.scrollerService.mousemoveListener(t);},s=function s(t){e.scrollerService.mouseupListener(t);},u=function u(t){var i=e.tabService.getCurrentTab();null==i||!i.total||0===i.selected.length&&"single"===e.config.displayMode||e.scrollerService.wheelListener(t);},l=function l(e){e.cancelable&&e.preventDefault();};t.addEventListener("wheel",u,{passive:!1}),t.addEventListener("touchstart",o,{passive:!1}),t.addEventListener("touchmove",l,{passive:!1}),document.addEventListener("touchmove",a,{passive:!1}),document.addEventListener("touchend",s),t.addEventListener("mousedown",i),document.addEventListener("mousemove",r),document.addEventListener("mouseup",n),e.hooksService.hooks.destroy.on(function(){t.removeEventListener("wheel",u),t.removeEventListener("touchstart",o),t.removeEventListener("touchmove",l),document.removeEventListener("touchmove",a),document.removeEventListener("touchend",s),t.removeEventListener("mousedown",i),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",n);});}}]);}(),jF=function(){return Yk(function e(){Xk(this,e);},[{key:"init",value:function value(e){this.listenViewerHooks(e);}},{key:"listenTabHooks",value:function value(e){var t=function t(_t4){e.hooksService.hooks.removeTab.emit(_t4);},_i4=function i(){e.tabService.tabManager.hooks.removeTab.off(t),e.hooksService.hooks.destroy.off(_i4);};e.tabService.tabManager.hooks.removeTab.on(t),e.hooksService.hooks.destroy.on(_i4);}},{key:"listenViewerHooks",value:function value(e){var t=this,i={beforeStatus:null,afterStatus:null,operation:null,docUid:null},r=function r(_r3){var n=_r3.modifiedUid,o=_r3.docUid,a=_r3.removedUids,s=e.tabService.getTab(o);s&&e.tabService.isCurrentTab(o)&&(i.beforeStatus=t.createBufferStatus(s,n,a));},n=function n(r){var n=r.modifiedUid,o=r.docUid,a=r.operation,s=r.removedUids,u=e.tabService.getTab(o);if(u&&e.tabService.isCurrentTab(o)){var l,c;i.afterStatus=t.createBufferStatus(u,n,s),i.operation=a,i.docUid=o,i.curIndex=u.current||0,i.total=u.total||0;var h=e.viewer.getSelectedIndexes();e.emit("_imageSelectedUI",h),e.emit("imageSelected",h);var d=u.current,f=u.total;e.emit("_dvsPagerChanged",{current:d,total:f}),r.isSameDoc||e.emit("bufferChanged",Fk({},i));var v=null===(l=i.beforeStatus)||void 0===l?void 0:l.currentUid,g=null===(c=i.afterStatus)||void 0===c?void 0:c.currentUid;if("add"===a&&v!==g){var m=_SL(i);m.operation="shift",e.emit("bufferChanged",m);}}i={beforeStatus:null,afterStatus:null,operation:null,docUid:null,curIndex:0,total:0};},o=function o(t){e.tabService.openDoc(t);},a=e.hooksService.hooks;a.beforeBufferChanged.on(r),a.afterBufferChanged.on(n),a.openDoc.on(o);var _s2=function s(){a.beforeBufferChanged.off(r),a.afterBufferChanged.off(n),a.openDoc.off(o),e.hooksService.hooks.destroy.off(_s2);};e.hooksService.hooks.destroy.on(_s2);}},{key:"createBufferStatus",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return{uids:e.getChildUids(),selectedUids:e.getSelected(),currentUid:e.currentUid,modifiedUid:t,removedUids:i};}}]);}();function YF(e,t){if(kL(t)){LU(e.config.viewerStyle,t);var i=e.uiService,r=i.scrollContainer,n=i.canvasContainer,o=e.getBorderWidth(e.config.viewerStyle);n&&r&&(LU(n.style,{left:"".concat(o,"px"),top:"".concat(o,"px")}),LU(r.style,t),e.resized());}}function XF(e,t){if(kL(t)){LU(e.config.canvasStyle,t);var i,r=e.rendererService.canvasDom;if(r)LU(r.style,t),OI(i=eS(t||{})).call(i,"border")>-1&&e.resized();}}function qF(e,t){if(kL(t)){var i;LU(e.config.pageStyle,t);var r=e.getBorderWidth(e.config.pageStyle);$k(i=e.getAllTabs()).call(i,function(e){e.borderWidth=r;}),e.clearCurTabOptimization(),e.render();}}function ZF(e,t){if(kL(t)){var i;LU(e.config.selectedPageStyle,t);var r=e.getBorderWidth(e.config.selectedPageStyle);$k(i=e.getAllTabs()).call(i,function(e){e.selectedBorderWidth=r;}),e.clearCurTabOptimization(),e.render();}}function _F(e,t){if(kL(t)){var i;LU(e.config.hoveredPageStyle,t);var r=e.getBorderWidth(e.config.hoveredPageStyle);$k(i=e.getAllTabs()).call(i,function(e){e.hoveredBorderWidth=r;}),e.clearCurTabOptimization(),e.render();}}function GF(e,t){kL&&(LU(e.config.placeholderStyle,t),e.render());}function KF(e,t){var i;kL(t)&&(LU(e.config.pageNumberStyle,t),$k(i=e.getAllTabs()).call(i,function(t){var i;$k(i=t.children).call(i,function(t){t.pageNumber.updateStyle(e.config.pageNumberStyle);});}),e.rendererService.render());}function $F(e,t){var i;kL(t)&&(LU(e.config.checkboxStyle,t),$k(i=e.getAllTabs()).call(i,function(t){var i;$k(i=t.children).call(i,function(t){t.checkbox.updateStyle(e.config.checkboxStyle);});}),e.rendererService.render());}function JF(e,t){var i;kL(t)&&(LU(e.config.removeBtnStyle,t),$k(i=e.getAllTabs()).call(i,function(t){var i;$k(i=t.children).call(i,function(t){t.removeBtn.updateStyle(e.config.removeBtnStyle);});}),e.rendererService.render());}function QF(e,t){e.config.enableDragPage=t;}function ej(e,t){e.config.enableKeyboardControl=t;}function tj(e,t){e.config.multiselectMode=t;}function ij(e,t){e.config.zoomOrigin=t;}function rj(e,t){t=HL(t,e.config.minZoom,e.config.maxZoom),e.zoomService.zoomTo(t),e.config.zoom=t;}function nj(e,t){e.config.minZoom=t;}function oj(e,t){e.config.maxZoom=t;}function aj(e,t){e.config.enableZoom=t;}function sj(e,t){e.config.enableScrollX=t;}function uj(e,t){e.config.enableScrollY=t;}function lj(e,t){e.config.keepZoom=t;}function cj(e,t){e.config.zoomInDelta=t;}function hj(e,t){e.config.zoomOutDelta=t;}function dj(e,t){e.config.wheelZoomDelta=t;}function fj(e,t){e.config.scrollDirection=t;var i=e.getCurrentTab();i&&(i.direction=t,e.resized());}function vj(e,t){var i,r=t!==e.config.displayMode;e.config.displayMode=t;var n=e.getCurrentTab();n&&(n.displayMode=t,$k(i=n.children).call(i,function(e){e.isLoaded=!1;}),e.showTab(n),r&&e.resetScrollbarStatus(),e.clearCurTabOptimization(),e.render(),"multiple"===t&&e.emitCurrentIndexChanged());}function gj(e,t){e.config.toolType=t;var i=e.getCurrentTab();i&&(i.toolType=t,e.rendererService.render());}function mj(e,t){if(e.config.fitType!==t){e.config.fitType=t;var i=e.getCurrentTab();if(i){i.fitType=t,e.resetScrollbarStatus(),e.resetScrollerSize(),e.resize(),e.clearCurTabOptimization(),e.render();var r=e.uiService.scrollContainer,n=r.scrollWidth,o=r.scrollHeight,a=n-r.clientWidth,s=o-r.clientHeight,u=e.config.zoomOrigin,l=u.x,c=u.y,h=0,d=0;"center"===l?h=a/2:"right"===l&&(h=a),"center"===c?d=s/2:"bottom"===c&&(d=s),0===h&&0===d||e.uiService.scrollTo(h,d);}}}function yj(e,t){if(e.config.show!==t){e.config.show=t;var i=e.uiService,r=i.rootDom,n=i.defaultDom;if(r&&(t?(r.style.display="flex",n.style.display="flex"):r.style.display="none"),e.resized(),t){var o=e.getCurrentTab();o&&(e.showTab(o),e.renderOnly());}}}function pj(e,t){e.setViewMode(t,e.config.columns);}function wj(e,t){e.setViewMode(e.config.rows,t);}function bj(e,t){e.config.pure=!0;}function kj(e,t){e.config.margin!==t&&(e.config.margin=t,e.clearCurTabOptimization(),e.render());}function Sj(e,t){e.config.gap!==t&&(e.config.gap=t,e.clearCurTabOptimization(),e.render());}function xj(e,t){e.config.autoChangeIndex=t;}function Cj(e,t){e.config.autoScroll=t;}function Vj(e,t){e.config.autoSelectLatest=t;}function Tj(e,t){e.config.enableSelectWithShift=t;}function Ij(e,t){e.config.enableZoomWithCtrl=t;}function Ej(e,t){e.config.enableSelectWithCtrl=t;}function Pj(e,t){"single"===t||"multiple"===t?(e.config.tabMode=t,e.tabService.tabManager.setMode(t),e.ok()):e.err(mL);}function Bj(e,t){e.config.enableSyncSelect=t;}function Dj(e,t){e.config.enableSingleModeBorder=t;}function Mj(e,t){e.config.blankFillColor=t;}function zj(e,t){e.config.dragThreshold=t;}function Uj(e,t){e.config.slideThreshold=t;}function Aj(e,t){e.config.maxOptimizationSize=t;}function Rj(e,t){e.config.enableSlide=t;}function Lj(e,t){e.config.enableDWT1x1=t;}function Nj(e,t){e.config.enableEmitPageRendered=t;}function Oj(e,t){e.config.autoSelectTopPage=t;}function Wj(e,t){e.config.enableOptimizeImage=t;}function Hj(e,t){e.config.useMinImage=t;}var Fj=function(){return Yk(function e(t){Xk(this,e),Wk(this,"context",void 0),Wk(this,"handlers",{}),this.context=t,this.initHandlers();},[{key:"destroy",value:function value(){this.context=null,this.handlers={};}},{key:"updateConfig",value:function value(e){for(var t=0,i=oB(e);t<i.length;t++){var r=Gb(i[t],2),n=r[0],o=r[1],a=this.handlers[n];a&&a(this.context,o);}}},{key:"registerHandler",value:function value(e,t){return!this.handlers[e]&&(this.handlers[e]=t,!0);}},{key:"initHandlers",value:function value(){var e={viewerStyle:YF,canvasStyle:XF,pageStyle:qF,selectedPageStyle:ZF,hoveredPageStyle:_F,placeholderStyle:GF,pageNumberStyle:KF,checkboxStyle:$F,removeBtnStyle:JF,enableDragPage:QF,enableKeyboardControl:ej,multiselectMode:tj,zoomOrigin:ij,zoom:rj,minZoom:nj,maxZoom:oj,enableZoom:aj,enableScrollX:sj,enableScrollY:uj,keepZoom:lj,zoomInDelta:cj,zoomOutDelta:hj,wheelZoomDelta:dj,scrollDirection:fj,displayMode:vj,toolType:gj,fitType:mj,show:yj,rows:pj,columns:wj,pure:bj,margin:kj,gap:Sj,autoChangeIndex:xj,autoScroll:Cj,autoSelectLatest:Vj,enableSelectWithShift:Tj,enableZoomWithCtrl:Ij,enableSelectWithCtrl:Ej,tabMode:Pj,enableSyncSelect:Bj,enableSingleModeBorder:Dj,blankFillColor:Mj,dragThreshold:zj,slideThreshold:Uj,maxOptimizationSize:Aj,enableSlide:Rj,enableDWT1x1:Lj,enableEmitPageRendered:Nj,enableOptimizeImage:Wj,useMinImage:Hj,autoSelectTopPage:Oj};this.handlers=e;}}]);}(),jj=Yk(function e(t){Xk(this,e),Wk(this,"hooks",{init:SN.create(),destroy:SN.create(),beforeLayout:SN.create(),layout:SN.create(),afterLayout:SN.create(),beforeRender:SN.create(),render:SN.create(),afterRender:SN.create(),resize:SN.create(),externalResized:SN.create(),bindContainer:SN.create(),pageChanged:SN.create(),afterScroll:SN.create(),afterZoom:SN.create(),mousedown:SN.create(),mousemove:SN.create(),mouseup:SN.create(),mouseover:SN.create(),mouseout:SN.create(),click:SN.create(),dblclick:SN.create(),wheel:SN.create(),contextmenu:SN.create(),dragStart:SN.create(),loadImage:SN.create(),update:SN.create(),remove:SN.create(),move:SN.create(),switch:SN.create(),reorder:SN.create(),changePage:SN.create(),selectPage:SN.create(),beforeBufferChanged:SN.create(),afterBufferChanged:SN.create(),currentIndexChanged:SN.create(),scrollValueChanged:SN.create(),tabCleared:SN.create(),focusChanged:SN.create(),removePagesFromDoc:SN.create(),appendPagesToDoc:SN.create(),openDoc:SN.create(),removeTab:SN.create()}),Wk(this,"context",void 0),this.context=t;}),Yj=function(){return Yk(function e(t){Xk(this,e),Wk(this,"hooks",{beforeLayout:SN.create(),layout:SN.create(),afterLayout:SN.create()}),Wk(this,"context",void 0),this.context=t;},[{key:"layout",value:function value(e){this.hooks.beforeLayout.emit({tabNode:e}),this.context.dvsContext.layoutService.layout(e),e.layoutStatus.isScrollbarChanged&&(e.layoutStatus.isScrollbarChanged=!1,this.hooks.afterLayout.emit({tabNode:e}),this.context.resize(),this.context.clearCurTabOptimization(),this.context.dvsContext.layoutService.layout(e)),this.hooks.afterLayout.emit({tabNode:e});}}]);}(),Xj=function(){return Yk(function e(t){Xk(this,e),Wk(this,"canvasDom",void 0),Wk(this,"hooks",{beforeRender:SN.create(),render:SN.create(),afterRender:SN.create()}),Wk(this,"context",void 0),Wk(this,"canvas",void 0),Wk(this,"renderer",void 0),Wk(this,"isInitialized",!1),Wk(this,"lastTopPageIndex",-1),this.context=t;},[{key:"render",value:function value(){if("single"===this.context.config.displayMode){var e,t=null===(e=this.context)||void 0===e?void 0:e.getCurrentTab();if(t){var i=t.currentPage;if(i&&!i.isLoaded)return;}}this.hooks.beforeRender.emit(this.context),this.internalRender(),this.hooks.afterRender.emit(this.context);}},{key:"internalRender",value:function value(){var e,t,i=null===(e=this.context)||void 0===e?void 0:e.getCurrentTab(),r=this.canvas.document.documentElement;if(i)0===r.children.length?r.appendChild(i):OI(t=r.children).call(t,i)<0&&r.replaceChild(i,r.children[0]);else for(var n=r.childNodes.length-1;n>=0;n--)r.removeChild(r.childNodes[n]);this.canvas.render();}},{key:"initCanvas",value:function value(e){var t=e.container,i=e.width,r=e.height,n=new TH({}),o=new uH({renderer:n,container:t,width:i,height:r});this.renderer=n,this.canvas=o,this.canvasDom=o.contextService.getDomElement(),this.canvasDom.tabIndex=0,LU(this.canvasDom.style,this.context.config.canvasStyle),this.isInitialized=!0;}},{key:"registerShapeRenderer",value:function value(e,t){this.canvas.contextService.registerShapeRenderer(e,t);}},{key:"getCanvasPosition",value:function value(){var e=this.canvasDom.getBoundingClientRect(),t=yN(),i=t.scrollX,r=t.scrollY;return{x:e.left+i,y:e.top+r};}},{key:"resetCanvasSize",value:function value(){this.canvasDom.style.width="0px",this.canvasDom.style.height="0px";}}]);}(),qj=function(){return Yk(function e(t){var i=this;Xk(this,e),Wk(this,"context",void 0),Wk(this,"isStart",!1),Wk(this,"scroller",void 0),Wk(this,"startDistance",0),Wk(this,"startZoom",1),Wk(this,"lastScale",1),Wk(this,"originX",0),Wk(this,"originY",0),Wk(this,"startX",0),Wk(this,"startY",0),Wk(this,"isSliding",!1),Wk(this,"isZoom",!1),Wk(this,"slideDirection","left"),Wk(this,"slideDistance",0),Wk(this,"slideTimer",null),Wk(this,"wheelTimer",null),Wk(this,"touchZoomTimer",null),Wk(this,"startTime",0),Wk(this,"isScrolling",!1),Wk(this,"scrollTimer",null),Wk(this,"scrollDirectionX","left"),Wk(this,"scrollDirectionY","up"),Wk(this,"lineHeight",this.getLineHeight()),Wk(this,"startHandler",function(e,t){var r=i.context.config;"default"===r.toolType?(i.isStart=!0,e.length>1&&(i.startDistance=Math.pow(Math.pow(e[0].pageX-e[1].pageX,2)+Math.pow(e[0].pageY-e[1].pageY,2),.5)),i.scroller.onStartHandler(e,t)):"zoomIn"===r.toolType&&"multiple"!==r.displayMode?i.context.zoomService.zoomTo(r.zoom*r.zoomInDelta,e[0].pageX,e[0].pageY):"zoomOut"===r.toolType&&"multiple"!==r.displayMode&&i.context.zoomService.zoomTo(r.zoom/r.zoomOutDelta,e[0].pageX,e[0].pageY);}),this.context=t,this.scroller=new zF(),this.scroller.hooks.publish.on(function(e,i,r){t.uiService.scrollTo(e,i);});},[{key:"getLineHeight",value:function value(){var e=getComputedStyle(document.body),t=e.lineHeight,i=e.fontSize;if(/\d+/.test(t)){var r=Gb(t.match(/(\d+)/),1)[0];return $S(r,10);}if(/\d+/.test(i)){var n=Gb(i.match(/(\d+)/),1)[0];return 1.2*$S(n,10);}return 16;}},{key:"destroy",value:function value(){this.wheelTimer&&(clearTimeout(this.wheelTimer),this.wheelTimer=null),this.touchZoomTimer&&(clearTimeout(this.touchZoomTimer),this.touchZoomTimer=null),this.scrollTimer&&($N.clearTimer(this.scrollTimer),this.scrollTimer=null),this.slideTimer&&($N.clearTimer(this.slideTimer),this.slideTimer=null);}},{key:"updateScroller",value:function value(e){this.scroller.updateScroller(e);}},{key:"mousedownListener",value:function value(e){var t;if(!(e instanceof MouseEvent&&"multiple"===this.context.config.displayMode||this.isSliding)){var i=null===(t=this.context)||void 0===t?void 0:t.getCurrentTab();if(i&&i.total){var r=this.context.formatTouches(e);this.startX=r[0].pageX,this.startY=r[0].pageY,this.lastScale=1,this.startTime=new Date().getTime(),this.isScrolling=!1,this.scrollTimer&&($N.clearTimer(this.scrollTimer),this.scrollTimer=null),this.startZoom=this.context.config.zoom,this.startHandler(r,e.timeStamp);}}}},{key:"mousemoveListener",value:function value(e){var t,i=this;if(this.isStart){var r=this.context.formatTouches(e);if(window.TouchEvent&&e instanceof TouchEvent){if(this.context.draggingPrepared)return void(e.cancelable&&e.preventDefault());if(r.length>1&&this.context.config.enableZoom&&"single"===this.context.config.displayMode){var n=(r[0].pageX+r[1].pageX)/2,o=(r[0].pageY+r[1].pageY)/2,a=Math.pow(Math.pow(r[0].pageX-r[1].pageX,2)+Math.pow(r[0].pageY-r[1].pageY,2),.5)/this.startDistance;e.scale&&(a=e.scale);var s=this.context.config.zoom,u=s;return(s=this.startZoom*a)!==u&&(this.touchZoomTimer||(this.touchZoomTimer=jP(function(){i.context.zoomService.zoomTo(s,n,o),clearTimeout(i.touchZoomTimer),i.touchZoomTimer=null;},25))),this.lastScale=a,void(this.isZoom=!0);}}var l=null===(t=this.context)||void 0===t?void 0:t.getCurrentTab(),c=r[0].pageX-this.startX;if(l&&l.total){if(c>0?this.slideDirection="right":c<0&&(this.slideDirection="left"),this.slideDistance=Math.min(l.layoutStatus.viewWidth,Math.abs(c)),this.isSliding)return"right"===this.slideDirection?l.setPosition({x:this.slideDistance,y:0,z:0}):"left"===this.slideDirection&&l.setPosition({x:-this.slideDistance,y:0,z:0}),void this.context.renderOnly();"single"===this.context.config.displayMode&&"default"===this.context.config.toolType&&this.context.config.enableSlide&&Math.abs(c)>this.context.config.slideThreshold&&!this.context.uiService.isScrollbarAppeared()&&(this.isSliding=!0,this.context.updateViewerConfig({displayMode:"slide"}));}this.scroller.onMoveHandler(r,e.timeStamp);}}},{key:"slide",value:function value(e){var t,i=this,r=0,n=0,o=0,a=!1;this.slideDistance>=this.context.config.slideThreshold?(t=(n=e.layoutStatus.viewWidth)-this.slideDistance,"left"===this.slideDirection?e.current!==e.total-1?(o=-this.slideDistance,r=-t/8):(n=0,t=this.slideDistance,a=!0,o=-this.slideDistance,r=t/8):0!==e.current?(o=this.slideDistance,r=t/8):(n=0,t=this.slideDistance,a=!0,o=this.slideDistance,r=-t/8)):(a=!0,n=0,t=this.slideDistance,"left"===this.slideDirection?(o=-this.slideDistance,r=t/8):(o=this.slideDistance,r=-t/8)),this.slideTimer=$N.createTimer(function(){var t=(o+=r)>=0;if(Math.abs(o)>=n&&(o=n,t||(o*=-1)),e.setPosition({x:o,y:0,z:0}),Math.abs(o)===n)return a||("right"===i.slideDirection?i.context.viewer.prevPage():i.context.viewer.nextPage(),i.context.updateViewerConfig({fitType:"window"})),i.isSliding=!1,i.context.updateViewerConfig({displayMode:"single"}),void $N.clearTimer(i.slideTimer);i.context.renderOnly();},25);}},{key:"mouseupListener",value:function value(e){if(this.isStart){var t=this.context.formatTouches(e,!0),i=this.context.config.displayMode;if(this.isZoom||"slide"!==i){this.scroller.onEndHandler(e.timeStamp);var r=this.context.uiService.getMaxScrollValue(),n=r.maxScrollLeft,o=r.maxScrollTop,a=this.context.uiService.scrollContainer,s=a.scrollLeft,u=a.scrollTop;if(!this.isZoom&&!this.isSliding&&!this.isScrolling&&!this.context.draggingPrepared&&(n>0||o>0)&&window.TouchEvent&&e instanceof TouchEvent&&"default"===this.context.config.toolType){var l=new Date().getTime(),c=t[0].pageX,h=t[0].pageY,d=c-this.startX,f=h-this.startY,v=!1,g=!1;d>0?(v=0!==s,this.scrollDirectionX="right"):(v=s!==n,this.scrollDirectionX="left"),f>0?(g=0!==u,this.scrollDirectionY="down"):(g=u!==o,this.scrollDirectionY="up");var m=l-this.startTime;if((Math.abs(d)>10||Math.abs(f)>10)&&m>0&&m<300&&(v||g)){var y=Math.abs(d)/m,p=Math.abs(f)/m;(y>.4||p>.4)&&(y=Math.min(y,2.8),p=Math.min(p,2.8),this.scroll(y,p,-.05));}}}else{var w,b=null===(w=this.context)||void 0===w?void 0:w.getCurrentTab();b&&this.slide(b);}this.isStart=!1,this.lastScale=1,this.isZoom=!1;}}},{key:"scroll",value:function value(e,t,i){var r=this;this.isScrolling=!0;var n=this.context.uiService.scrollContainer,o=n.scrollLeft,a=n.scrollTop,s=0,u=0;this.scrollTimer=$N.createTimer(function(){var n=r.context.uiService.getMaxScrollValue(),l=n.maxScrollLeft,c=n.maxScrollTop;if(e<=0&&t<=0||!1===r.isScrolling)return $N.clearTimer(r.scrollTimer),r.scrollTimer=null,void(r.isScrolling=!1);e>=0&&("right"===r.scrollDirectionX?s-=40*e:s+=40*e,e+=i),t>=0&&("down"===r.scrollDirectionY?u-=40*t:u+=40*t,t+=i);var h=HL(o+s,0,l),d=HL(a+u,0,c);r.context.uiService.scrollTo(h,d);},25);}},{key:"wheelListener",value:function value(e){var t=this,i=this.context.config,r=e.wheelDelta;if(e.deltaY&&(r=-e.deltaY),1===e.deltaMode&&(r*=this.lineHeight),2===e.deltaMode&&(r=r<0?-100:100),e.ctrlKey&&i.enableZoomWithCtrl){if("multiple"!==i.displayMode){e.cancelable&&e.preventDefault();var n=r>0?i.wheelZoomDelta:1/i.wheelZoomDelta,o=this.context.rendererService.getCanvasPosition(),a=o.x,s=o.y;this.wheelTimer||(this.wheelTimer=jP(function(){t.context.zoomService.zoomTo(i.zoom*n,e.pageX-a,e.pageY-s),clearTimeout(t.wheelTimer),t.wheelTimer=null;},40));}}else e.shiftKey?(e.cancelable&&e.preventDefault(),this.context.uiService.scrollBy(-r,0)):(e.cancelable&&e.preventDefault(),this.context.uiService.scrollBy(0,-r));}}]);}(),Zj=function(){return Yk(function e(t){var i=this;Xk(this,e),Wk(this,"context",void 0),Wk(this,"tabManager",void 0),Wk(this,"appendPageTimer",null),Wk(this,"selectPage",function(e){var t=i.context,r=t.groupUid,n=t.hooksService,o=t.viewerUid;if(e.groupUid===r){var a=i.getTab(e.docUid);if(a){i.isCurrentTab(a.uid)&&n.hooks.beforeBufferChanged.emit(e);var s=!e.triggerByScroll||e.triggerByScroll&&e.trigger!==o;s&&(a.select(e.selectedUids),!1!==e.updateShiftReference&&a.updateShiftReference()),i.isCurrentTab(a.uid)&&(s&&!1!==e.updateShiftReference&&i.context.emitCurrentIndexChanged(),n.hooks.afterBufferChanged.emit(e),s&&(i.context.showTab(a),i.context.handleOrigin(),i.context.renderOnly()));}}}),this.context=t,this.tabManager=new WF({tabMode:this.context.config.tabMode});},[{key:"destroy",value:function value(){this.appendPageTimer&&(clearTimeout(this.appendPageTimer),this.appendPageTimer=null);}},{key:"createTab",value:function value(e){var t,i,r=this,n=this.context.config,o=n.displayMode,a=n.toolType,s=n.scrollDirection,u=n.fitType,l=n.rows,c=n.columns,h=n.enableDWT1x1,d=n.pageStyle,f=n.selectedPageStyle,v=n.hoveredPageStyle,g=n.zoom,m=this.context.getBorderWidth(d),y=this.context.getBorderWidth(f),p=this.context.getBorderWidth(v),w=this.context.uiService.getViewportSize(),b={doc:e,displayMode:o,toolType:a,fitType:u,direction:s,viewWidth:w.width||800,viewHeight:w.height||800,dpr:1,scrollbarWidth:17,row:l,column:c,borderWidth:m,selectedBorderWidth:y,hoveredBorderWidth:p,enableDWT1x1:h,viewer:this.context.viewer},k=xP(t=this.tabManager).call(t,e.uid);return k||((k=this.tabManager.createTab(e,b)).layoutStatus.zoom=g,$k(i=e.children).call(i,function(e){var t=r.createPage(e);t&&k.appendChild(t);})),k;}},{key:"getCurrentTab",value:function value(){return this.tabManager.getCurTab();}},{key:"getAllTabs",value:function value(){return this.tabManager.getAllTabs();}},{key:"isCurrentTab",value:function value(e){return this.tabManager.currentTabUid===e;}},{key:"updateTab",value:function value(e){var t,i=this,r=e.modifiedUid,n=e.data,o=this.context,a=o.viewerUid,s=o.groupUid,u=o.hooksService;$k(t=this.tabManager.getAllTabs()).call(t,function(e){var t=e.getChildByUid(r);if(t){var o,l,c,h,d,f={docUid:e.uid,trigger:a,groupUid:s,operation:"modify",modifiedUid:r};i.isCurrentTab(e.uid)&&u.hooks.beforeBufferChanged.emit(f);var v=e.current,g=RI(o=e.selected).call(o);t.isPreload=!1,t.isLoaded=!1,t.isUpdated=!0,t.image.style.img=null,t.clearOptimization(),$k(l=RI(c=t.blanks.childNodes).call(c)).call(l,function(e){t.blanks.removeChild(e);}),void 0!==(null===(h=n.metadata)||void 0===h?void 0:h.width)&&(t.realTimeWidth=n.metadata.width),void 0!==(null===(d=n.metadata)||void 0===d?void 0:d.height)&&(t.realTimeHeight=n.metadata.height),e.current=v,e.selected=g,i.isCurrentTab(e.uid)&&(i.context.showTab(e),u.hooks.afterBufferChanged.emit(f));}});}},{key:"movePage",value:function value(e){var t=this.getTab(e.docUid);if(t){var i=this.context.hooksService;this.isCurrentTab(t.uid)&&i.hooks.beforeBufferChanged.emit(e),t.move(e.from,e.to),this.isCurrentTab(t.uid)&&(this.context.emitCurrentIndexChanged(),i.hooks.afterBufferChanged.emit(e),this.context.showTab(t),this.context.renderOnly());}}},{key:"switchPage",value:function value(e){var t=this.getTab(e.docUid);if(t){var i=this.context.hooksService;this.isCurrentTab(t.uid)&&i.hooks.beforeBufferChanged.emit(e),t.switch(e.one,e.other),this.isCurrentTab(t.uid)&&(this.context.emitCurrentIndexChanged(),i.hooks.afterBufferChanged.emit(e),this.context.showTab(t),this.context.renderOnly());}}},{key:"reorderPages",value:function value(e){var t,i=xP(t=this.tabManager).call(t,e.docUid);if(i){var r=this.context.hooksService;this.isCurrentTab(i.uid)&&r.hooks.beforeBufferChanged.emit(e),i.reorder(e.indexes),this.isCurrentTab(i.uid)&&(r.hooks.afterBufferChanged.emit(e),this.context.showTab(i),this.context.emitCurrentIndexChanged());}}},{key:"changePage",value:function value(e){var t=this.context,i=t.groupUid,r=t.hooksService;if(e.groupUid===i){var n,o=xP(n=this.tabManager).call(n,e.docUid);o&&(o.current!==e.index||o.selected.length>1)&&(this.isCurrentTab(o.uid)&&r.hooks.beforeBufferChanged.emit(e),o.goto(e.index),o.updateShiftReference(),this.isCurrentTab(o.uid)&&(this.context.emitCurrentIndexChanged(),r.hooks.afterBufferChanged.emit(e),this.context.showTab(o),this.context.handleOrigin(),this.context.renderOnly()));}}},{key:"removePagesFromDoc",value:function value(e,t){var i=this.getTab(e);if(i){var r=this.context.hooksService,n={removedUids:t,docUid:i.uid,operation:"remove"};this.isCurrentTab(i.uid)&&r.hooks.beforeBufferChanged.emit(n),$k(t).call(t,function(e){var t=i.getChildByUid(e);t&&t.destroy(),i.removeChildByUid(e);}),i.updateShiftReference(),i.total||(i.topPageUid=null),this.isCurrentTab(i.uid)&&(r.hooks.afterBufferChanged.emit(n),this.context.showTab(i),this.context.handleOrigin(),this.context.renderOnly());}}},{key:"appendPagesToDoc",value:function value(e,t){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=this.getTab(e);if(o){var a=this.context,s=a.viewerUid,u=a.groupUid,l=a.hooksService,c=a.config,h={docUid:e,trigger:s,groupUid:u,operation:"add",isSameDoc:n};this.isCurrentTab(o.uid)&&l.hooks.beforeBufferChanged.emit(h);var d=r>-1;if($k(t).call(t,function(e,t){var n=i.createPage(e);n&&(n.clearOptimization(),d?o.insertChild(n,r+t):o.appendChild(n));}),c.autoSelectLatest){o.currentPage&&o.currentPage.clearOptimization(),o.current=d?r+t.length-1:o.total-1;var f=o.currentPage;f&&o.select([f.uid]);}else o.total>0&&-1===o.current&&(o.current=0,o.select([o.getChildByIndex(0).uid]));o.updateShiftReference(),this.isCurrentTab(o.uid)&&(l.hooks.afterBufferChanged.emit(h),this.appendPageTimer||(this.appendPageTimer=jP(function(){o.isLoadPage=!0,i.getCurrentTab()===o&&(i.context.showTab(o),c.autoSelectLatest&&"single"!==c.displayMode&&"slide"!==c.displayMode&&i.context.config.show?i.context.emitCurrentIndexChanged():i.context.renderOnly()),clearTimeout(i.appendPageTimer),i.appendPageTimer=null;},42)));}}},{key:"openDoc",value:function value(e){var t=this.context,i=t.config,r=t.hooksService,n=t.viewerUid,o=t.groupUid,a=this.getTab(e.uid);a||(a=this.createTab(e)).total>0&&(i.autoSelectLatest?a.current=a.total-1:a.current=0,a.select([a.getChildByIndex(a.current).uid])),this.context.showTab(a);var s={docUid:e.uid,trigger:n,groupUid:o,operation:"filter"};r.hooks.beforeBufferChanged.emit(s),r.hooks.afterBufferChanged.emit(s),i.autoSelectLatest&&"single"!==i.displayMode&&"slide"!==i.displayMode&&this.context.config.show?this.context.emitCurrentIndexChanged():this.context.renderOnly();}},{key:"renameDoc",value:function value(e,t){var i=this.getTab(t);i&&(i.name=e);}},{key:"removeDoc",value:function value(e){return!!TL(e)&&!!this.tabManager.closeTab(e)&&(0===this.getAllTabs().length&&this.context.tabCleared(),this.context.render(),!0);}},{key:"getTab",value:function value(e){var t;return xP(t=this.tabManager).call(t,e);}},{key:"createPage",value:function value(e){var t=this.context.config,i=t.pageStyle,r=t.checkboxStyle,n=t.pageNumberStyle,o=t.removeBtnStyle,a=t.blankFillColor,s=t.defaultWidth,u=t.defaultHeight,l=this.getFormattedStyle(i),c=this.context.getStatus(e);if(!c)return null;var h=c.realTimeWidth,d=c.realTimeHeight;return new DF({uid:e,style:{visibility:"hidden",pointerEvents:"auto",width:h||s,height:d||u},formattedPageStyle:l,checkboxStyle:r,pageNumberStyle:n,removeBtnStyle:o,realTimeWidth:h,realTimeHeight:d,blankFillColor:a||"rgba(0,0,0,0)"});}},{key:"getFormattedStyle",value:function value(e){var t=e.border,i=e.background,r={};return t&&(r=hF(t)),Fk({background:i},r);}},{key:"setViewportSize",value:function value(e,t){var i=this.tabManager.getCurTab();i&&i.updateLayoutStatus({viewWidth:e,viewHeight:t});}}]);}(),_j=function(){return Yk(function e(t){Xk(this,e),Wk(this,"container",void 0),Wk(this,"scrollContent",void 0),Wk(this,"scrollContainer",void 0),Wk(this,"canvasAndScrollContainer",void 0),Wk(this,"canvasContainer",void 0),Wk(this,"defaultDom",void 0),Wk(this,"rootDom",void 0),Wk(this,"hooks",{scroll:SN.create()}),Wk(this,"isBindContainer",!1),Wk(this,"viewerWidth",void 0),Wk(this,"viewerHeight",void 0),Wk(this,"context",void 0),Wk(this,"dpr",gN()),this.context=t;},[{key:"initDefaultUI",value:function value(){var e=this,t=this.context,i=t.postfix,r=t.config,n=this.createDefaultUI(),o=n.querySelector("#dvs-canvas-container".concat(i)),a=n.querySelector("#dvs-scroller-and-canvas".concat(i)),s=n.querySelector("#dvs-scroll-container".concat(i)),u=n.querySelector("#dvs-scroll-content".concat(i));if(this.canvasAndScrollContainer=a,this.scrollContainer=s,this.scrollContent=u,this.canvasContainer=o,this.defaultDom=n,o&&s){var l=this.context.getBorderWidth(r.viewerStyle);LU(o.style,{left:"".concat(l,"px"),top:"".concat(l,"px")}),LU(s.style,r.viewerStyle);}this.scrollContainer.addEventListener("scroll",function(t){e.hooks.scroll.emit(t);});}},{key:"createDefaultUI",value:function value(){var e=this.context,t=e.postfix;return e.config.pure?Gj(mF,t):Gj(gF,t);}},{key:"updateScrollContentSize",value:function value(e,t){this.scrollContent.style.width="".concat(e,"px"),this.scrollContent.style.height="".concat(t,"px");}},{key:"resizeViewport",value:function value(){var e=this.scrollContainer,t=e.clientWidth,i=e.clientHeight;return this.viewerWidth=e.offsetWidth,this.viewerHeight=e.offsetHeight,LU(this.canvasContainer.style,{width:"".concat(t,"px"),height:"".concat(i,"px")}),{width:t,height:i};}},{key:"getMaxScrollValue",value:function value(){var e=this.scrollContainer;return{maxScrollLeft:e.scrollWidth-e.clientWidth,maxScrollTop:e.scrollHeight-e.clientHeight};}},{key:"isViewerResized",value:function value(){return this.scrollContainer.offsetWidth!==this.viewerWidth||this.scrollContainer.offsetHeight!==this.viewerHeight;}},{key:"isDPRChanged",value:function value(){var e=gN();return this.dpr!==e&&(this.dpr=e,!0);}},{key:"isScrollbarAppeared",value:function value(){return this.scrollContent.offsetWidth>this.scrollContainer.clientWidth||this.scrollContent.offsetHeight>this.scrollContainer.clientHeight;}},{key:"getViewportSize",value:function value(){return{width:this.scrollContainer.clientWidth,height:this.scrollContainer.clientHeight};}},{key:"bindContainer",value:function value(e){if(!e)return!1;var t=e;return e&&TL(e)&&(t=document.querySelector("#".concat(e))),t.appendChild(this.defaultDom),this.container=t,this.rootDom=this.defaultDom,this.isBindContainer=!0,this.context.resize(),!0;}},{key:"unbindContainer",value:function value(){if(0===this.container.children.length)return!1;for(var e=0;e<this.container.children.length;e++)if(this.container.children[e]===this.rootDom){this.container.removeChild(this.rootDom);break;}return this.isBindContainer=!1,!0;}},{key:"scrollTo",value:function value(e,t){this.scrollContainer.scrollTo?this.scrollContainer.scrollTo(e,t):(this.scrollContainer.scrollLeft=e,this.scrollContainer.scrollTop=t);}},{key:"scrollBy",value:function value(e,t){this.scrollContainer.scrollBy?this.scrollContainer.scrollBy(e,t):(this.scrollContainer.scrollLeft+=e,this.scrollContainer.scrollTop+=t);}}]);}();function Gj(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=e.tag,r=e.style,n=e.id,o=e.className,a=e.children,s=document.createElement(i);return n&&(s.id=n+t),o&&(s.className=o),LU(s.style,r||{}),a&&$k(a).call(a,function(e){var i=Gj(e,t);s.appendChild(i);}),s;}var Kj=function(){return Yk(function e(t){Xk(this,e),Wk(this,"context",void 0),Wk(this,"zoomOriginCache",void 0),this.context=t;},[{key:"zoomTo",value:function value(e,t,i){var r;if((e=HL(e,this.context.config.minZoom,this.context.config.maxZoom))===this.context.config.zoom)return!1;var n=this.formatZoomOrigin(t,i);this.updateZoomReferencePoint(n),this.context.config.fitType="none",this.context.config.zoom=e;var o=null===(r=this.context)||void 0===r?void 0:r.getCurrentTab();if(o){var a;if(o.layoutStatus.zoom=e,o.fitType="none","multiple"===this.context.config.displayMode)return!1;this.context.layoutService.layout(o),n=this.formatZoomOrigin(t,i);var s=this.alignZoomReferencePoint(n),u=s.scrollLeft,l=s.scrollTop;return o.updateLayoutStatus({scrollLeft:u,scrollTop:l}),this.context.uiService.scrollTo(u,l),this.context.scrollerService.updateScroller({scrollLeft:u,scrollTop:l}),$k(a=o.childNodes).call(a,function(e){e.clearOptimization();}),this.context.rendererService.render(),!0;}return!1;}},{key:"formatZoomOrigin",value:function value(e,t){var i=this.context.rendererService.canvasDom.getBoundingClientRect(),r=i.width,n=i.height;if(CL(e)||CL(t)){var o=this.context.config.zoomOrigin,a=.5,s=.5;"left"===o.x?a=0:"right"===o.x&&(a=1),"top"===o.y?s=0:"bottom"===o.y&&(s=1),e=r*a,t=n*s;}return{originX:e=HL(e,0,r),originY:t=HL(t,0,n)};}},{key:"updateZoomReferencePoint",value:function value(e){var t,i,r,n,o=this,a=e.originX,s=e.originY,u=null,l=this.context.getPointerOverPageInfo(a,s).pageInfo.obj;if(l){var c=l.imageContainer.getPosition();r=(a-c.x)/this.context.config.zoom,n=(s-c.y)/this.context.config.zoom,t="center",i="center",u=l.uid;}else{var h,d,f=null===(h=this.context)||void 0===h?void 0:h.getCurrentTab(),v=Number.MAX_VALUE;null==f||$k(d=f.children).call(d,function(e){if(e.isVisible){var l=e.imageContainer.getPosition(),c=e.imageContainer,h=c.width,d=c.height,f=new IN(l.x+h/2,l.y+d/2).distanceTo({x:a,y:s});f<v&&(v=f,u=e.uid,a<l.x?(t="start",r=l.x-a):a>l.x+h?(t="end",r=a-(l.x+h)):(t="center",r=(a-l.x)/o.context.config.zoom),s<l.y?(i="start",n=l.y-s):s>l.y+d?(i="end",n=s-(l.y+d)):(i="center",n=(s-l.y)/o.context.config.zoom));}});}this.zoomOriginCache={imageX:r,imageY:n,positionX:t,positionY:i,pageUid:u};}},{key:"alignZoomReferencePoint",value:function value(e){var t,i=e.originX,r=e.originY,n=0,o=0,a=this.zoomOriginCache,s=a.imageX,u=a.imageY,l=a.positionX,c=a.positionY,h=a.pageUid,d=null===(t=this.context)||void 0===t?void 0:t.getCurrentTab();if(d){var f=d.getChildByUid(h);if(f){var v,g,m=f.imageContainer.getPosition();"start"===l?v=m.x-s:"center"===l?v=m.x+s*this.context.config.zoom:"end"===l&&(v=m.x+f.imageContainer.width+s),"start"===c?g=m.y-u:"center"===c?g=m.y+u*this.context.config.zoom:"end"===c&&(g=m.y+f.imageContainer.height+u),n=v-i,o=g-r;}}var y=this.context.uiService.scrollContainer,p=y.scrollLeft,w=y.scrollTop,b=this.context.uiService.getMaxScrollValue(),k=b.maxScrollLeft,S=b.maxScrollTop;return w+=o,{scrollLeft:p=HL(p+=n,0,k),scrollTop:w=HL(w,0,S)};}}]);}(),$j=function(){return Yk(function e(t,i){Xk(this,e),Wk(this,"viewerUid",void 0),Wk(this,"postfix",void 0),Wk(this,"groupUid",void 0),Wk(this,"emitter",void 0),Wk(this,"viewer",void 0),Wk(this,"config",_SL(yF)),Wk(this,"dvsContext",void 0),Wk(this,"boxRenderer",void 0),Wk(this,"configService",void 0),Wk(this,"hooksService",void 0),Wk(this,"layoutService",void 0),Wk(this,"rendererService",void 0),Wk(this,"scrollerService",void 0),Wk(this,"tabService",void 0),Wk(this,"uiService",void 0),Wk(this,"zoomService",void 0),Wk(this,"isFocus",!1),Wk(this,"defaultWidth",600),Wk(this,"defaultHeight",800),Wk(this,"isDestroyed",!1),Wk(this,"iListeners",[]),Wk(this,"draggingPrepared",!1),Wk(this,"showOutline",!1),this.viewer=t,this.configService=new Fj(this),this.hooksService=new jj(this),this.layoutService=new Yj(this),this.rendererService=new Xj(this),this.scrollerService=new qj(this),this.tabService=new Zj(this),this.uiService=new _j(this),this.zoomService=new Kj(this),this.viewerUid=WL(),this.groupUid=i.groupUid,NL(i.viewerConfig||{},this.config),this.emitter=i.emitter,this.postfix="-".concat(this.viewerUid),this.dvsContext=i.dvsContext,this.uiService.initDefaultUI(),this.initPlugins(),i.container&&this.uiService.bindContainer(i.container),this.config.show||(this.uiService.rootDom?this.uiService.rootDom.style.display="none":this.uiService.defaultDom.style.display="none");},[{key:"initPlugins",value:function value(){var e=this;new SF().init(this),new HF().init(this),new FF().init(this),new CF().init(this),new jF().init(this),new pF().init(this),$k(Jj).call(Jj,function(t){return t.init(e);});}},{key:"setDisableFocusOutline",value:function value(e){var t,i;this.showOutline=!e;var r=null==this||null===(t=this.rendererService)||void 0===t?void 0:t.canvasDom,n=null==this||null===(i=this.uiService)||void 0===i?void 0:i.scrollContainer;e?(n.classList.add("dvs-disable-outline"),r.classList.add("dvs-disable-outline")):(n.classList.remove("dvs-disable-outline"),r.classList.remove("dvs-disable-outline"));}},{key:"clearCurTabOptimization",value:function value(){var e,t=this.getCurrentTab();t&&$k(e=t.children).call(e,function(e){e.clearOptimization();});}},{key:"updateViewerConfig",value:function value(e){this.configService.updateConfig(e);}},{key:"setViewMode",value:function value(e,t){var i;if(!BL(t)||!BL(e))return this.err(fL),!1;if(e<=0||t<=0)return this.err(vL),!1;var r=this.config.rows!==e||this.config.columns!==t;this.config.rows=e,this.config.columns=t;var n=this.getCurrentTab();return n&&(n.row=e,n.column=t,this.resetScrollbarStatus(),$k(i=n.children).call(i,function(e){e.clearOptimization();}),this.render(),r&&this.emitCurrentIndexChanged()),this.ok(),!0;}},{key:"syncFromViewer",value:function value(e){var t=this,i=e.context.tabService.getAllTabs(),r=e.context.tabService.getCurrentTab();$k(i).call(i,function(e){var i,n,o=t.tabService.createTab(e.doc);o.current=e.current,o.select(RI(i=e.selected).call(i)),$k(n=e.children).call(n,function(e,t){if(e.blanks.children.length){var i,r=o.childNodes[t];$k(i=e.blanks.children).call(i,function(e){var t=new WW({id:e.id,style:{points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],background:e.style.background,borderWidth:0}});r.blanks.appendChild(t);});}if(e.overlays.children.length){var n,a=o.children[t];$k(n=e.overlays.children).call(n,function(e){var t,i=new WW({id:e.id,style:{points:RI(t=e.style.points).call(t),background:e.style.background,borderWidth:0,opacity:e.style.opacity}});a.overlays.appendChild(i);});}}),r.uid===o.uid&&t.showTab(o);});}},{key:"getStatus",value:function value(e){return this.dvsContext.spaceService.getStatus(e);}},{key:"getGlobalHooks",value:function value(){return this.dvsContext.hooksService.hooks;}},{key:"getLocalHooks",value:function value(){return this.hooksService.hooks;}},{key:"getCurrentTab",value:function value(){return this.tabService.getCurrentTab();}},{key:"getTab",value:function value(e){return this.tabService.getTab(e);}},{key:"getAllTabs",value:function value(){return this.tabService.getAllTabs();}},{key:"showTab",value:function value(e){var t,i,r=this;this.tabService.tabManager.setCurrentTab(e.uid),e.style.visibility="visible",this.config.show&&(0===e.total&&(this.resetScrollbarStatus(),this.resetScrollerSize(),this.resize()),this.layoutService.layout(e),0!==e.layoutStatus.viewWidth&&0!==e.layoutStatus.viewHeight&&(0===e.selected.length&&"single"===this.config.displayMode&&($k(t=e.children).call(t,function(e){e.updateStyle({visibility:"hidden"});}),this.resetScrollbarStatus(),this.resetScrollerSize(),this.resize()),$k(i=e.children).call(i,function(e){e.isPreload&&!e.isLoaded&&("multiple"===r.config.displayMode&&r.config.useMinImage?r.dvsContext.minImageService.load(e.uid):r.dvsContext.imageService.load(e.uid));}),this.hooksService.hooks.pageChanged.emit({current:e.current,total:e.total})));}},{key:"emitCurrentIndexChanged",value:function value(){var e=this.tabService.getCurrentTab();if(e&&(this.layoutService.layout(e),e.currentPage)){var t={isPassive:!1,trigger:this.viewerUid,docUid:""};this.hooksService.hooks.currentIndexChanged.emit(t);}}},{key:"resize",value:function value(){this.rendererService.resetCanvasSize();var e=this.uiService.resizeViewport(),t=e.width,i=e.height,r=gN();this.rendererService.canvas.setDPR(r),this.rendererService.canvas.resize(t,i),this.tabService.setViewportSize(t,i),this.scrollerService.updateScroller({viewportWidth:t,viewportHeight:i});}},{key:"resized",value:function value(){this.uiService.isBindContainer&&this.config.show&&(this.resetScrollbarStatus(),this.resize(),this.hooksService.hooks.resize.emit(),this.emitCurrentIndexChanged(),this.clearCurTabOptimization(),this.rendererService.render(),this.handleOrigin(),this.emit("resize",this.viewer.width,this.viewer.height));}},{key:"externalResized",value:function value(){if((this.uiService.isViewerResized()||this.uiService.isDPRChanged())&&this.uiService.isBindContainer&&this.config.show){this.resetScrollbarStatus(),this.resetScrollerSize(),this.resize(),this.hooksService.hooks.externalResized.emit(),this.emitCurrentIndexChanged();var e=this.getCurrentTab();e&&(this.layoutService.layout(e),this.clearCurTabOptimization()),this.rendererService.render(),this.handleOrigin(),this.emit("resize",this.viewer.width,this.viewer.height);}}},{key:"handleOrigin",value:function value(){if("single"===this.config.displayMode){var e=this.uiService.getMaxScrollValue(),t=e.maxScrollLeft,i=e.maxScrollTop,r=this.config.zoomOrigin,n=r.x,o=r.y,a=t/2,s=i/2;"left"===n?a=0:"right"===n&&(a=t),"top"===o?s=0:"bottom"===o&&(s=i),this.uiService.scrollTo(a,s);}}},{key:"getScrollbarWidth",value:function value(){var e,t=document.createElement("div"),i=document.createElement("div");if(t.appendChild(i),t.style.width="60px",t.style.height="60px",t.style.position="absolute",t.style.overflow="auto",i.style.width="100px",i.style.height="100px",null===(e=document)||void 0===e||!e.body)return 0;document.body.appendChild(t);var r=t.offsetWidth-t.clientWidth;return document.body.removeChild(t),r;}},{key:"selectPage",value:function value(e){this.tabService.selectPage(e),this.dvsContext.hooksService.hooks.selectPage.emit(e);}},{key:"getCanvasDpr",value:function value(){return this.rendererService.canvas.contextService.getDPR();}},{key:"optimizePage",value:function value(e){var t=this;if(this.config.enableOptimizeImage){var i=this.tabService.getCurrentTab();if(i){var r=i.getChildByUid(e);if(r){var n;if(r.isOptimized||!r.isVisible||!r.isLoaded||r.optimizationUid===r.optimizedUid||this.scrollerService.isSliding||this.isDestroyed)return;var o=this.getStatus(e);if(!(null!=o&&o.img||null!=o&&o.minImg))return;var a=r.image.style.img,s=a.naturalWidth,u=a.naturalHeight,l=s,c=u,h=this.config.maxOptimizationSize;if(l>h||c>h||r.realTimeWidth>h||r.realTimeHeight>h)return;var d=[],f=[];if(this.dvsContext.editService){var v={operations:o.operations,width:s,height:u};"multiple"===this.config.displayMode&&this.config.useMinImage&&(v.operations=this.dvsContext.editService.toMinImageOperations(o.operations,o.imageScale));var g=this.dvsContext.editService.handle(v);l=g.width,c=g.height,d=g.matrixes,f=g.blanks||[];}var m=new LW({style:{x:0,y:0,img:a,width:s,height:u}});m.externalMatrixes=d;var y="rgba(0,0,0,0)";if("multiple"===this.config.displayMode){var p=this.config.pageStyle;r.isSelected?p=this.config.selectedPageStyle:r.isHovered&&(p=this.config.hoveredPageStyle),y=p.background;}o.useFillColor&&(y=this.config.blankFillColor);var w=new AW({style:{x:0,y:0,width:l,height:c,background:y}}),b=new AW();$k(f).call(f,function(e){var t=new WW({id:e.uid,style:{background:e.background,points:e.points,borderWidth:0}});b.appendChild(t);}),m.appendChild(b),w.appendChild(m);var k=new AW();$k(n=r.overlays.children).call(n,function(e){var t,i=new WW({id:e.id,style:{points:RI(t=e.style.points).call(t),background:e.style.background,borderWidth:0,opacity:e.style.opacity}});k.appendChild(i);}),w.appendChild(k),this.dvsContext.commonCanvas.render(w),this.dvsContext.commonCanvas.clear();var S=this.dvsContext.commonCanvas.getCanvas(),x=gN(),C=Math.floor(r.imageContainer.width*x-1),V=Math.floor(r.imageContainer.height*x-1);r.isOptimized=!0,this.dvsContext.optimizationService.optimize(S,l,c,C,V,r.optimizationUid).then(function(e){if(!t.isDestroyed&&e.taskUid===r.optimizationUid){r.isOptimized=!0,r.optimizedUid=r.optimizationUid;var i=S.getContext("2d",{willReadFrequently:!0}).createImageData(C,V);i.data.set(e.target),r.imageContainer.imageData=i,r.isVisible&&t.render();}}).catch(function(e){r.isOptimized=!1;});}}}}},{key:"renderPage",value:function value(e){if(!(this.isDestroyed||this.config.useMinImage&&"multiple"===this.config.displayMode)){var t=this.tabService.getCurrentTab();if(t){var i=t.getChildByUid(e);if(i){var r=this.dvsContext.spaceService.getStatus(e);r&&(r.img&&(i.isLoaded=!0,i.updateImage(r.img)),i.isVisible&&(this.render(),this.handleOrigin()));}}}}},{key:"renderMinPage",value:function value(e){if(!this.isDestroyed&&this.config.useMinImage&&"multiple"===this.config.displayMode){var t=this.tabService.getCurrentTab();if(t){var i=t.getChildByUid(e);if(i){var r=this.dvsContext.spaceService.getStatus(e);r&&(r.minImg&&(i.isLoaded=!0,i.updateImage(r.minImg)),i.isVisible&&(this.render(),this.handleOrigin()));}}}}},{key:"renderOnly",value:function value(){this.rendererService.render();}},{key:"render",value:function value(){if(!this.config.show)return!1;if(this.isDestroyed)return!1;var e=this.tabService.getCurrentTab();if(e){var t;this.layoutService.layout(e),0===e.selected.length&&"single"===this.config.displayMode&&($k(t=e.children).call(t,function(e){e.updateStyle({visibility:"hidden"});}),this.resetScrollbarStatus(),this.resetScrollerSize(),this.resize()),this.config.zoom=e.layoutStatus.zoom;var i=this.uiService.scrollContainer,r=i.scrollLeft,n=i.scrollTop;e.setPosition({x:-r,y:-n}),e.updateLayoutStatus({scrollLeft:r,scrollTop:n}),this.scrollerService.updateScroller({scrollLeft:r,scrollTop:n});}return this.rendererService.render(),this.ok(),!0;}},{key:"tabCleared",value:function value(){this.tabService.tabManager.clear(),this.uiService.updateScrollContentSize(0,0),this.scrollerService.updateScroller({contentWidth:0,contentHeight:0}),this.render();}},{key:"storeActionToStatus",value:function value(e){var t,i=this;$k(t=(e=_SL(e)).uids).call(t,function(t){var r=i.getStatus(t);if(r){var n=r.operations[r.operations.length-1];n&&n.type===e.actionType||(n={type:e.actionType,detail:[]},r.operations.push(n)),n.detail.push(e);}});}},{key:"removeActionFromStatus",value:function value(e){var t,i=this;$k(t=e.uids).call(t,function(t){var r=i.getStatus(t);if(r){var n=r.operations[r.operations.length-1];if(n&&n.type===e.actionType&&(n.detail.pop(),!n.detail.length)){var o,a,s=OI(o=r.operations).call(o,n);s>-1&&gE(a=r.operations).call(a,s,1);}}});}},{key:"isEmpty",value:function value(){var e=this.getCurrentTab();return!e||0===e.children.length;}},{key:"resetScrollbarStatus",value:function value(){var e,t=this;$k(e=this.getAllTabs()).call(e,function(e){e.layoutStatus.scrollbarWidth=t.getScrollbarWidth(),e.layoutStatus.resetScrollbarStatus();});}},{key:"resetScrollerSize",value:function value(){var e=this.uiService.scrollContainer;this.rendererService.canvasDom.style.width="0px",this.rendererService.canvasDom.style.height="0px",this.uiService.canvasContainer.style.width="0px",this.uiService.canvasContainer.style.height="0px",this.uiService.scrollContent.style.width="0px",this.uiService.scrollContent.style.height="0px";var t=e.clientWidth,i=e.clientHeight;LU(this.uiService.canvasContainer.style,{width:"".concat(t,"px"),height:"".concat(i,"px")});}},{key:"setScrollbarWidth",value:function value(e){var t;$k(t=this.tabService.tabManager.tabs).call(t,function(t){t.scrollbarWidth=e;});}},{key:"getPointerOverPageInfo",value:function value(e,t){var i=function(e,t,i){var r={pageInfo:{isOver:!1,pointerX:-1,pointerY:-1,obj:null,pagePositionX:-1,pagePositionY:-1,pageWidth:-1,pageHeight:-1},imageInfo:{isOver:!1,pointerX:-1,pointerY:-1,obj:null},index:-1};if(e)for(var n=0;n<e.children.length;n++){var o=e.children[n],a=dF(o,t,i);if(a.isOver){r.index=n;var s=o.getPosition(),u=s.x,l=s.y,c=o.getScale(),h=c.x,d=c.y;a.pagePositionX=u,a.pagePositionY=l,a.pageWidth=o.parsedStyle.width.value*h,a.pageHeight=o.parsedStyle.height.value*d,LU(r.pageInfo,a);var f=dF(o.imageContainer,t,i);return LU(r.imageInfo,f),r;}}return r;}(this.tabService.getCurrentTab(),e,t);return i;}},{key:"getHitRemoveBtn",value:function value(e,t){var i=this.getCurrentTab();if(i)for(var r=0;r<i.total;r++){var n=i.childNodes[r];if(n.isVisible&&n.removeBtn.isVisible){var o=n.removeBtn.parsedCheckBoxStyle,a=o.x,s=o.y,u=o.width,l=o.height,c=n.getPosition(),h=c.x,d=c.y;if(e>=a+h&&t>=s+d&&e<=a+h+u&&t<=s+d+l)return r;}}return-1;}},{key:"getCanvasPosition",value:function value(){return this.rendererService.getCanvasPosition();}},{key:"getBorderWidth",value:function value(e){var t=e.border;if(!t)return 0;var i=t.match(/[0-9]+/g)[0];return $S(i||"0",10);}},{key:"isBorderWidthEqualHovered",value:function value(){return this.getBorderWidth(this.config.pageStyle)===this.getBorderWidth(this.config.hoveredPageStyle);}},{key:"isSelectedBorderWidthEqualHovered",value:function value(){return this.getBorderWidth(this.config.selectedPageStyle)===this.getBorderWidth(this.config.hoveredPageStyle);}},{key:"isSelectedBorderWidthEqualNormal",value:function value(){return this.getBorderWidth(this.config.pageStyle)===this.getBorderWidth(this.config.selectedPageStyle);}},{key:"formatTouches",value:function value(e){var t,i=[];t=e instanceof MouseEvent||e instanceof PointerEvent?[e]:arguments.length>1&&void 0!==arguments[1]&&arguments[1]?e.changedTouches:e.touches;for(var r=this.rendererService.getCanvasPosition(),n=r.x,o=r.y,a=0;a<t.length;a++){var s=t[a];i.push({pageX:s.pageX-n,pageY:s.pageY-o});}return i;}},{key:"getMargin",value:function value(){return this.formatMarginAndGap(this.config.margin);}},{key:"getGap",value:function value(){return this.formatMarginAndGap(this.config.gap);}},{key:"formatMarginAndGap",value:function value(e){if(TL(e)){if(/px/.test(e)){var t=Gb(e.match(/(\d+)/),1)[0];return $S(t,10);}if(/%/.test(e)){var i=this.rendererService.canvasDom.width/gN(),r=Gb(e.match(/(\d+)/),1)[0];return i*$S(r,10)/100;}if(/em/.test(e)){var n=Gb(getComputedStyle(this.rendererService.canvasDom).fontSize.match(/(\d+)/),1)[0],o=Gb(e.match(/(\d+)/),1)[0];return $S(n,10)*$S(o,10);}}return BL(e)?e:$S(e,10);}},{key:"saveEvents",value:function value(){this.emitter.save();}},{key:"restoreEvents",value:function value(){this.emitter.restore();}},{key:"on",value:function value(e,t){if(TL(e)&&ML(t)){var i=this.emitter.on(e,t);this.iListeners.push(i);}else this.err(fL);}},{key:"emit",value:function value(e){for(var t,i,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];TL(e)?(t=this.emitter).emit.apply(t,lS(i=[e]).call(i,n)):this.err(fL);}},{key:"off",value:function value(e,t){TL(e)&&(void 0===t||ML(t))?this.emitter.off(e,t):this.err(fL);}},{key:"err",value:function value(e){this.dvsContext.errorService.err(e);}},{key:"ok",value:function value(){this.err(dL);}},{key:"unbindEvents",value:function value(){var e,t=this;$k(e=this.iListeners).call(e,function(e){var i=e.name,r=e.fn,n=e.context,o=e.once;t.emitter.off(i,r,n,o);}),this.iListeners=[];}},{key:"destroy",value:function value(){this.isDestroyed||(this.getLocalHooks().destroy.emit(),this.scrollerService.destroy(),this.tabService.destroy(),this.unbindEvents(),this.isDestroyed=!0);}},{key:"getVisiblePagesInfo",value:function value(){var e=this.tabService.getCurrentTab();if(!e)return[];if(!this.viewer.getViewerConfig().show)return[];var t=e.visibleChildren,i=[];if(t.length>0){var r,n=this.rendererService,o=this.uiService.container;null!==(r=this.viewer)&&void 0!==r&&r.isThumbnail&&(o=this.viewer.thumbnailObject.viewer.context.uiService.container);var a=n.canvasDom,s=o.getBoundingClientRect(),u=s.left,l=s.top,c=a.getBoundingClientRect(),h=c.left,d=c.top,f=e.getIndexByUid(t[0].id);$k(t).call(t,function(e,t){!function(e,t){if(e.isVisible){var r=e.getPosition(),n=r.x,o=r.y,a=e.getScale(),s=a.x,c=a.y,f=Math.round(e.parsedStyle.width.value*s*10)/10,v=Math.round(e.parsedStyle.height.value*c*10)/10;i.push({pageIndex:t,isHovered:e.isHovered,isSelected:e.isSelected,pageWidth:f,pageHeight:v,canvasOffsetX:Math.round(10*n)/10,canvasOffsetY:Math.round(10*o)/10,containerOffsetX:Math.round(10*(h-u+n))/10,containerOffsetY:Math.round(10*(d-l+o))/10});}}(e,f+t);});}return i;}}]);}(),Jj=[],Qj=function(){return Yk(function e(t){Xk(this,e),Wk(this,"context",void 0),Wk(this,"OriginalViewer",e),Wk(this,"uid",void 0),Wk(this,"groupUid",null),Wk(this,"postfix",void 0),Wk(this,"destroyFlag",!1),this.context=new $j(this,t),this.uid=this.context.viewerUid,this.postfix=this.context.postfix,this.groupUid=this.context.groupUid;},[{key:"isDestroyed",get:function get(){return this.destroyFlag;}},{key:"currentPageCount",get:function get(){var e=this.getCurrentTab();return(null==e?void 0:e.total)||0;}},{key:"rootDom",get:function get(){return this.context.uiService.rootDom;}},{key:"defaultDom",get:function get(){return this.context.uiService.defaultDom;}},{key:"container",get:function get(){return this.context.uiService.container;}},{key:"scrollContainer",get:function get(){return this.context.uiService.scrollContainer;}},{key:"canvasContainer",get:function get(){return this.context.uiService.canvasContainer;}},{key:"updateViewerConfig",value:function value(e){this.context.updateViewerConfig(e);}},{key:"getViewerConfig",value:function value(){return this.context.config;}},{key:"getViewerConfigByName",value:function value(e){return this.context.config[e];}},{key:"show",value:function value(){if(!0!==this.context.config.show){this.context.config.show=!0;var e=this.context.uiService,t=e.rootDom,i=e.defaultDom;t&&(t.style.display="flex",i.style.display="flex"),this.resized();var r=this.getCurrentTab();return r&&this.context.showTab(r),!0;}return!1;}},{key:"hide",value:function value(){if(!1!==this.context.config.show){this.context.config.show=!1;var e=this.context.uiService.rootDom;return e&&(e.style.display="none"),!0;}return!1;}},{key:"bindContainer",value:function value(e){return this.context.uiService.bindContainer(e);}},{key:"unbindContainer",value:function value(){return this.context.uiService.unbindContainer();}},{key:"externalResized",value:function value(){this.context.externalResized();}},{key:"resized",value:function value(){this.context.resized();}},{key:"checkPageVisibility",value:function value(e){var t={min:!1,ori:!1},i=this.getCurrentTab();if(i){var r=i.getChildByUid(e);r&&r.isPreload&&("multiple"===this.context.config.displayMode&&(t.min=!0),t.ori=!0);}return t;}},{key:"getCurrentTab",value:function value(){var e;return null===(e=this.context)||void 0===e?void 0:e.getCurrentTab();}},{key:"getTab",value:function value(e){return TL(e)?this.context.tabService.getTab(e):(this.err(fL),null);}},{key:"getAllTabs",value:function value(){return this.context.tabService.getAllTabs();}},{key:"removePage",value:function value(e){if(BL(e)&&(e=[e]),!bL(e))return this.err(fL),!1;var t=e.length;if(0===t)return this.err(mL),!1;var i=this.getCurrentTab();if(!i)return!1;for(var r=[],n=0;n<t;n++){var o=this.getUidByIndex(e[n]);if(!o)return!1;r.push(o);}var a={removedUids:r,docUid:i.uid,trigger:this.uid,operation:"remove"};return this.context.getLocalHooks().remove.emit(a),!0;}},{key:"removeAllPages",value:function value(){var e=this.getCurrentTab();if(e){var t,i={removedUids:$E(t=e.children).call(t,function(e){return e.uid;}),docUid:e.uid,trigger:this.uid,operation:"remove"};this.context.getLocalHooks().remove.emit(i);}return this.ok(),!0;}},{key:"switchPage",value:function value(e,t){var i=this.getCurrentTab();if(!i||!this.isIndexValid(i,e)||!this.isIndexValid(i,t))return!1;var r={one:e,other:t,trigger:this.uid,docUid:i.uid,type:i.type,operation:"shift"};return this.context.getLocalHooks().switch.emit(r),!0;}},{key:"movePage",value:function value(e,t){var i=this.getCurrentTab();if(!i||!this.isIndexValid(i,e)||!this.isIndexValid(i,t))return!1;var r={from:e,to:t,trigger:this.uid,docUid:i.uid,type:i.type,operation:"shift"};return this.context.getLocalHooks().move.emit(r),!0;}},{key:"reorderPage",value:function value(e){var t=this.getCurrentTab();if(!t||!bL(e)||t.total!==e.length)return!1;var i={indexes:e,trigger:this.uid,docUid:t.uid,type:t.type,operation:"shift"};return this.context.getLocalHooks().reorder.emit(i),!0;}},{key:"setViewMode",value:function value(e,t){return this.context.setViewMode(e,t);}},{key:"nextPage",value:function value(){var e=this.getCurrentTab();if(!e)return-1;var t=e.current;if(t+1===e.total&&e.selected.length<=1)return t;var i={index:t+1,docUid:e.uid,trigger:this.uid,groupUid:this.groupUid,operation:"shift"};return this.context.getLocalHooks().changePage.emit(i),e.current;}},{key:"prevPage",value:function value(){var e=this.getCurrentTab();if(!e)return-1;var t=e.current;if(t-1<0&&e.selected.length<=1)return t;var i={index:t-1,docUid:e.uid,trigger:this.uid,groupUid:this.groupUid,operation:"shift"};return this.context.getLocalHooks().changePage.emit(i),e.current;}},{key:"firstPage",value:function value(){var e=this.getCurrentTab();if(!e)return-1;var t=e.current;if(0===t&&e.selected.length<=1)return t;var i={index:0,docUid:e.uid,trigger:this.uid,groupUid:this.groupUid,operation:"shift"};return this.context.getLocalHooks().changePage.emit(i),e.current;}},{key:"lastPage",value:function value(){var e=this.getCurrentTab();if(!e)return-1;var t=e.current,i=e.total;if(t===i-1&&e.selected.length<=1)return t;var r={index:i,docUid:e.uid,trigger:this.uid,groupUid:this.groupUid,operation:"shift"};return this.context.getLocalHooks().changePage.emit(r),e.current;}},{key:"gotoPage",value:function value(e){var t=this.getCurrentTab();if(!t)return-1;var i=t.current;if(e>t.total-1||e<0)return-1;if(i===e&&t.selected.length<=1)return i;var r={index:e,docUid:t.uid,trigger:this.uid,groupUid:this.groupUid,operation:"shift"};return this.context.getLocalHooks().changePage.emit(r),t.current;}},{key:"getCurrentIndex",value:function value(){var e=this.getCurrentTab();return e?(this.err(dL),e.current):(this.err(gL),-1);}},{key:"setCurrentIndex",value:function value(e){return-1!==this.gotoPage(e);}},{key:"setSelectedIndexes",value:function value(e){if(!bL(e))return this.err(fL),!1;var t=this.getCurrentTab();if(!t)return!1;var i=t.selected,r=!1;i.length!==e.length&&(r=!0);for(var n=[],o=0;o<e.length;o++){var a=this.getUidByIndex(e[o]);if(!a)return!1;i[o]!==a&&(r=!0),n.push(a);}if(!r)return!0;var s={selectedUids:n,indexes:e,docUid:t.uid,trigger:this.uid,groupUid:this.groupUid,operation:"shift"};return this.context.getLocalHooks().selectPage.emit(s),!0;}},{key:"getSelectedIndexes",value:function value(){var e,t=this.getCurrentTab();if(!t)return this.err(gL),null;var i=$E(e=t.selected).call(e,function(e){return t.getIndexByUid(e);});return this.ok(),i;}},{key:"selectAll",value:function value(){var e,t=this.getCurrentTab();if(!t)return this.err(gL),!1;var i=Kb(GB(e=Array(t.total)).call(e));return this.setSelectedIndexes(i);}},{key:"getIndexByUid",value:function value(e){if(!TL(e))return null;var t=this.getCurrentTab();if(!t)return this.err(gL),null;var i=t.getIndexByUid(e);return i>-1?this.ok():this.err(mL),i;}},{key:"getUidByIndex",value:function value(e){var t=this.getCurrentTab();return t?this.isIndexValid(t,e)?(this.ok(),t.children[e].uid):null:(this.err(gL),null);}},{key:"undo",value:function value(){var e=this.getCurrentTab();if(e){var t=e.commandController.undoStack,i=t[t.length-1];if(i){var r,n={commandUid:i.uid,trigger:this.uid};return $k(r=i.action.uids).call(r,function(t){var i=e.getChildByUid(t);i&&i.clearOptimization();}),this.context.getGlobalHooks().undo.emit(n),!0;}}return!1;}},{key:"redo",value:function value(){var e=this.getCurrentTab();if(e){var t=e.commandController.redoStack,i=t[t.length-1];if(i){var r,n={commandUid:i.uid,trigger:this.uid};return $k(r=i.action.uids).call(r,function(t){var i=e.getChildByUid(t);i&&i.clearOptimization();}),this.context.storeActionToStatus(i.action),this.context.getGlobalHooks().redo.emit(n),!0;}}return!1;}},{key:"reset",value:function value(e){var t=this;if(!vF(this,e=fF(this,e)))return!1;var i=this.getCurrentTab(),r=$E(e).call(e,function(e){return i.getChildByIndex(e).uid;}),n={tabUid:i.uid,tabType:i.type,trigger:this.uid,uids:r};return $k(r).call(r,function(e){var r=t.context.getStatus(e);r&&(r.operations=[]);var n=i.getChildByUid(e);n&&n.clearOptimization();}),this.context.getGlobalHooks().reset.emit(n),!0;}},{key:"zoomIn",value:function value(){var e=this.getViewerConfigByName("zoom");this.updateViewerConfig({zoom:1.2*e});}},{key:"zoomOut",value:function value(){var e=this.getViewerConfigByName("zoom");this.updateViewerConfig({zoom:e/1.2});}},{key:"render",value:function value(){return this.context.render();}},{key:"on",value:function value(e,t){this.context.on(e,t);}},{key:"emit",value:function value(e){for(var t,i,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];(t=this.context).emit.apply(t,lS(i=[e]).call(i,n));}},{key:"off",value:function value(e,t){this.context.off(e,t);}},{key:"err",value:function value(e){this.context.dvsContext.errorService.err(e);}},{key:"ok",value:function value(){this.err(dL);}},{key:"isIndexValid",value:function value(e,t){return BL(t)?!(t<0||t>=e.total)||(this.err(vL),!1):(this.err(fL),!1);}},{key:"destroy",value:function value(){this.destroyFlag||(this.context.destroy(),this.context=null,this.destroyFlag=!0);}}],[{key:"use",value:function value(e){OI(Jj).call(Jj,e)<0&&Jj.push(e);}}]);}(),eY={Viewer:Qj},tY=function(){return Yk(function e(t,i){Xk(this,e),Wk(this,"dvs",void 0),Wk(this,"errorService",void 0),Wk(this,"hooksService",void 0),Wk(this,"imageService",void 0),Wk(this,"minImageService",void 0),Wk(this,"layoutService",void 0),Wk(this,"spaceService",void 0),Wk(this,"trackerService",void 0),Wk(this,"viewerService",void 0),Wk(this,"saveService",void 0),Wk(this,"workerService",void 0),Wk(this,"commonCanvas",void 0),Wk(this,"optimizationService",void 0),this.dvs=t,this.errorService=new QH(this),this.hooksService=new eF(this),this.imageService=new tF(this),this.minImageService=new rF(this),this.layoutService=new iF(this),this.spaceService=new oF(this,i),this.trackerService=new sF(this),this.viewerService=new uF(this),this.saveService=new nF(this),this.workerService=new lF(this),this.commonCanvas=new PH(),this.optimizationService=new cF(this);},[{key:"destroy",value:function value(){this.imageService.destroy(),this.minImageService.destroy();}},{key:"getSpace",value:function value(){return this.spaceService.space;}}]);}(),iY=[],rY=function(){return Yk(function e(t){Xk(this,e),Wk(this,"uid",void 0),Wk(this,"emitter",void 0),Wk(this,"subClasses",void 0),Wk(this,"isDestroyed",!1),Wk(this,"options",void 0),Wk(this,"context",void 0),this.uid=WL(),this.subClasses=eY,this.emitter=bN.create(),this.options=t,this.context=new tY(this,t.space),this.init(),nH(["borderWidth","letterSpacing","lineDashOffset","shadowOffsetX","shadowOffsetY","shadowBlur","textMaxWidth"],HO,void 0),nH(["startAngle","endAngle"],jO,void 0),nH(["r","rx","ry","width","height","padding","fontSize","arrowWidth","markSize","markLineWidth"],HO,void 0),nH(["borderColor","background","shadowColor","color"],_O,void 0),nH(["opacity","fillOpacity","borderOpacity"],$O,void 0),rH("lineDash",KO,void 0),rH("shadow",GO,void 0),nH(["x","y"],void 0,JO),nH(["points"],void 0,JW),nH(["x1","y1","x2","y2"],void 0,$W),nH(["startPoint","endPoint"],void 0,tH),nH(["lineEnding"],void 0,iH),nH(["fontStyle","fontVariant","fontWeight","fontFamily","fontSize"],void 0,QW),nH(["x","y","width","wordWarp","lineHeight","text","textTransform","textBaseLine"],void 0,KW),nH(["width","height"],void 0,eH);},[{key:"init",value:function value(){var e=this;new $H().apply(this.context),new JH().apply(this.context),this.emitter.save(),$k(iY).call(iY,function(t){var i,r=t.plugin,n=t.config;!ML(r)&&ML(r.init)&&r.init.apply(r,lS(i=[e]).call(i,Kb(n)));}),this.context.hooksService.hooks.init.emit(),this.emitter.restore();}},{key:"setSpace",value:function value(e){e!==this.context.spaceService.space&&(this.context.hooksService.hooks.beforeSetSpace.emit(e),this.context.spaceService.setSpace(e),this.context.hooksService.hooks.afterSetSpace.emit(e));}},{key:"getImageData",value:function value(e,t){return this.context.saveService.getImageData(e,t);}},{key:"destroy",value:function value(){var e;this.isDestroyed||(this.context.hooksService.hooks.destroy.emit(),this.context.destroy(),null!==(e=this.emitter)&&void 0!==e&&e.destroy(),this.emitter=null,this.subClasses=null,this.isDestroyed=!0);}},{key:"removeSource",value:function value(e){return this.context.spaceService.space.removeSource(e);}},{key:"loadSource",value:function value(e){return this.context.spaceService.space.loadSource(e);}},{key:"updateSource",value:function value(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.context.spaceService.space.updateSource(e,t,i);}},{key:"createViewer",value:function value(e){return this.context.viewerService.createViewer(e);}},{key:"removeViewer",value:function value(e){return this.context.viewerService.removeViewer(e);}},{key:"getViewerByUid",value:function value(e){return this.context.viewerService.getViewer(e);}},{key:"getViewerByIndex",value:function value(e){return this.context.viewerService.viewerManager.getAllViewers()[e];}},{key:"getViewerList",value:function value(){var e;return RI(e=this.context.viewerService.viewerManager.getAllViewers()).call(e);}}],[{key:"use",value:function value(e){for(var t,i,r,n=arguments.length,o=new Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];return OI(t=$E(iY).call(iY,function(e){return e.plugin;})).call(t,e)>-1?(console.error("The plugin ".concat(e.name," is already installed.")),this):("function"==typeof e?e.apply(void 0,lS(i=[this]).call(i,o)):"function"==typeof e.install&&e.install.apply(e,lS(r=[this]).call(r,o)),iY.push({plugin:e,config:o}),this);}},{key:"useAll",value:function value(e){var t=this;return $k(e).call(e,function(e){if(bL(e)){var i,r=ph(a=e)||wd(a)||Kd(a)||$d(),n=r[0],o=RI(r).call(r,1);t.use.apply(t,lS(i=[n]).call(i,Kb(o)));}else t.use(e);var a;}),this;}},{key:"getClassStore",value:function value(){return eY;}},{key:"getPlugins",value:function value(){return iY;}}]);}(),nY={sequence:-1,location:"horizontal",size:180,thumbnailStyle:{},canvasStyle:{border:"1px solid #2a2a2a"},pageStyle:{},selectedPageStyle:{},placeholderStyle:{},hoveredPageStyle:{},pageNumberStyle:{},checkboxStyle:{},removeBtnStyle:{},enableDragPage:!0,enableKeyboardControl:!0,multiselectMode:!1,scrollDirection:"vertical",rows:4,columns:1,show:!0,enableResizing:!0,autoChangeIndex:!0,gap:10,margin:10,autoSelectTopPage:!1,autoScroll:!0,autoSelectLatest:!0},oY={enableOptimizeImage:!1,enableZoom:!1,displayMode:"multiple",toolType:"default",rows:4,columns:1,pure:!0,tabMode:"single"},aY=function(){return Yk(function e(t){Xk(this,e),Wk(this,"uid",void 0),Wk(this,"emitter",void 0),Wk(this,"thbConfig",{}),Wk(this,"innerViewer",void 0),Wk(this,"viewer",void 0),Wk(this,"postfix",void 0),Wk(this,"container",void 0),Wk(this,"hooks",{destroy:SN.create()}),Wk(this,"configHandlers",{}),Wk(this,"isDestroyed",!1);var i=bN.create();this.emitter=i,this.viewer=t.viewer,NL(oY,this.thbConfig),NL(nY,this.thbConfig),NL(t.viewerConfig||{},this.thbConfig),this.initThbConfigHandlers(),this.innerViewer=new this.viewer.OriginalViewer(Fk(Fk({},t),{},{emitter:i,viewerConfig:Fk(Fk({},this.thbConfig),{},{viewerStyle:Fk({},this.thbConfig.thumbnailStyle)}),groupUid:this.viewer.groupUid,dvsContext:t.viewer.context.dvsContext})),this.innerViewer.isThumbnail=!0,this.innerViewer.thumbnailObject=this,this.uid=this.innerViewer.uid,this.postfix=this.innerViewer.context.postfix,this.listenViewerHooks(),t.container||this.updatePosition();},[{key:"listenViewerHooks",value:function value(){var e=this,t=this.viewer.context.hooksService.hooks,i=function i(){e.innerViewer&&e.innerViewer.context.resized();},r=function r(){e.innerViewer&&e.innerViewer.externalResized();},n=function n(t){e.innerViewer.context.hooksService.hooks.openDoc.emit(t);};t.resize.on(i),t.externalResized.on(r),t.openDoc.on(n),t.destroy.on(function(){e.destroy();}),this.hooks.destroy.on(function(){t.resize.off(i),t.externalResized.off(r),t.openDoc.off(n);});}},{key:"updatePosition",value:function value(){var e=null,t=this.innerViewer.context.uiService.defaultDom,i=this.viewer.context.uiService.defaultDom;"horizontal"===this.thbConfig.location?(t.style.width=sY(this.thbConfig.size),t.style.height="100%",e=i.querySelector("#dvs-viewer-middle".concat(this.viewer.context.postfix))):(t.style.width="100%",t.style.height=sY(this.thbConfig.size),e=i);var r=String(this.thbConfig.sequence);t.style.order=r,this.container=e,this.innerViewer.context.uiService.bindContainer(e),this.viewer.externalResized();}},{key:"getThbConfig",value:function value(){return this.thbConfig;}},{key:"getThbConfigByName",value:function value(e){return this.thbConfig[e];}},{key:"updateThbConfig",value:function value(e){for(var t=0,i=oB(e);t<i.length;t++){var r=Gb(i[t],2),n=r[0],o=r[1],a=this.configHandlers[n];a&&a(this,o);}}},{key:"initThbConfigHandlers",value:function value(){this.configHandlers={thumbnailStyle:uY,canvasStyle:lY,pageStyle:cY,selectedPageStyle:hY,placeholderStyle:dY,hoveredPageStyle:fY,pageNumberStyle:vY,checkboxStyle:gY,removeBtnStyle:mY,scrollDirection:yY,multiselectMode:pY,enableDragPage:wY,enableKeyboardControl:bY,show:kY,rows:SY,columns:xY,margin:CY,gap:VY,autoSelectTopPage:TY,size:IY,sequence:EY,location:PY,showRemoveBtn:BY,autoScroll:DY,autoSelectLatest:MY};}},{key:"show",value:function value(){return this.updateThbConfig({show:!0}),!0;}},{key:"hide",value:function value(){return this.updateThbConfig({show:!1}),!0;}},{key:"resized",value:function value(){this.viewer.resized(),this.innerViewer.resized();}},{key:"setViewMode",value:function value(e,t){return this.innerViewer.setViewMode(e,t);}},{key:"bindContainer",value:function value(e){return this.innerViewer.bindContainer(e);}},{key:"unbindContainer",value:function value(){return this.innerViewer.unbindContainer();}},{key:"on",value:function value(e,t){TL(e)&&ML(t)?this.emitter.on(e,t):this.err(fL);}},{key:"emit",value:function value(e){for(var t,i,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];TL(e)?(t=this.emitter).emit.apply(t,lS(i=[e]).call(i,n)):this.err(fL);}},{key:"off",value:function value(e,t){TL(e)&&(void 0===t||ML(t))?this.emitter.off(e,t):this.err(fL);}},{key:"destroy",value:function value(){this.isDestroyed||(this.hooks.destroy.emit(),this.innerViewer.unbindContainer(),this.innerViewer.destroy(),this.innerViewer=null,this.container=null,this.isDestroyed=!0);}},{key:"err",value:function value(e){this.emitter.emit("_dvsUpdateErrorMessage",e);}},{key:"ok",value:function value(){this.emitter.emit("_dvsUpdateErrorMessage",dL);}}]);}();function sY(e){if(TL(e)){if(!/%/.test(e)&&!/px/.test(e)&&!/em/.test(e))return"".concat(e,"px");}else if(BL(e))return"".concat(e,"px");return e;}function uY(e,t){LU(e.thbConfig.thumbnailStyle,t),e.innerViewer.updateViewerConfig({viewerStyle:Fk({},e.thbConfig.thumbnailStyle)}),e.viewer.resized();}function lY(e,t){LU(e.thbConfig.canvasStyle,t),e.innerViewer.updateViewerConfig({canvasStyle:Fk({},e.thbConfig.canvasStyle)}),e.viewer.resized();}function cY(e,t){LU(e.thbConfig.pageStyle,t),e.innerViewer.updateViewerConfig({pageStyle:Fk({},e.thbConfig.pageStyle)}),e.innerViewer.render();}function hY(e,t){LU(e.thbConfig.selectedPageStyle,t),e.innerViewer.updateViewerConfig({selectedPageStyle:Fk({},e.thbConfig.selectedPageStyle)}),e.innerViewer.render();}function dY(e,t){LU(e.thbConfig.placeholderStyle,t),e.innerViewer.updateViewerConfig({placeholderStyle:Fk({},e.thbConfig.placeholderStyle)}),e.innerViewer.render();}function fY(e,t){LU(e.thbConfig.hoveredPageStyle,t),e.innerViewer.updateViewerConfig({hoveredPageStyle:Fk({},e.thbConfig.hoveredPageStyle)}),e.innerViewer.render();}function vY(e,t){LU(e.thbConfig.pageNumberStyle,t),e.innerViewer.updateViewerConfig({pageNumberStyle:Fk({},e.thbConfig.pageNumberStyle)}),e.innerViewer.render();}function gY(e,t){LU(e.thbConfig.checkboxStyle,t),e.innerViewer.updateViewerConfig({checkboxStyle:Fk({},e.thbConfig.checkboxStyle)}),e.innerViewer.render();}function mY(e,t){LU(e.thbConfig.removeBtnStyle,t),e.innerViewer.updateViewerConfig({removeBtnStyle:Fk({},e.thbConfig.removeBtnStyle)}),e.innerViewer.render();}function yY(e,t){e.thbConfig.scrollDirection=t,e.innerViewer.updateViewerConfig({scrollDirection:t}),e.innerViewer.render();}function pY(e,t){e.thbConfig.multiselectMode=t,e.innerViewer.updateViewerConfig({multiselectMode:t}),e.innerViewer.render();}function wY(e,t){e.thbConfig.enableDragPage=t,e.innerViewer.updateViewerConfig({enableDragPage:t});}function bY(e,t){e.thbConfig.enableKeyboardControl=t,e.innerViewer.updateViewerConfig({enableKeyboardControl:t});}function kY(e,t){if(DL(t)&&e.thbConfig.show!==t){e.thbConfig.show=t,e.innerViewer.context.config.show=t;var i=(e.innerViewer||{}).defaultDom;i&&(i.style.display=t?"flex":"none"),e.viewer.externalResized();var r=e.innerViewer.getCurrentTab();if(r){e.innerViewer.context.showTab(r),e.innerViewer.context.renderOnly();var n=e.innerViewer.context.config;n.autoSelectLatest&&n.show&&n.autoScroll&&e.innerViewer.context.emitCurrentIndexChanged();}}}function SY(e,t){BL(t)?t<=0?e.err(vL):(e.thbConfig.rows=t,e.setViewMode(t,e.thbConfig.columns),e.ok()):e.err(fL);}function xY(e,t){BL(t)?t<=0?e.err(vL):(e.thbConfig.columns=t,e.setViewMode(e.thbConfig.rows,t),e.ok()):e.err(fL);}function CY(e,t){e.thbConfig.margin=t,e.innerViewer.updateViewerConfig({margin:t});}function VY(e,t){e.thbConfig.gap=t,e.innerViewer.updateViewerConfig({gap:t});}function TY(e,t){e.thbConfig.autoSelectTopPage=t,e.innerViewer.updateViewerConfig({autoSelectTopPage:t});}function IY(e,t){!function(e){var t=String(e);return!!/^\d+(px|em)$|^\d+$|^(100|[1-9]?\d(\.\d\d?\d?)?)%$/.test(t);}(t)?e.err(yL):(e.thbConfig.size=t,e.updatePosition(),e.ok());}function EY(e,t){BL(t)?(e.thbConfig.sequence=t,e.updatePosition(),e.ok()):e.err(fL);}function PY(e,t){"horizontal"===t||"vertical"===t?(e.thbConfig.location=t,e.updatePosition(),e.ok()):e.err(fL);}function BY(e,t){DL(t)?(e.thbConfig.showRemoveBtn=t,e.ok()):e.err(fL);}function DY(e,t){e.thbConfig.autoScroll=t,e.innerViewer.updateViewerConfig({autoScroll:t});}function MY(e,t){e.thbConfig.autoSelectLatest=t,e.innerViewer.updateViewerConfig({autoSelectLatest:t});}var zY={name:"dvsThumbnail",install:function install(e){var t=e.getClassStore(),i=function(e,t){return t=function(e){function t(e){var i;return Xk(this,t),Wk(yb(i=cL(this,t,[e])),"thumbnails",void 0),i.thumbnails=[],i;}return _b(t,e),Yk(t,[{key:"createThumbnail",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new aY({container:e.container||"",viewerConfig:e,dvs:this.dvs,viewer:this});this.thumbnails.push(t);var i=this.context.getCurrentTab();if(i){var r,n,o=t.innerViewer.context,a=o.tabService.createTab(i.doc);a.current=i.current,a.select(RI(r=i.selected).call(r)),$k(n=i.children).call(n,function(e,t){if(e.blanks.children.length){var i,r=a.childNodes[t];$k(i=e.blanks.children).call(i,function(e){var t=new WW({id:e.id,style:{points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],background:e.style.background,borderWidth:0}});r.blanks.appendChild(t);});}if(e.overlays.children.length){var n,o=a.children[t];$k(n=e.overlays.children).call(n,function(e){var t,i=new WW({id:e.id,style:{points:RI(t=e.style.points).call(t),background:e.style.background,borderWidth:0,opacity:e.style.opacity}});o.overlays.appendChild(i);});}}),o.showTab(a),o.config.autoSelectLatest&&o.config.show?o.emitCurrentIndexChanged():o.renderOnly();}return e.container&&this.context.resized(),t;}},{key:"removeThumbnail",value:function value(e){var t,i,r,n;return TL(e)?r=EE(t=this.thumbnails).call(t,function(t){return t.uid===e;}):kL(e)&&(r=EE(i=this.thumbnails).call(i,function(t){return t===e;})),r>-1&&(Gb(gE(n=this.thumbnails).call(n,r,1),1)[0].destroy(),!0);}},{key:"getThumbnailList",value:function value(){return this.thumbnails;}},{key:"getThumbnailByIndex",value:function value(e){return this.thumbnails[e];}},{key:"getThumbnailByUid",value:function value(e){var t;return xP(t=this.thumbnails).call(t,function(t){return t.uid===e;});}},{key:"checkPageVisibility",value:function value(e){var t={min:!1,ori:!1},i=this.getCurrentTab();if(i){var r=i.getChildByUid(e);r&&r.isPreload&&("multiple"===this.context.config.displayMode&&(t.min=!0),t.ori=!0);}for(var n=0,o=this.thumbnails.length;n<o;n++){var a=this.thumbnails[n].innerViewer.checkPageVisibility(e);a.min&&(t.min=!0),a.ori&&(t.ori=!0);}return t;}}]);}(e),Wk(t,"use",e.use),t;}(t.Viewer);t.Viewer=i;}},UY=function(){function e(t,i){Xk(this,e),Wk(this,"reducer",void 0),Wk(this,"state",void 0),Wk(this,"listeners",[]),this.reducer=t,this.state=i,this.dispatch({type:""});}return Yk(e,[{key:"subscribe",value:function value(e){return this.listeners.push(e),function(){var t,i,r=null===(t=this.listeners)||void 0===t?void 0:OI(t).call(t,e);null===(i=this.listeners)||void 0===i||gE(i).call(i,r,1);};}},{key:"dispatch",value:function value(e){var t;this.state=this.reducer(this.state,e),$k(t=this.listeners).call(t,function(t){t(e);});}},{key:"getState",value:function value(){return this.state;}},{key:"replaceReducer",value:function value(e){this.reducer=e,this.dispatch({type:""});}}],[{key:"create",value:function value(t,i,r){return"function"==typeof i&&void 0===r&&(r=i,i=void 0),r?r(e.create)(t,i):new e(t,i);}},{key:"combineReducers",value:function value(e){return function(t,i){var r;null!==(r=t)&&void 0!==r||(t={});for(var n={},o=0,a=oB(e);o<a.length;o++){var s=Gb(a[o],2),u=s[0],l=(0,s[1])(t[u],i);n[u]=l;}return n;};}},{key:"applyMiddleware",value:function value(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return function(e){return function(i,r){var n=e(i,r),o={getState:n.getState},a=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return 0===t.length?function(e){return e;}:1===t.length?t[0]:vx(t).call(t,function(e,t){return function(){return e(t.apply(void 0,arguments));};});}.apply(void 0,Kb($E(t).call(t,function(e){return e(o);})))(n.dispatch);return Fk(Fk({},n),{},{dispatch:a});};};}}]);}(),AY=/^<\/([^>]*)>/,RY=/^<([^\s>]+)[^>]*>/,LY=/^<slot>.*<\/slot>/,NY=/(:?[@\w-]+)\s*=\s*"(.*?)"/;function OY(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=WY(e.template,e.data,e.components,e.injection,t),r=i.length;return r&&(i[0].cpInstance=e,i[r-1].cpInstance=e),i;}function WY(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=AS(e).call(e),a=[];function s(e){o=o.substring(e);}function u(e){var n=Gb(e,2),o=n[0],s=n[1];if(s){var u=function(e){var t={},i=LL(e,NY);return i?($k(i).call(i,function(e){var i=Gb(e,3),r=i[1],n=i[2];t[r]=n;}),t):t;}(o),l=t[":for"];l&&(delete t[":for"],u[":for"]=l);var c={type:"start",name:s,data:t,attrs:u};if(a.push(c),(i[s]||r.components&&r.components[s])&&(c.cpOption={Component:i[s]||r.components[s],injection:r}),"input"===s||/\/>/.test(o)){var h={type:"end",name:s,data:t,attrs:{}};a.push(h);}}}function l(e){var t=Gb(e,2)[1];if(t){var i={type:"end",name:t,attrs:{}};a.push(i);}}function c(e){if(e=AS(e).call(e)){var i={type:"text",name:e,attrs:{},data:t};a.push(i);}}for(;o;){var h=OI(o).call(o,"<"),d=void 0;if(0===h){var f=o.match(AY);if(f){s(f[0].length),l(f);continue;}var v=o.match(LY);if(v){s(v[0].length),a.push.apply(a,Kb(n));continue;}var g=o.match(RY);if(g&&g[0]!==g.input){s(g[0].length),u(g);continue;}d=o;}else d=h>0?o.substring(0,h):o;d&&(s(d.length),c(d));}return a;}function HY(e){var t=e.cpInstance;e.el;var i=e.children;t&&!t.isInserted&&(t.isInserted=!0,t.inserted&&t.inserted()),$k(i).call(i,function(e){HY(e);});}function FY(e,t){return t.key===e.key&&t.tagName===e.tagName;}function jY(e,t,i){for(var r={},n=t;n<=i;++n){var o=e[n];if(o&&o.data){var a=o.data.key;a&&(r[a]=n);}}return r;}function YY(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t<=i;)XY(e[t]),t+=1;}function XY(e){if(e){var t=e.el,i=e.children;if(function(e,t){var i=e.cpInstance;i&&(i.unbindSelfEvents(),i.unbindGlobalEvents(),i.unbindNativeEvents(),null===(t=i.beforeDestroyed)||void 0===t||t.call(i,e));}(e),t){var r=t.parentElement;r&&r.removeChild(t),t.dvsNode=null,e.el=null;}return function(e){var t=e.cpInstance;t&&t.destroyed&&t.destroyed(e);}(e),e.text=null,e.parent=null,i.length&&$k(i).call(i,function(e){XY(e);}),!0;}return!1;}function qY(e,t,i,r,n){for(var o=document.createDocumentFragment(),a=r;a<=n;a++){var s=i[a];o.appendChild(s.renderDom());}hN(o,t,e);}function ZY(e,t){var i,r,n,o;if(e!==t){if((null===(i=e.cpInstance)||void 0===i||null===(r=i.constructor)||void 0===r?void 0:r.name)!==(null===(n=t.cpInstance)||void 0===n||null===(o=n.constructor)||void 0===o?void 0:o.name))return qY(e.parent.el,e.el,[t],0,0),void XY(e);var a=e.el;e.data;var s=e.children,u=e.tagName,l=e.text;t.el=a,a.dvsNode=t;var c,h=t.data,d=t.children,f=t.tagName,v=t.text;if(a.setAttribute)$k(c=eS(h)).call(c,function(e){a instanceof HTMLInputElement&&"value"===e?a.value=h[e]:a.setAttribute(e,h[e]);});u===f&&"TEXT"===f&&l!==v?a.textContent=cN(v):s.length&&d.length?function(e,t,i){for(var r,n=0,o=0,a=t.length-1,s=i.length-1,u=t[n],l=t[a],c=i[o],h=i[s];n<=a&&o<=s;)if(null==u)u=t[n+=1];else if(null==l)l=t[a-=1];else if(null==c)c=i[o+=1];else if(null==h)h=i[s-=1];else if(FY(u,c))ZY(u,c),o+=1,u=t[n+=1],c=i[o];else if(FY(l,h))ZY(l,h),s-=1,l=t[a-=1],h=i[s];else if(FY(u,h))ZY(u,h),dN(u.el,l.el),s-=1,u=t[n+=1],h=i[s];else if(FY(l,c))ZY(l,c),hN(l.el,u.el,e),o+=1,l=t[a-=1],c=i[o];else{void 0===r&&(r=jY(t,n,a));var d=r[c.key];if(void 0===d)qY(e,u.el,i,o,o),c=i[o+=1];else{var f=t[d];ZY(f,c),hN(f.el,u.el,e),t[d]=null,c=i[o+=1];}}n>a?qY(e,i[s+1]?i[s+1].el:null,i,o,s):o>s&&YY(t,n,a);}(a,s,d):d.length?qY(a,null,d,0,d.length-1):s.length&&YY(s,0,s.length),function(e,t){var i=(e||{}).cpInstance,r=t.cpInstance;i&&(r&&(i.data=r.data,i.injection=Fk(Fk({},i.injection),r.injection)),t.cpInstance=i,i.dvsNode=t,i.updated&&i.updated(t));}(e,t);}}var _Y=function(){return Yk(function e(t){Xk(this,e),Wk(this,"el",void 0),Wk(this,"tagName",void 0),Wk(this,"sel",""),Wk(this,"data",void 0),Wk(this,"children",void 0),Wk(this,"text",void 0),Wk(this,"key",void 0),Wk(this,"cpInstance",void 0),Wk(this,"cpOptions",void 0),Wk(this,"inserted",!1),Wk(this,"parent",void 0),this.createVNode(t);},[{key:"renderDom",value:function value(){var e,t;if(this.el)return this.el;var i,r=this.cpInstance;if("FRAGMENT"===this.tagName)i=document.createDocumentFragment();else if("TEXT"===this.tagName){var n=cN(this.text);i=document.createTextNode(n);}else{var o;i=document.createElement("IMAGE"===this.tagName?"IMG":this.tagName);for(var a=0,s=oB(this.data);a<s.length;a++){var u=Gb(s[a],2),l=u[0],c=u[1];if("style"===l){var h=GY(c);for(var d in h)h.hasOwnProperty(d)&&(i.style[d]=h[d]);}else i.setAttribute(l,c);}if(null!==(o=this.data)&&void 0!==o&&o.events)for(var f=0,v=oB(null===(g=this.data)||void 0===g?void 0:g.events);f<v.length;f++){var g,m=Gb(v[f],2),y=m[0],p=m[1];i.addEventListener(y,p);}}return $k(e=this.children).call(e,function(e){var t=e.renderDom();i.appendChild(t);}),i.dvsNode=this,this.el=i,null!=r&&null!==(t=r.updated)&&void 0!==t&&t.call(r,this),function(e,t){var i=e.cpInstance,r=e.el;i&&(i.dvsNode=e,null===(t=i.created)||void 0===t||t.call(i,r));}(this),i;}},{key:"patch",value:function value(e){return function(e,t,i){if(FY(e,t))ZY(e,t);else{var r=e.el,n=r.parentNode;null!==n&&(t.el=t.renderDom(),hN(t.el,r,n),YY([e]),e=null);}var o=-1,a=e.parent;return null!=a&&$k(i=a.children).call(i,function(t,i){t===e&&(o=i);}),o>-1&&(a.children[o]=t,t.parent=a,e.el=null),t;}(this,e);}},{key:"destroy",value:function value(){return XY(this);}},{key:"createVNode",value:function value(e){var t=e.tagName,i=e.data,r=void 0===i?{}:i,n=e.children,o=void 0===n?[]:n,a=e.el,s=void 0===a?null:a,u=e.key,l=e.text,c=void 0===l?"":l,h=e.cpOptions,d=e.cpInstance,f=t;r.id&&(f+="#".concat(r.id)),r.class&&(f+=".".concat(r.class)),this.sel=f,this.data=r,this.tagName=t,this.children=o,this.el=s,this.key=u,this.text=c,this.cpInstance=d,this.cpOptions=h;}}]);}();function GY(e){var t=e.split(";"),i={};return $k(t).call(t,function(e){var t,r=AS(e).call(e);if(r){var n=$E(t=r.split(":")).call(t,function(e){return AS(e).call(e);}),o=Gb(n,2),a=o[0],s=o[1],u=a.replace(/-(\w)/g,function(e,t){return t.toUpperCase();});i[u]=s;}}),i;}function KY(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=[],r=[],n=[];return $k(e).call(e,function(e){if("start"===e.type)i.push(e),r.push(n),n=[];else if("text"===e.type)n.push({type:"text",value:e.name,data:e.data});else if(e instanceof _Y)n.push(e);else{for(var t=i.pop();t.name!==e.name;)t=i.pop();if(t){var o=t,a=o.name,s=o.cpInstance,u=o.attrs,l={type:"token",tagName:a,cpInstance:s,cpOption:o.cpOption,attrs:u,data:o.data,children:n};$k(n).call(n,function(e){e.parent=l;}),(n=r.pop()).push(l);}}}),t?n[0]:n;}var $Y=/'.+'|\\".+\\"|[\w$.]+/g,JY=/{{([^\s@}]+)}}/;function QY(e,t){for(var i=function i(){var i=n[r],o=Gb(i.match(/^(:|@)(.+)/)||[],3),a=o[1],s=o[2];if(!s)return 1;var u=e[i];if(delete e[i],"for"===s){var l,c,h,d=Gb(u.split(" in "),2),f=d[0],v=d[1],g=Gb(f.split(","),2),m=g[0],y=g[1];m=AS(m).call(m),y=null===(l=y)||void 0===l?void 0:AS(l).call(l),v=null===(c=v)||void 0===c?void 0:AS(c).call(c);var p=[],w=vx(h=v.split(".")).call(h,function(e,t){return e[t];},t);if(bL(w))$k(w).call(w,function(e,t){var i={};i[m]=e,y&&(i[y]=t),p.push(i);});else if(kL(w))for(var b=0,k=oB(w);b<k.length;b++){var S=Gb(k[b],2),x=S[0],C=S[1],V={};V[m]=C,y&&(V[y]=x),p.push(V);}e[":for"]=p;}else{var T,I,E=vx(T=u.split(".")).call(T,function(e,t){return null==e?void 0:e[t];},t);if(void 0!==E)"class"===s&&e[s]?e[s]=lS(I="".concat(e[s]," ")).call(I,E):e[s]=E;else{u=u.replace($Y,function(e){if(OI(e).call(e,'"')<0&&OI(e).call(e,"'")<0){var i;if(/^(true|false|\d+|undefined|null)$/.test(e))return e;var r=vx(i=e.split(".")).call(i,function(e,t){return null==e?void 0:e[t];},t);return VR(r);}return e;});try{var P,B=function(e,t){var i=null;try{for(var r=e.split(","),n=0;n<r.length;n++){var o=r[n],a=/(\w+)(\[(\d+)\])?/,s=o.match(a);if(!s){t=null;break;}var u=s[1],l=s[3];if(!Object.prototype.hasOwnProperty.call(t,u)){t=null;break;}t=t[u],void 0!==l&&_k(t)&&(t=t[l]);}i=t;}catch(e){i=null;}return i;}(u,t);AL(B)&&(e[s]=void 0),"class"===s&&e[s]?e[s]=lS(P="".concat(e[s]," ")).call(P,B):e[s]=B;}catch(t){e[s]=void 0;}}"@"===a&&(e.events||(e.events={}),e.events[s]=e[s],delete e["@".concat(s)]);}},r=0,n=eS(e);r<n.length;r++)i();}function eX(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(bL(e)){var i=[];return $k(e).call(e,function(e){i.push.apply(i,Kb(tX(eX(e))));}),i;}if(e instanceof _Y)return e;if("token"===e.type){var r,n,o=e.tagName,a=e.attrs,s=e.cpInstance,u=e.children,l=e.data,c=e.cpOption;if(a[":for"])return function(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.attrs,n=e.data,o=JSON.parse(VR(r)),a={":for":r[":for"]};delete r[":for"],QY(a,Fk(Fk({},n),i));var s=[];return $k(t=a[":for"]).call(t,function(t){var i=eX(e,t);s.push.apply(s,Kb(tX(i)));}),e.attrs=o,s;}(e,t);var h,d=Fk(Fk({},l),t),f=Fk({},a);if(QY(a,d),Object.prototype.hasOwnProperty.call(a,"if")&&!a.if)h=null;else if(delete a.if,c)h=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.children,r=e.attrs,n=e.cpOption,o=iX(i,t),a=KY(OY(new(0,n.Component)({data:r,injection:n.injection}),o));return a?tX(eX(a))[0]:null;}(e,t);else{var v=a.key;void 0!==v&&delete a.key;var g=iX(u,t);h=new _Y({tagName:o.toUpperCase(),data:a,cpInstance:s,key:v,children:g});}return e.attrs=f,null!==(r=h)&&void 0!==r&&$k(n=r.children).call(n,function(e){e.parent=h;}),h;}return function(e){var t,i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.value,o=null===(t=e.parent)||void 0===t||null===(i=t.attrs)||void 0===i?void 0:i.html;return n=function(e,t){var i=LL(e,JY);return i.length&&$k(i).call(i,function(i){var r,n=vx(r=i[1].split(".")).call(r,function(e,t){return e[t];},t),o=i[0];e=e.replace(o,n);}),e;}(AS(n).call(n),Fk(Fk({},e.data),r)),o?eX(KY(WY(n),!1)):new _Y({tagName:"TEXT",text:n});}(e,t);}function tX(e){return e?(bL(e)||(e=[e]),e):[];}function iX(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=[];return $k(e).call(e,function(e){var r=eX(e,t)||[];i.push.apply(i,Kb(tX(r)));}),i;}var rX=function(){return Yk(function e(t){var i=t.data,r=void 0===i?{}:i,n=t.template,o=void 0===n?"":n,a=t.components,s=void 0===a?{}:a,u=t.injection,l=void 0===u?{}:u;Xk(this,e),Wk(this,"template",""),Wk(this,"data",{}),Wk(this,"components",{}),Wk(this,"injection",{}),Wk(this,"isInserted",!1),Wk(this,"emitter",void 0),Wk(this,"uiEmitter",void 0),Wk(this,"viewerEmitter",void 0),Wk(this,"dvsNode",null),Wk(this,"el",void 0),Wk(this,"created",void 0),Wk(this,"inserted",void 0),Wk(this,"updated",void 0),Wk(this,"beforeDestroyed",void 0),Wk(this,"destroyed",void 0),Wk(this,"selfEvents",[]),Wk(this,"globalEvents",[]),Wk(this,"nativeEvents",[]),this.emitter=bN.create(),this.setData(r),this.template=o,this.setComponents(s),this.setInjects(l),this.uiEmitter=this.injection.emitter,this.viewerEmitter=this.injection.viewerEmitter,this.autoBindEvents();},[{key:"parseHTML",value:function value(){return eX(KY(OY(this,[])));}},{key:"setData",value:function value(e){LU(this.data,e);}},{key:"setComponents",value:function value(e){LU(this.components,e);}},{key:"setInjects",value:function value(e){LU(this.injection,e);}},{key:"autoBindEvents",value:function value(){for(var e=this,t=function t(){var t=Gb(r[i],2),n=t[0],o=t[1];e.on(n,function(){o.apply(void 0,arguments);});},i=0,r=oB(this.data.events||{});i<r.length;i++)t();for(var n=function n(){var t=Gb(a[o],2),i=t[0],r=t[1];e.on(i,function(){for(var t,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];TL(r)?e.$emit.apply(e,lS(t=[r]).call(t,n)):ML(r)&&r.apply(void 0,n);});},o=0,a=oB((null===(s=this.data)||void 0===s||null===(u=s.options)||void 0===u?void 0:u.events)||{});o<a.length;o++){var s,u;n();}}},{key:"unbindSelfEvents",value:function value(){var e,t=this;$k(e=this.selfEvents).call(e,function(e){var i=Gb(e,2),r=i[0],n=i[1];t.emitter.off(r,n);}),this.selfEvents=[];}},{key:"unbindGlobalEvents",value:function value(){var e,t=this;$k(e=this.globalEvents).call(e,function(e){var i=Gb(e,2),r=i[0],n=i[1];t.uiEmitter.off(r,n);}),this.globalEvents=[];}},{key:"unbindNativeEvents",value:function value(){var e;$k(e=this.nativeEvents).call(e,function(e){e();}),this.nativeEvents=[];}},{key:"on",value:function value(e,t){this.emitter.on(e,t),this.selfEvents.push([e,t]);}},{key:"emit",value:function value(e){for(var t,i,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];(t=this.emitter).emit.apply(t,lS(i=[e]).call(i,n));}},{key:"$on",value:function value(e,t){var i;this.uiEmitter&&(null!==(i=this.uiEmitter)&&void 0!==i&&i.on(e,t),this.globalEvents.push([e,t]));}},{key:"$emit",value:function value(e){for(var t,i,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];null===(t=this.uiEmitter)||void 0===t||t.emit.apply(t,lS(i=[e]).call(i,n));}},{key:"nativeOn",value:function value(e,t,i){var r=function(e,t,i){return e?(e.addEventListener(t,i,void 0),function(){e.removeEventListener(t,i);}):null;}(e,t,i);r&&this.nativeEvents.push(r);}},{key:"reRenderVNode",value:function value(){var e=function(e){return eX(KY(OY(e)));}(this);this.dvsNode.patch(e);}},{key:"query",value:function value(e){var t;return null===(t=this.el)||void 0===t?void 0:t.querySelector(e);}},{key:"queryAll",value:function value(e){var t;return null===(t=this.el)||void 0===t?void 0:t.querySelectorAll(e);}}]);}();Wk(rX,"storeName",void 0),Wk(rX,"hasStore",!1),Wk(rX,"reducer",void 0),Wk(rX,"initState",void 0);var nX=function(){function e(t){Xk(this,e),Wk(this,"container",void 0),Wk(this,"emitter",null),Wk(this,"viewerEmitter",null),Wk(this,"options",void 0),Wk(this,"rootVNode",void 0),Wk(this,"postfix",void 0),Wk(this,"injection",void 0),Wk(this,"data",void 0),Wk(this,"isInserted",!1),Wk(this,"iListeners",[]),Wk(this,"rootDom",void 0),Wk(this,"stores",{});var i=t.container,r=t.injection,n=t.emitter,o=t.postfix,a=t.data;this.viewerEmitter=n,this.emitter=bN.create(),this.postfix=o||"-".concat(WL()),this.options=t,this.injection=r,this.data=a,TL(i)?this.container=document.getElementById(i):"DIV"===(null==i?void 0:i.nodeName)&&(this.container=i),this.initStore(),this.init();}return Yk(e,[{key:"initStore",value:function value(){for(var t=0,i=BR(e.getComponents());t<i.length;t++){var r=i[t];if(!r.hasStore||this.stores[r.storeName]);else{var n=UY.create(r.reducer,r.initState);this.stores[r.storeName]=n;}}}},{key:"init",value:function value(){var t=new rX({data:this.options.uiConfig,template:'<Root :options="root"></Root>',components:e.getComponents(),injection:Fk(Fk({},this.injection),{},{components:e.getComponents(),postfix:this.postfix,emitter:this.emitter,viewerEmitter:this.viewerEmitter,stores:this.stores,i18n:this.options.uiConfig.i18n})}).parseHTML(),i=t.renderDom();this.rootVNode=t,this.rootDom=i,this.container&&(this.container.appendChild(i),HY(t),this.isInserted=!0);}},{key:"bindContainer",value:function value(e){this.container=e,e.appendChild(this.rootDom),this.isInserted||HY(this.rootVNode);}},{key:"unbindContainer",value:function value(){for(var e=0;e<this.container.children.length;e++)if(this.container.children[e]===this.rootDom)return void this.container.removeChild(this.rootDom);}},{key:"queryByDataId",value:function value(e){var t;return null===(t=this.rootDom)||void 0===t?void 0:t.querySelector("[data-id=".concat(e,"]"));}},{key:"queryAllByDataId",value:function value(e){var t;return null===(t=this.rootDom)||void 0===t?void 0:t.querySelectorAll("[data-id=".concat(e,"]"));}},{key:"on",value:function value(e,t){var i=this.emitter.on(e,t);this.iListeners.push(i);}},{key:"emit",value:function value(e){for(var t,i,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];(t=this.emitter).emit.apply(t,lS(i=[e]).call(i,n));}},{key:"off",value:function value(e,t){this.emitter.off(e,t);}},{key:"unbindEvents",value:function value(){var e,t=this;$k(e=this.iListeners).call(e,function(e){var i=e.name,r=e.fn,n=e.context,o=e.once;t.emitter.off(i,r,n,o);});}},{key:"destroy",value:function value(){this.unbindEvents();}}],[{key:"registerComponent",value:function value(){for(var t=0,i=oB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});t<i.length;t++){var r=Gb(i[t],2),n=r[0],o=r[1];if(e.isAlreadyRegistered(n))return;this.components[n]=o;}}},{key:"isAlreadyRegistered",value:function value(e){return!!this.components[e];}},{key:"getComponents",value:function value(){return this.components;}}]);}();Wk(nX,"components",{});var oX=function oX(e,t,i,r){var n,o,a=e||{},s=a.id,u=a.title,l=a.dataId,c=a.style,h=a.className,d=function(e){var t="";if(e)for(var i=0,r=oB(e);i<r.length;i++){var n,o=Gb(r[i],2),a=o[0],s=o[1];t+=lS(n="".concat(pL(a),":")).call(n,s,";");}return t;}(c);return(CL(s)?"":' id="'.concat(s,'"'))+lS(n=lS(o=' class="'.concat(t)).call(o,null!=i?i:""," ")).call(n,h||"",'"')+(CL(r)?"":' :class="'.concat(r,'"'))+(d?' style="'.concat(d,'"'):"")+(CL(u)?"":' title="'.concat(u,'"'))+(CL(l)?"":' data-id="'.concat(l,'"'));},aX=function aX(e,t){var i,r,n,o=(null===(i=t)||void 0===i?void 0:i.className)||"";return NL(e=e||{},t=t||{}),t.className=lS(r="".concat(o," ")).call(r,(null===(n=t)||void 0===n?void 0:n.className)||""),t;},sX=function(e){function t(e){var i;if(Xk(this,t),Wk(yb(i=cL(this,t,[e])),"status",!1),Wk(yb(i),"store",void 0),Wk(yb(i),"unsubscribe",void 0),Wk(yb(i),"created",function(e){i.el=e,i.initEvent(),i.$on("setButtonClass",function(e,t){e===i.data.options.name&&(i.el.className="dvs-btn ".concat(t));});}),Wk(yb(i),"updated",function(){}),Wk(yb(i),"destroyed",function(){var e,t;i.data.options.selectable&&(null===(e=(t=i).unsubscribe)||void 0===e||e.call(t));}),i.data.options.selectable){var r;i.store=i.injection.stores[t.storeName];var n=i.store.getState();i.setData({isSelect:OI(r=n.select).call(r,i.data.options.dataId)>-1}),i.unsubscribe=i.store.subscribe(function(){var e=i.data.options.dataId,t=i.store.getState(),r=t.select,n=t.unselect;OI(r).call(r,e)>-1&&!i.data.isSelect?(i.data.isSelect=!0,i.reRenderVNode()):OI(n).call(n,e)>-1&&i.data.isSelect&&(i.data.isSelect=!1,i.reRenderVNode());});}return i.initTemplate(),i;}return _b(t,e),Yk(t,[{key:"initEvent",value:function value(){var e=this,t=this.data.options.events;if(t)for(var i=function i(){var t=Gb(n[r],2),i=t[0],o=t[1];e.el.addEventListener(i,function(t){e.uiEmitter.emit(o,t,e);});},r=0,n=oB(t);r<n.length;r++)i();}},{key:"initNativeEvent",value:function value(){var e,t=this,i=this.el,r=this.data.options;$k(e=eS(r.events||{})).call(e,function(e){t.nativeOn(i,e,function(i){t.emit(e,i,t);});});}},{key:"initTemplate",value:function value(){var e,t=this.data.options,i=t.selectable?"isSelect?'dvs-selected':''":void 0,r=oX(t,"dvs-btn","",i);this.template=lS(e="<div ".concat(r," >")).call(e,CL(t.label)?"":t.label,"<slot></slot></div>");}}]);}(rX);Wk(sX,"hasStore",!0),Wk(sX,"storeName","button"),Wk(sX,"reducer",function(e,t){var i,r,n,o;switch(e||(e={select:[],unselect:[]}),t.type){case"setButton":return $k(i=t.select).call(i,function(t){var i,r,n=EE(i=e.unselect).call(i,function(e){return e===t;});gE(r=e.unselect).call(r,n,1);}),$k(r=t.unselect).call(r,function(t){var i,r,n=EE(i=e.select).call(i,function(e){return e===t;});gE(r=e.select).call(r,n,1);}),e.select=Kb(new Pz(lS(n=[]).call(n,Kb(e.select),Kb(t.select)))),e.unselect=Kb(new Pz(lS(o=[]).call(o,Kb(e.unselect),Kb(t.unselect)))),Fk({},e);case"select":return Fk(Fk({},e),{},{select:t.select});case"unselect":return Fk(Fk({},e),{},{unselect:t.unselect});default:return e;}});var uX=function(e){function t(e){var i;return Xk(this,t),Wk(yb(i=cL(this,t,[e])),"startScroll",!1),Wk(yb(i),"allowScroll",!1),Wk(yb(i),"startInfo",void 0),Wk(yb(i),"created",function(e){i.el=e,i.allowScroll&&(i.addButtonScroll(),i.addResizeEvent());}),Wk(yb(i),"inserted",function(){i.updateShowMore();}),i.initTemplate(),i;}return _b(t,e),Yk(t,[{key:"initTemplate",value:function value(){var e=this.data.options;e.style,e.id,e.className;var t=e.children;this.injection;var i="<div ".concat(oX(this.data.options,"dvs-group",""),">");t&&$k(t).call(t,function(e,t){var r,n,o=e.enable,a=e.type;!1!==o&&(AS(a).call(a),i+=lS(r=lS(n="<".concat(a,' :options="options.children.')).call(n,t,'"></')).call(r,a,">"));}),i+="</div>",this.template=i;}},{key:"addButtonScroll",value:function value(){var e=this,t=this.el;t.onmousedown=function(i){return!(i.button&&0!==i.button||t.scrollWidth<=t.clientWidth&&t.scrollHeight<=t.clientHeight||(e.startScroll=!0,e.startInfo={x:i.clientX,y:i.clientY,left:t.scrollLeft,top:t.scrollTop},0));},t.onmousemove=function(i){if(!e.startScroll)return!1;var r=e.startInfo,n=r.x,o=r.y,a=r.left,s=r.top,u=i.clientX-n,l=i.clientY-o;return(Math.abs(u)>5||Math.abs(l)>5)&&(t.scrollLeft=a-u,t.scrollTop=s-l),e.updateShowMore(),!0;},this.nativeOn(document.body,"mouseup",function(){e.startScroll=!1;});var i=t.querySelector(".dvs-showBefore");i&&(i.onclick=function(){t.scrollLeft=0,e.updateShowMore();});var r=t.querySelector(".dvs-showAfter");r&&(r.onclick=function(){t.scrollLeft=t.scrollWidth,e.updateShowMore();});}},{key:"updateShowMore",value:function value(){var e=this.el,t=e.clientWidth,i=e.scrollWidth,r=e.scrollLeft,n=e.querySelector(".dvs-showBefore");n&&(n.classList[r>5&&t>40?"remove":"add"]("dvs-display-none"),n.style.transform="translate3d(".concat(r,"px,0,0)"));var o=e.querySelector(".dvs-showAfter");o&&(o.classList[r+t<i-5&&t>40?"remove":"add"]("dvs-display-none"),o.style.transform="translate3d(".concat(r,"px,0,0)"));}},{key:"addResizeEvent",value:function value(){var e=this;this.nativeOn(window,"resize",function(){e.updateShowMore();});}}]);}(rX),lX=function(e){function t(e){var i;return Xk(this,t),Wk(yb(i=cL(this,t,[e])),"created",function(e){i.el=e;}),Wk(yb(i),"inserted",function(){i.injection.viewer.context.uiService.bindContainer(i.el);}),i.initTemplate(),i;}return _b(t,e),Yk(t,[{key:"initTemplate",value:function value(){var e="<div ".concat(oX(this.data.options,"dvs-main-canvas","")," ><slot></slot></div>");this.template=e;}}]);}(rX);var cX=function(e){function t(e){var i;return Xk(this,t),Wk(yb(i=cL(this,t,[e])),"current",0),Wk(yb(i),"total",0),Wk(yb(i),"store",void 0),Wk(yb(i),"unsubscribe",void 0),Wk(yb(i),"prefix","dvs-pagination-"),Wk(yb(i),"created",function(e){i.el=e,i.updateStyle(),i.initEvent();}),Wk(yb(i),"updated",function(){i.updateStyle();}),Wk(yb(i),"destroyed",function(){var e,t;null===(e=(t=i).unsubscribe)||void 0===e||e.call(t);}),i.data.firstPage=aX(i.data.options.firstPage,{className:i.getClassName("first-page")}),i.data.prevPage=aX(i.data.options.prevPage,{className:i.getClassName("prev-page")}),i.data.nextPage=aX(i.data.options.nextPage,{className:i.getClassName("next-page")}),i.data.lastPage=aX(i.data.options.lastPage,{className:i.getClassName("last-page")}),i.data.gotoPage=e.gotoPage||{},i.data.total=e.total||{},i.data.separator=e.separator||{},i.store=i.injection.stores[t.storeName],i.unsubscribe=i.store.subscribe(function(){i.initDataFromStore(),i.reRenderVNode();}),i.initDataFromStore(),i.initTemplate(),i;}return _b(t,e),Yk(t,[{key:"getClassName",value:function value(e){var t,i,r=this.prefix;return lS(t=lS(i="".concat(r,"iconfont dvs-icon-")).call(i,e," ")).call(t,r+e);}},{key:"initDataFromStore",value:function value(){this.setData({pageDetails:Fk(Fk({},this.store.getState()),{},{current:this.store.getState().current+1})});}},{key:"updateStyle",value:function value(){if(this.el){var e=this.data.pageDetails,t=e.current,i=e.total,r=this.prefix,n=this.query(".".concat(r,"first-page")),o=this.query(".".concat(r,"prev-page")),a=this.query(".".concat(r,"next-page")),s=this.query(".".concat(r,"last-page"));1===t||0===i?(this.disable(n),this.disable(o)):(this.enable(n),this.enable(o)),t===i||0===i?(this.disable(a),this.disable(s)):(this.enable(a),this.enable(s));}}},{key:"disable",value:function value(e){var t="".concat(this.prefix,"disable");e.classList.contains(t)||e.classList.add(t);}},{key:"enable",value:function value(e){var t="".concat(this.prefix,"disable");e.classList.contains(t)&&e.classList.remove(t);}},{key:"initEvent",value:function value(){var e=this,t=this.prefix,i=this.query(".".concat(t,"first-page")),r=this.query(".".concat(t,"prev-page")),n=this.query(".".concat(t,"next-page")),o=this.query(".".concat(t,"last-page")),a=this.query(".".concat(t,"goto"));this.nativeOn(i,"click",function(){var t=e.data.pageDetails,i=t.current,r=t.total;1!==i&&r>1&&(e.store.dispatch({type:"firstPage"}),e.emit("change",e.data.pageDetails));}),this.nativeOn(r,"click",function(){var t=e.data.pageDetails,i=t.current,r=t.total;1!==i&&r>1&&(e.store.dispatch({type:"previousPage"}),e.emit("change",e.data.pageDetails));}),this.nativeOn(n,"click",function(){var t=e.data.pageDetails,i=t.current,r=t.total;i!==r&&r>1&&(e.store.dispatch({type:"nextPage"}),e.emit("change",e.data.pageDetails));}),this.nativeOn(o,"click",function(){var t=e.data.pageDetails,i=t.current,r=t.total;i!==r&&r>1&&(e.store.dispatch({type:"lastPage"}),e.emit("change",e.data.pageDetails));}),this.nativeOn(a,"input",function(e){a.value=e.target.value.replace(/[^\d]/g,"");}),this.nativeOn(a,"keyup",function(t){if("Enter"===t.key){var i=e.data.pageDetails.total,r=$S(a.value,10);r=HL(r,1,i),a.value=String(r),0!==i&&(e.store.dispatch({type:"gotoPage",current:r-1}),e.emit("change",e.data.pageDetails));}});}},{key:"initTemplate",value:function value(){var e,t,i,r=this.data.options,n=r.gotoPage,o=r.total,a=r.separator;this.injection;var s="dvs-pagination",u=lS(e=lS(t=lS(i="<div ".concat(oX(this.data.options,s,""),'><Button :options="firstPage"></Button><Button :options="prevPage"></Button><input ')).call(i,oX(n,s,"-goto"),' :value="pageDetails.current" :title="pageDetails.current"><div ')).call(t,oX(a,s,"-separator"),"></div><span ")).call(e,oX(o,s,"-total"),' :title="pageDetails.total">{{pageDetails.total}}</span><Button :options="nextPage"></Button><Button :options="lastPage"></Button></div>');this.template=u;}}]);}(rX);Wk(cX,"hasStore",!0),Wk(cX,"storeName","pagination"),Wk(cX,"reducer",function(e,t){switch(e||(e={current:-1,total:0}),t.type){case"setPageNumber":return Fk(Fk({},e),t.pageDetails);case"firstPage":return Fk(Fk({},e),{},{current:0});case"lastPage":return Fk(Fk({},e),{},{current:e.total-1});case"nextPage":return Fk(Fk({},e),{},{current:e.current+1});case"previousPage":return Fk(Fk({},e),{},{current:e.current-1});case"gotoPage":return Fk(Fk({},e),{},{current:t.current});default:return e;}});var hX=function(e){function t(e){var i;Xk(this,t),Wk(yb(i=cL(this,t,[e])),"postfix",""),Wk(yb(i),"created",function(e){i.el=e,i.initNativeEvent();}),e.template&&(i.template=e.template);var r=i.injection,n=r.emitter,o=r.postfix;return i.uiEmitter=n,i.emitter=n,i.postfix=o,i.initTemplate(),i;}return _b(t,e),Yk(t,[{key:"initTemplate",value:function value(){var e=this.data.options.children,t="<div ".concat(oX(this.data.options,"dvs-root","")," >");e&&$k(e).call(e,function(e,i){var r,n,o=e.enable,a=e.type;!1!==o&&(t+=lS(r=lS(n="<".concat(a,' :options="options.children.')).call(n,i,'"></')).call(r,a,">"));}),t+="</div>",this.template=t;}},{key:"initNativeEvent",value:function value(){}}]);}(rX),dX={name:"dvsUi",install:function install(e){for(var t=e.getClassStore(),i=t.Viewer,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];t.Viewer=function(e,t,i){var r=Gb(t,1)[0];return i=function(e){function t(e){var i;return Xk(this,t),Wk(yb(i=cL(this,t,[e])),"ui",void 0),Wk(yb(i),"uiConfig",void 0),Wk(yb(i),"bindPostfix",!0),i.uiConfig=NL(e.uiConfig||{root:{}},_SL(r||{})),n(i.uiConfig.root,i.context.postfix),nX.registerComponent({Group:uX,Button:sX,Root:hX,MainCanvas:lX,Pagination:cX}),i.ui=new nX({container:e.container,emitter:i.context.emitter,postfix:i.context.postfix,uiConfig:i.uiConfig,injection:{viewer:yb(i)}}),i.context.uiService.rootDom=i.ui.rootDom,i.bindContainer(e.container),i.context.hooksService.hooks.destroy.on(function(){i.ui.unbindContainer();}),i.initEvent(),i;}return _b(t,e),Yk(t,[{key:"width",get:function get(){var e=getComputedStyle(this.rootDom).width.match(/\d+/);if(!e)return 0;var t=Gb(e,1)[0];return $S(t,10);},set:function set(e){this.uiConfig.root.style.width=e,e=String(e),/\d+$/.test(e)&&(e="".concat(e,"px")),this.rootDom.style.width="".concat(e),this.externalResized();}},{key:"height",get:function get(){var e=getComputedStyle(this.rootDom).height.match(/\d+/);if(!e)return 0;var t=Gb(e,1)[0];return $S(t,10);},set:function set(e){this.uiConfig.root.style.height=e,e=String(e),/\d+$/.test(e)&&(e="".concat(e,"px")),this.rootDom.style.height="".concat(e),this.externalResized();}},{key:"setButtonClass",value:function value(e,t){this.ui.emit("setButtonClass",e,t);}},{key:"updateUiConfig",value:function value(e){return!0;}},{key:"bindContainer",value:function value(e){if(!e)return!1;var t=e;return TL(e)&&(t=document.querySelector("#".concat(e))),this.ui.bindContainer(t),this.context.uiService.container=t,this.context.uiService.rootDom=this.ui.rootDom,this.getViewerConfig().show||(this.context.uiService.rootDom.style.display="none"),this.context.uiService.isBindContainer=!0,this.resized(),!0;}},{key:"initEvent",value:function value(){var e=this;this.context.hooksService.hooks.pageChanged.on(function(t){var i,r;null===(i=e.ui)||void 0===i||null===(r=i.stores[cX.storeName])||void 0===r||r.dispatch({type:"setPageNumber",pageDetails:t});});}}]);}(e),Wk(i,"use",e.use),i;function n(e,t){if(kL(e)){CL(e.id)||(e.id+=t);for(var i=0,r=oB(e);i<r.length;i++){var o=Gb(r[i],2);o[0],n(o[1],t);}}else bL(e)&&$k(e).call(e,function(e){n(e,t);});}}(i,n);}},fX=function(){return Yk(function e(){Xk(this,e);},[{key:"init",value:function value(e){var t=e.dvsContext.hooksService.hooks.overlay,i=function i(t){var i=t.uids,r=t.left,n=t.top,o=t.width,a=t.height,s=t.tabUid;t.trigger;var u=t.color,l=t.opacity,c=t.overlayUid,h=e.getTab(s);h&&($k(i).call(i,function(e){var t=h.getChildByUid(e);if(t){var i=new WW({id:c,style:{points:[{x:r,y:n},{x:r+o,y:n},{x:r+o,y:n+a},{x:r,y:n+a}],background:u,borderWidth:0,opacity:l}});t.overlays.appendChild(i),t.clearOptimization();}}),e.tabService.isCurrentTab(s)&&(e.showTab(h),e.renderOnly()));},r=function r(t){var i,r=t.tabNode;$k(i=r.childNodes).call(i,function(t){var i=e.getStatus(t.uid);if(i&&t.isVisible){var r,n,o;$k(r=RI(n=t.overlays.childNodes).call(n)).call(r,function(e){t.overlays.removeChild(e);});var a=i.imageScale;$k(o=i.overlays).call(o,function(i){i.uids;var r=i.left,n=i.top,o=i.width,s=i.height;i.tabUid,i.trigger;var u=i.color,l=i.opacity,c=i.overlayUid;"multiple"===e.config.displayMode&&e.config.useMinImage&&(r/=a,n/=a,o/=a,s/=a);var h=new WW({id:c,style:{points:[{x:r,y:n},{x:r+o,y:n},{x:r+o,y:n+s},{x:r,y:n+s}],background:u,borderWidth:0,opacity:l}});t.overlays.appendChild(h);});}});};e.layoutService.hooks.beforeLayout.on(r),t.on(i),e.hooksService.hooks.destroy.on(function(){t.off(i),e.layoutService.hooks.beforeLayout.off(r);});}}]);}(),vX={name:"dvsDWT",install:function install(e){var t=e.getClassStore(),i=t.Viewer;if(i){var r=function(e,t){return t=function(e){function t(e){var i;return Xk(this,t),Wk(i=cL(this,t,[e]),"imageSize",void 0),i.context.configService.registerHandler("showVideoContainer",function(e,t){e.config.showVideoContainer=t;var i=document.querySelector("#dvs-video-container".concat(e.postfix));i&&(t?(i.style.display="flex",i.firstChild.style.display="inline",e.uiService.canvasAndScrollContainer.style.display="none"):(i.style.display="none",i.firstChild.style.display="none",e.uiService.canvasAndScrollContainer.style.display="flex",e.resized()));}),i;}return _b(t,e),Yk(t,[{key:"dwtWidth",get:function get(){return this.width;},set:function set(e){this.width=e,this.emit("dwtResize",this.width,this.height);}},{key:"dwtHeight",get:function get(){return this.height;},set:function set(e){this.height=e,this.emit("dwtResize",this.width,this.height);}},{key:"dwtRender",value:function value(){var e=this,t=this.render();if(t&&"single"===this.context.config.displayMode){var i=this.getCurrentIndex();this.emit("pageRendered",i);}if(t&&"multiple"===this.context.config.displayMode){var r,n=this.getCurrentTab();n&&$k(r=n.children).call(r,function(t,i){t.isVisible&&e.emit("pageRendered",i);});}return t;}},{key:"updateVideoImage",value:function value(e){var t=this;if(!this.getViewerConfig().showVideoContainer)return!1;var i=document.querySelector("#dvs-video-image".concat(this.postfix));return i&&(i.src=e),i.onload=function(){var e=i.naturalWidth,r=i.naturalHeight,n=i.clientWidth,o=i.clientHeight,a=t.imageSize;a&&a.naturalWidth===e&&a.naturalHeight===r&&a.clientWidth===n&&a.clientHeight===o||(t.imageSize={naturalWidth:e,naturalHeight:r,clientWidth:n,clientHeight:o},t.updateVideoSize());},!0;}},{key:"updateVideoSize",value:function value(){if(this.imageSize&&this.getViewerConfig().showVideoContainer){var e=document.querySelector("#dvs-video-container".concat(this.postfix)),t=document.querySelector("#dvs-video-image".concat(this.postfix)),i=e.clientWidth,r=e.clientHeight,n=this.imageSize,o=n.naturalWidth,a=n.naturalHeight,s=o,u=a;o/a>=i/r?(s=i,u=a*(i/o)):(u=r,s=o*(r/a)),t.style.width="".concat(s,"px"),t.style.height="".concat(u,"px"),this.imageSize.clientWidth=t.clientWidth,this.imageSize.clientHeight=t.clientHeight;}}},{key:"overlayRectangle",value:function value(e,t,i,r,n){var o=this,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"#000",s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;if(!vF(this,e=fF(this,e)))return!1;var u=this.getCurrentTab(),l=$E(e).call(e,function(e){return u.getUidByIndex(e);}),c={tabUid:u.uid,tabType:u.type,trigger:this.uid,uids:l,left:t,top:i,width:r,height:n,color:a,opacity:s,overlayUid:WL()};return $k(l).call(l,function(e){o.context.getStatus(e).overlays.push(Fk({},c));}),this.context.dvsContext.hooksService.hooks.overlay.emit(c),!0;}},{key:"getCurrentPageUids",value:function value(){var e,t=this.getCurrentTab();return t?$E(e=t.children).call(e,function(e){return e.uid;}):[];}},{key:"getCurrentPageCounts",value:function value(){var e=this.getCurrentTab();return(null==e?void 0:e.total)||0;}}]);}(e),Wk(t,"use",e.use),t;}(i);r.use(new fX()),t.Viewer=r;}}},gX=function(){return Yk(function e(t){Xk(this,e),Wk(this,"context",void 0),Wk(this,"outer",void 0),Wk(this,"inner",void 0),Wk(this,"original",void 0),Wk(this,"matrixes",void 0),Wk(this,"blanks",[]),Wk(this,"overlays",[]),this.context=t;},[{key:"handle",value:function value(e){var t,i=this;this.outer=new AW(),this.inner=new AW(),this.outer.appendChild(this.inner),this.original=this.inner,this.matrixes=[],this.blanks=[],this.overlays=[];var r=e.operations,n=e.width,o=e.height,a=e.blanks,s=n,u=o;return this.inner.updateStyle({x:0,y:0,width:n,height:o}),this.outer.updateStyle({width:n,height:o}),r&&$k(r).call(r,function(e){if("r"===e.type){var t=i.rotate(e,s,u),r=t.rWidth,n=t.rHeight;s=r,u=n;}else if("c"===e.type){var o=i.crop(e),l=o.width,c=o.height;s=l,u=c;}else if("f"===e.type)i.flip(e);else if("z"===e.type){var h=i.resize(e,s,u),d=h.rWidth,f=h.rHeight;s=d,u=f;}else"e"===e.type&&i.erase(e,a);}),{width:s,height:u,matrixes:RI(t=this.matrixes).call(t),blanks:this.blanks};}},{key:"erase",value:function value(e,t){var i,r=this;$k(i=e.detail).call(i,function(e){var t,i=e.left,n=e.top,o=e.width,a=e.height,s=r.original.getWorldTransform().clone().invertSelf(),u=$E(t=[[i,n],[i+o,n],[i+o,n+a],[i,n+a]]).call(t,function(e){var t=Gb(e,2),i=t[0],r=t[1];return s.transformPoint({x:i,y:r,z:0});});r.blanks.push({uid:e.eraseUid,points:u,background:e.color});});}},{key:"resize",value:function value(e,t,i){var r=e.detail[e.detail.length-1];r||console.error("resize operation is empty");var n=r.width,o=r.height,a=n/t,s=o/i,u=(n-t)/2,l=(o-i)/2,c=new AW();c.updateStyle({x:0,y:0,width:n,height:o}),c.appendChild(this.outer),this.inner=this.outer,this.outer=c,this.inner.scale(a,s,1);var h=this.inner.getPosition(),d=h.x,f=h.y;this.inner.setPosition({x:d+u,y:f+l,z:0});var v=this.inner.getLocalTransform();return this.matrixes.push(v),{rWidth:n,rHeight:o};}},{key:"flip",value:function value(e){var t,i=[1,1,1];$k(t=e.detail).call(t,function(e){"v"===e.dir?(i[1]*=-1,i[2]*=-1):"h"===e.dir&&(i[0]*=-1,i[2]*=-1);});var r=new AW();r.updateStyle({x:0,y:0,width:this.outer.width,height:this.outer.height}),r.appendChild(this.outer),this.outer.scale(i[0],i[1],i[2]),this.inner=this.outer,this.outer=r;var n=this.inner.getLocalTransform();this.matrixes.push(n);}},{key:"crop",value:function value(e){var t,i=null;if($k(t=e.detail).call(t,function(e){var t=e.left,r=e.top,n=e.width,o=e.height;if(i){var a=i.getRect(),s=a.left,u=a.top,l=new qW(t+s,t+s+n,r+u,r+u+o);i=i.intersection(l);}else i=new qW(t,t+n,r,r+o);}),!i)return console.error("there is no crop operation"),{width:0,height:0};var r=i.getRect(),n=new AW();n.updateStyle({x:0,y:0,width:r.width,height:r.height}),n.appendChild(this.outer),this.inner=this.outer,this.outer=n;var o=this.inner.getPosition(),a=o.x,s=o.y;this.inner.setPosition({x:a-r.left,y:s-r.top,z:0});var u=this.inner.getLocalTransform();return this.matrixes.push(u),i.getRect();}},{key:"rotate",value:function value(e,t,i){var r,n=this,o=null,a=0;if($k(r=e.detail).call(r,function(e){if(null===o&&(o=e.type),e.type===o)a+=e.angle;else{var r=n.executeRotate(o,a,t,i),s=r.width,u=r.height;t=s,i=u,o=e.type,a=e.angle;}}),o){var s=this.executeRotate(o,a,t,i),u=s.width,l=s.height;t=u,i=l;}return{rWidth:t,rHeight:i};}},{key:"rotateInContainMode",value:function value(e,t,i){var r=function(e,t,i,r,n,o,a){var s=0+i/2,u=0+r/2,l=_N(0,0,s,u,n),c=_N(0+i,0,s,u,n),h=_N(0+i,0+r,s,u,n),d=_N(0,0+r,s,u,n),f=pA(o=[c.x,l.x,d.x,h.x]).call(o,function(e,t){return e-t;}),v=pA(a=[c.y,l.y,d.y,h.y]).call(a,function(e,t){return e-t;});return{x:f[0],y:v[0],width:f[3]-f[0],height:v[3]-v[0]};}(0,0,t,i,xN(e)),n=r.width,o=r.height,a=(n-t)/2,s=(o-i)/2;t=n,i=o;var u=new AW();u.updateStyle({x:0,y:0,width:n,height:o}),u.appendChild(this.outer),this.outer.rotateLocal(e),this.inner=this.outer,this.outer=u;var l=this.inner.getPosition(),c=l.x,h=l.y;this.inner.setPosition({x:c+a,y:h+s,z:0});var d=this.inner.getLocalTransform();return this.matrixes.push(d),{rWidth:n,rHeight:o};}},{key:"executeRotate",value:function value(e,t,i,r){if("clip"===e){var n=new AW();n.updateStyle({x:0,y:0,width:i,height:r}),n.appendChild(this.outer),this.outer.rotateLocal(t),this.inner=this.outer,this.outer=n;var o=this.inner.getLocalTransform();this.matrixes.push(o);}else if("contain"===e){var a=this.rotateInContainMode(t,i,r);i=a.rWidth,r=a.rHeight;}return{width:i,height:r};}},{key:"toMinImageOperations",value:function value(e,t){var i=[];return $k(e).call(e,function(e){var r,n,o,a={type:e.type,detail:[]};i.push(a),"c"===e.type||"e"===e.type?$k(r=e.detail).call(r,function(e){var i=Fk(Fk({},e),{},{left:e.left/t,top:e.top/t,width:e.width/t,height:e.height/t});a.detail.push(i);}):"f"===e.type||"r"===e.type?$k(n=e.detail).call(n,function(e){var t=Fk({},e);a.detail.push(t);}):"z"===e.type&&$k(o=e.detail).call(o,function(e){var i=Fk(Fk({},e),{},{width:e.width/t,height:e.height/t});a.detail.push(i);});}),i;}}]);}(),mX=function(e){function t(e,i){var r;return Xk(this,t),Wk(yb(r=cL(this,t)),"uid",void 0),Wk(yb(r),"context",void 0),Wk(yb(r),"action",void 0),Wk(yb(r),"tabUid",void 0),r.context=e,r.action=i,r.uid=i.commandUid,r.tabUid=i.tabUid,r;}return _b(t,e),Yk(t,[{key:"execute",value:function value(){}},{key:"undo",value:function value(){this.context.removeActionFromStatus(this.action);}}]);}(wF),yX=function(e){function t(){return Xk(this,t),cL(this,t,arguments);}return _b(t,e),Yk(t);}(mX),pX=function(e){function t(){return Xk(this,t),cL(this,t,arguments);}return _b(t,e),Yk(t);}(mX),wX=function(e){function t(){return Xk(this,t),cL(this,t,arguments);}return _b(t,e),Yk(t,[{key:"execute",value:function value(){var e=this.action,t=e.left,i=e.top,r=e.width,n=e.height,o=e.color,a=e.uids,s=e.eraseUid,u=this.context.getTab(this.tabUid);u&&$k(a).call(a,function(e){var a=u.getChildByUid(e);if(a){var l=new WW({id:s,style:{points:[{x:t,y:i},{x:t+r,y:i},{x:t+r,y:i+n},{x:t,y:i+n}],background:o,borderWidth:0}});a.blanks.appendChild(l);}});}},{key:"undo",value:function value(){var e,t=this;this.context.removeActionFromStatus(this.action);var i=this.context.getTab(this.tabUid);i&&$k(e=this.action.uids).call(e,function(e){var r=i.getChildByUid(e);if(r){var n,o=xP(n=r.blanks.children).call(n,function(e){return e.id===t.action.eraseUid;});o&&r.blanks.removeChild(o);}});}}]);}(mX),bX=function(e){function t(){return Xk(this,t),cL(this,t,arguments);}return _b(t,e),Yk(t);}(mX),kX=function(e){function t(){return Xk(this,t),cL(this,t,arguments);}return _b(t,e),Yk(t);}(mX),SX=function(){return Yk(function e(){Xk(this,e);},[{key:"init",value:function value(e){var t=e.getGlobalHooks(),i=t.rotate,r=t.flip,n=t.crop,o=t.erase,a=t.changeSize,s=t.reset,u=function u(t){var i;$k(i=e.getAllTabs()).call(i,function(i){var r;if(bF(t,i)){var n,o=null;switch($k(n=(t=_SL(t)).uids).call(n,function(e){var t=i.getChildByUid(e);t.isEdited=!0,t&&t.clearOptimization();}),t.actionType){case"r":(Math.abs(t.angle)%90||"clip"===t.type)&&$k(r=t.uids).call(r,function(t){var r=i.getChildByUid(t);r&&(r.imageContainer.updateStyle({background:e.config.blankFillColor}),e.getStatus(r.uid).useFillColor=!0);}),o=new kX(e,t);break;case"f":o=new bX(e,t);break;case"c":o=new pX(e,t);break;case"e":o=new wX(e,t);break;case"z":o=new yX(e,t);}i.commandController.execute(o),e.tabService.isCurrentTab(i.uid)&&e.render();}});},l=function l(t){var i,r=t.uids;$k(i=e.getAllTabs()).call(i,function(i){bF(t,i)&&($k(r).call(r,function(e){var t,r,n=i.getChildByUid(e);n.isEdited=!0,n&&$k(t=RI(r=n.blanks.childNodes).call(r)).call(t,function(e){n.blanks.removeChild(e);});}),e.tabService.isCurrentTab(i.uid)&&e.render());});};e.layoutService.hooks.beforeLayout.on(function(t){var i,r=t.tabNode;$k(i=r.childNodes).call(i,function(t){var i=e.getStatus(t.uid);if(i&&t.isVisible&&t.isLoaded&&t.image.style.img){var r,n,o,a={operations:i.operations,width:(null===(r=t.image.style.img)||void 0===r?void 0:r.naturalWidth)||0,height:(null===(n=t.image.style.img)||void 0===n?void 0:n.naturalHeight)||0,blanks:$E(o=t.blanks.children).call(o,function(e){return e.id;})};"multiple"===e.config.displayMode&&e.config.useMinImage&&(a.operations=e.dvsContext.editService.toMinImageOperations(i.operations,i.imageScale));var s=e.dvsContext.editService.handle(a),u=s.width,l=s.height,c=s.matrixes,h=s.blanks;t.image.externalMatrixes=c,t.realTimeWidth=u,t.realTimeHeight=l,"multiple"===e.config.displayMode&&e.config.useMinImage||i.setRealTimeSize(u,l),$k(h).call(h,function(e){var i;xP(i=t.blanks.children).call(i,function(t){return t.id===e.uid;}).updateStyle({points:e.points,background:e.background});});}});}),i.on(u),r.on(u),n.on(u),o.on(u),a.on(u),s.on(l),e.hooksService.hooks.destroy.on(function(){i.off(u),r.off(u),n.off(u),o.off(u),a.off(u),s.off(l);});}}]);}(),xX={name:"dvsEdit",install:function install(e){var t=e.getClassStore(),i=t.Viewer;if(i){var r=function(e,t){return t=function(e){function t(e){var i;return Xk(this,t),Wk(yb(i=cL(this,t,[e])),"viewerConfig",void 0),i.context.configService.registerHandler("rotationType",function(e,t){e.config.rotationType=t;}),i.context.config.rotationType||(i.context.config.rotationType="contain"),i;}return _b(t,e),Yk(t,[{key:"rotate",value:function value(e,t){if(!vF(this,t=fF(this,t)))return!1;var i=this.getCurrentTab(),r=$E(t).call(t,function(e){return i.getUidByIndex(e);}),n={actionType:"r",commandUid:WL(),tabUid:i.uid,tabType:i.type,trigger:this.uid,uids:r,angle:e,type:this.getViewerConfigByName("rotationType")};return this.context.storeActionToStatus(n),this.context.getGlobalHooks().rotate.emit(n),!0;}},{key:"flip",value:function value(e,t){if(!vF(this,e=fF(this,e)))return!1;var i=this.getCurrentTab(),r=$E(e).call(e,function(e){return i.getUidByIndex(e);}),n={actionType:"f",commandUid:WL(),tabUid:i.uid,tabType:i.type,trigger:this.uid,uids:r,dir:t||"v"};return this.context.storeActionToStatus(n),this.context.getGlobalHooks().flip.emit(n),!0;}},{key:"mirror",value:function value(e){return this.flip(e,"h");}},{key:"changePageSize",value:function value(e,t,i){if(!vF(this,e=fF(this,e)))return!1;var r=this.getCurrentTab(),n=$E(e).call(e,function(e){return r.getUidByIndex(e);}),o={actionType:"z",commandUid:WL(),tabUid:r.uid,tabType:r.type,trigger:this.uid,uids:n,width:t,height:i};return this.context.storeActionToStatus(o),this.context.getGlobalHooks().changeSize.emit(o),!0;}},{key:"crop",value:function value(e,t,i,r,n){if(!vF(this,e=fF(this,e)))return!1;var o=this.getCurrentTab(),a=$E(e).call(e,function(e){return o.getUidByIndex(e);}),s={actionType:"c",commandUid:WL(),tabUid:o.uid,tabType:o.type,trigger:this.uid,uids:a,left:t,top:i,width:r,height:n};return this.context.storeActionToStatus(s),this.context.getGlobalHooks().crop.emit(s),!0;}},{key:"erase",value:function value(e,t,i,r,n,o){if(!vF(this,e=fF(this,e)))return!1;var a=this.getCurrentTab(),s=$E(e).call(e,function(e){return a.getUidByIndex(e);}),u={actionType:"e",commandUid:WL(),tabUid:a.uid,tabType:a.type,trigger:this.uid,eraseUid:WL(),uids:s,left:t,top:i,width:r,height:n,color:o};return this.context.storeActionToStatus(u),this.context.getGlobalHooks().erase.emit(u),!0;}}]);}(e),Wk(t,"use",e.use),t;}(i);r.use(new SX()),t.Viewer=r;}},init:function init(e){e.context.editService=new gX(e.context);}},CX=function(){return Yk(function e(t,i,r,n){Xk(this,e),Wk(this,"webViewer",void 0),Wk(this,"bDispose",!1),Wk(this,"element",void 0),Wk(this,"container",void 0),Wk(this,"css",void 0),this.webViewer=t,this.element=i,this.element.style.flexShrink="0";var o=this.webViewer.myViewer.rootDom;this.container=o.querySelector("#dvs-viewer-main".concat(t.myViewer.postfix));var a="dvs-customElement-right";switch(r){case"left":a="dvs-customElement-left";break;case"top":a="dvs-customElement-top";break;case"bottom":a="dvs-customElement-bottom";}n&&this.element.classList.add("dvs-customElement-full"),this.css=a,this.container.classList.add(a),this.container.appendChild(i),this.hide();},[{key:"show",value:function value(){if(this.element)return this.element.style.display="block",this.webViewer.resized(),this.webViewer.resized(),!0;var e=this.bDispose?"CustomElementDispose":"CustomElementNotExist";return this.webViewer.setError(e),!1;}},{key:"hide",value:function value(){if(this.element)return this.element.style.display="none",this.webViewer.resized(),this.webViewer.resized(),!0;var e=this.bDispose?"CustomElementDispose":"CustomElementNotExist";return this.webViewer.setError(e),!1;}},{key:"dispose",value:function value(){return this.bDispose||(this.element&&(this.container.removeChild(this.element),this.webViewer.resized(),this.webViewer.resized(),this.webViewer.customElement=void 0,this.element=null,this.container.classList.remove(this.css),this.container=void 0),this.bDispose=!0),!0;}}]);}();function VX(e){var t=function t(e){var t=Number(e).toString(16).toUpperCase();return 1===t.length&&(t=["0",t].join("")),t;},i=(65280&e)>>8,r=255&e;return["#",t(e>>16),t(i),t(r)].join("");}function TX(e){if(CL(e))return!1;if(""===e)return!0;var t=document.createElement("div");return t.style.background=e,""!==t.style.background;}function IX(e){if(CL(e))return!1;if(""===e)return!0;var t=document.createElement("div");t.style.border=e;var i=t.style,r=i.borderWidth,n=i.borderColor,o=i.borderStyle;return"initial"!==r&&""!==r&&"initial"!==n&&""!==r&&"initial"!==o&&""!==r;}function EX(e){var t=FO(e);return!(CL(t)||t.value<0);}var PX=10===document.documentMode?"dvs-buttons-ie":"dvs-buttons";function BX(e){var t;return lS(t="dvs-editor-iconfont ds-dwt-ui-icon-".concat(e," ")).call(t,PX);}var DX={type:"Button",className:"".concat(PX," dwt-viewer-imageEditor-emptyBtn"),style:{visibility:"visible"}},MX={type:"Button",name:"previous",id:"previous",className:BX("preImage"),style:{visibility:"visible"},events:{click:"previousImage"}},zX={type:"Button",name:"next",id:"next",className:BX("nextImage"),style:{visibility:"visible"},events:{click:"nextImage"}},UX={type:"Button",name:"scan",id:"scan",className:BX("acquire"),style:{visibility:"visible"},events:{click:"scanImage"}},AX={type:"Button",name:"load",id:"load",className:BX("load"),style:{visibility:"visible"},events:{click:"loadImage"}},RX={type:"Button",name:"print",id:"print",className:BX("printImage"),style:{visibility:"visible"},events:{click:"printImage"}},LX={type:"Button",name:"removeAll",id:"removeAll",className:BX("removeall"),style:{visibility:"visible"},events:{click:"removeAllImage"}},NX={type:"Button",name:"removeSelected",id:"removeSelected",className:BX("removeImage"),style:{visibility:"visible"},events:{click:"removeImage"}},OX={type:"Button",name:"rotateLeft",id:"rotateLeft",className:BX("rotateLeftImage"),style:{visibility:"visible"},events:{click:"rotateLeft"}},WX={type:"Button",name:"rotate",id:"rotate",className:BX("rotate"),style:{visibility:"visible",position:"relative"},events:{click:"rotate"}},HX={type:"Button",name:"rotateRight",id:"rotateRight",className:BX("rotateRightImage"),style:{visibility:"visible"},events:{click:"rotateRight"}},FX={type:"Button",name:"deskew",id:"deskew",className:BX("deskew"),style:{visibility:"visible"},events:{click:"deskew"}},jX={type:"Button",name:"crop",id:"crop",className:BX("cropImage-grey"),style:{visibility:"visible"},events:{click:"cropImage"}},YX={type:"Button",name:"cut",id:"cut",className:BX("erase-grey"),style:{visibility:"visible"},events:{click:"cutImage"}},XX={type:"Button",name:"changeImageSize",id:"changeImageSize",className:BX("changeImageSize"),style:{visibility:"visible",position:"relative"},events:{click:"changeImageSize"}},qX={type:"Button",name:"flip",id:"flip",className:BX("flipImage"),style:{visibility:"visible"},events:{click:"flipImage"}},ZX={type:"Button",name:"mirror",id:"mirror",className:BX("mirrorImage"),style:{visibility:"visible"},events:{click:"mirrorImage"}},_X={type:"Button",name:"zoomIn",id:"zoomIn",className:BX("zoomin"),style:{visibility:"visible"},events:{click:"zoomIn"}},GX={type:"Button",name:"originalSize",id:"originalSize",className:BX("originalsize"),style:{visibility:"visible"},events:{click:"originalSize"}},KX={type:"Button",name:"zoomOut",id:"zoomOut",className:BX("zoomout"),style:{visibility:"visible"},events:{click:"zoomOut"}},$X={type:"Button",name:"fit",id:"fit",className:BX("fullWebType"),style:{visibility:"visible"},events:{click:"fitWindow"}},JX={type:"Button",name:"fitW",id:"fitW",className:BX("fitWidthType"),style:{visibility:"visible"},events:{click:"fitWidth"}},QX={type:"Button",name:"fitH",id:"fitH",className:BX("fitHeightType"),style:{visibility:"visible"},events:{click:"fitHeight"}},eq={type:"Button",name:"hand",id:"hand",className:BX("hand"),style:{visibility:"visible"},events:{click:"handMode"}},tq={type:"Button",name:"rectSelect",id:"rectSelect",className:BX("select"),style:{visibility:"visible"},events:{click:"selectMode"}},iq={type:"Button",name:"zoom",id:"zoom",className:BX("clicktozoomin"),style:{visibility:"visible"},events:{click:"zoomMode"}},rq={type:"Button",name:"restore",id:"restore",className:BX("restore"),style:{visibility:"visible"},events:{click:"restoreImage"}},nq={type:"Button",name:"save",id:"save",className:BX("saveImage"),style:{visibility:"visible"},events:{click:"saveImage"}},oq={type:"Button",name:"close",id:"close",className:BX("close"),style:{visibility:"visible"},events:{click:"closeImageEditor"}},aq=["previousImage","nextImage","scanImage","loadImage","printImage","removeAllImage","removeImage","rotateLeft","rotate","rotateRight","deskew","cropImage","cutImage","changeImageSize","flipImage","mirrorImage","zoomIn","originalSize","zoomOut","fitWindow","fitWidth","fitHeight","handMode","selectMode","zoomMode","restoreImage","saveImage","closeImageEditor"],sq=["bufferChanged","click","pageAreaSelected","pageAreaUnselected"],uq={root:{style:{display:"flex",flexDirection:"column",position:"relative"},id:"root",children:[{type:"Group",style:{height:"40px",minHeight:"30px",background:"rgb(58, 57, 59)",boxSizing:"border-box"},id:"header",className:"dwt-viewer-imageEditor-header",children:[{style:{width:"95%"},type:"Group",className:"dwt-viewer-imageEditor-leftButtons",children:[MX,zX,DX,UX,AX,RX,DX,LX,NX,DX,OX,WX,HX,FX,DX,jX,YX,XX,qX,ZX,DX,_X,GX,KX,DX,$X,JX,QX,DX,eq,tq,iq,DX,rq,nq]},{style:{width:"5%",justifyContent:"flex-end"},type:"Group",className:"dwt-viewer-imageEditor-rightButtons",children:[oq]}]},{type:"MainCanvas",id:"canvas",className:"dvs-canvas"}]}},lq={flex:"1",visibility:"visible",fontSize:"1.2em"},cq={visibility:"visible",fontSize:"1.2em"},hq={root:{style:{display:"flex",flexDirection:"column",position:"relative"},id:"root",children:[{type:"Group",dataId:"header",style:{padding:"0 8px",height:"40px",background:"#2a292b",boxSizing:"border-box"},className:"dwt-viewer-imageEditor-header",children:[Fk(Fk({},AX),{},{style:Fk({},cq)}),Fk(Fk({},oq),{},{style:Fk({},cq)})]},{type:"Group",dataId:"body",style:{display:"flex",flexDirection:"column"},children:[{type:"Group",dataId:"topMenu",style:{height:"60px",boxSizing:"border-box",background:"#3a393b"},children:[Fk(Fk({},OX),{},{style:Fk({},lq)}),Fk(Fk({},HX),{},{style:Fk({},lq)}),Fk(Fk({},qX),{},{style:Fk({},lq)}),Fk(Fk({},ZX),{},{style:Fk({},lq)}),Fk(Fk({},jX),{},{style:Fk({},lq)}),Fk(Fk({},YX),{},{style:Fk({},lq)}),Fk(Fk({},eq),{},{style:Fk({},lq)}),Fk(Fk({},tq),{},{style:Fk({},lq)})]},{type:"MainCanvas",dataId:"canvas",className:"dvs-canvas"},{type:"Group",dataId:"bottomMenu",style:{height:"60px",background:"rgb(58, 57, 59)"},children:[{type:"Pagination",className:"dvs-imageEditor-pagination",events:{change:"paginationChange"},style:{display:"flex",width:"50%"},firstPage:{id:"firstPage",style:{visibility:"visible",flex:1}},lastPage:{id:"lastPage",style:{visibility:"visible",flex:1}},prevPage:{id:"previousPage",style:{visibility:"visible",flex:1}},nextPage:{id:"nextPage",style:{visibility:"visible",flex:1}},gotoPage:{style:{visibility:"visible",flex:1}},total:{style:{visibility:"visible",flex:1,textAlign:"center"}}},Fk(Fk({},LX),{},{style:Fk({},lq)}),Fk(Fk({},NX),{},{style:Fk({},lq)}),Fk(Fk({},rq),{},{style:Fk({},lq)}),Fk(Fk({},nq),{},{style:Fk({},lq)})]}]}]}};function dq(e){var t={};return BL(null==e?void 0:e.borderWidth)&&(t.borderWidth=e.borderWidth),bL(null==e?void 0:e.lineDash)&&BL(e.lineDash[0])&&BL(e.lineDash[1])&&(t.dashLine=[e.lineDash[0],e.lineDash[1]]),TL(null==e?void 0:e.borderColor)&&(t.borderColor=e.borderColor),TL(null==e?void 0:e.handleColor)&&(t.ctrlBorderColor=e.handleColor),BL(null==e?void 0:e.handleWidth)&&(t.ctrlWidth=e.handleWidth),BL(null==e?void 0:e.handleHeight)&&(t.ctrlHeight=e.handleHeight),t;}function fq(e){return{borderWidth:e.borderWidth,lineDash:e.dashLine,handleWidth:e.ctrlWidth,handleHeight:e.ctrlHeight,handleColor:e.ctrlBorderColor,borderColor:e.borderColor};}var vq=function(){return Yk(function e(t,i){Xk(this,e),Wk(this,"dvs",void 0),Wk(this,"cutColor","white"),Wk(this,"webViewer",void 0),Wk(this,"editorViewer",void 0),Wk(this,"viewerSetting",void 0),Wk(this,"containerElement",void 0),Wk(this,"uiSetting",uq),Wk(this,"editorSetting",void 0),Wk(this,"bShowImageEditor",!1),Wk(this,"lastRotateAngle",45),Wk(this,"lastRotateKeepSize",!1),Wk(this,"promoteSaveChange",!0),Wk(this,"workMode",!1),Wk(this,"bCrop",!1),Wk(this,"bErase",!1),Wk(this,"curIndex",0),Wk(this,"bChanged",!1),Wk(this,"bChangedUid",""),Wk(this,"cursor","select"),Wk(this,"defaultBtnClass","dvs-btn dvs-editor-iconfont dvs-buttons"),Wk(this,"bDispose",!1),Wk(this,"bMobile",!1),Wk(this,"bFullScreen",!1),Wk(this,"deskewStarted",!1),this.webViewer=t,this.dvs=t.myDvs,this.editorSetting=i||VO,this.promoteSaveChange=i.promptToSaveChange,this.workMode=0===i.workMode,this.updateEditorSetting(i),this.init(i);},[{key:"init",value:function value(e){this.bMobile=UL(),this.editorViewer=this.webViewer.myDvs.createViewer({viewerConfig:{viewerStyle:{background:"white"},canvasStyle:{background:"rgba(0,0,0,0)"},pageStyle:{background:"white"},displayMode:"single",enableOptimizeImage:!0,enableSlide:!0,maxZoom:50,margin:0},uiConfig:this.uiSetting,syncViewerUid:this.webViewer.myViewer.uid}),this.updateViewerSetting(e),0!==this.dvs.context.errorService.errorCode&&this.webViewer.setDefaultError(),this.bDispose=!1,this.bindEditorEvents(),zR(this).call(this),this.disableMobileInput(),this.setWidth(null==e?void 0:e.width),this.setHeight(null==e?void 0:e.height),this.setIfAutoScroll(this.webViewer.getIfAutoScroll());}},{key:"updateViewerSetting",value:function value(e){if(!this.editorViewer)return!1;var t=e.innerBorder,i=e.background,r=e.zoomOrigin,n=this.editorViewer.getViewerConfig().canvasStyle,o={border:t||n.border,background:i||n.background};return this.setZoomOrigin(r),this.editorViewer.updateViewerConfig({cropBoxConfig:_SL(TO),canvasStyle:o}),!0;}},{key:"updateUISetting",value:function value(e){this.editorSetting=e,this.uiSetting=_SL(uq);var t=this.uiSetting.root.children[0],i=t.children[0].children,r=t.children[1].children;if(e.topMenuBorder&&IX(e.topMenuBorder)&&(t.style.border=e.topMenuBorder),e.border&&IX(e.border)&&(this.uiSetting.root.style.border=e.border),this.editorSetting.buttons){for(var n,o=this.editorSetting.buttons,a=o.titles,s=o.visibility,u=[i,r],l=[],c=function c(e){var t;$k(t=u[e]).call(t,function(t,i){var r,n=null==t||null===(r=t.name)||void 0===r?void 0:r.toLocaleLowerCase();CL(a)||CL(a[n])||(t.title=a[n]),CL(s)||CL(s[n])||(t.style.display=!0===s[n]?"":"none",!1===s[n]&&0===e&&l.push(i));});},h=0;h<u.length;h++)c(h);$k(n=[[0,1],[3,4,5],[7,8],[10,11,12,13],[15,16,17,18,19],[21,22,23],[25,26,27],[29,30,31]]).call(n,function(e){if(function(e,t){for(var i=0;i<t.length;i++)if(!AB(e).call(e,t[i]))return!1;return!0;}(l,e)){var t=e[e.length-1]+1;i[t].style.display="none";}});}return this.uiSetting;}},{key:"updateMobileUISetting",value:function value(e){this.editorSetting=e,this.uiSetting=_SL(hq);var t=this.uiSetting.root.children[0],i=this.uiSetting.root.children[1],r=t.children,n=i.children[0],o=n.children,a=i.children[2].children;if(e.topMenuBorder&&IX(e.topMenuBorder)&&(n.style.border=e.topMenuBorder),e.border&&IX(e.border)&&(this.uiSetting.root.style.border=e.border),this.editorSetting.buttons)for(var s=this.editorSetting.buttons,u=s.titles,l=s.visibility,c=[r,o,a],h=0;h<c.length;h++){var d;$k(d=c[h]).call(d,function(e){var t,i=null==e||null===(t=e.name)||void 0===t?void 0:t.toLocaleLowerCase();CL(u)||CL(u[i])||(e.title=u[i]),CL(l)||CL(l[i])||(e.style.visibility=!0===l[i]?"visible":"hidden");});}return this.uiSetting;}},{key:"updateEditorSetting",value:function value(e){this.editorSetting=e,UL()?this.updateMobileUISetting(e):this.updateUISetting(e);}},{key:"bindEditorEvents",value:function value(){var e=this;$k(aq).call(aq,function(t){e.editorViewer.ui.on(t,function(){e.hideImageEditorDialog(),e[t]();});}),$k(sq).call(sq,function(t){e.editorViewer.on(t,function(i,r){e[t](i,r);});}),this.editorViewer.on("contextmenu",function(e,t){t.preventDefault();});var t=this.webViewer.webViewerInitConfig.viewerEvents;ML(null==t?void 0:t.onDrop)&&this.editorViewer.on("drop",function(i,r){e.webViewer.acceptDrop&&(null==t||t.onDrop(i,r));}),this.bMobile&&this.editorViewer.ui.on("paginationChange",function(t){e.goToPage(t.current-1);});}},{key:"resize",value:function value(){if(this.editorViewer){var e=this.editorViewer.rootDom;if(e){var t=this.editorViewer.width,i=16;t>600&&(i=Math.min(22,t/750*16)),i<16&&(i=16),this.bMobile&&(i=20),e.style.fontSize="".concat(i,"px");}}}},{key:"hideImageEditorDialog",value:function value(){this.closeRotateDialog(),this.closeChangeSizeDialog();}},{key:"updateZoomInState",value:function value(e){var t=e?"ds-dwt-ui-icon-zoomin":"ds-dwt-ui-icon-zoomin dvs-grey";this.setButtonClass("zoomIn",t);}},{key:"updateZoomOutState",value:function value(e){var t=e?"ds-dwt-ui-icon-zoomout":"ds-dwt-ui-icon-zoomout dvs-grey";this.setButtonClass("zoomOut",t);}},{key:"updateDeskewState",value:function value(e){var t=e?"ds-dwt-ui-icon-deskew":"ds-dwt-ui-icon-deskew dvs-grey";this.setButtonClass("deskew",t);}},{key:"updateEraseState",value:function value(e,t){var i=e?"ds-dwt-ui-icon-erase":"ds-dwt-ui-icon-erase dvs-grey";this.setButtonClass("cut",i),t&&this.clearSelectedArea();}},{key:"updateCropState",value:function value(e,t){var i=e?"ds-dwt-ui-icon-cropImage":"ds-dwt-ui-icon-cropImage dvs-grey";this.setButtonClass("crop",i),t&&this.clearSelectedArea();}},{key:"updateSaveAndRestoreBtn",value:function value(){var e=this.bChanged?"ds-dwt-ui-icon-saveImage":"ds-dwt-ui-icon-saveImage dvs-grey",t=this.bChanged?"ds-dwt-ui-icon-restore":"ds-dwt-ui-icon-restore dvs-grey";this.setButtonClass("save",e),this.setButtonClass("restore",t);}},{key:"updateCursorState",value:function value(){switch(this.cursor){case"pointer":this.handMode();break;case"zoom":this.zoomMode();break;default:this.selectMode();}return!0;}},{key:"updateMouseModeState",value:function value(e){this.setButtonClass("hand","ds-dwt-ui-icon-hand"),this.setButtonClass("rectSelect","ds-dwt-ui-icon-select"),this.setButtonClass("zoom","ds-dwt-ui-icon-clicktozoomin"),"pointer"===e?this.setButtonClass("hand","ds-dwt-ui-icon-hand dwt-viewer-imageEditor-selected"):"crosshair"===e?this.setButtonClass("rectSelect","ds-dwt-ui-icon-select dwt-viewer-imageEditor-selected"):this.setButtonClass("zoom","ds-dwt-ui-icon-clicktozoomin dwt-viewer-imageEditor-selected");}},{key:"updateState",value:function value(){if(this.editorViewer){var e=this.webViewer.getHowManyImagesInBuffer(),t=this.webViewer.getCurrentIndex();e>1?(this.webViewer.getCurrentIndex()===e-1||e<=1?this.setButtonClass("next","ds-dwt-ui-icon-nextImage dvs-grey"):this.setButtonClass("next","ds-dwt-ui-icon-nextImage"),t<=0||e<=1?this.setButtonClass("previous","ds-dwt-ui-icon-preImage dvs-grey"):this.setButtonClass("previous","ds-dwt-ui-icon-preImage")):(this.setButtonClass("next","ds-dwt-ui-icon-nextImage dvs-grey"),this.setButtonClass("previous","ds-dwt-ui-icon-preImage dvs-grey")),this.updateSaveAndRestoreBtn(),this.updateCropState(!1,!0),this.updateEraseState(!1,!0),this.updateCursorState();}}},{key:"setChangedState",value:function value(e){e?(this.bChanged=!0,this.bChangedUid=this.webViewer.getCurrentImgUUid()):(this.bChanged=!1,this.bChangedUid="");}},{key:"disableMobileInput",value:function value(){if(this.bMobile){var e=document.querySelector(".dvs-pagination-goto");e&&(e.disabled=!0);}}},{key:"bindStopPropagation",value:function value(e){var t=document.getElementById(e);t&&(t.onclick=function(e){fN(e);});}},{key:"updateEditorConfig",value:function value(e){this.editorViewer.updateViewerConfig(e);}},{key:"setIfAutoScroll",value:function value(e){return!!this.editorViewer&&(this.updateEditorConfig({autoSelectLatest:e,autoScroll:e}),!0);}},{key:"getSelectionBoxStyle",value:function value(){if(!this.editorViewer){var e=this.bDispose?"ImageEditorDispose":"ImageEditorNotExist";return this.webViewer.setError(e),!1;}return fq(this.editorViewer.cropBoxConfig);}},{key:"setSelectionBoxStyle",value:function value(e){if(!this.editorViewer){var t=this.bDispose?"ImageEditorDispose":"ImageEditorNotExist";return this.webViewer.setError(t),!1;}if(!kL(e))return!1;var i=dq(e);return this.updateEditorConfig({cropBoxConfig:i}),!0;}},{key:"resetButtonState",value:function value(){this.setChangedState(!1),this.updateSaveAndRestoreBtn();}},{key:"bind",value:function value(){var e;if(this.bShowImageEditor)return!0;if(!this.editorViewer){var t=this.bDispose?"ImageEditorDispose":"ImageEditorNotExist";return this.webViewer.setError(t),!1;}if(this.editorSetting&&this.editorSetting.element)this.bFullScreen=!1,TL(this.editorSetting.element)?this.containerElement=document.getElementById(this.editorSetting.element):this.containerElement=this.editorSetting.element;else{var i=document.createElement("div");i.className="dwt-viewer-imageEditor-fullScreen",document.body.insertBefore(i,document.body.firstElementChild),this.bFullScreen=!0,this.containerElement=i;}if(this.editorViewer.bindContainer(this.containerElement),this.editorViewer.hide(),this.updateState(),this.setSelectionRectAspectRatio((null===(e=this.editorSetting)||void 0===e?void 0:e.selectionRectAspectRatio)||0),!this.bMobile){var r=document.getElementById("header".concat(this.editorViewer.postfix));r&&r.addEventListener("wheel",function(e){e.preventDefault();},{passive:!1});}return!0;}},{key:"close",value:function value(){if(!this.editorViewer){var e=this.bDispose?"ImageEditorDispose":"ImageEditorNotExist";return this.webViewer.setError(e),!1;}this.bFullScreen&&document.body.removeChild(this.containerElement);var t=this.webViewer.webViewerInitConfig.imageEditorEvents;return this.bShowImageEditor=!1,this.webViewer.bShowImageEditor=!1,this.hideImageEditorDialog(),this.dvs.removeViewer(this.editorViewer),this.bFullScreen=!1,this.containerElement=null,this.editorViewer=void 0,this.webViewer.imageEditor=void 0,this.dvs=null,this.bDispose=!0,t&&ML(null==t?void 0:t.close)&&null!=t&&t.close(),window.removeEventListener("resize",window.dvsResize),window.dvsResize=null,document.body.style.overflow="",!0;}},{key:"show",value:function value(){var e;if(this.bShowImageEditor)return!0;if(this.editorViewer)return this.bFullScreen&&(this.containerElement.style.display="block",document.body.style.overflow="hidden"),this.bShowImageEditor=!0,this.editorViewer.show(),window.dvsResize=zR(e=this.resize).call(e,this),window.addEventListener("resize",window.dvsResize),this.resize(),!0;var t=this.bDispose?"ImageEditorDispose":"ImageEditorNotExist";return this.webViewer.setError(t),!1;}},{key:"hide",value:function value(){if(this.editorViewer)return this.editorViewer.hide(),this.bShowImageEditor=!1,this.bFullScreen&&(document.body.style.overflow="",this.containerElement.style.display="none"),window.removeEventListener("resize",window.dvsResize),window.dvsResize=null,!0;var e=this.bDispose?"ImageEditorDispose":"ImageEditorNotExist";return this.webViewer.setError(e),!1;}},{key:"hideImageEditor",value:function value(){var e=this;this.bChanged?this.showSaveDialog(function(){e.hide();},this.webViewer.getCurrentImgUUid()):this.hide();}},{key:"setSelectionRectAspectRatio",value:function value(e){if(!this.editorViewer)return!1;var t=e>0,i=e>0?e:0;return this.editorViewer.updateViewerConfig({cropBoxConfig:{aspectRatio:i,keepAspectRatio:t}}),!0;}},{key:"clearSelectedArea",value:function value(){if(!this.editorViewer||this.bDispose)return!1;var e=this.webViewer.getHowManyImagesInBuffer(),t=this.webViewer.getCurrentIndex();if(e<=0||t<0)return!0;var i=this.editorViewer.clearCropBox();return this.editorViewer.render(),i||this.webViewer.setDefaultError(),i;}},{key:"setOperationMode",value:function value(e){if(this.editorViewer){var t="default";switch(e){case 1:t="crop";break;case 2:t="zoomIn";break;case 3:t="zoomOut";break;case 4:t="annotation";break;default:t="default";}this.editorViewer.updateViewerConfig({toolType:t});}}},{key:"setCursor",value:function value(e){if(!this.editorViewer)return!1;var t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex();if(t<=0||i<0)return!1;var r="pointer",n=0,o=this.bMobile?"pointer":"crosshair";switch(e){case"zoom-out":o="zoom",r="zoom-out",n=3;break;case"zoom-in":o="zoom",r="zoom-in",n=2;break;case"crosshair":o="crosshair",r="crosshair",n=1;break;default:o="pointer",r="pointer",n=0;}var a={cursor:r};return this.editorViewer.updateViewerConfig({canvasStyle:a}),this.setOperationMode(n),this.updateMouseModeState(e),this.cursor=o,!0;}},{key:"setFit",value:function value(e){if(!this.webViewer||!this.editorViewer)return!1;var t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex();return!(t<=0||i<0||(this.editorViewer.updateViewerConfig({fitType:e}),this.updateZoomInState(!0),this.updateZoomOutState(!0),this.updateCropState(!1,!0),this.updateEraseState(!1,!0),0));}},{key:"setWidth",value:function value(e){return!(!this.webViewer||!this.editorViewer)&&!(TL(e)&&!/^((\d+em)|(\d+px)|(\d+%)|(\d+))$/.test(e)||BL(e)&&e<=0||(this.editorViewer.dwtWidth=e,this.resize(),0));}},{key:"setHeight",value:function value(e){return!(!this.webViewer||!this.editorViewer)&&!(TL(e)&&!/^((\d+em)|(\d+px)|(\d+%)|(\d+))$/.test(e)||BL(e)&&e<=0||(this.editorViewer.dwtHeight=e,this.resize(),0));}},{key:"setButtonClass",value:function value(e,t){var i;return!!this.editorViewer&&this.editorViewer.setButtonClass(e,lS(i="".concat(this.defaultBtnClass," ")).call(i,t));}},{key:"setZoomOrigin",value:function value(e){var t,i;if(!this.editorViewer){var r=this.bDispose?"ImageEditorDispose":"ImageEditorNotExist";return this.webViewer.setError(r),!1;}if(!kL(e)||!TL(null==e?void 0:e.x)||!TL(null==e?void 0:e.y))return this.webViewer.setError("InvalidValue"),!1;var n=e.x,o=e.y;return-1===OI(t=["left","right","center"]).call(t,n)||-1===OI(i=["top","bottom","center"]).call(i,o)?(this.webViewer.setError("InvalidValue"),!1):(this.editorViewer.updateViewerConfig({zoomOrigin:{x:n,y:o}}),!0);}},{key:"getZoomOrigin",value:function value(){return this.bDispose?"":this.editorViewer.getViewerConfigByName("zoomOrigin");}},{key:"previousImage",value:function value(){var e=this;if(!this.webViewer||!this.editorViewer)return!1;var t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex();return!(t<2||0===i||(this.bChanged?this.showSaveDialog(function(){e.editorViewer.prevPage(),e.updateState();},this.webViewer.getCurrentImgUUid()):(this.editorViewer.prevPage(),this.updateState()),0));}},{key:"nextImage",value:function value(){var e=this;if(!this.webViewer||!this.editorViewer)return!1;var t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex();return!(t<2||i===t-1||(this.bChanged?this.showSaveDialog(function(){e.editorViewer.nextPage(),e.updateState();},this.webViewer.getCurrentImgUUid()):(this.editorViewer.nextPage(),this.updateState()),0));}},{key:"scanImage",value:function value(){var e=this;if(!this.webViewer||!this.editorViewer)return!1;var t=this.webViewer.webViewerInitConfig.imageEditorEvents;return!(!t||!ML(null==t?void 0:t.acquire)||(this.bChanged?this.showSaveDialog(function(){null!=t&&t.acquire(e.editorSetting.dialogText.selectSource),e.updateState();},this.webViewer.getCurrentImgUUid()):(null!=t&&t.acquire(this.editorSetting.dialogText.selectSource),this.updateState()),0));}},{key:"loadImage",value:function value(){var e=this;if(!this.webViewer||!this.editorViewer)return!1;var t=this.webViewer.webViewerInitConfig.imageEditorEvents;return!(!t||!ML(null==t?void 0:t.loadImage)||(this.bChanged?this.showSaveDialog(function(){null!=t&&t.loadImage(),e.updateState();},this.webViewer.getCurrentImgUUid()):(null!=t&&t.loadImage(),this.updateState()),0));}},{key:"removeAllImage",value:function value(){var e=this.webViewer.webViewerInitConfig.imageEditorEvents,t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex();return!(t<=0||i<0||(e&&ML(null==e?void 0:e.removeAllImage)?null==e||e.removeAllImage():this.webViewer.bufferService.removeAllImages(),this.setChangedState(!1),this.updateState(),0));}},{key:"removeImage",value:function value(){var e=this.webViewer.webViewerInitConfig.imageEditorEvents,t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex();return!(t<=0||i<0||(e&&ML(null==e?void 0:e.removeImage)?null==e||e.removeImage():this.webViewer.bufferService.removeSelectedImages(),this.setChangedState(!1),this.updateState(),0));}},{key:"rotate",value:function value(){this.showRotateDialog();}},{key:"changeImageSize",value:function value(){this.showChangeSizeDialog();}},{key:"zoomIn",value:function value(){if(!this.webViewer||!this.editorViewer)return!1;var e=this.webViewer.getHowManyImagesInBuffer(),t=this.webViewer.getCurrentIndex();if(e<=0||t<0)return!1;var i=this.editorViewer.getViewerConfig();return i.zoom<i.maxZoom?(this.editorViewer.zoomIn(),this.updateZoomInState(!0)):this.updateZoomInState(!1),this.updateZoomOutState(!0),this.updateCropState(!1,!0),this.updateEraseState(!1,!0),!0;}},{key:"originalSize",value:function value(){if(!this.webViewer||!this.editorViewer)return!1;var e=this.webViewer.getHowManyImagesInBuffer(),t=this.webViewer.getCurrentIndex();return!(e<=0||t<0||(this.editorViewer.updateViewerConfig({zoom:1}),this.updateZoomInState(!0),this.updateZoomOutState(!0),this.updateCropState(!1,!0),this.updateEraseState(!1,!0),0));}},{key:"zoomOut",value:function value(){if(!this.webViewer||!this.editorViewer)return!1;var e=this.webViewer.getHowManyImagesInBuffer(),t=this.webViewer.getCurrentIndex();if(e<=0||t<0)return!1;var i=this.editorViewer.getViewerConfig();return i.zoom>i.minZoom?(this.editorViewer.zoomOut(),this.updateZoomOutState(!0)):this.updateZoomOutState(!1),this.updateZoomInState(!0),this.updateCropState(!1,!0),this.updateEraseState(!1,!0),!0;}},{key:"fitWindow",value:function value(){this.setFit("window");}},{key:"fitWidth",value:function value(){this.setFit("width");}},{key:"fitHeight",value:function value(){this.setFit("height");}},{key:"selectMode",value:function value(){this.setCursor("crosshair");}},{key:"handMode",value:function value(){this.clearSelectedArea(),this.setCursor("pointer");}},{key:"zoomMode",value:function value(){this.clearSelectedArea(),this.setCursor("zoom-in");}},{key:"restoreImage",value:function value(e){if(!this.webViewer||!this.editorViewer)return!1;if(!this.bChanged)return!1;var t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex();if(CL(e)||(i=this.webViewer.myViewer.getIndexByUid(e)),t<=0||i<0)return!1;var r=this.webViewer.webViewerInitConfig.imageEditorServerCallback;if(this.workMode&&r&&ML(null==r?void 0:r.restore)){var n=e||this.webViewer.getCurrentImgUUid();r.restore(n);}else this.editorViewer.reset(i),this.webViewer.myViewer.resized();return this.setChangedState(!1),this.updateState(),this.webViewer.clearSelectedAreas(),!0;}},{key:"first",value:function value(){var e=this;this.bChanged?this.showSaveDialog(function(){e.goToPage(0);},this.webViewer.getCurrentImgUUid()):this.goToPage(0);}},{key:"last",value:function value(){var e=this,t=this.webViewer.getHowManyImagesInBuffer()-1;this.bChanged?this.showSaveDialog(function(){e.goToPage(t);},this.webViewer.getCurrentImgUUid()):this.goToPage(t);}},{key:"go",value:function value(e){var t=this;this.bChanged?this.showSaveDialog(function(){t.goToPage(e);},this.webViewer.getCurrentImgUUid()):this.goToPage(e);}},{key:"goToPage",value:function value(e){var t=this;if(!this.webViewer||!this.editorViewer)return!1;var i=this.webViewer.getHowManyImagesInBuffer(),r=this.webViewer.getCurrentIndex();return!(i<=0||r<0||!this.bShowImageEditor||CL(e)||-1===e||(this.bChanged?this.showSaveDialog(function(){t.editorViewer.gotoPage(e),t.updateState();},this.webViewer.getCurrentImgUUid()):(this.editorViewer.gotoPage(e),this.updateState()),0));}},{key:"selectPages",value:function value(e){var t=this,i=this.webViewer.getHowManyImagesInBuffer();return jR(e).call(e,function(e){return e>i-1;})?(this.webViewer.setError("ParameterOutRange"),!1):(this.bChanged?this.showSaveDialog(function(){t.webViewer.myViewer.setSelectedIndexes(e),t.updateState();},this.webViewer.getCurrentImgUUid()):(this.webViewer.myViewer.setSelectedIndexes(e),this.updateState()),!0);}},{key:"closeImageEditor",value:function value(){var e=this;0!==this.webViewer.getHowManyImagesInBuffer()&&this.bChanged?this.showSaveDialog(function(){e.close();},this.webViewer.getCurrentImgUUid()):this.close();}},{key:"dispose",value:function value(){this.bChanged&&this.saveImage(this.webViewer.getCurrentImgUUid()),this.close();}},{key:"printImage",value:(d=mb(vb().mark(function e(){var t,i,r,n,o,a,s,u,l;return vb().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.webViewer&&this.editorViewer){e.next=2;break;}return e.abrupt("return",!1);case 2:if(t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex(),!(t<=0||i<0)){e.next=5;break;}return e.abrupt("return",!1);case 5:return r=this.editorViewer.getCurrentTab(),n=r.currentPage,o=n.realTimeWidth,a=n.realTimeHeight,s=n.uid,u="",e.next=9,this.webViewer.myDvs.getImageData(s,{type:"blob"});case 9:if(l=e.sent,!zL()){e.next=16;break;}return e.next=13,new uB(function(e){var t=new FileReader();t.onload=function(){return e(t.result);},t.readAsDataURL(l);});case 13:u=e.sent,e.next=17;break;case 16:u=vN(l).data;case 17:return e.abrupt("return",(function(e,t){var i,r="";r=lS(t="".concat(r,'<div class="image-container"><img src="')).call(t,e.url,'" /></div>');var n="".concat(Dynamsoft.DWT.ResourcesPath,"/src/dynamsoft.webtwain.css"),o=["alwaysRaised=yes,z-look=yes,top=0,left=0,toolbar=no,menubar=no,location=no,status=no,width=",0,",height=",0].join(""),a=window.open("about:blank","_blank",o),s=["<html>",'<head><link rel="stylesheet" type="text/css" href="',n,'"></head>','<body id="D_body">',r,"</body></html>"].join("");a&&(a.document.write(s),a.document.close(),a.focus(),(i=a.document.body)&&(i.onload=function(){a&&a.print();}));}({url:u,width:Math.floor(o),height:Math.floor(a)}),this.updateState(),!0));case 18:case"end":return e.stop();}},e,this);})),function(){return d.apply(this,arguments);})},{key:"rotateLeft",value:(h=mb(vb().mark(function e(){var t,i,r;return vb().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex(),!(t<=0||i<0)){e.next=3;break;}return e.abrupt("return",!1);case 3:if(e.t0=!1===this.bChanged&&this.workMode,!e.t0){e.next=7;break;}return e.next=7,this.saveToServerBeforeEdit();case 7:return r=this.webViewer.webViewerInitConfig.imageEditorServerCallback,e.abrupt("return",(this.workMode&&r&&ML(null==r?void 0:r.rotateLeft)?null==r||r.rotateLeft():this.editorViewer.rotate(-90,i),this.setChangedState(!0),this.updateState(),this.webViewer.clearSelectedAreas(),!0));case 9:case"end":return e.stop();}},e,this);})),function(){return h.apply(this,arguments);})},{key:"rotateInner",value:(c=mb(vb().mark(function e(){var t,i,r,n,o,a,s;return vb().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.getElementById("dvsImageEditorKeepSize"),i=document.getElementById("dvsImageEditorRotateAngle"),r=$S(i.value,10),n=this.webViewer.getHowManyImagesInBuffer(),o=this.webViewer.getCurrentIndex(),!(n<=0||o<0)){e.next=3;break;}return e.abrupt("return",!1);case 3:if(e.t0=!1===this.bChanged&&this.workMode,!e.t0){e.next=7;break;}return e.next=7,this.saveToServerBeforeEdit();case 7:return a=this.webViewer.webViewerInitConfig.imageEditorServerCallback,this.workMode&&a&&ML(null==a?void 0:a.rotate)?(s=document.getElementById("dvsImageEditorInterpolation"),null==a||a.rotate(r,s.selectedIndex+1,t.checked)):this.webViewer.rotateInner(o,r,t.checked),e.abrupt("return",(this.setChangedState(!0),this.closeRotateDialog(),this.updateState(),this.webViewer.clearSelectedAreas(),this.lastRotateAngle=r,this.lastRotateKeepSize=t.checked,!0));case 10:case"end":return e.stop();}},e,this);})),function(){return c.apply(this,arguments);})},{key:"rotateRight",value:(l=mb(vb().mark(function e(){var t,i,r,n;return vb().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.webViewer.getHowManyImagesInBuffer(),r=this.webViewer.getCurrentIndex(),!(i<=0||r<0)){e.next=3;break;}return e.abrupt("return",!1);case 3:if(e.t0=!1===this.bChanged&&this.workMode,!e.t0){e.next=7;break;}return e.next=7,this.saveToServerBeforeEdit();case 7:return n=this.webViewer.webViewerInitConfig.imageEditorServerCallback,e.abrupt("return",(this.workMode&&n&&ML(null==n?void 0:n.rotateRight)?null==n||n.rotateRight():null===(t=this.editorViewer)||void 0===t||t.rotate(90,r),this.setChangedState(!0),this.updateState(),this.webViewer.clearSelectedAreas(),!0));case 9:case"end":return e.stop();}},e,this);})),function(){return l.apply(this,arguments);})},{key:"deskew",value:(u=mb(vb().mark(function e(){var t,i,r,n,o,a,s,u,l=this;return vb().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex(),!(t<=0||i<0)){e.next=3;break;}return e.abrupt("return",!1);case 3:if(r=this.webViewer.webViewerInitConfig,n=r.imageEditorEvents,o=r.imageEditorServerCallback,e.t0=!1===this.bChanged&&this.workMode,!e.t0){e.next=8;break;}return e.next=8,this.saveToServerBeforeEdit();case 8:if(!this.deskewStarted){e.next=10;break;}return e.abrupt("return",!1);case 10:if(this.deskewStarted=!0,this.updateDeskewState(!1),!(this.workMode&&o&&ML(null==o?void 0:o.deskew))){e.next=14;break;}o.deskew(),this.setChangedState(!0),this.deskewStarted=!1,this.updateDeskewState(!0),e.next=22;break;case 14:if(n&&ML(null==n?void 0:n.deskew)){e.next=16;break;}return e.abrupt("return",!1);case 16:return a=this.webViewer.getCurrentImgUUid(),s=this.webViewer.getCurrentIndex(),e.next=20,this.webViewer.myDvs.getImageData(a,{type:"blob",min:!0});case 20:u=e.sent,n.deskew(u,function(e){l.webViewer.rotateInner(s,e,!0),l.setChangedState(!0),l.deskewStarted=!1,l.updateDeskewState(!0),l.updateSaveAndRestoreBtn();});case 22:return e.abrupt("return",(this.updateState(),!0));case 23:case"end":return e.stop();}},e,this);})),function(){return u.apply(this,arguments);})},{key:"cropImage",value:(s=mb(vb().mark(function e(){var t,i,r,n,o,a,s,u,l;return vb().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.bCrop){e.next=2;break;}return e.abrupt("return",!1);case 2:if(t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex(),!(t<=0||i<0)){e.next=5;break;}return e.abrupt("return",!1);case 5:if(1===(r=this.editorViewer.getCropBoxes()).length){e.next=8;break;}return e.abrupt("return",!1);case 8:if(n=r[0],o=n.left,a=n.top,s=n.width,u=n.height,e.t0=!1===this.bChanged&&this.workMode,!e.t0){e.next=13;break;}return e.next=13,this.saveToServerBeforeEdit();case 13:return l=this.webViewer.webViewerInitConfig.imageEditorServerCallback,e.abrupt("return",(this.workMode&&l&&ML(null==l?void 0:l.crop)?l.crop(n):this.editorViewer.crop(i,o,a,s,u),this.setChangedState(!0),this.updateState(),this.webViewer.clearSelectedAreas(),!0));case 15:case"end":return e.stop();}},e,this);})),function(){return s.apply(this,arguments);})},{key:"cutImage",value:(a=mb(vb().mark(function e(){var t,i,r,n,o,a,s,u,l;return vb().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.bErase){e.next=2;break;}return e.abrupt("return",!1);case 2:if(t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex(),!(t<=0||i<0)){e.next=5;break;}return e.abrupt("return",!1);case 5:if(1===(r=this.editorViewer.getCropBoxes()).length){e.next=8;break;}return e.abrupt("return",!1);case 8:if(n=r[0],o=n.left,a=n.top,s=n.width,u=n.height,e.t0=!1===this.bChanged&&this.workMode,!e.t0){e.next=13;break;}return e.next=13,this.saveToServerBeforeEdit();case 13:return l=this.webViewer.webViewerInitConfig.imageEditorServerCallback,e.abrupt("return",(this.workMode&&l&&ML(null==l?void 0:l.erase)?l.erase(n):this.editorViewer.erase(i,o,a,s,u,this.cutColor),this.setChangedState(!0),this.updateState(),this.webViewer.clearSelectedAreas(),!0));case 15:case"end":return e.stop();}},e,this);})),function(){return a.apply(this,arguments);})},{key:"changeImageSizeInner",value:(o=mb(vb().mark(function e(){var t,i,r,n,o,a,s,u;return vb().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex(),!(t<=0||i<0)){e.next=3;break;}return e.abrupt("return",!1);case 3:if(r=document.getElementById("dvsImageEditorChangeH"),n=document.getElementById("dvsImageEditorChangeW"),o=$S(r.value,10),a=$S(n.value,10),e.t0=!1===this.bChanged&&this.workMode,!e.t0){e.next=8;break;}return e.next=8,this.saveToServerBeforeEdit();case 8:return s=this.webViewer.webViewerInitConfig.imageEditorServerCallback,this.workMode&&s&&ML(null==s?void 0:s.changeImageSize)?(u=document.getElementById("dvsImageEditorInterpolation"),s.changeImageSize(a,o,u.selectedIndex+1)):this.editorViewer.changePageSize(i,a,o),e.abrupt("return",(this.setChangedState(!0),this.updateState(),this.closeChangeSizeDialog(),this.webViewer.clearSelectedAreas(),!0));case 11:case"end":return e.stop();}},e,this);})),function(){return o.apply(this,arguments);})},{key:"flipImage",value:(n=mb(vb().mark(function e(){var t,i,r;return vb().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex(),!(t<=0||i<0)){e.next=3;break;}return e.abrupt("return",!1);case 3:if(e.t0=!1===this.bChanged&&this.workMode,!e.t0){e.next=7;break;}return e.next=7,this.saveToServerBeforeEdit();case 7:return r=this.webViewer.webViewerInitConfig.imageEditorServerCallback,e.abrupt("return",(this.workMode&&r&&ML(null==r?void 0:r.flip)?r.flip():this.editorViewer.flip(i),this.setChangedState(!0),this.updateState(),this.webViewer.clearSelectedAreas(),!0));case 9:case"end":return e.stop();}},e,this);})),function(){return n.apply(this,arguments);})},{key:"mirrorImage",value:(r=mb(vb().mark(function e(){var t,i,r;return vb().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex(),!(t<=0||i<0)){e.next=3;break;}return e.abrupt("return",!1);case 3:if(e.t0=!1===this.bChanged&&this.workMode,!e.t0){e.next=7;break;}return e.next=7,this.saveToServerBeforeEdit();case 7:return r=this.webViewer.webViewerInitConfig.imageEditorServerCallback,e.abrupt("return",(this.workMode&&r&&ML(null==r?void 0:r.mirror)?r.mirror():this.editorViewer.mirror(i),this.setChangedState(!0),this.updateState(),this.webViewer.clearSelectedAreas(),!0));case 9:case"end":return e.stop();}},e,this);})),function(){return r.apply(this,arguments);})},{key:"saveImageAsync",value:(i=mb(vb().mark(function e(){var t,i,r,n,o,a,s;return vb().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.editorViewer){e.next=3;break;}return t=this.bDispose?"ImageEditorDispose":"ImageEditorNotExist",e.abrupt("return",(this.webViewer.setError(t),uB.reject("The ImageEditor object has been disposed.")));case 3:if(this.bChanged||!this.workMode){e.next=5;break;}return e.abrupt("return",uB.resolve());case 5:if(this.bChanged){e.next=7;break;}return e.abrupt("return",uB.resolve());case 7:if(i=this.webViewer.webViewerInitConfig,r=i.viewerEvents,n=i.imageEditorServerCallback,o=this.webViewer.getCurrentImgUUid(),this.setChangedState(!1),this.updateState(),this.webViewer.clearSelectedAreas(),this.workMode&&n&&ML(null==n?void 0:n.save)){e.next=16;break;}if(r&&ML(null==r?void 0:r.save)){e.next=11;break;}return e.abrupt("return",uB.reject());case 11:return e.next=13,this.webViewer.myDvs.getImageData(o,{type:"imageData"});case 13:return a=e.sent,s=Fk(Fk({},this.webViewer.bufferService.getMetadataByUid(o)),{},{width:Math.floor(a.width),height:Math.floor(a.height)}),e.abrupt("return",null==r?void 0:r.save(o,a.data.buffer,s,!0));case 16:return e.abrupt("return",(n.save(o),uB.resolve()));case 17:case"end":return e.stop();}},e,this);})),function(){return i.apply(this,arguments);})},{key:"saveImage",value:(t=mb(vb().mark(function e(t){var i,r,n,o,a,s,u,l;return vb().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.editorViewer){e.next=2;break;}return e.abrupt("return");case 2:if(this.bChanged){e.next=4;break;}return e.abrupt("return");case 4:if(i=this.webViewer.webViewerInitConfig,r=i.viewerEvents,n=i.imageEditorServerCallback,o=t||this.webViewer.getCurrentImgUUid(),this.setChangedState(!1),this.updateState(),this.webViewer.clearSelectedAreas(),!(this.workMode&&n&&ML(null==n?void 0:n.save))){e.next=9;break;}n.save(o),e.next=23;break;case 9:if(r&&ML(null==r?void 0:r.save)){e.next=11;break;}return e.abrupt("return");case 11:return e.next=13,this.webViewer.myDvs.getImageData(o,{type:"imageData"});case 13:return u=e.sent,l=Fk(Fk({},(null===(a=this.webViewer)||void 0===a||null===(s=a.bufferService)||void 0===s?void 0:s.getMetadataByUid(o))||{}),{},{width:Math.floor(u.width),height:Math.floor(u.height)}),e.prev=15,e.next=18,null==r?void 0:r.save(o,u.data.buffer,l,!0);case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(15),this.setChangedState(!0),this.updateState();case 23:case"end":return e.stop();}},e,this,[[15,20]]);})),function(e){return t.apply(this,arguments);})},{key:"saveToServerBeforeEdit",value:(e=mb(vb().mark(function e(){var t,i,r;return vb().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.webViewer.webViewerInitConfig.imageEditorServerCallback,i=this.webViewer.myViewer,!(this.workMode&&t&&ML(null==t?void 0:t.save))){e.next=8;break;}return i.updateViewerConfig({enableEmitPageRendered:!1}),this.webViewer.bEmitBufferChanged=!1,r=this.webViewer.getCurrentImgUUid(),e.next=6,t.save(r);case 6:this.webViewer.bEmitBufferChanged=!0,i.updateViewerConfig({enableEmitPageRendered:!0});case 8:case"end":return e.stop();}},e,this);})),function(){return e.apply(this,arguments);})},{key:"bufferChanged",value:function value(e){return this.curIndex!==this.webViewer.getCurrentIndex()&&(this.curIndex=this.webViewer.getCurrentIndex(),this.updateState()),"shift"===e.operation&&this.bChanged||"add"===e.operation&&this.bChanged?(this.showSaveDialog(function(){},e.beforeStatus.currentUid),!1):("remove"===e.operation&&this.bChanged&&this.bChangedUid===e.beforeStatus.currentUid&&(this.setChangedState(!1),this.updateState()),!0);}},{key:"click",value:function value(){this.hideImageEditorDialog();var e=this.editorViewer.getViewerConfig();e.zoom<e.maxZoom?this.updateZoomInState(!0):this.updateZoomInState(!1),this.updateZoomOutState(!0);}},{key:"pageAreaSelected",value:function value(e,t){var i=1===t.length;this.bCrop=i,this.updateCropState(i,!1);var r=1===t.length;this.bErase=r,this.updateEraseState(r,!1);}},{key:"pageAreaUnselected",value:function value(){this.updateCropState(!1,!1),this.updateEraseState(!1,!1);}},{key:"wheel",value:function value(e,t){if(t.ctrlKey){var i=this.editorViewer.getViewerConfig(),r=i.zoom,n=r<i.maxZoom,o=r>i.minZoom;this.updateZoomInState(n),this.updateZoomOutState(o);}}},{key:"showMask",value:function value(){var e=document.createElement("div");e.className="dvs-imageEditor-mask",this.editorViewer.rootDom.appendChild(e);}},{key:"closeMask",value:function value(){var e=document.querySelector(".dvs-imageEditor-mask");e&&e.parentNode.removeChild(e);}},{key:"createSaveDialog",value:function value(){var e=this.editorSetting.dialogText,t=null==e?void 0:e.saveChangedImage;(CL(e)||CL(null==e?void 0:e.saveChangedImage))&&(t=CO.saveChangedImage);var i=gq({tag:"div",className:"dvs-imageEditor-saveDlg",children:[{tag:"div",className:"dvs-imageEditor-saveDlg-header",children:[{tag:"i",className:"dynamsoft-dialog-close"}]},{tag:"div",className:"dvs-imageEditor-saveDlg-box",children:[{tag:"div",textContent:t[0]},{tag:"div",className:"dvs-imageEditor-saveDlg-btnGroup",children:[{tag:"input",className:"dynamsoft_btnSave",attributes:{type:"button",value:t[1]}},{tag:"input",className:"dynamsoft_btnCancel",attributes:{type:"button",value:t[2]}}]}]}]});return i.style.width=this.bMobile?"300px":"420px",i;}},{key:"showSaveDialog",value:function value(e,t){var i=this;if(document.querySelector(".dvs-imageEditor-saveDlg")||!this.bChanged)return!1;if(!this.promoteSaveChange)return this.saveImage(t),e(),!0;this.showMask();var r=this.createSaveDialog();this.editorViewer.rootDom.appendChild(r);var n=document.querySelector(".dynamsoft_btnSave"),o=document.querySelector(".dynamsoft_btnCancel"),a=document.querySelector(".dynamsoft-dialog-close");return a&&(a.onclick=function(){i.closeSaveDialog(),i.closeMask();}),n&&(n.onclick=mb(vb().mark(function r(){return vb().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,i.saveImage(t);case 2:i.closeSaveDialog(),i.closeMask(),e();case 5:case"end":return r.stop();}},r);}))),o&&(o.onclick=function(){i.restoreImage(t),i.closeSaveDialog(),i.closeMask(),e();}),!0;}},{key:"closeSaveDialog",value:function value(){var e=document.querySelector(".dvs-imageEditor-saveDlg");e&&e.parentNode.removeChild(e);}},{key:"createRotateDialog",value:function value(){var e=this.editorSetting.dialogText,t=null==e?void 0:e.dlgRotateAnyAngle;(CL(e)||CL(null==e?void 0:e.dlgRotateAnyAngle))&&(t=CO.dlgRotateAnyAngle);var i=!0===this.lastRotateKeepSize?"checked":"",r=this.workMode?"flex":"none",n=gq({tag:"div",children:[{tag:"div",children:[{tag:"span",textContent:t[0]},{tag:"input",attributes:{id:"dvsImageEditorRotateAngle",type:"number",value:this.lastRotateAngle}}]},{tag:"div",attributes:{style:"display:".concat(r)},children:[{tag:"span",textContent:t[1]},{tag:"select",attributes:{size:"1",id:"dvsImageEditorInterpolation"},children:[{tag:"option",attributes:{value:"1"},textContent:"NearestNeighbor"},{tag:"option",attributes:{value:"2"},textContent:"Bilinear"},{tag:"option",attributes:{value:"3"},textContent:"Bicubic"}]}]},{tag:"div",children:[{tag:"label",children:[Fk({tag:"input",attributes:{type:"checkbox",id:"dvsImageEditorKeepSize"}},i&&{checked:"checked"}),{tag:"span",textContent:t[2]}]}]},{tag:"div",children:[{tag:"input",attributes:{id:"dvsImageEditorRotateOk",type:"button",value:t[3]}},{tag:"input",attributes:{id:"dvsImageEditorRotateCancel",type:"button",value:t[4]}}]}]});return n.className="dvs-imageEditor-rotateBox",n.id="dvsImageEditorRotateBox",n;}},{key:"showRotateDialog",value:function value(){var e=this;if(!document.getElementById("dvsImageEditorRotateBox")){var t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex();if(!(t<=0||i<0)){var r=document.getElementById("rotate".concat(this.editorViewer.postfix));if(r){var n=this.createRotateDialog();r.appendChild(n);var o=r.getBoundingClientRect(),a=o.width,s=o.height;n.style.left=a/2+"px",n.style.top=s/2+"px";var u=document.getElementById("dvsImageEditorRotateOk"),l=document.getElementById("dvsImageEditorRotateCancel");this.bindStopPropagation("dvsImageEditorRotateBox"),u&&(u.onclick=function(t){e.rotateInner();}),l&&(l.onclick=function(t){e.closeRotateDialog();});}}}}},{key:"closeRotateDialog",value:function value(){var e=document.getElementById("dvsImageEditorRotateBox");e&&e.parentNode.removeChild(e);}},{key:"createChangeSizeDialog",value:function value(e,t){var i=this.editorSetting.dialogText,r=null==i?void 0:i.dlgChangeImageSize;(CL(i)||CL(null==i?void 0:i.dlgChangeImageSize))&&(r=CO.dlgChangeImageSize);var n=this.workMode?"flex":"none",o=gq({tag:"div",children:[{tag:"div",children:[{tag:"span",textContent:r[0]},{tag:"div",children:[{tag:"input",attributes:{id:"dvsImageEditorChangeH",type:"number",value:t}},{tag:"span",textContent:"pixel"}]}]},{tag:"div",attributes:{style:"margin-top:10px"},children:[{tag:"span",textContent:r[1]},{tag:"div",children:[{tag:"input",attributes:{id:"dvsImageEditorChangeW",type:"number",value:e}},{tag:"span",textContent:"pixel"}]}]},{tag:"div",attributes:{style:"display:".concat(n)},children:[{tag:"span",textContent:r[2]},{tag:"select",attributes:{size:"1",id:"dvsImageEditorInterpolation"},children:[{tag:"option",attributes:{value:"1"},textContent:"NearestNeighbor"},{tag:"option",attributes:{value:"2"},textContent:"Bilinear"},{tag:"option",attributes:{value:"3"},textContent:"Bicubic"}]}]},{tag:"div",children:[{tag:"input",attributes:{id:"dvsImageEditorChangeSizeOk",type:"button",value:r[3]}},{tag:"input",attributes:{id:"dvsImageEditorChangeSizeCancel",type:"button",value:r[4]}}]}]});return o.className="dvs-imageEditor-changeSizeBox",o.id="dvsImageEditorChangeSizeBox",o;}},{key:"showChangeSizeDialog",value:function value(){var e=this;if(!document.getElementById("dvsImageEditorChangeSizeBox")){var t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex();if(!(t<=0||i<0)){var r=document.getElementById("changeImageSize".concat(this.editorViewer.postfix));if(r){var n=this.editorViewer.getCurrentTab().currentPage,o=n.realTimeWidth,a=n.realTimeHeight,s=this.createChangeSizeDialog(Math.floor(o),Math.floor(a));r.appendChild(s);var u=r.getBoundingClientRect(),l=u.width,c=u.height;s.style.left=l/2+"px",s.style.top=c/2+"px";var h=document.getElementById("dvsImageEditorChangeSizeOk"),d=document.getElementById("dvsImageEditorChangeSizeCancel");this.bindStopPropagation("dvsImageEditorChangeSizeBox"),h&&(h.onclick=function(t){fN(t),e.changeImageSizeInner();}),d&&(d.onclick=function(t){fN(t),e.closeChangeSizeDialog();});}}}}},{key:"closeChangeSizeDialog",value:function value(){var e=document.getElementById("dvsImageEditorChangeSizeBox");e&&e.parentNode.removeChild(e);}}]);var e,t,i,r,n,o,a,s,u,l,c,h,d;}();function gq(e){var t=e.tag,i=e.className,r=void 0===i?"":i,n=e.attributes,o=void 0===n?{}:n,a=e.textContent,s=void 0===a?"":a,u=e.children,l=void 0===u?[]:u,c=document.createElement(t);r&&(c.className=r);for(var h=0,d=oB(o);h<d.length;h++){var f=Gb(d[h],2),v=f[0],g=f[1];if("style"===v){var m=mq(g);for(var y in m)m.hasOwnProperty(y)&&(c.style[y]=m[y]);}else c.setAttribute(v,g);}return s&&(c.textContent=s),$k(l).call(l,function(e){var t=gq(e);c.appendChild(t);}),c;}function mq(e){var t=e.split(";"),i={};return $k(t).call(t,function(e){var t,r=AS(e).call(e);if(r){var n=$E(t=r.split(":")).call(t,function(e){return AS(e).call(e);}),o=Gb(n,2),a=o[0],s=o[1],u=a.replace(/-(\w)/g,function(e,t){return t.toUpperCase();});i[u]=s;}}),i;}var yq=function(){return Yk(function e(t,i){Xk(this,e),Wk(this,"inner",void 0),this.inner=new vq(t,i);},[{key:"idPostfix",get:function get(){return this.inner.editorViewer.postfix;}},{key:"zoomOrigin",get:function get(){return this.inner.getZoomOrigin();},set:function set(e){this.inner.webViewer.setError("Successful"),this.inner.setZoomOrigin(e);}},{key:"show",value:function value(){return this.inner.webViewer.setError("Successful"),this.inner.show();}},{key:"hide",value:function value(){return this.inner.webViewer.setError("Successful"),this.inner.hideImageEditor();}},{key:"save",value:function value(){return this.inner.webViewer.setError("Successful"),this.inner.saveImageAsync();}},{key:"dispose",value:function value(){return this.inner.webViewer.setError("Successful"),this.inner.dispose();}},{key:"updateSelectionBoxStyle",value:function value(e){this.inner.setSelectionBoxStyle(e);}}]);}();function pq(e,t){var i=t.getViewerConfig(),r=i.rows,n=i.columns,o=getComputedStyle(t.canvasContainer).fontSize,a=t.canvasContainer.getBoundingClientRect(),s=a.width,u=a.height,l=FO(e),c=s||0,h=u||0,d=FO(o).value,f=Math.floor(Math.min(h/(2*r+1),c/(2*n+1))),v=e,g=0;switch(l.unit){case"%":g=.01*l.value*c;break;case"em":g=l.value*d;break;default:g=l.value;}if(g>f)switch(l.unit){case"%":v="".concat(Math.floor(f/c*100),"%");break;case"em":v="".concat(Math.floor(f/d),"em");break;case"px":v="".concat(f,"px");break;default:v=f;}return v;}var wq=function(){return Yk(function e(t,i){if(Xk(this,e),Wk(this,"stretchBarColor","black"),Wk(this,"bHide",!0),Wk(this,"pageMargin",10),Wk(this,"bSingleMode",!1),Wk(this,"bDispose",!1),Wk(this,"webViewer",void 0),Wk(this,"myThumbnailViewer",void 0),Wk(this,"thbStretchBar",null),Wk(this,"enableResizing",!1),Wk(this,"enableProps",["enableDragPage","enableResizing","autoSelectTopPage"]),Wk(this,"keyboardControl",!0),this.webViewer=t,i){var r=i.removeBtn;CL(null==r?void 0:r.removeMarkColor)||(r.checkMarkColor=r.removeMarkColor),CL(null==r?void 0:r.removeMarkLineWidth)||(r.checkMarkLineWidth=r.removeMarkLineWidth);var n=function(e){var t,i,r,n,o,a,s=e.size,u=e.pageMargin,l=e.checkbox,c=e.pageNumber,h=e.removeBtn,d=e.scrollDirection,f={};return $k(t=["showThumbnail","allowKeyboardControl","allowPageDragging","allowResizing","autoChangeIndex"]).call(t,function(t){var i;i=e[t],!CL(i)&&DL(i)&&(f[t]=e[t]);}),$k(i=["columns","rows"]).call(i,function(t){(function(e){var t=FO(e);return!(CL(t)||t.value<0);})(e[t])&&(f[t]=e[t]);}),$k(r=["background","hoverPageBackground","pageBackground","placeholderBackground","selectedPageBackground"]).call(r,function(t){TX(e[t])&&(f[t]=e[t]);}),$k(n=["border","hoverPageBorder","pageBorder","selectedPageBorder"]).call(n,function(t){IX(e[t])&&(f[t]=e[t]);}),$k(o=["location"]).call(o,function(t){var i;i=e[t],!CL(i)&&TL(i)&&(f[t]=e[t]);}),function(e){var t=FO(e);return!CL(t)&&!(t.value>100&&"%"===t.unit||t.value<0);}(s)&&(f.size=s),EX(u)&&(f.pageMargin=u),CL(l)||(f.checkbox=l),CL(c)||(f.pageNumber=c),CL(h)||(f.removeBtn=h),-1!==OI(a=["vertical","horizontal"]).call(a,d)&&(f.scrollDirection=d),f;}(i);i=this.mergeThumbSettings(n);}else i=_SL(xO);this.myThumbnailViewer=this.webViewer.myViewer.createThumbnail(i),this.bDispose=!1,this.pageMargin=this.myThumbnailViewer.getThbConfigByName("gap"),this.webViewer.bThumbnailDispose=!1,this.setIfAutoScroll(this.webViewer.getIfAutoScroll()),i.show&&(this.bHide=!1,this.setPageMargin(this.pageMargin)),this.bindDefaultEvent(),this.initStretchBar(),this.allowResize=i.enableResizing;},[{key:"setDefaultError",value:function value(){var e=this.bDispose?"ThumbnailViewerDispose":"ThumbnailViewerNotExist";this.webViewer.setError(e);}},{key:"getLegalBorder",value:function value(e,t){var i,r;if(CL(e))return"";if(""===e)return"";var n=document.createElement("div");n.style.border=e;var o=n.style,a=o.borderWidth,s=o.borderColor,u=o.borderStyle;return lS(i=lS(r="".concat(""===a||"initial"===a||"medium"===a?"1px":a," ")).call(r,"initial"===u||"none"===u?"solid":u," ")).call(i,"initial"===s||"currentcolor"===s?t:s);}},{key:"mergeThumbSettings",value:function value(e){var t="horizontal",i=-1;switch(e.location||"left"){case"right":t="horizontal",i=1;break;case"top":t="vertical",i=-1;break;case"bottom":t="vertical",i=1;}var r=e.showThumbnail,n=e.size,o=e.columns,a=e.rows,s=e.autoChangeIndex,u=e.allowPageDragging,l=e.allowKeyboardControl,c=e.allowResizing,h=e.pageMargin,d=e.scrollDirection,f=e.background,v=e.border,g=e.hoverPageBackground,m=e.hoverPageBorder,y=e.pageBackground,p=e.pageBorder,w=e.placeholderBackground,b=e.selectedPageBackground,k=e.selectedPageBorder,S=h,x=h;a===o&&1===a&&(x=0,this.bSingleMode=!0);var C={location:t,sequence:i,show:r,size:n,columns:o,rows:a,autoSelectTopPage:s,enableDragPage:u,enableKeyboardControl:l,enableResizing:c,gap:S,margin:x,scrollDirection:d,thumbnailStyle:{background:f||this.webViewer.getBackground(),border:this.getLegalBorder(v,"rgba(0,0,0,0)")||""},hoveredPageStyle:{background:g||"rgb(239, 246, 253)",border:this.getLegalBorder(m,"rgb(238, 238, 238)")||"1px solid rgb(238, 238, 238)"},pageStyle:{background:y||"transparent",border:this.getLegalBorder(p,"rgb(238, 238, 238)")||"1px solid rgb(238, 238, 238)"},placeholderStyle:{background:w||"rgb(251, 236, 136)"},selectedPageStyle:{background:b||"rgb(199, 222, 252)",border:this.getLegalBorder(k,"rgb(125, 162, 206)")||"1px solid rgb(125, 162, 206)"},checkboxStyle:Fk(Fk({},this.webViewer.myViewer.getViewerConfig().checkboxStyle),oN(e.checkbox)),pageNumberStyle:Fk(Fk({},this.webViewer.myViewer.getViewerConfig().pageNumberStyle),oN(e.pageNumber)),removeBtnStyle:Fk(Fk({},this.webViewer.myViewer.getViewerConfig().removeBtnStyle),oN(e.removeBtn)),multiselectMode:1===this.webViewer.getMultiSelectMode()},V={};return NL(_SL(xO),V),NL(oN(C),V),V;}},{key:"bindDefaultEvent",value:function value(){this.myThumbnailViewer&&this.webViewer&&(this.bindDefaultKeyDown(),this.bindDefaultContextmenu());}},{key:"bindDefaultKeyDown",value:function value(){var e=this;this.myThumbnailViewer.on("keydown",function(t){if(e.keyboardControl)return"ArrowUp"===t.key||"Up"===t.key?(t.preventDefault(),void e.webViewer.previous()):void("ArrowDown"!==t.key&&"Down"!==t.key||(t.preventDefault(),e.webViewer.next()));});}},{key:"bindDefaultContextmenu",value:function value(){var e=this;this.myThumbnailViewer.on("contextmenu",function(t,i){e.webViewer.hideContextmenu&&i.preventDefault();});}},{key:"initStretchBar",value:function value(){var e=document.createElement("div");e.id="thbStretchBar",e.style.display="none",this.thbStretchBar=e;var t=this.getLocation(),i=this.myThumbnailViewer.innerViewer.rootDom;e.className="top"!==t&&"bottom"!==t?"dvs-thbStretchBarH dvs-thbStretchBar-".concat(t):"dvs-thbStretchBarV dvs-thbStretchBar-".concat(t),i.appendChild(e),this.bindStretchEvent(e);}},{key:"bindStretchEvent",value:function value(e){var t=this,i=0,r=0,n=!1,o=this.getLocation(),a=0,s=0,u=0,l=0,c=function c(_c3){if(t.myThumbnailViewer){var h=t.myThumbnailViewer.innerViewer.rootDom,d=t.webViewer.myViewer.rootDom,f=getComputedStyle(h),v=getComputedStyle(d);u=HO(f.width).value,l=HO(f.height).value,a=HO(v.width).value,s=HO(v.height).value,i=_c3.clientX,r=_c3.clientY,n=!0,o=t.getLocation(),e.style.background=t.stretchBarColor;}},h=function h(c){if(n&&t.myThumbnailViewer){var h="left"===o?c.clientX-i:i-c.clientX,d="top"===o?c.clientY-r:r-c.clientY;"right"===o&&t.thbStretchBar.classList.remove("dvs-thbStretchBar-right"),"bottom"===o&&t.thbStretchBar.classList.remove("dvs-thbStretchBar-bottom");var f=u+h;"top"!==o&&"bottom"!==o||(f=l+d),f<0&&(f=0),("left"===o||"right"===o)&&f>a&&(f=a),("top"===o||"bottom"===o)&&f>s&&(f=s),e.style[o]="".concat(f,"px");}},d=function d(i){if(n&&t.myThumbnailViewer){n=!1;var r,a=t.myThumbnailViewer.getThbConfigByName("size");switch(o){case"top":""!==e.style.top&&(r=HO(e.style.top),e.style.top="");break;case"bottom":""!==e.style.bottom&&(r=HO(e.style.bottom),e.style.bottom="",t.thbStretchBar.classList.add("dvs-thbStretchBar-bottom"));break;case"right":""!==e.style.right&&(r=HO(e.style.right),e.style.right="",t.thbStretchBar.classList.add("dvs-thbStretchBar-right"));break;default:""!==e.style.left&&(r=HO(e.style.left),e.style.left="");}e.style.background="",r&&a!==r.value&&(t.myThumbnailViewer.updateThbConfig({size:Math.floor(r.value)}),t.emitThumbnailResize(),t.resized());}};window.PointerEvent?(e.addEventListener("pointerdown",c),document.addEventListener("pointermove",h),document.addEventListener("pointerup",d)):window.MSPointerEvent?(e.addEventListener("MSPointerDown",c),document.addEventListener("MSPointerMove",h),document.addEventListener("MSPointerUp",d)):(e.addEventListener("mousedown",c),document.addEventListener("mousemove",h),document.addEventListener("mouseup",d));}},{key:"showThumbnail",get:function get(){return this.myThumbnailViewer.getThbConfig().show;},set:function set(e){this.showThumbnail===e&&!0===e||(this.bHide=!e,this.myThumbnailViewer.updateThbConfig({show:e}),this.setPageMargin(this.pageMargin));}},{key:"allowResize",get:function get(){return this.enableResizing;},set:function set(e){this.enableResizing=e,this.thbStretchBar.style.display=!0===e?"":"none";}},{key:"updateThumbnailConfig",value:function value(e){this.myThumbnailViewer.updateThbConfig(e);}},{key:"e",value:function value(){this.webViewer.setError("Successful");}},{key:"setError",value:function value(e){this.webViewer.setError(e);}},{key:"setBorder",value:function value(e){var t;if(!this.myThumbnailViewer)return!1;var i=this.getLocation(),r=this.myThumbnailViewer.innerViewer.defaultDom;if(!r)return!1;switch($k(t=["borderLeft","borderBottom","borderTop","borderRight"]).call(t,function(e){r.style[e]="";}),i){case"right":r.style.borderLeft=e;break;case"top":r.style.borderBottom=e;break;case"bottom":r.style.borderTop=e;break;default:r.style.borderRight=e;}return!0;}},{key:"getLocation",value:function value(){return this.myThumbnailViewer?"vertical"===this.myThumbnailViewer.getThbConfig().location?this.myThumbnailViewer.getThbConfig().sequence>0?"bottom":"top":this.myThumbnailViewer.getThbConfig().sequence>0?"right":"left":(this.setDefaultError(),"");}},{key:"setLocation",value:function value(e){var t=e||"left",i="horizontal",r=-1;if(this.myThumbnailViewer){switch(t){case"right":i="horizontal",r=1;break;case"top":i="vertical",r=-1;break;case"bottom":i="vertical",r=1;}this.myThumbnailViewer.updateThbConfig({location:i,sequence:r});var n=this.getLocation();return this.setBorder(this.webViewer.getBorder()),this.thbStretchBar.className="top"!==n&&"bottom"!==n?"dvs-thbStretchBarH dvs-thbStretchBar-".concat(n):"dvs-thbStretchBarV dvs-thbStretchBar-".concat(n),this.resized(),!0;}return this.setDefaultError(),!1;}},{key:"getSize",value:function value(){return this.myThumbnailViewer?this.myThumbnailViewer.getThbConfig().size:(this.setDefaultError(),!1);}},{key:"setSize",value:function value(e){return!/^((\d+em)|(\d+px)|(\d+%)|(\d+))$/.test(e)||e<0?(this.webViewer.setError("InvalidValue"),!1):e===this.myThumbnailViewer.getThbConfig().size||(this.myThumbnailViewer?(this.setPageMargin(this.pageMargin),this.myThumbnailViewer.updateThbConfig({size:e}),this.bHide?(this.show(),this.emitThumbnailResize(),this.hide()):this.emitThumbnailResize(),this.myThumbnailViewer.innerViewer.resized(),!0):(this.setDefaultError(),!1));}},{key:"getScrollDirection",value:function value(){return this.myThumbnailViewer?this.myThumbnailViewer.getThbConfig().scrollDirection:(this.setDefaultError(),!1);}},{key:"setScrollDirection",value:function value(e){return"horizontal"!==e&&(e="vertical"),this.myThumbnailViewer?(this.myThumbnailViewer.updateThbConfig({scrollDirection:e}),!0):(this.setDefaultError(),!1);}},{key:"getShowPageNumber",value:function value(){return this.myThumbnailViewer?"visible"===this.myThumbnailViewer.getThbConfig().pageNumberStyle.visibility:(this.setDefaultError(),!1);}},{key:"setShowPageNumber",value:function value(e){if(!DL(e))return this.webViewer.setError("InvalidValue"),!1;var t={visibility:e?"visible":"hidden"};return this.updatePageNumberStyle(t),!0;}},{key:"getShowCheckbox",value:function value(){return this.myThumbnailViewer?"visible"===this.myThumbnailViewer.getThbConfig().checkboxStyle.visibility:(this.setDefaultError(),!1);}},{key:"setShowCheckbox",value:function value(e){if(!DL(e))return this.webViewer.setError("InvalidValue"),!1;if(this.myThumbnailViewer){var t={visibility:e?"visible":"hidden"};this.updateCheckboxStyle(t);var i="visible"===t.visibility?1:0;return this.setMultiSelectMode(i),!0;}return this.setDefaultError(),!1;}},{key:"getShowRemoveBtn",value:function value(){return this.myThumbnailViewer?"visible"===this.myThumbnailViewer.getThbConfig().removeBtnStyle.visibility:(this.setDefaultError(),!1);}},{key:"setShowRemoveBtn",value:function value(e){if(!DL(e))return this.webViewer.setError("InvalidValue"),!1;if(this.myThumbnailViewer){var t={visibility:e?"visible":"hidden"};return this.updateRemoveBtnStyle(t),!0;}return this.setDefaultError(),!1;}},{key:"getPageMargin",value:function value(){if(this.myThumbnailViewer){var e=this.myThumbnailViewer.getThbConfig(),t=e.columns,i=e.rows;return t===i&&1===i?0:this.pageMargin;}return this.setDefaultError(),0;}},{key:"setPageMargin",value:function value(e){if(!/^((\d+em)|(\d+px)|(\d+%)|(\d+))$/.test(e)||e<0)return this.webViewer.setError("InvalidValue"),!1;this.pageMargin=e;var t=pq(e,this.myThumbnailViewer.innerViewer);return this.myThumbnailViewer?(this.myThumbnailViewer.updateThbConfig({gap:t}),this.bSingleMode||this.myThumbnailViewer.updateThbConfig({margin:t}),this.resized(),!0):(this.setDefaultError(),!1);}},{key:"getEnableProp",value:function value(e){var t;return-1!==OI(t=this.enableProps).call(t,e)&&("enableResizing"===e?this.allowResize:this.myThumbnailViewer?this.myThumbnailViewer.getThbConfigByName(e):(this.setDefaultError(),!1));}},{key:"setEnableProp",value:function value(e,t){var i;return-1!==OI(i=this.enableProps).call(i,e)&&(DL(t)?("enableResizing"===e&&(this.allowResize=t),this.myThumbnailViewer?(this.myThumbnailViewer.updateThbConfig(Wk({},e,t)),!0):(this.setDefaultError(),!1)):(this.webViewer.setError("InvalidValue"),!1));}},{key:"getThumbSetting",value:function value(e){return this.myThumbnailViewer?this.myThumbnailViewer.getThbConfig().thumbnailStyle[e]:(this.setDefaultError(),"");}},{key:"setThumbSetting",value:function value(e,t){if(this.myThumbnailViewer){var i=Wk({},e,t);return this.myThumbnailViewer.updateThbConfig({thumbnailStyle:i}),!0;}return this.setDefaultError(),!1;}},{key:"getPageSetting",value:function value(e){return this.myThumbnailViewer?this.myThumbnailViewer.getThbConfig().pageStyle[e]:(this.setDefaultError(),"");}},{key:"setPageSetting",value:function value(e,t){if(this.myThumbnailViewer){var i=Wk({},e,t);return this.myThumbnailViewer.updateThbConfig({pageStyle:i}),!0;}return this.setDefaultError(),!1;}},{key:"getHoverSetting",value:function value(e){return this.myThumbnailViewer?this.myThumbnailViewer.getThbConfig().hoveredPageStyle[e]:(this.setDefaultError(),"");}},{key:"setHoverSetting",value:function value(e,t){if(this.myThumbnailViewer){var i=Wk({},e,t);return this.myThumbnailViewer.updateThbConfig({hoveredPageStyle:i}),!0;}return this.setDefaultError(),!1;}},{key:"getSelectSetting",value:function value(e){return this.myThumbnailViewer?this.myThumbnailViewer.getThbConfig().selectedPageStyle[e]:(this.setDefaultError(),"");}},{key:"setSelectSetting",value:function value(e,t){if(this.myThumbnailViewer){var i=Wk({},e,t);return this.myThumbnailViewer.updateThbConfig({selectedPageStyle:i}),!0;}return this.setDefaultError(),!1;}},{key:"getPlaceholderSetting",value:function value(e){return this.myThumbnailViewer?this.myThumbnailViewer.getThbConfig().placeholderStyle[e]:(this.setDefaultError(),"");}},{key:"setPlaceholderSetting",value:function value(e,t){if(this.myThumbnailViewer){var i=Wk({},e,t);return this.myThumbnailViewer.updateThbConfig({placeholderStyle:i}),!0;}return this.setDefaultError(),!1;}},{key:"show",value:function value(){return this.myThumbnailViewer?(this.webViewer.myViewer.setViewMode(1,1),this.webViewer.setIfSinglePageMode(!0),this.myThumbnailViewer.show(),this.bHide=!1,this.setPageMargin(this.pageMargin),!0):(this.setDefaultError(),!1);}},{key:"hide",value:function value(){return this.myThumbnailViewer?(this.bHide=!0,this.myThumbnailViewer.hide(),!0):(this.setDefaultError(),!1);}},{key:"dispose",value:function value(){if(this.bDispose)return!0;var e=this.webViewer.myViewer.removeThumbnail(this.myThumbnailViewer);return this.webViewer.resized(),e&&(this.bDispose=!0,this.webViewer.bThumbnailDispose=!0,this.myThumbnailViewer=void 0,this.webViewer.thumbnailViewer=void 0),e;}},{key:"updateViewMode",value:function value(e){if(!e)return this.webViewer.setError("InvalidValue"),!1;if(this.myThumbnailViewer){var t=e.columns,i=e.rows,r=e.scrollDirection;if(i&&t){var n;if(i<0||t<0)return this.webViewer.setError("InvalidPropertyValue"),!1;this.myThumbnailViewer.setViewMode(i,t),i===t&&1===i?(this.bSingleMode=!0,this.myThumbnailViewer.updateThbConfig({margin:0})):(this.bSingleMode=!1,this.setPageMargin(this.pageMargin),this.myThumbnailViewer.updateThbConfig({margin:this.myThumbnailViewer.getThbConfig().gap})),r&&-1!==OI(n=["horizontal","vertical"]).call(n,r)&&this.myThumbnailViewer.updateThbConfig({scrollDirection:r});}return this.resized(),!0;}return this.setDefaultError(),!1;}},{key:"updateCheckboxStyle",value:function value(e){return this.myThumbnailViewer?(this.myThumbnailViewer.updateThbConfig({checkboxStyle:e}),!0):(this.setDefaultError(),!1);}},{key:"updatePageNumberStyle",value:function value(e){return this.myThumbnailViewer?(this.myThumbnailViewer.updateThbConfig({pageNumberStyle:e}),!0):(this.setDefaultError(),!1);}},{key:"updateRemoveBtnStyle",value:function value(e){if(this.myThumbnailViewer){var t=Fk({},e);return CL(null==e?void 0:e.removeMarkColor)||(t.checkMarkColor=null==e?void 0:e.removeMarkColor),CL(null==e?void 0:e.removeMarkLineWidth)||(t.checkMarkLineWidth=null==e?void 0:e.removeMarkLineWidth),this.myThumbnailViewer.updateThbConfig({removeBtnStyle:t}),!0;}return this.setDefaultError(),!1;}},{key:"on",value:function value(e,t){if(e)if(ML(t)){var i=e;switch(e){case"onDrop":i="drop";break;case"rightclick":i="contextmenu";break;case"resize":i="dwtResize";break;default:i=e;}this.myThumbnailViewer.on(i,t);}else this.webViewer.setError("CallbackNotAFunction");}},{key:"off",value:function value(e,t){if(e){var i=e;switch(e){case"onDrop":i="drop";break;case"rightclick":i="contextmenu";break;case"resize":i="dwtResize";break;default:i=e;}if(CL(t))return this.myThumbnailViewer.off(i),"keydown"===i&&this.bindDefaultKeyDown(),void("contextmenu"===i&&this.bindDefaultContextmenu());ML(t)?this.myThumbnailViewer.off(i,t):this.webViewer.setError("CallbackNotAFunction");}}},{key:"setIfAutoScroll",value:function value(e){return!!this.myThumbnailViewer&&(this.myThumbnailViewer.updateThbConfig({autoSelectLatest:e,autoScroll:e}),!0);}},{key:"setMultiSelectMode",value:function value(e){return BL(e)?this.myThumbnailViewer?(this.myThumbnailViewer.updateThbConfig({multiselectMode:1===e}),!0):(this.setDefaultError(),!1):(this.webViewer.setError("InvalidValue"),!1);}},{key:"emitThumbnailResize",value:function value(){if(this.myThumbnailViewer){var e=this.myThumbnailViewer.innerViewer.defaultDom;if(e){var t=e.getClientRects();if(!(t.length<1)){var i=t[0],r=i.width,n=i.height;this.myThumbnailViewer.innerViewer.emit("dwtResize",r,n);}}}}},{key:"resized",value:function value(){this.myThumbnailViewer&&this.myThumbnailViewer.innerViewer.resized();}},{key:"showFocusOutLine",value:function value(e){this.myThumbnailViewer&&this.myThumbnailViewer.innerViewer.context.setDisableFocusOutline(!e);}},{key:"getVisiblePagesInfo",value:function value(){return this.myThumbnailViewer?this.myThumbnailViewer.innerViewer.context.getVisiblePagesInfo():[];}}]);}(),bq=function(){return Yk(function e(t,i){Xk(this,e),Wk(this,"inner",void 0),this.inner=new wq(t,i);},[{key:"location",get:function get(){return this.inner.e(),this.inner.getLocation();},set:function set(e){this.inner.e(),this.inner.setLocation(e);}},{key:"size",get:function get(){return this.inner.e(),this.inner.getSize();},set:function set(e){this.inner.e(),this.inner.setSize(e);}},{key:"scrollDirection",get:function get(){return this.inner.e(),this.inner.getScrollDirection();},set:function set(e){this.inner.e(),this.inner.setScrollDirection(e);}},{key:"showPageNumber",get:function get(){return this.inner.e(),this.inner.getShowPageNumber();},set:function set(e){this.inner.e(),this.inner.setShowPageNumber(e);}},{key:"showCheckbox",get:function get(){return this.inner.e(),this.inner.getShowCheckbox();},set:function set(e){this.inner.e(),this.inner.setShowCheckbox(e);}},{key:"showRemoveBtn",get:function get(){return this.inner.e(),this.inner.getShowRemoveBtn();},set:function set(e){this.inner.e(),this.inner.setShowRemoveBtn(e);}},{key:"pageMargin",get:function get(){return this.inner.e(),this.inner.getPageMargin();},set:function set(e){this.inner.e(),EX(e)?this.inner.setPageMargin(e):this.inner.setError("InvalidValue");}},{key:"border",get:function get(){return this.inner.e(),this.inner.getThumbSetting("border");},set:function set(e){this.inner.e(),IX(e)&&this.inner.setThumbSetting("border",e);}},{key:"background",get:function get(){return this.inner.e(),this.inner.getThumbSetting("background");},set:function set(e){this.inner.e(),BL(e)&&(e=VX(e)),TX(e)&&this.inner.setThumbSetting("background",e);}},{key:"pageBackground",get:function get(){return this.inner.e(),this.inner.getPageSetting("background");},set:function set(e){this.inner.e(),BL(e)&&(e=VX(e)),TX(e)&&this.inner.setPageSetting("background",e);}},{key:"pageBorder",get:function get(){return this.inner.e(),this.inner.getPageSetting("border");},set:function set(e){this.inner.e(),IX(e)&&this.inner.setPageSetting("border",e);}},{key:"hoverPageBackground",get:function get(){return this.inner.e(),this.inner.getHoverSetting("background");},set:function set(e){this.inner.e(),BL(e)&&(e=VX(e)),TX(e)&&this.inner.setHoverSetting("background",e);}},{key:"hoverPageBorder",get:function get(){return this.inner.e(),this.inner.getHoverSetting("border");},set:function set(e){this.inner.e(),IX(e)&&this.inner.setHoverSetting("border",e);}},{key:"placeholderBackground",get:function get(){return this.inner.e(),this.inner.getPlaceholderSetting("background");},set:function set(e){this.inner.e(),BL(e)&&(e=VX(e)),TX(e)&&this.inner.setPlaceholderSetting("background",e);}},{key:"selectedPageBorder",get:function get(){return this.inner.e(),this.inner.getSelectSetting("border");},set:function set(e){this.inner.e(),IX(e)&&this.inner.setSelectSetting("border",e);}},{key:"selectedPageBackground",get:function get(){return this.inner.e(),this.inner.getSelectSetting("background");},set:function set(e){this.inner.e(),BL(e)&&(e=VX(e)),TX(e)&&this.inner.setSelectSetting("background",e);}},{key:"allowKeyboardControl",get:function get(){return this.inner.e(),this.inner.keyboardControl;},set:function set(e){this.inner.e(),DL(e)&&(this.inner.keyboardControl=e);}},{key:"allowPageDragging",get:function get(){return this.inner.e(),this.inner.getEnableProp("enableDragPage");},set:function set(e){this.inner.e(),this.inner.setEnableProp("enableDragPage",e);}},{key:"allowResizing",get:function get(){return this.inner.e(),this.inner.getEnableProp("enableResizing");},set:function set(e){this.inner.e(),this.inner.setEnableProp("enableResizing",e);}},{key:"autoChangeIndex",get:function get(){return this.inner.e(),this.inner.getEnableProp("autoSelectTopPage");},set:function set(e){this.inner.e(),this.inner.setEnableProp("autoSelectTopPage",e);}},{key:"show",value:function value(){return this.inner.e(),this.inner.show();}},{key:"hide",value:function value(){return this.inner.e(),this.inner.hide();}},{key:"dispose",value:function value(){return this.inner.e(),this.inner.dispose();}},{key:"updateViewMode",value:function value(e){return this.inner.e(),this.inner.updateViewMode(e);}},{key:"updateCheckboxStyle",value:function value(e){return this.inner.e(),this.inner.updateCheckboxStyle(e);}},{key:"updatePageNumberStyle",value:function value(e){return this.inner.e(),this.inner.updatePageNumberStyle(e);}},{key:"on",value:function value(e,t){return this.inner.e(),this.inner.on(e,t);}},{key:"off",value:function value(e,t){return this.inner.e(),this.inner.off(e,t);}},{key:"getVisiblePagesInfo",value:function value(){return this.inner.e(),this.inner.getVisiblePagesInfo();}}]);}(),kq={root:{style:{},className:"dvs-web-viewer",id:"root",children:[{type:"Group",dataId:"body",className:"dvs-body",children:[{type:"MainCanvas",style:{},dataId:"canvas",className:"dvs-canvas"}]}]}},Sq=function(){function e(t,i){Xk(this,e),Wk(this,"myDvs",void 0),Wk(this,"myViewer",void 0),Wk(this,"error",void 0),Wk(this,"containerElement",void 0),Wk(this,"imageEditor",void 0),Wk(this,"customElement",void 0),Wk(this,"thumbnailViewer",void 0),Wk(this,"bindViewUI",!1),Wk(this,"hideContextmenu",!0),Wk(this,"acceptDrop",void 0),Wk(this,"bShowImageEditor",void 0),Wk(this,"bThumbnailDispose",void 0),Wk(this,"bufferService",void 0),Wk(this,"webViewerInitConfig",{}),Wk(this,"bEmitBufferChanged",!0),Wk(this,"pageMargin",10),Wk(this,"initWidth",void 0),Wk(this,"initHeight",void 0),Wk(this,"bSingleMode",!0),Wk(this,"oldEnableDrag",!0),Wk(this,"oldBShowThumbnail",!1),Wk(this,"outerBorder","1px solid rgb(204, 204, 204)"),Wk(this,"minZoom",.02),Wk(this,"maxZoom",65),Wk(this,"bindViewEvent",!1),Wk(this,"resizeObserver",null),this.acceptDrop=!0,this.bShowImageEditor=!1,this.error=new IO(),this.bufferService=t||new EO(),this.webViewerInitConfig=i||{},this.init(),this.bufferService.bindViewer(this);}return Yk(e,[{key:"init",value:function value(){var t=this;e.isInstallDVSPlugin||(rY.use(dX),rY.use(xX),rY.use(zY),rY.use(OO),rY.use(vX),e.isInstallDVSPlugin=!0),this.myDvs=new rY({space:this.bufferService.space,container:""}),this.myViewer=this.myDvs.createViewer({uiConfig:_SL(kq),viewerConfig:_SL(SO)}),this.myViewer.updateViewerConfig({cropBoxConfig:_SL(TO)});var i=this.webViewerInitConfig.viewerEvents;ML(null==i?void 0:i.bufferChanged)&&this.myViewer.on("bufferChanged",function(e,r){t.bEmitBufferChanged&&i.bufferChanged(e,r);}),ML(null==i?void 0:i.removeBtnClick)&&this.myViewer.on("removeBtnClick",function(e){i.removeBtnClick(e);}),this.initBind();}},{key:"initBind",value:function value(){var e=this.webViewerInitConfig.viewerContainer;if(CL(e))return!1;var t=e.container,i=e.width,r=e.height;return!!this.bindView(t)&&(CL(i)||(this.setWidth(i),this.initWidth=this.getWidth()),CL(r)||(this.setHeight(r),this.initHeight=this.getHeight()),this.show(),!0);}},{key:"bindDefaultKeyEvent",value:function value(){var e=this;this.myViewer.on("keydown",function(t){var i=e.myViewer.getViewerConfig(),r=i.rows,n=i.columns,o=i.displayMode;if(!(r<1&&n<1||"single"===o))return"ArrowUp"===t.key||"Up"===t.key?(t.preventDefault(),void e.previous()):void("ArrowDown"!==t.key&&"Down"!==t.key||(t.preventDefault(),e.next()));});}},{key:"bindDefaultDrop",value:function value(){var e=this,t=this.webViewerInitConfig.viewerEvents;this.myViewer.on("drop",function(i,r){e.acceptDrop&&t.onDrop(i,r);});}},{key:"bindDefaultRightClick",value:function value(){var e=this.webViewerInitConfig.viewerEvents;this.myViewer.on("contextmenu",function(t,i){e.rightclick(t,i);});}},{key:"preventDefaultContextmenu",value:function value(){var e=this;this.myViewer.on("contextmenu",function(t,i){e.hideContextmenu&&i.preventDefault();});}},{key:"bindViewerEvents",value:function value(){var e=this;if(this.myViewer){var t=this.webViewerInitConfig.viewerEvents;this.myViewer.off("bufferChanged"),this.bindDefaultKeyEvent(),this.preventDefaultContextmenu(),$k(kO).call(kO,function(i){t&&ML(t[i])&&("onDrop"===i?e.bindDefaultDrop():"rightclick"===i?e.bindDefaultRightClick():"bufferChanged"===i?e.myViewer.on("bufferChanged",function(i,r){e.bEmitBufferChanged&&t.bufferChanged(i,r);}):e.myViewer.on(i,function(e,r){t[i](e,r);}));}),this.bindViewEvent=!0;}}},{key:"unbindViewEvents",value:function value(){var e=this;$k(kO).call(kO,function(t){"bufferChanged"!==t&&e.myViewer.off(t);});}},{key:"initViewer",value:function value(){this.myViewer.updateViewerConfig({autoSelectLatest:!0,maxZoom:this.maxZoom,minZoom:this.minZoom}),UL()?this.setCursor("default"):this.setCursor("crosshair"),this.setAcceptDrop(!0),this.setAllowSlide(!0);}},{key:"getErrorInfo",value:function value(e){return yO[e].errorString||"Successful";}},{key:"disConnectObserver",value:function value(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null);}},{key:"emitPageRendered",value:function value(){var e,t=this;this.myViewer.updateViewerConfig({enableEmitPageRendered:!0});var i=this.myViewer.getCurrentTab();i&&$k(e=i.children).call(e,function(e,i){e.isVisible&&t.myViewer.emit("pageRendered",i);});}},{key:"updateViewerConfig",value:function value(e){this.myViewer.updateViewerConfig(e);}},{key:"resetImageEditorButton",value:function value(){this.imageEditor&&this.imageEditor.inner.resetButtonState();}},{key:"resized",value:function value(){return!!this.myViewer&&(this.myViewer.resized(),!0);}},{key:"setBufferService",value:function value(e){return!!e&&e!==this.bufferService&&(this.bufferService.webViewer=void 0,this.myDvs.setSpace(e.space),this.bufferService=e,this.bufferService.bindViewer(this),this.bufferService.isActiveFile?this.bufferService.openDocument(this.bufferService.getCurrentDocument()):this.bufferService.isActiveTag&&this.bufferService.filterImagesByTag(this.bufferService.getCurrentTag(),function(){},function(){}),this.resized(),!0);}},{key:"setDefaultError",value:function value(){var e=this.webViewerInitConfig.viewerError,t=this.myDvs.context.errorService,i=t.errorCode,r=t.errorMessage;ML(null==e?void 0:e.setError)&&null!=e&&e.setError(i,r),this.error.setError(i,r);}},{key:"setError",value:function value(e){var t=this.webViewerInitConfig.viewerError,i=yO[e],r=i.errorCode,n=i.errorString;ML(null==t?void 0:t.setError)&&null!=t&&t.setError(r,n),this.error.setError(r,n);}},{key:"show",value:function value(){return this.bindViewUI?!!this.myViewer&&(this.myViewer.show(),this.setPageMargin(this.pageMargin),!0):(this.setError("UnBindViewer"),!1);}},{key:"hide",value:function value(){return this.bindViewUI?!!this.myViewer&&(this.myViewer.hide(),!0):(this.setError("UnBindViewer"),!1);}},{key:"setOperationMode",value:function value(e){if(this.myViewer){var t="default";switch(e){case 1:t="crop";break;case 3:t="zoomOut";break;case 2:t="zoomIn";break;case 4:t="annotation";break;default:t="default";}this.myViewer.updateViewerConfig({toolType:t});}}},{key:"bindView",value:function value(e){var t,i,r,n=this,o=null;if(this.closeImageEditor(),e&&(o="DIV"===(null==e?void 0:e.nodeName)?e:document.getElementById(e)),CL(o)||AL(o))return this.setError("ElementNotExist"),!1;if(TL(o.id)||(o.id=WL()),(null===(t=o)||void 0===t||null===(i=t.getElementsByClassName("dvs-root dvs-web-viewer"))||void 0===i?void 0:i.length)>0)return this.setError("AlReadyBindViewer"),!1;if(!(r=this.myViewer.bindContainer(o)))return this.setDefaultError(),!1;var a=this.webViewerInitConfig.viewerEvents;if(a&&ML(a.onBind)&&a.onBind(o),this.bindViewUI=!0,this.containerElement=o,this.initWidth=this.getWidth(),this.initHeight=this.getHeight(),this.initViewer(),this.setBorder(this.outerBorder),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),ML(window.ResizeObserver)){var s=new ResizeObserver(function(){var e;(null===(e=document)||void 0===e?void 0:e.body)&&n.render();});s.observe(this.myViewer.rootDom),this.resizeObserver=s;}else this.resizeObserver=null;return this.bindViewUI&&!this.bindViewEvent&&this.bindViewerEvents(),r;}},{key:"unbindView",value:function value(){if(!this.bindViewUI)return!0;var e;if(this.resetViewerSettings(!1),this.disposeComponent(),e=this.myViewer.unbindContainer()){this.hide(),this.unbindViewEvents(),this.bindViewUI=!1,this.bindViewEvent=!1;var t=this.webViewerInitConfig.viewerEvents;t&&ML(t.onUnBind)&&t.onUnBind(this.containerElement),this.containerElement="";}else this.setDefaultError();return e;}},{key:"getIdPostfix",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.postfix:(this.setError("UnBindViewer"),"");}},{key:"getCursor",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.getViewerConfig().canvasStyle.cursor:(this.setError("UnBindViewer"),"");}},{key:"setCursor",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;if(("zoom-in"===e||"zoom-out"===e)&&!this.getIfSinglePageMode())return this.setError("CursorInvalidMode"),!1;"crosshair"===this.getCursor()&&"crosshair"!==e&&this.clearSelectedAreas();var t="default",i=0;switch(e){case"zoom-out":t="zoom-out",i=3;break;case"zoom-in":t="zoom-in",i=2;break;case"crosshair":t="crosshair",i=1;break;case"pointer":t="pointer",i=0;break;default:t="default",i=0;}return this.myViewer.updateViewerConfig({canvasStyle:{cursor:t}}),this.setOperationMode(i),!0;}},{key:"setIfSinglePageMode",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;var t=e?"single":"multiple",i=0;if(e)this.bSingleMode=!0,i=0;else{var r=this.myViewer.getViewerConfig(),n=r.rows,o=r.columns;(n>1||o>1)&&(i=this.myViewer.getViewerConfig().gap,this.bSingleMode=!1);}return this.myViewer.updateViewerConfig({displayMode:t,margin:i}),this.clearSelectedAreas(),this.resized(),!0;}},{key:"getIfSinglePageMode",value:function value(){return this.bindViewUI?!!this.myViewer&&"single"===this.myViewer.getViewerConfigByName("displayMode"):(this.setError("UnBindViewer"),!1);}},{key:"setZoom",value:function value(e){return this.bindViewUI?!!this.myViewer&&(this.myViewer.updateViewerConfig({zoom:e}),!0):(this.setError("UnBindViewer"),!1);}},{key:"getZoom",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.getViewerConfigByName("zoom"):(this.setError("UnBindViewer"),"");}},{key:"setZoomOrigin",value:function value(e){var t,i;if(!this.bindViewUI)return this.setError("UnBindViewer"),"";if(!this.myViewer)return!1;if(!kL(e)||!TL(null==e?void 0:e.x)||!TL(null==e?void 0:e.y))return this.setError("InvalidValue"),!1;var r=e.x,n=e.y;return-1===OI(t=["left","right","center"]).call(t,r)||-1===OI(i=["top","bottom","center"]).call(i,n)?(this.setError("InvalidValue"),!1):(this.updateViewerConfig({zoomOrigin:{x:r,y:n}}),!0);}},{key:"getZoomOrigin",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.getViewerConfigByName("zoomOrigin"):(this.setError("UnBindViewer"),"");}},{key:"setAcceptDrop",value:function value(e){return this.bindViewUI?!!this.myViewer&&(DL(e)?(this.acceptDrop=e,!0):(this.setError("InvalidValue"),!1)):(this.setError("UnBindViewer"),!1);}},{key:"getAcceptDrop",value:function value(){return this.bindViewUI?!!this.myViewer&&this.acceptDrop:(this.setError("UnBindViewer"),"");}},{key:"setAllowSlide",value:function value(e){return this.bindViewUI?!!this.myViewer&&(DL(e)?(this.myViewer.updateViewerConfig({enableSlide:e}),!0):(this.setError("InvalidValue"),!1)):(this.setError("UnBindViewer"),!1);}},{key:"getAllowSlide",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.getViewerConfigByName("enableSlide"):(this.setError("UnBindViewer"),"");}},{key:"setShowRemoveBtn",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;if(!DL(e))return this.setError("InvalidValue"),!1;var t=e?"visible":"hidden";return this.myViewer.updateViewerConfig({removeBtnStyle:{visibility:t}}),!0;}},{key:"getShowRemoveBtn",value:function value(){return this.bindViewUI?!!this.myViewer&&"visible"===this.myViewer.getViewerConfig().removeBtnStyle.visibility:(this.setError("UnBindViewer"),"");}},{key:"setShowCheckbox",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;if(!DL(e))return this.setError("InvalidValue"),!1;var t=e?"visible":"hidden",i="visible"===t?1:0;return this.myViewer.updateViewerConfig({checkboxStyle:{visibility:t}}),this.setMultiSelectMode(i),this.thumbnailViewer&&(this.thumbnailViewer.showCheckbox=!0),!0;}},{key:"getShowCheckbox",value:function value(){return this.bindViewUI?!!this.myViewer&&"visible"===this.myViewer.getViewerConfig().checkboxStyle.visibility:(this.setError("UnBindViewer"),"");}},{key:"getSelectionRectAspectRatio",value:function value(){if(!this.bindViewUI)return this.setError("UnBindViewer"),"";if(!this.myViewer)return!1;var e=this.myViewer.cropBoxConfig,t=e.aspectRatio;return!1===e.keepAspectRatio||t<1?0:this.myViewer.cropBoxConfig.aspectRatio;}},{key:"setSelectionRectAspectRatio",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;var t=e>0,i=e>0?e:0;return this.myViewer.updateViewerConfig({cropBoxConfig:{aspectRatio:i,keepAspectRatio:t}}),!0;}},{key:"getIfAutoScroll",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.getViewerConfig().autoScroll:(this.setError("UnBindViewer"),"");}},{key:"setIfAutoScroll",value:function value(e){return this.bindViewUI?!!this.myViewer&&(DL(e)?(this.thumbnailViewer&&this.thumbnailViewer.inner.setIfAutoScroll(e),this.imageEditor&&this.imageEditor.inner.setIfAutoScroll(e),this.myViewer.updateViewerConfig({autoSelectLatest:e,autoScroll:e}),!0):(this.setError("InvalidValue"),!1)):(this.setError("UnBindViewer"),!1);}},{key:"getPageMargin",value:function value(){return this.bindViewUI?!!this.myViewer&&this.pageMargin:(this.setError("UnBindViewer"),0);}},{key:"setPageMargin",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;if(!/^((\d+em)|(\d+px)|(\d+%)|(\d+))$/.test(e)||e<0)return this.setError("InvalidValue"),!1;if(!EX(e))return!1;this.pageMargin=e;var t=pq(e,this.myViewer);return this.myViewer.updateViewerConfig({gap:t}),this.bSingleMode||this.myViewer.updateViewerConfig({margin:t}),this.resized(),!0;}},{key:"getWidth",value:function value(){if(!this.bindViewUI)return this.setError("UnBindViewer"),"";if(this.myViewer){var e=this.myViewer.dwtWidth||"";if(window.navigator.userAgent.match(/Trident/g)||window.navigator.userAgent.match(/MSIE/g)){var t=this.myViewer.rootDom,i=getComputedStyle(t).borderLeftWidth,r=2*HO(i).value;if(BL(e))return e+r;}return e;}return"";}},{key:"setWidth",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(TL(e)&&!/^((\d+em)|(\d+px)|(\d+%)|(\d+))$/.test(e)||BL(e)&&e<0)return this.setError("InvalidWidth"),!1;if(e===this.myViewer.dwtWidth)return!0;if(this.myViewer.dwtWidth=e,this.myViewer.getViewerConfig().show&&this.setPageMargin(this.pageMargin),this.thumbnailViewer){var t=this.thumbnailViewer.size;"%"===FO(t).unit&&this.thumbnailViewer.inner.emitThumbnailResize();}return!0;}},{key:"getHeight",value:function value(){if(!this.bindViewUI)return this.setError("UnBindViewer"),"";if(this.myViewer){var e=this.myViewer.dwtHeight||"";if(window.navigator.userAgent.match(/Trident/g)||window.navigator.userAgent.match(/MSIE/g)){var t=this.myViewer.rootDom,i=getComputedStyle(t).borderLeftWidth,r=2*HO(i).value;if(BL(e))return e+r;}return e;}return"";}},{key:"setHeight",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(TL(e)&&!/^((\d+em)|(\d+px)|(\d+%)|(\d+))$/.test(e)||BL(e)&&e<0)return this.setError("InvalidHeight"),!1;if(e===this.myViewer.dwtHeight)return!0;if(this.myViewer.dwtHeight=e,this.myViewer.getViewerConfig().show&&this.setPageMargin(this.pageMargin),this.thumbnailViewer){var t=this.thumbnailViewer.size;"%"===FO(t).unit&&this.thumbnailViewer.inner.emitThumbnailResize();}return!0;}},{key:"getBackground",value:function value(){return this.bindViewUI?this.myViewer?this.myViewer.getViewerConfig().canvasStyle.background:"":(this.setError("UnBindViewer"),"");}},{key:"setBackground",value:function value(e){return this.bindViewUI?!(!this.myViewer&&!this.thumbnailViewer||!TX(e)||(this.myViewer&&this.myViewer.updateViewerConfig({canvasStyle:{background:e}}),this.thumbnailViewer&&(this.thumbnailViewer.background=e),0)):(this.setError("UnBindViewer"),!1);}},{key:"getBorder",value:function value(){return this.bindViewUI?this.outerBorder:(this.setError("UnBindViewer"),"");}},{key:"setBorder",value:function value(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;if(!IX(e))return!1;var i=this.myViewer.rootDom;return i&&(i.style.border=e),this.outerBorder=e,this.thumbnailViewer&&this.thumbnailViewer.inner.setBorder(e),t&&this.myViewer.externalResized(),!0;}},{key:"getInnerBorder",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.getViewerConfig().viewerStyle.border:(this.setError("UnBindViewer"),"");}},{key:"setInnerBorder",value:function value(e){return this.bindViewUI?!!this.myViewer&&!!IX(e)&&(this.myViewer.updateViewerConfig({viewerStyle:{border:e}}),this.resized(),!0):(this.setError("UnBindViewer"),!1);}},{key:"getSelectedPageBorder",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.getViewerConfig().selectedPageStyle.border:(this.setError("UnBindViewer"),"");}},{key:"setSelectedPageBorder",value:function value(e){return this.bindViewUI?!!this.myViewer&&!!IX(e)&&(this.myViewer.updateViewerConfig({selectedPageStyle:{border:e}}),this.thumbnailViewer&&(this.thumbnailViewer.selectedPageBorder=e),!0):(this.setError("UnBindViewer"),!1);}},{key:"getSelectedPageBackground",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.getViewerConfig().selectedPageStyle.background:(this.setError("UnBindViewer"),"");}},{key:"setSelectedPageBackground",value:function value(e){return this.bindViewUI?!(!this.myViewer&&!this.thumbnailViewer||!TX(e)||(this.myViewer.updateViewerConfig({selectedPageStyle:{background:e}}),this.thumbnailViewer&&(this.thumbnailViewer.selectedPageBackground=e),0)):(this.setError("UnBindViewer"),!1);}},{key:"getShowPageNumber",value:function value(){return this.bindViewUI?!!this.myViewer&&"visible"===this.myViewer.getViewerConfig().pageNumberStyle.visibility:(this.setError("UnBindViewer"),"");}},{key:"setShowPageNumber",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;if(!DL(e))return this.setError("InvalidValue"),!1;var t={visibility:e?"visible":"hidden"};return this.updatePageNumberStyle(t),!0;}},{key:"setMultiSelectMode",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;if(!BL(e))return this.setError("InvalidValue"),!1;var t=1===e;return this.myViewer.updateViewerConfig({multiselectMode:t}),this.thumbnailViewer&&this.thumbnailViewer.inner.setMultiSelectMode(e),t&&this.setCursor("pointer"),!0;}},{key:"getMultiSelectMode",value:function value(){return this.bindViewUI?!!this.myViewer&&(this.myViewer.getViewerConfig().multiselectMode?1:0):(this.setError("UnBindViewer"),"");}},{key:"setAllowPageDragging",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;if(!DL)return this.setError("InvalidValue"),!1;var t=e;return this.bSingleMode&&(this.oldEnableDrag=e,t=!1),this.myViewer.updateViewerConfig({enableDragPage:t}),!0;}},{key:"getAllowPageDragging",value:function value(){return this.bindViewUI?!!this.myViewer&&(this.bSingleMode?this.oldEnableDrag:this.myViewer.getViewerConfig().enableDragPage):(this.setError("UnBindViewer"),"");}},{key:"getAutoChangeIndex",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.getViewerConfig().autoSelectTopPage:(this.setError("UnBindViewer"),"");}},{key:"setAutoChangeIndex",value:function value(e){return this.bindViewUI?!!this.myViewer&&(DL(e)?(this.myViewer.updateViewerConfig({autoSelectTopPage:e}),!0):(this.setError("InvalidValue"),!1)):(this.setError("UnBindViewer"),!1);}},{key:"getSelectedAreaBorderColor",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.cropBoxConfig.borderColor:(this.setError("UnBindViewer"),"");}},{key:"setSelectedAreaBorderColor",value:function value(e){return this.bindViewUI?!!this.myViewer&&!!TX(e)&&(this.myViewer.updateViewerConfig({cropBoxConfig:{borderColor:e,ctrlBorderColor:e}}),!0):(this.setError("UnBindViewer"),!1);}},{key:"updateCheckboxStyle",value:function value(e){return this.bindViewUI?(this.myViewer.updateViewerConfig({checkboxStyle:e}),this.thumbnailViewer&&this.thumbnailViewer.inner.updateCheckboxStyle(e),!0):(this.setError("UnBindViewer"),!1);}},{key:"updatePageNumberStyle",value:function value(e){return this.bindViewUI?!(!this.myViewer&&!this.thumbnailViewer||(this.myViewer&&this.myViewer.updateViewerConfig({pageNumberStyle:e}),this.thumbnailViewer&&this.thumbnailViewer.updatePageNumberStyle(e),0)):(this.setError("UnBindViewer"),!1);}},{key:"updateRemoveBtnStyle",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;var t=Fk({},e);return CL(null==e?void 0:e.removeMarkColor)||(t.checkMarkColor=null==e?void 0:e.removeMarkColor),CL(null==e?void 0:e.removeMarkLineWidth)||(t.checkMarkLineWidth=null==e?void 0:e.removeMarkLineWidth),this.myViewer.updateViewerConfig({removeBtnStyle:t}),this.thumbnailViewer&&this.thumbnailViewer.inner.updateRemoveBtnStyle(t),!0;}},{key:"getUISettings",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.uiConfig:(this.setError("UnBindViewer"),!1);}},{key:"resetViewerSettings",value:function value(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;var t=_SL(SO);return this.initViewer(),this.setWidth(this.initWidth),this.setHeight(this.initHeight),this.setBorder("1px solid rgb(204, 204, 204)",e),this.pageMargin=10,this.bSingleMode=!0,this.oldEnableDrag=!0,this.myViewer.updateViewerConfig({rows:1,columns:1,margin:0,gap:10,zoom:1,enableDragPage:!1,scrollDirection:"vertical",displayMode:"multiple",fitType:"window",autoSelectTopPage:!1,autoScroll:!0,viewerStyle:t.viewerStyle,canvasStyle:t.canvasStyle,pageStyle:t.pageStyle,selectedPageStyle:t.selectedPageStyle,hoveredPageStyle:t.hoveredPageStyle,placeholderStyle:t.placeholderStyle,checkboxStyle:t.checkboxStyle,pageNumberStyle:t.pageNumberStyle}),this.resized(),!0;}},{key:"updateUISettings",value:function value(){return!!this.bindViewUI||(this.setError("UnBindViewer"),!1);}},{key:"setSelectionBoxStyle",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),"";if(!kL(e))return!1;if(!this.myViewer)return!1;var t=dq(e);return this.updateCropBoxConfig(t),!0;}},{key:"getSelectionBoxStyle",value:function value(){return this.bindViewUI?!!this.myViewer&&fq(this.myViewer.cropBoxConfig):(this.setError("UnBindViewer"),"");}},{key:"updateCropBoxConfig",value:function value(e){return!!this.myViewer&&(this.myViewer.updateViewerConfig({cropBoxConfig:e}),!0);}},{key:"isFocusOutLine",value:function value(){return!!this.myViewer&&this.myViewer.context.showOutline;}},{key:"showFocusOutLine",value:function value(e){this.thumbnailViewer&&this.thumbnailViewer.inner.showFocusOutLine(e),this.imageEditor&&this.imageEditor.inner.editorViewer.context.setDisableFocusOutline(!e),this.myViewer.context.setDisableFocusOutline(!e);}},{key:"getIfShowVideoContainer",value:function value(){return!!this.myViewer&&this.myViewer.getViewerConfig().showVideoContainer;}},{key:"showVideoContainer",value:function value(e){return!!this.myViewer&&(this.getIfShowVideoContainer()===e||(this.thumbnailViewer&&(e?(this.oldBShowThumbnail=this.thumbnailViewer.inner.showThumbnail,this.thumbnailViewer.inner.showThumbnail=!1):this.thumbnailViewer.inner.showThumbnail=this.oldBShowThumbnail),this.myViewer.updateViewerConfig({showVideoContainer:e})),!0);}},{key:"updateVideoImage",value:function value(e){var t=this.myViewer.updateVideoImage(e);return t||this.setDefaultError(),t;}},{key:"createThumbnailViewer",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),null;if(this.thumbnailViewer)return this.setError("ThumbnailViewerExist"),this.thumbnailViewer;this.thumbnailViewer=new bq(this,e),this.setBorder(this.outerBorder);var t=this.webViewerInitConfig.viewerEvents;return ML(null==t?void 0:t.removeBtnClick)&&this.thumbnailViewer.on("removeBtnClick",function(e){t.removeBtnClick(e);}),this.showFocusOutLine(this.isFocusOutLine()),this.thumbnailViewer;}},{key:"createImageEditor",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),null;if(this.imageEditor)this.setError("ImageEditorExist");else{var t,i,r=xL(_SL(VO),this.webViewerInitConfig.imageEditorUiConfig);r.border=this.getBorder(),r.selectionRectAspectRatio=this.getSelectionRectAspectRatio();var n=r;ML(null===(t=this.webViewerInitConfig)||void 0===t?void 0:t.beforeImageEditorCreated)&&null!==(i=this.webViewerInitConfig)&&void 0!==i&&i.beforeImageEditorCreated(n),e&&(n=xL(n,e)),this.imageEditor=new yq(this,n);var o=this.getSelectionBoxStyle();this.imageEditor.updateSelectionBoxStyle(o);}return this.showFocusOutLine(this.isFocusOutLine()),this.imageEditor;}},{key:"closeImageEditor",value:function value(){this.imageEditor&&(this.imageEditor.dispose(),this.imageEditor=void 0);}},{key:"createCustomElement",value:function value(e,t,i){if(!this.bindViewUI)return this.setError("UnBindViewer"),null;var r=t||"right",n=!!DL(i)&&i;return CL(e)?(this.setError("ElementRequired"),null):e instanceof HTMLDivElement?(this.customElement?this.setError("CustomElementExist"):this.customElement=new CX(this,e,r,n),this.customElement):(this.setError("ElementNotExist"),null);}},{key:"getCurrentIndex",value:function value(){var e=-1;return this.getHowManyImagesInBuffer()>0&&(e=this.myViewer.getCurrentIndex(),(CL(e)||e<0)&&this.setDefaultError()),e;}},{key:"getCurrentImgUUid",value:function value(){var e=this.myViewer.getCurrentIndex();return-1===e?"":this.bufferService.getUidByIndex(e);}},{key:"getHowManyImagesInBuffer",value:function value(){return!!this.myViewer&&(CL(this.myViewer.currentPageCount)?0:this.myViewer.currentPageCount);}},{key:"getSelectedImagesIndices",value:function value(){return!!this.myViewer&&this.myViewer.getSelectedIndexes();}},{key:"setButtonClass",value:function value(e,t){return this.bindViewUI?CL(e)||CL(t)?(this.setError("InvalidValue"),!1):(this.myViewer.setButtonClass(e,t),!0):(this.setError("UnBindViewer"),!1);}},{key:"setViewMode",value:function value(e,t){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;var i=!1,r="vertical";if(!BL(e)||!BL(t))return this.setError("InvalidValue"),!1;this.myViewer.updateViewerConfig({enableEmitPageRendered:!1}),this.thumbnailViewer&&this.thumbnailViewer.hide();var n=this.myViewer.getViewerConfig(),o=n.rows,a=n.columns;return-1===e&&-1===t?(this.setIfSinglePageMode(!0),i=!0):(t<0&&(r="horizontal",t=-t),e=e<0?-e:e,this.myViewer.updateViewerConfig({scrollDirection:r}),i=this.myViewer.setViewMode(t,e),1===e&&1===t?(this.bSingleMode=!0,1===o&&1===a||(this.oldEnableDrag=this.myViewer.getViewerConfig().enableDragPage),this.myViewer.updateViewerConfig({margin:0,enableDragPage:!1})):(this.bSingleMode=!1,this.setPageMargin(this.pageMargin),this.myViewer.updateViewerConfig({enableDragPage:this.oldEnableDrag})),this.setIfSinglePageMode(!1),i||this.setDefaultError(),"zoom-in"===this.getCursor()&&this.setCursor("crosshair")),this.emitPageRendered(),i;}},{key:"setFitType",value:function value(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"window";if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;var i="window";return-1===OI(e=["width","height","window"]).call(e,t)?(this.setError("InvalidValue"),!1):(i=t,this.myViewer.updateViewerConfig({fitType:i}),!0);}},{key:"setSelectedAreas",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if("crosshair"!==this.getCursor())return this.setError("OperationError"),!1;var t,i=[],r=!0;if(this.getCurrentIndex()<0)return this.setError("NoImage"),!1;if(CL(e)||CL(e.length)||0===e.length)return this.setError("InvalidLeftOrTopOrRightOrBottom"),!1;if(e.length&&e.length>0)for(var n=0;n<e.length;n++){var o=e[n],a=o.left,s=o.right,u=o.top,l=o.bottom;if(t={},BL(a+s+u+l)){if(a<0||u<0||s<0||l<0)continue;if(a>s||u>l)continue;t.left=a,t.top=u,t.width=s-a,t.height=l-u,i.push(t);}}return 0===i.length?(this.setError("InvalidLeftOrTopOrRightOrBottom"),!1):((r=this.myViewer.setCropBox(i,!0))||this.setDefaultError(),r);}},{key:"clearSelectedAreas",value:function value(){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;var e=!0;return!(this.getHowManyImagesInBuffer()<=0)&&(e=this.myViewer.clearCropBox(),this.myViewer.render(),e||this.setDefaultError(),e);}},{key:"next",value:function value(){if(!this.bindViewUI)return this.setError("UnBindViewer"),-1;if(!this.myViewer)return!1;var e=this.getHowManyImagesInBuffer();if(e<=0)return this.setError("NoImage"),-1;if(0===e)return 0;var t=this.getIfAutoScroll();return!1===t&&this.setIfAutoScroll(!0),this.imageEditor&&this.imageEditor.inner&&this.imageEditor.inner.bShowImageEditor?this.imageEditor.inner.nextImage():this.myViewer.nextPage(),!1===t&&this.setIfAutoScroll(!1),this.getCurrentIndex();}},{key:"previous",value:function value(){if(!this.bindViewUI)return this.setError("UnBindViewer"),-1;if(!this.myViewer)return!1;var e=this.getHowManyImagesInBuffer();if(e<=0)return this.setError("NoImage"),-1;if(0===e)return 0;var t=this.getIfAutoScroll();return!1===t&&this.setIfAutoScroll(!0),this.imageEditor&&this.imageEditor.inner&&this.imageEditor.inner.bShowImageEditor?this.imageEditor.inner.previousImage():this.myViewer.prevPage(),!1===t&&this.setIfAutoScroll(!1),this.getCurrentIndex();}},{key:"first",value:function value(){if(!this.bindViewUI)return this.setError("UnBindViewer"),-1;if(this.getHowManyImagesInBuffer()<=0)return this.setError("NoImage"),-1;var e=this.getIfAutoScroll();return!1===e&&this.setIfAutoScroll(!0),this.imageEditor&&this.imageEditor.inner&&this.imageEditor.inner.bShowImageEditor?this.imageEditor.inner.first():this.myViewer.firstPage(),this.myViewer.firstPage(),!1===e&&this.setIfAutoScroll(!1),0;}},{key:"last",value:function value(){if(!this.bindViewUI)return this.setError("UnBindViewer"),-1;var e=this.getHowManyImagesInBuffer();if(e<=0)return this.setError("NoImage"),-1;var t=this.getIfAutoScroll();return!1===t&&this.setIfAutoScroll(!0),this.imageEditor&&this.imageEditor.inner&&this.imageEditor.inner.bShowImageEditor?this.imageEditor.inner.last():this.myViewer.lastPage(),!1===t&&this.setIfAutoScroll(!1),e-1;}},{key:"gotoPage",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),-1;var t=this.getHowManyImagesInBuffer();if(t<=0)return this.setError("NoImage"),-1;if(t<0||e>=this.getHowManyImagesInBuffer())return this.setError("IndexOutOfRange"),-1;if(!/^(\d+)$/.test(e)||e<0)return this.setError("MobileServer_InvalidIndex"),-1;var i=this.getIfAutoScroll();return!1===i&&this.setIfAutoScroll(!0),this.imageEditor&&this.imageEditor.inner&&this.imageEditor.inner.bShowImageEditor?this.imageEditor.inner.goToPage(e):this.myViewer.gotoPage(e),!1===i&&this.setIfAutoScroll(!1),this.resized(),e;}},{key:"render",value:function value(){return this.bindViewUI?!!this.myViewer&&(this.myViewer.dwtRender(),this.myViewer.externalResized(),this.resized(),!0):(this.setError("UnBindViewer"),!1);}},{key:"on",value:function value(e,t){if(!e)return this.setError("InvalidValue"),!1;if(!ML(t))return this.setError("CallbackNotAFunction"),!1;var i=e;switch(e){case"onDrop":i="drop";break;case"rightclick":i="contextmenu";break;case"resize":i="dwtResize";break;default:i=e;}return this.myViewer.on(i,t),!0;}},{key:"off",value:function value(e,t){if(!e)return this.setError("InvalidValue"),!1;var i=e;switch(e){case"onDrop":i="drop";break;case"rightclick":i="contextmenu";break;case"resize":i="dwtResize";break;default:i=e;}if(CL(t)){this.myViewer.off(i),"contextmenu"===e&&this.preventDefaultContextmenu();var r=this.webViewerInitConfig.viewerEvents;OI(kO).call(kO,e)>=0&&ML(r[e])&&("onDrop"===e?this.bindDefaultDrop():"rightclick"===e?this.bindDefaultRightClick():this.myViewer.on(i,function(t,i){r[e](t,i);}));}else{if(!ML(t))return this.setError("CallbackNotAFunction"),!1;this.myViewer.off(i,t);}return!0;}},{key:"disposeComponent",value:function value(){this.disConnectObserver(),this.imageEditor&&this.imageEditor.dispose(),this.thumbnailViewer&&this.thumbnailViewer.dispose(),this.customElement&&this.customElement.dispose();}},{key:"dispose",value:function value(){if(this.myViewer){this.myViewer.off("bufferChanged"),this.disposeComponent(),this.myViewer.destroy(),this.myViewer=null;var e=this.webViewerInitConfig.viewerEvents;e&&ML(e.onUnBind)&&e.onUnBind(this.containerElement);}this.bufferService&&(this.bufferService.space.destroy(),this.bufferService=null),this.myDvs&&(this.myDvs.destroy(),this.myDvs=null);}},{key:"rotateInner",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:90,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.myViewer)return!1;if(!BL(e)||e<0)return this.setError("InvalidIndex"),!1;var r=this.getHowManyImagesInBuffer();return r<0?(this.setError("NoImage"),!1):e>=r?(this.setError("IndexOutOfRange"),!1):BL(t)?(this.myViewer.updateViewerConfig({rotationType:i?"clip":"contain"}),this.myViewer.rotate(t,e)):(this.setError("InvalidValue"),!1);}},{key:"rotate",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:90,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!BL(e)||e<0)return this.setError("InvalidIndex"),uB.reject(this.getErrorInfo("InvalidIndex"));var r=this.getHowManyImagesInBuffer();if(r<0)return this.setError("NoImage"),uB.reject(this.getErrorInfo("NoImage"));if(e>=r)return this.setError("IndexOutOfRange"),uB.reject(this.getErrorInfo("IndexOutOfRange"));if(!BL(t))return this.setError("InvalidValue"),uB.reject(this.getErrorInfo("InvalidValue"));var n=this.webViewerInitConfig.viewerEvents;return n&&ML(null==n?void 0:n.rotate)?n.rotate(e,t,i):(this.myViewer.updateViewerConfig({rotationType:i?"clip":"contain"}),this.myViewer.rotate(t,e),this.saveToServer(e));}},{key:"crop",value:(i=mb(vb().mark(function e(t,i){var r,n,o,a,s,u,l,c,h;return vb().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.getHowManyImagesInBuffer(),!(t<0)&&BL(t)){e.next=3;break;}return e.abrupt("return",(this.setError("InvalidIndex"),uB.reject(this.getErrorInfo("InvalidIndex"))));case 3:if(!(r<0)){e.next=5;break;}return e.abrupt("return",(this.setError("NoImage"),uB.reject(this.getErrorInfo("NoImage"))));case 5:if(!(t>=r)){e.next=7;break;}return e.abrupt("return",(this.setError("IndexOutOfRange"),uB.reject(this.getErrorInfo("IndexOutOfRange"))));case 7:if(n=i.x,o=i.y,a=i.width,s=i.height,!CL(i)&&BL(n+o+a+s)){e.next=10;break;}return e.abrupt("return",(this.setError("InvalidValue"),uB.reject(this.getErrorInfo("InvalidValue"))));case 10:if(!(n<0||o<0||a<=0||s<=0)){e.next=12;break;}return e.abrupt("return",(this.setError("InvalidValue"),uB.reject(this.getErrorInfo("InvalidValue"))));case 12:if(u=this.myViewer.getCurrentTab().getChildByIndex(t),l=u.realTimeWidth,c=u.realTimeHeight,!(a>l||s>c)){e.next=15;break;}return e.abrupt("return",(this.setError("WidthOrHeightOutOfImageSize"),uB.reject(this.getErrorInfo("WidthOrHeightOutOfImageSize"))));case 15:return h=this.webViewerInitConfig.viewerEvents,e.abrupt("return",h&&ML(null==h?void 0:h.crop)?h.crop(t,n,o,a,s):(this.myViewer.crop(t,n,o,a,s),this.saveToServer(t)));case 17:case"end":return e.stop();}},e,this);})),function(e,t){return i.apply(this,arguments);})},{key:"saveToServer",value:(t=mb(vb().mark(function e(t){var i,r,n,o;return vb().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.bufferService.getUidByIndex(t),(r=this.webViewerInitConfig.viewerEvents)&&ML(null==r?void 0:r.save)){e.next=3;break;}return e.abrupt("return",uB.reject());case 3:return e.next=5,this.myDvs.getImageData(i,{type:"imageData"});case 5:return n=e.sent,o=Fk(Fk({},this.bufferService.getMetadataByUid(i)),{},{width:Math.floor(n.width),height:Math.floor(n.height)}),e.abrupt("return",r.save(i,n.data.buffer,o,!1));case 8:case"end":return e.stop();}},e,this);})),function(e){return t.apply(this,arguments);})},{key:"overlayRectangle",value:function value(e,t,i,r,n,o,a){if(CL(e)||CL(t)||CL(i)||CL(r)||CL(n))return!1;var s=r-t,u=n-i;return!(s<=0||u<=0)&&this.myViewer.overlayRectangle(e,t,i,s,u,o,a);}},{key:"selectPages",value:function value(e){if(!this.myViewer)return!1;var t=e[e.length-1],i=this.getCurrentIndex();return this.imageEditor&&this.imageEditor.inner&&this.imageEditor.inner.bShowImageEditor&&t!==i?this.imageEditor.inner.selectPages(e):this.myViewer.setSelectedIndexes(e);}},{key:"removePageByUid",value:function value(e){if(!this.myViewer)return!1;var t=this.myViewer.getIndexByUid(e);return null!==t&&this.myViewer.removePage(t);}},{key:"removePageByIndexes",value:function value(e){return!!this.myViewer&&this.myViewer.removePage(e);}},{key:"removeAllPages",value:function value(){return!!this.myViewer&&this.myViewer.removeAllPages();}},{key:"getVisiblePagesInfo",value:function value(){return this.myViewer?this.myViewer.context.getVisiblePagesInfo():[];}}]);var t,i;}();Wk(Sq,"isInstallDVSPlugin",!1);var xq=function(){return Yk(function e(t,i){Xk(this,e),Wk(this,"webViewer",void 0),Wk(this,"elements",[]),this.webViewer=new Sq(t,i),this.elements=[],this.disableFocusOutline=!0;},[{key:"e",value:function value(){this.webViewer.setError("Successful");}},{key:"disableFocusOutline",get:function get(){return!this.webViewer.isFocusOutLine();},set:function set(e){this.e(),this.webViewer.showFocusOutLine(!e);}},{key:"idPostfix",get:function get(){return this.e(),this.webViewer.getIdPostfix();}},{key:"width",get:function get(){return this.e(),this.webViewer.getWidth();},set:function set(e){this.e(),this.webViewer.setWidth(e);}},{key:"height",get:function get(){return this.e(),this.webViewer.getHeight();},set:function set(e){this.e(),this.webViewer.setHeight(e);}},{key:"background",get:function get(){return this.e(),this.webViewer.getBackground();},set:function set(e){this.e(),BL(e)&&(e=VX(e)),this.webViewer.setBackground(e);}},{key:"border",get:function get(){return this.e(),this.webViewer.getBorder();},set:function set(e){this.e(),this.webViewer.setBorder(e);}},{key:"innerBorder",get:function get(){return this.e(),this.webViewer.getInnerBorder();},set:function set(e){this.e(),this.webViewer.setInnerBorder(e);}},{key:"selectedPageBorder",get:function get(){return this.e(),this.webViewer.getSelectedPageBorder();},set:function set(e){this.e(),this.webViewer.setSelectedPageBorder(e);}},{key:"selectedPageBackground",get:function get(){return this.e(),this.webViewer.getSelectedPageBackground();},set:function set(e){this.e(),BL(e)&&(e=VX(e)),this.webViewer.setSelectedPageBackground(e);}},{key:"selectedAreaBorderColor",get:function get(){return this.e(),this.webViewer.getSelectedAreaBorderColor();},set:function set(e){this.e(),BL(e)&&(e=VX(e)),this.webViewer.setSelectedAreaBorderColor(e);}},{key:"selectionRectAspectRatio",get:function get(){return this.e(),this.webViewer.getSelectionRectAspectRatio();},set:function set(e){this.e(),this.webViewer.setSelectionRectAspectRatio(e);}},{key:"showPageNumber",get:function get(){return this.e(),this.webViewer.getShowPageNumber();},set:function set(e){this.e(),this.webViewer.setShowPageNumber(e);}},{key:"showCheckbox",get:function get(){return this.e(),this.webViewer.getShowCheckbox();},set:function set(e){this.e(),this.webViewer.setShowCheckbox(e);}},{key:"cursor",get:function get(){return this.e(),this.webViewer.getCursor();},set:function set(e){this.e(),this.webViewer.setCursor(e);}},{key:"ifAutoScroll",get:function get(){return this.e(),this.webViewer.getIfAutoScroll();},set:function set(e){this.e(),this.webViewer.setIfAutoScroll(e);}},{key:"pageMargin",get:function get(){return this.e(),this.webViewer.getPageMargin();},set:function set(e){this.e(),this.webViewer.setPageMargin(e);}},{key:"zoom",get:function get(){return this.e(),this.webViewer.getZoom();},set:function set(e){this.e(),this.webViewer.setZoom(e);}},{key:"zoomOrigin",get:function get(){return this.e(),this.webViewer.getZoomOrigin();},set:function set(e){this.e(),this.webViewer.setZoomOrigin(e);}},{key:"singlePageMode",get:function get(){return this.e(),this.webViewer.getIfSinglePageMode();},set:function set(e){this.e(),this.webViewer.setIfSinglePageMode(e);}},{key:"acceptDrop",get:function get(){return this.e(),this.webViewer.getAcceptDrop();},set:function set(e){this.e(),this.webViewer.setAcceptDrop(e);}},{key:"allowSlide",get:function get(){return this.e(),this.webViewer.getAllowSlide();},set:function set(e){this.e(),this.webViewer.setAllowSlide(e);}},{key:"autoChangeIndex",get:function get(){return this.e(),this.webViewer.getAutoChangeIndex();},set:function set(e){this.e(),this.webViewer.setAutoChangeIndex(e);}},{key:"selectionMode",get:function get(){return this.e(),this.webViewer.getMultiSelectMode();},set:function set(e){this.e(),this.webViewer.setMultiSelectMode(e);}},{key:"allowPageDragging",get:function get(){return this.e(),this.webViewer.getAllowPageDragging();},set:function set(e){this.e(),this.webViewer.setAllowPageDragging(e);}},{key:"selectedImagesIndices",get:function get(){return this.e(),this.webViewer.getSelectedImagesIndices();}},{key:"next",value:function value(){return this.e(),this.webViewer.next();}},{key:"previous",value:function value(){return this.e(),this.webViewer.previous();}},{key:"first",value:function value(){return this.e(),this.webViewer.first();}},{key:"last",value:function value(){return this.e(),this.webViewer.last();}},{key:"gotoPage",value:function value(e){return this.e(),this.webViewer.gotoPage(e);}},{key:"render",value:function value(){return this.e(),this.webViewer.render();}},{key:"show",value:function value(){return this.e(),this.webViewer.show();}},{key:"hide",value:function value(){return this.e(),this.webViewer.hide();}},{key:"on",value:function value(e,t){return this.e(),this.webViewer.on(e,t);}},{key:"off",value:function value(e,t){return this.e(),this.webViewer.off(e,t);}},{key:"createImageEditor",value:function value(e){return this.e(),this.webViewer.createImageEditor(e);}},{key:"createThumbnailViewer",value:function value(e){return this.e(),this.webViewer.createThumbnailViewer(e);}},{key:"createCustomElement",value:function value(e,t,i){return this.e(),this.webViewer.createCustomElement(e,t,i);}},{key:"updateCheckboxStyle",value:function value(e){return this.e(),this.webViewer.updateCheckboxStyle(e);}},{key:"updatePageNumberStyle",value:function value(e){return this.e(),this.webViewer.updatePageNumberStyle(e);}},{key:"updateSelectionBoxStyle",value:function value(e){return this.e(),this.webViewer.setSelectionBoxStyle(e);}},{key:"clearSelectedAreas",value:function value(){return this.e(),this.webViewer.clearSelectedAreas();}},{key:"setSelectedAreas",value:function value(e){return this.e(),this.webViewer.setSelectedAreas(e);}},{key:"fitWindow",value:function value(e){return this.e(),this.webViewer.setFitType(e);}},{key:"setButtonClass",value:function value(e,t){return this.e(),this.webViewer.setButtonClass(e,t);}},{key:"setViewMode",value:function value(e,t){return this.e(),this.webViewer.setViewMode(e,t);}},{key:"bind",value:function value(e){this.e();var t,i,r=e;if(t=r,window.ShadowRoot&&t instanceof window.ShadowRoot){var n=document.createElement("div");r.appendChild(n),this.elements.push(n),r=n;}if(i=r,"object"==("undefined"==typeof HTMLElement?"undefined":ch(HTMLElement))?i instanceof HTMLElement:i&&"object"==ch(i)&&1===i.nodeType&&"string"==typeof i.nodeName){var o=function(e){var t=e;if(window.ShadowRoot)for(;t;){if(t instanceof window.ShadowRoot)return t;t=t.parentNode;}return!1;}(r);if(o){var a=document.createElement("style");a.innerHTML=['@import url("',Dynamsoft.DWT.ResourcesPath,"/src/dynamsoft.webtwain.viewer.css",'")'].join(""),o.appendChild(a);var s=document.createElement("style");s.innerHTML=['@import url("',Dynamsoft.DWT.ResourcesPath,"/src/dynamsoft.webtwain.css",'")'].join(""),o.appendChild(s),this.elements.push(a,s);}else o=!1;r.id&&""!==r.id||(r.id=["dwt_",WL()].join(""));}return this.webViewer.bindView(r);}},{key:"unbind",value:function value(){var e;return this.e(),$k(e=this.elements).call(e,function(e){e.parentNode&&e.parentNode.removeChild(e);}),this.webViewer.unbindView();}},{key:"getUISettings",value:function value(){return this.e(),this.webViewer.getUISettings();}},{key:"updateUISettings",value:function value(){return this.e(),this.webViewer.updateUISettings();}},{key:"resetUISettings",value:function value(){return this.e(),this.webViewer.resetViewerSettings();}},{key:"getVisiblePagesInfo",value:function value(){return this.e(),this.webViewer.getVisiblePagesInfo();}}]);}(),Cq=function(e){function t(e,i){return Xk(this,t),cL(this,t,[e,i]);}return _b(t,e),Yk(t,[{key:"errorCode",get:function get(){return this.webViewer.error.getError().errCode;}},{key:"errorString",get:function get(){return this.webViewer.error.getError().errorString;}},{key:"SelectedImagesIndices",get:function get(){return this.webViewer.getSelectedImagesIndices();}},{key:"rotate",value:function value(e,t,i){return this.webViewer.rotate(e,t,i);}},{key:"crop",value:function value(e,t){return this.webViewer.crop(e,t);}}]);}(xq);HTMLCanvasElement.prototype.toBlob||tL(HTMLCanvasElement.prototype,"toBlob",{value:function value(e,t,i){for(var r=atob(this.toDataURL(t,i).split(",")[1]),n=r.length,o=new Uint8Array(n),a=0;a<n;a++)o[a]=r.charCodeAt(a);e(new Blob([o],{type:t||"image/png"}));}});var Vq=window.Dynamsoft||window;Vq.DWTViewer=xq,Vq.DWTViewerEx=Cq;}();
