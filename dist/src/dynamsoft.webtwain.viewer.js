/* ! 20240424140515
* Dynamsoft JavaScript Library
* Product: Dynamic Web TWAIN
* Web Site: https://www.dynamsoft.com
*
* Copyright 2024, Dynamsoft Corporation
* Author: Dynamsoft Support Team
* Version: 18.5
*/function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj;}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;},_typeof(obj);}!function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;}var i={},r={get exports(){return i;},set exports(e){i=e;}},n={},o={get exports(){return n;},set exports(e){n=e;}},a=function a(e){return e&&e.Math==Math&&e;},s=a("object"==(typeof globalThis==="undefined"?"undefined":_typeof(globalThis))&&globalThis)||a("object"==(typeof window==="undefined"?"undefined":_typeof(window))&&window)||a("object"==(typeof self==="undefined"?"undefined":_typeof(self))&&self)||a("object"==_typeof(e)&&e)||function(){return this;}()||Function("return this")(),l=function l(e){try{return!!e();}catch(e){return!0;}},u=!l(function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype");}),c=u,h=Function.prototype,d=h.apply,f=h.call,v="object"==(typeof Reflect==="undefined"?"undefined":_typeof(Reflect))&&Reflect.apply||(c?f.bind(d):function(){return f.apply(d,arguments);}),g=u,m=Function.prototype,y=m.call,p=g&&m.bind.bind(y,y),w=g?p:function(e){return function(){return y.apply(e,arguments);};},b=w,k=b({}.toString),x=b("".slice),S=function S(e){return x(k(e),8,-1);},C=S,V=w,T=function T(e){if("Function"===C(e))return V(e);},I="object"==(typeof document==="undefined"?"undefined":_typeof(document))&&document.all,E={all:I,IS_HTMLDDA:void 0===I&&void 0!==I},P=E.all,B=E.IS_HTMLDDA?function(e){return"function"==typeof e||e===P;}:function(e){return"function"==typeof e;},D={},M=!l(function(){return 7!=Object.defineProperty({},1,{get:function get(){return 7;}})[1];}),A=u,z=Function.prototype.call,U=A?z.bind(z):function(){return z.apply(z,arguments);},R={},L={}.propertyIsEnumerable,N=Object.getOwnPropertyDescriptor,O=N&&!L.call({1:2},1);R.f=O?function(e){var t=N(this,e);return!!t&&t.enumerable;}:L;var W,H,F=function F(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t};},j=l,Y=S,X=Object,q=w("".split),Z=j(function(){return!X("z").propertyIsEnumerable(0);})?function(e){return"String"==Y(e)?q(e,""):X(e);}:X,_=function _(e){return null==e;},G=_,K=TypeError,$=function $(e){if(G(e))throw K("Can't call method on "+e);return e;},Q=Z,J=$,ee=function ee(e){return Q(J(e));},te=B,ie=E.all,re=E.IS_HTMLDDA?function(e){return"object"==_typeof(e)?null!==e:te(e)||e===ie;}:function(e){return"object"==_typeof(e)?null!==e:te(e);},ne={},oe=ne,ae=s,se=B,le=function le(e){return se(e)?e:void 0;},ue=function ue(e,t){return arguments.length<2?le(oe[e])||le(ae[e]):oe[e]&&oe[e][t]||ae[e]&&ae[e][t];},ce=w({}.isPrototypeOf),he=ue("navigator","userAgent")||"",de=s,fe=he,ve=de.process,ge=de.Deno,me=ve&&ve.versions||ge&&ge.version,ye=me&&me.v8;ye&&(H=(W=ye.split("."))[0]>0&&W[0]<4?1:+(W[0]+W[1])),!H&&fe&&(!(W=fe.match(/Edge\/(\d+)/))||W[1]>=74)&&(W=fe.match(/Chrome\/(\d+)/))&&(H=+W[1]);var pe=H,we=pe,be=l,ke=!!Object.getOwnPropertySymbols&&!be(function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&we&&we<41;}),xe=ke&&!Symbol.sham&&"symbol"==_typeof(Symbol.iterator),Se=ue,Ce=B,Ve=ce,Te=Object,Ie=xe?function(e){return"symbol"==_typeof(e);}:function(e){var t=Se("Symbol");return Ce(t)&&Ve(t.prototype,Te(e));},Ee=String,Pe=function Pe(e){try{return Ee(e);}catch(e){return"Object";}},Be=B,De=Pe,Me=TypeError,Ae=function Ae(e){if(Be(e))return e;throw Me(De(e)+" is not a function");},ze=Ae,Ue=_,Re=function Re(e,t){var i=e[t];return Ue(i)?void 0:ze(i);},Le=U,Ne=B,Oe=re,We=TypeError,He={},Fe={get exports(){return He;},set exports(e){He=e;}},je=s,Ye=Object.defineProperty,Xe=function Xe(e,t){try{Ye(je,e,{value:t,configurable:!0,writable:!0});}catch(i){je[e]=t;}return t;},qe="__core-js_shared__",Ze=s[qe]||Xe(qe,{}),_e=Ze;(Fe.exports=function(e,t){return _e[e]||(_e[e]=void 0!==t?t:{});})("versions",[]).push({version:"3.27.1",mode:"pure",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.27.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Ge=$,Ke=Object,$e=function $e(e){return Ke(Ge(e));},Qe=$e,Je=w({}.hasOwnProperty),et=Object.hasOwn||function(e,t){return Je(Qe(e),t);},tt=w,it=0,rt=Math.random(),nt=tt(1..toString),ot=function ot(e){return"Symbol("+(void 0===e?"":e)+")_"+nt(++it+rt,36);},at=s,st=et,lt=ot,ut=ke,ct=xe,ht=He("wks"),dt=at.Symbol,ft=dt&&dt.for,vt=ct?dt:dt&&dt.withoutSetter||lt,gt=function gt(e){if(!st(ht,e)||!ut&&"string"!=typeof ht[e]){var t="Symbol."+e;ut&&st(dt,e)?ht[e]=dt[e]:ht[e]=ct&&ft?ft(t):vt(t);}return ht[e];},mt=U,yt=re,pt=Ie,wt=Re,bt=function bt(e,t){var i,r;if("string"===t&&Ne(i=e.toString)&&!Oe(r=Le(i,e)))return r;if(Ne(i=e.valueOf)&&!Oe(r=Le(i,e)))return r;if("string"!==t&&Ne(i=e.toString)&&!Oe(r=Le(i,e)))return r;throw We("Can't convert object to primitive value");},kt=TypeError,xt=gt("toPrimitive"),St=function St(e,t){if(!yt(e)||pt(e))return e;var i,r=wt(e,xt);if(r){if(void 0===t&&(t="default"),i=mt(r,e,t),!yt(i)||pt(i))return i;throw kt("Can't convert object to primitive value");}return void 0===t&&(t="number"),bt(e,t);},Ct=Ie,Vt=function Vt(e){var t=St(e,"string");return Ct(t)?t:t+"";},Tt=re,It=s.document,Et=Tt(It)&&Tt(It.createElement),Pt=function Pt(e){return Et?It.createElement(e):{};},Bt=Pt,Dt=!M&&!l(function(){return 7!=Object.defineProperty(Bt("div"),"a",{get:function get(){return 7;}}).a;}),Mt=M,At=U,zt=R,Ut=F,Rt=ee,Lt=Vt,Nt=et,Ot=Dt,Wt=Object.getOwnPropertyDescriptor;D.f=Mt?Wt:function(e,t){if(e=Rt(e),t=Lt(t),Ot)try{return Wt(e,t);}catch(e){}if(Nt(e,t))return Ut(!At(zt.f,e,t),e[t]);};var Ht=l,Ft=B,jt=/#|\.prototype\./,Yt=function Yt(e,t){var i=qt[Xt(e)];return i==_t||i!=Zt&&(Ft(t)?Ht(t):!!t);},Xt=Yt.normalize=function(e){return String(e).replace(jt,".").toLowerCase();},qt=Yt.data={},Zt=Yt.NATIVE="N",_t=Yt.POLYFILL="P",Gt=Yt,Kt=Ae,$t=u,Qt=T(T.bind),Jt=function Jt(e,t){return Kt(e),void 0===t?e:$t?Qt(e,t):function(){return e.apply(t,arguments);};},ei={},ti=M&&l(function(){return 42!=Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype;}),ii=re,ri=String,ni=TypeError,oi=function oi(e){if(ii(e))return e;throw ni(ri(e)+" is not an object");},ai=M,si=Dt,li=ti,ui=oi,ci=Vt,hi=TypeError,di=Object.defineProperty,fi=Object.getOwnPropertyDescriptor,vi="enumerable",gi="configurable",mi="writable";ei.f=ai?li?function(e,t,i){if(ui(e),t=ci(t),ui(i),"function"==typeof e&&"prototype"===t&&"value"in i&&mi in i&&!i[mi]){var r=fi(e,t);r&&r[mi]&&(e[t]=i.value,i={configurable:gi in i?i[gi]:r[gi],enumerable:vi in i?i[vi]:r[vi],writable:!1});}return di(e,t,i);}:di:function(e,t,i){if(ui(e),t=ci(t),ui(i),si)try{return di(e,t,i);}catch(e){}if("get"in i||"set"in i)throw hi("Accessors not supported");return"value"in i&&(e[t]=i.value),e;};var yi=ei,pi=F,wi=M?function(e,t,i){return yi.f(e,t,pi(1,i));}:function(e,t,i){return e[t]=i,e;},bi=s,ki=v,xi=T,Si=B,Ci=D.f,Vi=Gt,Ti=ne,Ii=Jt,Ei=wi,Pi=et,Bi=function Bi(e){var t=function t(i,r,n){if(this instanceof t){switch(arguments.length){case 0:return new e();case 1:return new e(i);case 2:return new e(i,r);}return new e(i,r,n);}return ki(e,this,arguments);};return t.prototype=e.prototype,t;},Di=function Di(e,t){var i,r,n,o,a,s,l,u,c,h=e.target,d=e.global,f=e.stat,v=e.proto,g=d?bi:f?bi[h]:(bi[h]||{}).prototype,m=d?Ti:Ti[h]||Ei(Ti,h,{})[h],y=m.prototype;for(o in t)r=!(i=Vi(d?o:h+(f?".":"#")+o,e.forced))&&g&&Pi(g,o),s=m[o],r&&(l=e.dontCallGetSet?(c=Ci(g,o))&&c.value:g[o]),a=r&&l?l:t[o],r&&_typeof(s)==_typeof(a)||(u=e.bind&&r?Ii(a,bi):e.wrap&&r?Bi(a):v&&Si(a)?xi(a):a,(e.sham||a&&a.sham||s&&s.sham)&&Ei(u,"sham",!0),Ei(m,o,u),v&&(Pi(Ti,n=h+"Prototype")||Ei(Ti,n,{}),Ei(Ti[n],o,a),e.real&&y&&(i||!y[o])&&Ei(y,o,a)));},Mi=S,Ai=Array.isArray||function(e){return"Array"==Mi(e);},zi=Math.ceil,Ui=Math.floor,Ri=Math.trunc||function(e){var t=+e;return(t>0?Ui:zi)(t);},Li=Ri,Ni=function Ni(e){var t=+e;return t!=t||0===t?0:Li(t);},Oi=Ni,Wi=Math.min,Hi=function Hi(e){return e>0?Wi(Oi(e),9007199254740991):0;},Fi=Hi,ji=function ji(e){return Fi(e.length);},Yi=TypeError,Xi=function Xi(e){if(e>9007199254740991)throw Yi("Maximum allowed index exceeded");return e;},qi=Vt,Zi=ei,_i=F,Gi=function Gi(e,t,i){var r=qi(t);r in e?Zi.f(e,r,_i(0,i)):e[r]=i;},Ki={};Ki[gt("toStringTag")]="z";var $i="[object z]"===String(Ki),Qi=$i,Ji=B,er=S,tr=gt("toStringTag"),ir=Object,rr="Arguments"==er(function(){return arguments;}()),nr=Qi?er:function(e){var t,i,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t];}catch(e){}}(t=ir(e),tr))?i:rr?er(t):"Object"==(r=er(t))&&Ji(t.callee)?"Arguments":r;},or=B,ar=Ze,sr=w(Function.toString);or(ar.inspectSource)||(ar.inspectSource=function(e){return sr(e);});var lr=ar.inspectSource,ur=w,cr=l,hr=B,dr=nr,fr=lr,vr=function vr(){},gr=[],mr=ue("Reflect","construct"),yr=/^\s*(?:class|function)\b/,pr=ur(yr.exec),wr=!yr.exec(vr),br=function br(e){if(!hr(e))return!1;try{return mr(vr,gr,e),!0;}catch(e){return!1;}},kr=function kr(e){if(!hr(e))return!1;switch(dr(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1;}try{return wr||!!pr(yr,fr(e));}catch(e){return!0;}};kr.sham=!0;var xr=!mr||cr(function(){var e;return br(br.call)||!br(Object)||!br(function(){e=!0;})||e;})?kr:br,Sr=Ai,Cr=xr,Vr=re,Tr=gt("species"),Ir=Array,Er=function Er(e){var t;return Sr(e)&&(t=e.constructor,(Cr(t)&&(t===Ir||Sr(t.prototype))||Vr(t)&&null===(t=t[Tr]))&&(t=void 0)),void 0===t?Ir:t;},Pr=function Pr(e,t){return new(Er(e))(0===t?0:t);},Br=l,Dr=pe,Mr=gt("species"),Ar=function Ar(e){return Dr>=51||!Br(function(){var t=[];return(t.constructor={})[Mr]=function(){return{foo:1};},1!==t[e](Boolean).foo;});},zr=Di,Ur=l,Rr=Ai,Lr=re,Nr=$e,Or=ji,Wr=Xi,Hr=Gi,Fr=Pr,jr=Ar,Yr=pe,Xr=gt("isConcatSpreadable"),qr=Yr>=51||!Ur(function(){var e=[];return e[Xr]=!1,e.concat()[0]!==e;}),Zr=jr("concat"),_r=function _r(e){if(!Lr(e))return!1;var t=e[Xr];return void 0!==t?!!t:Rr(e);};zr({target:"Array",proto:!0,arity:1,forced:!qr||!Zr},{concat:function concat(e){var t,i,r,n,o,a=Nr(this),s=Fr(a,0),l=0;for(t=-1,r=arguments.length;t<r;t++)if(_r(o=-1===t?a:arguments[t]))for(n=Or(o),Wr(l+n),i=0;i<n;i++,l++)i in o&&Hr(s,l,o[i]);else Wr(l+1),Hr(s,l++,o);return s.length=l,s;}});var Gr=nr,Kr=String,$r=function $r(e){if("Symbol"===Gr(e))throw TypeError("Cannot convert a Symbol value to a string");return Kr(e);},Qr={},Jr=Ni,en=Math.max,tn=Math.min,rn=function rn(e,t){var i=Jr(e);return i<0?en(i+t,0):tn(i,t);},nn=ee,on=rn,an=ji,sn=function sn(e){return function(t,i,r){var n,o=nn(t),a=an(o),s=on(r,a);if(e&&i!=i){for(;a>s;)if((n=o[s++])!=n)return!0;}else for(;a>s;s++)if((e||s in o)&&o[s]===i)return e||s||0;return!e&&-1;};},ln={includes:sn(!0),indexOf:sn(!1)},un={},cn=et,hn=ee,dn=ln.indexOf,fn=un,vn=w([].push),gn=function gn(e,t){var i,r=hn(e),n=0,o=[];for(i in r)!cn(fn,i)&&cn(r,i)&&vn(o,i);for(;t.length>n;)cn(r,i=t[n++])&&(~dn(o,i)||vn(o,i));return o;},mn=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],yn=gn,pn=mn,wn=Object.keys||function(e){return yn(e,pn);},bn=M,kn=ti,xn=ei,Sn=oi,Cn=ee,Vn=wn;Qr.f=bn&&!kn?Object.defineProperties:function(e,t){Sn(e);for(var i,r=Cn(t),n=Vn(t),o=n.length,a=0;o>a;)xn.f(e,i=n[a++],r[i]);return e;};var Tn,In=ue("document","documentElement"),En=ot,Pn=He("keys"),Bn=function Bn(e){return Pn[e]||(Pn[e]=En(e));},Dn=oi,Mn=Qr,An=mn,zn=un,Un=In,Rn=Pt,Ln="prototype",Nn="script",On=Bn("IE_PROTO"),Wn=function Wn(){},Hn=function Hn(e){return"<"+Nn+">"+e+"</"+Nn+">";},Fn=function Fn(e){e.write(Hn("")),e.close();var t=e.parentWindow.Object;return e=null,t;},_jn=function jn(){try{Tn=new ActiveXObject("htmlfile");}catch(e){}var e,t,i;_jn="undefined"!=typeof document?document.domain&&Tn?Fn(Tn):(t=Rn("iframe"),i="java"+Nn+":",t.style.display="none",Un.appendChild(t),t.src=String(i),(e=t.contentWindow.document).open(),e.write(Hn("document.F=Object")),e.close(),e.F):Fn(Tn);for(var r=An.length;r--;)delete _jn[Ln][An[r]];return _jn();};zn[On]=!0;var Yn=Object.create||function(e,t){var i;return null!==e?(Wn[Ln]=Dn(e),i=new Wn(),Wn[Ln]=null,i[On]=e):i=_jn(),void 0===t?i:Mn.f(i,t);},Xn={},qn=gn,Zn=mn.concat("length","prototype");Xn.f=Object.getOwnPropertyNames||function(e){return qn(e,Zn);};var _n={},Gn=rn,Kn=ji,$n=Gi,Qn=Array,Jn=Math.max,eo=function eo(e,t,i){for(var r=Kn(e),n=Gn(t,r),o=Gn(void 0===i?r:i,r),a=Qn(Jn(o-n,0)),s=0;n<o;n++,s++)$n(a,s,e[n]);return a.length=s,a;},to=S,io=ee,ro=Xn.f,no=eo,oo="object"==(typeof window==="undefined"?"undefined":_typeof(window))&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];_n.f=function(e){return oo&&"Window"==to(e)?function(e){try{return ro(e);}catch(e){return no(oo);}}(e):ro(io(e));};var ao={};ao.f=Object.getOwnPropertySymbols;var so=wi,lo=function lo(e,t,i,r){return r&&r.enumerable?e[t]=i:so(e,t,i),e;},uo={},co=gt;uo.f=co;var ho,fo,vo,go=ne,mo=et,yo=uo,po=ei.f,wo=function wo(e){var t=go.Symbol||(go.Symbol={});mo(t,e)||po(t,e,{value:yo.f(e)});},bo=U,ko=ue,xo=gt,So=lo,Co=function Co(){var e=ko("Symbol"),t=e&&e.prototype,i=t&&t.valueOf,r=xo("toPrimitive");t&&!t[r]&&So(t,r,function(e){return bo(i,this);},{arity:1});},Vo=nr,To=$i?{}.toString:function(){return"[object "+Vo(this)+"]";},Io=$i,Eo=ei.f,Po=wi,Bo=et,Do=To,Mo=gt("toStringTag"),Ao=function Ao(e,t,i,r){if(e){var n=i?e:e.prototype;Bo(n,Mo)||Eo(n,Mo,{configurable:!0,value:t}),r&&!Io&&Po(n,"toString",Do);}},zo=B,Uo=s.WeakMap,Ro=zo(Uo)&&/native code/.test(String(Uo)),Lo=s,No=re,Oo=wi,Wo=et,Ho=Ze,Fo=Bn,jo=un,Yo="Object already initialized",Xo=Lo.TypeError,qo=Lo.WeakMap;if(Ro||Ho.state){var Zo=Ho.state||(Ho.state=new qo());Zo.get=Zo.get,Zo.has=Zo.has,Zo.set=Zo.set,ho=function ho(e,t){if(Zo.has(e))throw Xo(Yo);return t.facade=e,Zo.set(e,t),t;},fo=function fo(e){return Zo.get(e)||{};},vo=function vo(e){return Zo.has(e);};}else{var _o=Fo("state");jo[_o]=!0,ho=function ho(e,t){if(Wo(e,_o))throw Xo(Yo);return t.facade=e,Oo(e,_o,t),t;},fo=function fo(e){return Wo(e,_o)?e[_o]:{};},vo=function vo(e){return Wo(e,_o);};}var Go={set:ho,get:fo,has:vo,enforce:function enforce(e){return vo(e)?fo(e):ho(e,{});},getterFor:function getterFor(e){return function(t){var i;if(!No(t)||(i=fo(t)).type!==e)throw Xo("Incompatible receiver, "+e+" required");return i;};}},Ko=Jt,$o=Z,Qo=$e,Jo=ji,ea=Pr,ta=w([].push),ia=function ia(e){var t=1==e,i=2==e,r=3==e,n=4==e,o=6==e,a=7==e,s=5==e||o;return function(l,u,c,h){for(var d,f,v=Qo(l),g=$o(v),m=Ko(u,c),y=Jo(g),p=0,w=h||ea,b=t?w(l,y):i||a?w(l,0):void 0;y>p;p++)if((s||p in g)&&(f=m(d=g[p],p,v),e))if(t)b[p]=f;else if(f)switch(e){case 3:return!0;case 5:return d;case 6:return p;case 2:ta(b,d);}else switch(e){case 4:return!1;case 7:ta(b,d);}return o?-1:r||n?n:b;};},ra={forEach:ia(0),map:ia(1),filter:ia(2),some:ia(3),every:ia(4),find:ia(5),findIndex:ia(6),filterReject:ia(7)},na=Di,oa=s,aa=U,sa=w,la=M,ua=ke,ca=l,ha=et,da=ce,fa=oi,va=ee,ga=Vt,ma=$r,ya=F,pa=Yn,wa=wn,ba=Xn,ka=_n,xa=ao,Sa=D,Ca=ei,Va=Qr,Ta=R,Ia=lo,Ea=He,Pa=un,Ba=ot,Da=gt,Ma=uo,Aa=wo,za=Co,Ua=Ao,Ra=Go,La=ra.forEach,Na=Bn("hidden"),Oa="Symbol",Wa="prototype",Ha=Ra.set,Fa=Ra.getterFor(Oa),ja=Object[Wa],Ya=oa.Symbol,Xa=Ya&&Ya[Wa],qa=oa.TypeError,Za=oa.QObject,_a=Sa.f,Ga=Ca.f,Ka=ka.f,$a=Ta.f,Qa=sa([].push),Ja=Ea("symbols"),es=Ea("op-symbols"),ts=Ea("wks"),is=!Za||!Za[Wa]||!Za[Wa].findChild,rs=la&&ca(function(){return 7!=pa(Ga({},"a",{get:function get(){return Ga(this,"a",{value:7}).a;}})).a;})?function(e,t,i){var r=_a(ja,t);r&&delete ja[t],Ga(e,t,i),r&&e!==ja&&Ga(ja,t,r);}:Ga,ns=function ns(e,t){var i=Ja[e]=pa(Xa);return Ha(i,{type:Oa,tag:e,description:t}),la||(i.description=t),i;},os=function os(e,t,i){e===ja&&os(es,t,i),fa(e);var r=ga(t);return fa(i),ha(Ja,r)?(i.enumerable?(ha(e,Na)&&e[Na][r]&&(e[Na][r]=!1),i=pa(i,{enumerable:ya(0,!1)})):(ha(e,Na)||Ga(e,Na,ya(1,{})),e[Na][r]=!0),rs(e,r,i)):Ga(e,r,i);},as=function as(e,t){fa(e);var i=va(t),r=wa(i).concat(cs(i));return La(r,function(t){la&&!aa(ss,i,t)||os(e,t,i[t]);}),e;},ss=function ss(e){var t=ga(e),i=aa($a,this,t);return!(this===ja&&ha(Ja,t)&&!ha(es,t))&&(!(i||!ha(this,t)||!ha(Ja,t)||ha(this,Na)&&this[Na][t])||i);},ls=function ls(e,t){var i=va(e),r=ga(t);if(i!==ja||!ha(Ja,r)||ha(es,r)){var n=_a(i,r);return!n||!ha(Ja,r)||ha(i,Na)&&i[Na][r]||(n.enumerable=!0),n;}},us=function us(e){var t=Ka(va(e)),i=[];return La(t,function(e){ha(Ja,e)||ha(Pa,e)||Qa(i,e);}),i;},cs=function cs(e){var t=e===ja,i=Ka(t?es:va(e)),r=[];return La(i,function(e){!ha(Ja,e)||t&&!ha(ja,e)||Qa(r,Ja[e]);}),r;};ua||(Ya=function Ya(){if(da(Xa,this))throw qa("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?ma(arguments[0]):void 0,t=Ba(e),i=function i(e){this===ja&&aa(i,es,e),ha(this,Na)&&ha(this[Na],t)&&(this[Na][t]=!1),rs(this,t,ya(1,e));};return la&&is&&rs(ja,t,{configurable:!0,set:i}),ns(t,e);},Ia(Xa=Ya[Wa],"toString",function(){return Fa(this).tag;}),Ia(Ya,"withoutSetter",function(e){return ns(Ba(e),e);}),Ta.f=ss,Ca.f=os,Va.f=as,Sa.f=ls,ba.f=ka.f=us,xa.f=cs,Ma.f=function(e){return ns(Da(e),e);},la&&Ga(Xa,"description",{configurable:!0,get:function get(){return Fa(this).description;}})),na({global:!0,constructor:!0,wrap:!0,forced:!ua,sham:!ua},{Symbol:Ya}),La(wa(ts),function(e){Aa(e);}),na({target:Oa,stat:!0,forced:!ua},{useSetter:function useSetter(){is=!0;},useSimple:function useSimple(){is=!1;}}),na({target:"Object",stat:!0,forced:!ua,sham:!la},{create:function create(e,t){return void 0===t?pa(e):as(pa(e),t);},defineProperty:os,defineProperties:as,getOwnPropertyDescriptor:ls}),na({target:"Object",stat:!0,forced:!ua},{getOwnPropertyNames:us}),za(),Ua(Ya,Oa),Pa[Na]=!0;var hs=ke&&!!Symbol.for&&!!Symbol.keyFor,ds=Di,fs=ue,vs=et,gs=$r,ms=He,ys=hs,ps=ms("string-to-symbol-registry"),ws=ms("symbol-to-string-registry");ds({target:"Symbol",stat:!0,forced:!ys},{for:function _for(e){var t=gs(e);if(vs(ps,t))return ps[t];var i=fs("Symbol")(t);return ps[t]=i,ws[i]=t,i;}});var bs=Di,ks=et,xs=Ie,Ss=Pe,Cs=hs,Vs=He("symbol-to-string-registry");bs({target:"Symbol",stat:!0,forced:!Cs},{keyFor:function keyFor(e){if(!xs(e))throw TypeError(Ss(e)+" is not a symbol");if(ks(Vs,e))return Vs[e];}});var Ts=w([].slice),Is=Di,Es=ue,Ps=v,Bs=U,Ds=w,Ms=l,As=Ai,zs=B,Us=re,Rs=Ie,Ls=Ts,Ns=ke,Os=Es("JSON","stringify"),Ws=Ds(/./.exec),Hs=Ds("".charAt),Fs=Ds("".charCodeAt),js=Ds("".replace),Ys=Ds(1..toString),Xs=/[\uD800-\uDFFF]/g,qs=/^[\uD800-\uDBFF]$/,Zs=/^[\uDC00-\uDFFF]$/,_s=!Ns||Ms(function(){var e=Es("Symbol")();return"[null]"!=Os([e])||"{}"!=Os({a:e})||"{}"!=Os(Object(e));}),Gs=Ms(function(){return"\"\\udf06\\ud834\""!==Os("\uDF06\uD834")||"\"\\udead\""!==Os("\uDEAD");}),Ks=function Ks(e,t){var i=Ls(arguments),r=t;if((Us(t)||void 0!==e)&&!Rs(e))return As(t)||(t=function t(e,_t2){if(zs(r)&&(_t2=Bs(r,this,e,_t2)),!Rs(_t2))return _t2;}),i[1]=t,Ps(Os,null,i);},$s=function $s(e,t,i){var r=Hs(i,t-1),n=Hs(i,t+1);return Ws(qs,e)&&!Ws(Zs,n)||Ws(Zs,e)&&!Ws(qs,r)?"\\u"+Ys(Fs(e,0),16):e;};Os&&Is({target:"JSON",stat:!0,arity:3,forced:_s||Gs},{stringify:function stringify(e,t,i){var r=Ls(arguments),n=Ps(_s?Ks:Os,null,r);return Gs&&"string"==typeof n?js(n,Xs,$s):n;}});var Qs=ao,Js=$e;Di({target:"Object",stat:!0,forced:!ke||l(function(){Qs.f(1);})},{getOwnPropertySymbols:function getOwnPropertySymbols(e){var t=Qs.f;return t?t(Js(e)):[];}}),wo("asyncIterator"),wo("hasInstance"),wo("isConcatSpreadable"),wo("iterator"),wo("match"),wo("matchAll"),wo("replace"),wo("search"),wo("species"),wo("split");var el=Co;wo("toPrimitive"),el();var tl=ue,il=Ao;wo("toStringTag"),il(tl("Symbol"),"Symbol"),wo("unscopables"),Ao(s.JSON,"JSON",!0);var rl,nl,ol,al=ne.Symbol,sl={},ll=M,ul=et,cl=Function.prototype,hl=ll&&Object.getOwnPropertyDescriptor,dl=ul(cl,"name"),fl={EXISTS:dl,PROPER:dl&&"something"===function(){}.name,CONFIGURABLE:dl&&(!ll||ll&&hl(cl,"name").configurable)},vl=!l(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e())!==e.prototype;}),gl=et,ml=B,yl=$e,pl=vl,wl=Bn("IE_PROTO"),bl=Object,kl=bl.prototype,xl=pl?bl.getPrototypeOf:function(e){var t=yl(e);if(gl(t,wl))return t[wl];var i=t.constructor;return ml(i)&&t instanceof i?i.prototype:t instanceof bl?kl:null;},Sl=l,Cl=B,Vl=re,Tl=Yn,Il=xl,El=lo,Pl=gt("iterator"),Bl=!1;[].keys&&("next"in(ol=[].keys())?(nl=Il(Il(ol)))!==Object.prototype&&(rl=nl):Bl=!0);var Dl=!Vl(rl)||Sl(function(){var e={};return rl[Pl].call(e)!==e;});Cl((rl=Dl?{}:Tl(rl))[Pl])||El(rl,Pl,function(){return this;});var Ml={IteratorPrototype:rl,BUGGY_SAFARI_ITERATORS:Bl},Al=Ml.IteratorPrototype,zl=Yn,Ul=F,Rl=Ao,Ll=sl,Nl=function Nl(){return this;},Ol=function Ol(e,t,i,r){var n=t+" Iterator";return e.prototype=zl(Al,{next:Ul(+!r,i)}),Rl(e,n,!1,!0),Ll[n]=Nl,e;},Wl=B,Hl=String,Fl=TypeError,jl=w,Yl=oi,Xl=function Xl(e){if("object"==_typeof(e)||Wl(e))return e;throw Fl("Can't set "+Hl(e)+" as a prototype");},ql=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,i={};try{(e=jl(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(i,[]),t=i instanceof Array;}catch(e){}return function(i,r){return Yl(i),Xl(r),t?e(i,r):i.__proto__=r,i;};}():void 0),Zl=Di,_l=U,Gl=fl,Kl=Ol,$l=xl,Ql=Ao,Jl=lo,eu=sl,tu=Ml,iu=Gl.PROPER,ru=tu.BUGGY_SAFARI_ITERATORS,nu=gt("iterator"),ou="keys",au="values",su="entries",lu=function lu(){return this;},uu=function uu(e,t,i,r,n,o,a){Kl(i,t,r);var s,l,u,c=function c(e){if(e===n&&g)return g;if(!ru&&e in f)return f[e];switch(e){case ou:case au:case su:return function(){return new i(this,e);};}return function(){return new i(this);};},h=t+" Iterator",d=!1,f=e.prototype,v=f[nu]||f["@@iterator"]||n&&f[n],g=!ru&&v||c(n),m="Array"==t&&f.entries||v;if(m&&(s=$l(m.call(new e())))!==Object.prototype&&s.next&&(Ql(s,h,!0,!0),eu[h]=lu),iu&&n==au&&v&&v.name!==au&&(d=!0,g=function g(){return _l(v,this);}),n)if(l={values:c(au),keys:o?g:c(ou),entries:c(su)},a)for(u in l)(ru||d||!(u in f))&&Jl(f,u,l[u]);else Zl({target:t,proto:!0,forced:ru||d},l);return a&&f[nu]!==g&&Jl(f,nu,g,{name:n}),eu[t]=g,l;},cu=function cu(e,t){return{value:e,done:t};},hu=ee,du=function du(){},fu=sl,vu=Go,gu=(ei.f,uu),mu=cu,yu="Array Iterator",pu=vu.set,wu=vu.getterFor(yu);gu(Array,"Array",function(e,t){pu(this,{type:yu,target:hu(e),index:0,kind:t});},function(){var e=wu(this),t=e.target,i=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,mu(void 0,!0)):mu("keys"==i?r:"values"==i?t[r]:[r,t[r]],!1);},"values");fu.Arguments=fu.Array;du(),du(),du();var bu={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},ku=s,xu=nr,Su=wi,Cu=sl,Vu=gt("toStringTag");for(var Tu in bu){var Iu=ku[Tu],Eu=Iu&&Iu.prototype;Eu&&xu(Eu)!==Vu&&Su(Eu,Vu,Tu),Cu[Tu]=Cu.Array;}var Pu=al;wo("dispose");var Bu=Pu;wo("asyncDispose"),wo("matcher"),wo("metadataKey"),wo("observable"),wo("metadata"),wo("patternMatch"),wo("replaceAll");var Du=Bu;o.exports=Du,function(e){e.exports=n;}(r);var Mu=t(i),Au={},zu={get exports(){return Au;},set exports(e){Au=e;}},Uu={},Ru={get exports(){return Uu;},set exports(e){Uu=e;}},Lu=w,Nu=Ni,Ou=$r,Wu=$,Hu=Lu("".charAt),Fu=Lu("".charCodeAt),ju=Lu("".slice),Yu=function Yu(e){return function(t,i){var r,n,o=Ou(Wu(t)),a=Nu(i),s=o.length;return a<0||a>=s?e?"":void 0:(r=Fu(o,a))<55296||r>56319||a+1===s||(n=Fu(o,a+1))<56320||n>57343?e?Hu(o,a):r:e?ju(o,a,a+2):n-56320+(r-55296<<10)+65536;};},Xu={codeAt:Yu(!1),charAt:Yu(!0)},qu=Xu.charAt,Zu=$r,_u=Go,Gu=uu,Ku=cu,$u="String Iterator",Qu=_u.set,Ju=_u.getterFor($u);Gu(String,"String",function(e){Qu(this,{type:$u,string:Zu(e),index:0});},function(){var e,t=Ju(this),i=t.string,r=t.index;return r>=i.length?Ku(void 0,!0):(e=qu(i,r),t.index+=e.length,Ku(e,!1));});var ec=uo.f("iterator");!function(e){e.exports=ec;}(Ru),function(e){e.exports=Uu;}(zu);var tc=t(Au);function ic(e){return ic="function"==typeof Mu&&"symbol"==_typeof(tc)?function(e){return _typeof(e);}:function(e){return e&&"function"==typeof Mu&&e.constructor===Mu&&e!==Mu.prototype?"symbol":_typeof(e);},ic(e);}function rc(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e;}function nc(e,t){if(t&&("object"===ic(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return rc(e);}var oc={},ac={get exports(){return oc;},set exports(e){oc=e;}},sc={},lc={get exports(){return sc;},set exports(e){sc=e;}};Di({target:"Array",stat:!0},{isArray:Ai});var uc=ne.Array.isArray,cc=uc;!function(e){e.exports=cc;}(lc),function(e){e.exports=sc;}(ac);var hc=t(oc);function dc(e){if(hc(e))return e;}var fc={},vc={get exports(){return fc;},set exports(e){fc=e;}},gc={},mc={get exports(){return gc;},set exports(e){gc=e;}},yc=nr,pc=Re,wc=_,bc=sl,kc=gt("iterator"),xc=function xc(e){if(!wc(e))return pc(e,kc)||pc(e,"@@iterator")||bc[yc(e)];},Sc=xc;!function(e){e.exports=Sc;}(mc),function(e){e.exports=gc;}(vc);var Cc=t(fc),Vc={},Tc={get exports(){return Vc;},set exports(e){Vc=e;}},Ic={},Ec={get exports(){return Ic;},set exports(e){Ic=e;}},Pc=U,Bc=oi,Dc=Re,Mc=function Mc(e,t,i){var r,n;Bc(e);try{if(!(r=Dc(e,"return"))){if("throw"===t)throw i;return i;}r=Pc(r,e);}catch(e){n=!0,r=e;}if("throw"===t)throw i;if(n)throw r;return Bc(r),i;},Ac=oi,zc=Mc,Uc=sl,Rc=gt("iterator"),Lc=Array.prototype,Nc=function Nc(e){return void 0!==e&&(Uc.Array===e||Lc[Rc]===e);},Oc=U,Wc=Ae,Hc=oi,Fc=Pe,jc=xc,Yc=TypeError,Xc=function Xc(e,t){var i=arguments.length<2?jc(e):t;if(Wc(i))return Hc(Oc(i,e));throw Yc(Fc(e)+" is not iterable");},qc=Jt,Zc=U,_c=$e,Gc=function Gc(e,t,i,r){try{return r?t(Ac(i)[0],i[1]):t(i);}catch(t){zc(e,"throw",t);}},Kc=Nc,$c=xr,Qc=ji,Jc=Gi,eh=Xc,th=xc,ih=Array,rh=function rh(e){var t=_c(e),i=$c(this),r=arguments.length,n=r>1?arguments[1]:void 0,o=void 0!==n;o&&(n=qc(n,r>2?arguments[2]:void 0));var a,s,l,u,c,h,d=th(t),f=0;if(!d||this===ih&&Kc(d))for(a=Qc(t),s=i?new this(a):ih(a);a>f;f++)h=o?n(t[f],f):t[f],Jc(s,f,h);else for(c=(u=eh(t,d)).next,s=i?new this():[];!(l=Zc(c,u)).done;f++)h=o?Gc(u,n,[l.value,f],!0):l.value,Jc(s,f,h);return s.length=f,s;},nh=gt("iterator"),oh=!1;try{var ah=0,sh={next:function next(){return{done:!!ah++};},return:function _return(){oh=!0;}};sh[nh]=function(){return this;},Array.from(sh,function(){throw 2;});}catch(e){}var lh=function lh(e,t){if(!t&&!oh)return!1;var i=!1;try{var r={};r[nh]=function(){return{next:function next(){return{done:i=!0};}};},e(r);}catch(e){}return i;},uh=rh;Di({target:"Array",stat:!0,forced:!lh(function(e){Array.from(e);})},{from:uh});var ch=ne.Array.from,hh=ch;!function(e){e.exports=hh;}(Ec),function(e){e.exports=Ic;}(Tc);var dh=t(Vc);function fh(e){if(void 0!==Mu&&null!=Cc(e)||null!=e["@@iterator"])return dh(e);}var vh={},gh={get exports(){return vh;},set exports(e){vh=e;}},mh={},yh={get exports(){return mh;},set exports(e){mh=e;}},ph=Di,wh=Ai,bh=xr,kh=re,xh=rn,Sh=ji,Ch=ee,Vh=Gi,Th=gt,Ih=Ts,Eh=Ar("slice"),Ph=Th("species"),Bh=Array,Dh=Math.max;ph({target:"Array",proto:!0,forced:!Eh},{slice:function slice(e,t){var i,r,n,o=Ch(this),a=Sh(o),s=xh(e,a),l=xh(void 0===t?a:t,a);if(wh(o)&&(i=o.constructor,(bh(i)&&(i===Bh||wh(i.prototype))||kh(i)&&null===(i=i[Ph]))&&(i=void 0),i===Bh||void 0===i))return Ih(o,s,l);for(r=new(void 0===i?Bh:i)(Dh(l-s,0)),n=0;s<l;s++,n++)s in o&&Vh(r,n,o[s]);return r.length=n,r;}});var Mh=ne,Ah=function Ah(e){return Mh[e+"Prototype"];},zh=Ah("Array").slice,Uh=ce,Rh=zh,Lh=Array.prototype,Nh=function Nh(e){var t=e.slice;return e===Lh||Uh(Lh,e)&&t===Lh.slice?Rh:t;},Oh=Nh,Wh=Oh;!function(e){e.exports=Wh;}(yh),function(e){e.exports=mh;}(gh);var Hh=t(vh);function Fh(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r;}function jh(e,t){var i;if(e){if("string"==typeof e)return Fh(e,t);var r=Hh(i=Object.prototype.toString.call(e)).call(i,8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?dh(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Fh(e,t):void 0;}}function Yh(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var Xh={},qh={get exports(){return Xh;},set exports(e){Xh=e;}},Zh={},_h={get exports(){return Zh;},set exports(e){Zh=e;}},Gh=ne.Object.getOwnPropertySymbols;!function(e){e.exports=Gh;}(_h),function(e){e.exports=Zh;}(qh);var Kh=t(Xh),$h={},Qh={get exports(){return $h;},set exports(e){$h=e;}},Jh={},ed={get exports(){return Jh;},set exports(e){Jh=e;}},td=l,id=function id(e,t){var i=[][e];return!!i&&td(function(){i.call(null,t||function(){return 1;},1);});},rd=Di,nd=ln.indexOf,od=id,ad=T([].indexOf),sd=!!ad&&1/ad([1],1,-0)<0,ld=od("indexOf");rd({target:"Array",proto:!0,forced:sd||!ld},{indexOf:function indexOf(e){var t=arguments.length>1?arguments[1]:void 0;return sd?ad(this,e,t)||0:nd(this,e,t);}});var ud=Ah("Array").indexOf,cd=ce,hd=ud,dd=Array.prototype,fd=function fd(e){var t=e.indexOf;return e===dd||cd(dd,e)&&t===dd.indexOf?hd:t;},vd=fd,gd=vd;!function(e){e.exports=gd;}(ed),function(e){e.exports=Jh;}(Qh);var md=t($h),yd={},pd={get exports(){return yd;},set exports(e){yd=e;}},wd={},bd={get exports(){return wd;},set exports(e){wd=e;}},kd=$e,xd=wn;Di({target:"Object",stat:!0,forced:l(function(){xd(1);})},{keys:function keys(e){return xd(kd(e));}});var Sd=ne.Object.keys,Cd=Sd;!function(e){e.exports=Cd;}(bd),function(e){e.exports=wd;}(pd);var Vd=t(yd);function Td(e,t){if(null==e)return{};var i,r,n=function(e,t){if(null==e)return{};var i,r,n={},o=Vd(e);for(r=0;r<o.length;r++)i=o[r],md(t).call(t,i)>=0||(n[i]=e[i]);return n;}(e,t);if(Kh){var o=Kh(e);for(r=0;r<o.length;r++)i=o[r],md(t).call(t,i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i]);}return n;}var Id={},Ed={get exports(){return Id;},set exports(e){Id=e;}},Pd={},Bd={get exports(){return Pd;},set exports(e){Pd=e;}},Dd=w,Md=Ae,Ad=re,zd=et,Ud=Ts,Rd=u,Ld=Function,Nd=Dd([].concat),Od=Dd([].join),Wd={},Hd=function Hd(e,t,i){if(!zd(Wd,t)){for(var r=[],n=0;n<t;n++)r[n]="a["+n+"]";Wd[t]=Ld("C,a","return new C("+Od(r,",")+")");}return Wd[t](e,i);},Fd=Rd?Ld.bind:function(e){var t=Md(this),i=t.prototype,r=Ud(arguments,1),n=function n(){var i=Nd(r,Ud(arguments));return this instanceof n?Hd(t,i.length,i):t.apply(e,i);};return Ad(i)&&(n.prototype=i),n;},jd=Fd;Di({target:"Function",proto:!0,forced:Function.bind!==jd},{bind:jd});var Yd=Ah("Function").bind,Xd=ce,qd=Yd,Zd=Function.prototype,_d=function _d(e){var t=e.bind;return e===Zd||Xd(Zd,e)&&t===Zd.bind?qd:t;},Gd=_d,Kd=Gd;!function(e){e.exports=Kd;}(Bd),function(e){e.exports=Pd;}(Ed);var $d=t(Id),Qd={},Jd={get exports(){return Qd;},set exports(e){Qd=e;}},ef={},tf={get exports(){return ef;},set exports(e){ef=e;}},rf=xr,nf=Pe,of=TypeError,af=function af(e){if(rf(e))return e;throw of(nf(e)+" is not a constructor");},sf=Di,lf=v,uf=Fd,cf=af,hf=oi,df=re,ff=Yn,vf=l,gf=ue("Reflect","construct"),mf=Object.prototype,yf=[].push,pf=vf(function(){function e(){}return!(gf(function(){},[],e)instanceof e);}),wf=!vf(function(){gf(function(){});}),bf=pf||wf;sf({target:"Reflect",stat:!0,forced:bf,sham:bf},{construct:function construct(e,t){cf(e),hf(t);var i=arguments.length<3?e:cf(arguments[2]);if(wf&&!pf)return gf(e,t,i);if(e==i){switch(t.length){case 0:return new e();case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);}var r=[null];return lf(yf,r,t),new(lf(uf,e,r))();}var n=i.prototype,o=ff(df(n)?n:mf),a=lf(e,o,t);return df(a)?a:o;}});var kf=ne.Reflect.construct;!function(e){e.exports=kf;}(tf),function(e){e.exports=ef;}(Jd);var xf=t(Qd),Sf={},Cf={get exports(){return Sf;},set exports(e){Sf=e;}},Vf={},Tf={get exports(){return Vf;},set exports(e){Vf=e;}};Di({target:"Object",stat:!0},{setPrototypeOf:ql});var If=ne.Object.setPrototypeOf;!function(e){e.exports=If;}(Tf),function(e){e.exports=Vf;}(Cf);var Ef=t(Sf);function Pf(e,t){var i;return Pf=Ef?$d(i=Ef).call(i):function(e,t){return e.__proto__=t,e;},Pf(e,t);}function Bf(){if("undefined"==typeof Reflect||!xf)return!1;if(xf.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(xf(Boolean,[],function(){})),!0;}catch(e){return!1;}}function Df(e,t,i){var r;Bf()?Df=$d(r=xf).call(r):Df=function Df(e,t,i){var r=[null];r.push.apply(r,t);var n=new($d(Function).apply(e,r))();return i&&Pf(n,i.prototype),n;};return Df.apply(null,arguments);}var Mf={},Af={get exports(){return Mf;},set exports(e){Mf=e;}},zf={},Uf={get exports(){return zf;},set exports(e){zf=e;}},Rf={},Lf={get exports(){return Rf;},set exports(e){Rf=e;}},Nf=Di,Of=M,Wf=ei.f;Nf({target:"Object",stat:!0,forced:Object.defineProperty!==Wf,sham:!Of},{defineProperty:Wf});var Hf=ne.Object,Ff=Lf.exports=function(e,t,i){return Hf.defineProperty(e,t,i);};Hf.defineProperty.sham&&(Ff.sham=!0);var jf=Rf,Yf=jf;!function(e){e.exports=Yf;}(Uf),function(e){e.exports=zf;}(Af);var Xf=t(Mf),qf={},Zf={get exports(){return qf;},set exports(e){qf=e;}},_f={},Gf={get exports(){return _f;},set exports(e){_f=e;}};Di({target:"Object",stat:!0,sham:!M},{create:Yn});var Kf=ne.Object,$f=function $f(e,t){return Kf.create(e,t);},Qf=$f;!function(e){e.exports=Qf;}(Gf),function(e){e.exports=_f;}(Zf);var Jf=t(qf),ev={},tv={get exports(){return ev;},set exports(e){ev=e;}},iv={},rv={get exports(){return iv;},set exports(e){iv=e;}},nv=$e,ov=xl,av=vl;Di({target:"Object",stat:!0,forced:l(function(){ov(1);}),sham:!av},{getPrototypeOf:function getPrototypeOf(e){return ov(nv(e));}});var sv=ne.Object.getPrototypeOf;!function(e){e.exports=sv;}(rv),function(e){e.exports=iv;}(tv);var lv=t(ev),uv={},cv={get exports(){return uv;},set exports(e){uv=e;}},hv={},dv={get exports(){return hv;},set exports(e){hv=e;}},fv=ra.forEach,vv=id("forEach")?[].forEach:function(e){return fv(this,e,arguments.length>1?arguments[1]:void 0);};Di({target:"Array",proto:!0,forced:[].forEach!=vv},{forEach:vv});var gv=Ah("Array").forEach,mv=nr,yv=et,pv=ce,wv=gv,bv=Array.prototype,kv={DOMTokenList:!0,NodeList:!0},xv=function xv(e){var t=e.forEach;return e===bv||pv(bv,e)&&t===bv.forEach||yv(kv,mv(e))?wv:t;},Sv=xv;!function(e){e.exports=Sv;}(dv),function(e){e.exports=hv;}(cv);var Cv=t(uv),Vv={},Tv={get exports(){return Vv;},set exports(e){Vv=e;}},Iv={},Ev={get exports(){return Iv;},set exports(e){Iv=e;}},Pv=ue,Bv=Xn,Dv=ao,Mv=oi,Av=w([].concat),zv=Pv("Reflect","ownKeys")||function(e){var t=Bv.f(Mv(e)),i=Dv.f;return i?Av(t,i(e)):t;},Uv=et,Rv=zv,Lv=D,Nv=ei,Ov=Error,Wv=w("".replace),Hv=String(Ov("zxcasd").stack),Fv=/\n\s*at [^:]*:[^\n]*/,jv=Fv.test(Hv),Yv=re,Xv=wi,qv=Jt,Zv=U,_v=oi,Gv=Pe,Kv=Nc,$v=ji,Qv=ce,Jv=Xc,eg=xc,tg=Mc,ig=TypeError,rg=function rg(e,t){this.stopped=e,this.result=t;},ng=rg.prototype,og=function og(e,t,i){var r,n,o,a,s,l,u,c=i&&i.that,h=!(!i||!i.AS_ENTRIES),d=!(!i||!i.IS_RECORD),f=!(!i||!i.IS_ITERATOR),v=!(!i||!i.INTERRUPTED),g=qv(t,c),m=function m(e){return r&&tg(r,"normal",e),new rg(!0,e);},y=function y(e){return h?(_v(e),v?g(e[0],e[1],m):g(e[0],e[1])):v?g(e,m):g(e);};if(d)r=e.iterator;else if(f)r=e;else{if(!(n=eg(e)))throw ig(Gv(e)+" is not iterable");if(Kv(n)){for(o=0,a=$v(e);a>o;o++)if((s=y(e[o]))&&Qv(ng,s))return s;return new rg(!1);}r=Jv(e,n);}for(l=d?e.next:r.next;!(u=Zv(l,r)).done;){try{s=y(u.value);}catch(e){tg(r,"throw",e);}if("object"==_typeof(s)&&s&&Qv(ng,s))return s;}return new rg(!1);},ag=$r,sg=F,lg=!l(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",sg(1,7)),7!==e.stack);}),ug=Di,cg=ce,hg=xl,dg=ql,fg=function fg(e,t,i){for(var r=Rv(t),n=Nv.f,o=Lv.f,a=0;a<r.length;a++){var s=r[a];Uv(e,s)||i&&Uv(i,s)||n(e,s,o(t,s));}},vg=Yn,gg=wi,mg=F,yg=function yg(e,t){if(jv&&"string"==typeof e&&!Ov.prepareStackTrace)for(;t--;)e=Wv(e,Fv,"");return e;},pg=function pg(e,t){Yv(t)&&"cause"in t&&Xv(e,"cause",t.cause);},wg=og,bg=function bg(e,t){return void 0===e?arguments.length<2?"":t:ag(e);},kg=lg,xg=gt("toStringTag"),Sg=Error,Cg=[].push,Vg=function Vg(e,t){var i,r=arguments.length>2?arguments[2]:void 0,n=cg(Tg,this);dg?i=dg(Sg(),n?hg(this):Tg):(i=n?this:vg(Tg),gg(i,xg,"Error")),void 0!==t&&gg(i,"message",bg(t)),kg&&gg(i,"stack",yg(i.stack,1)),pg(i,r);var o=[];return wg(e,Cg,{that:o}),gg(i,"errors",o),i;};dg?dg(Vg,Sg):fg(Vg,Sg,{name:!0});var Tg=Vg.prototype=vg(Sg.prototype,{constructor:mg(1,Vg),message:mg(1,""),name:mg(1,"AggregateError")});ug({global:!0,constructor:!0,arity:2},{AggregateError:Vg});var Ig,Eg,Pg,Bg,Dg="process"==S(s.process),Mg=ue,Ag=ei,zg=M,Ug=gt("species"),Rg=function Rg(e){var t=Mg(e),i=Ag.f;zg&&t&&!t[Ug]&&i(t,Ug,{configurable:!0,get:function get(){return this;}});},Lg=ce,Ng=TypeError,Og=function Og(e,t){if(Lg(t,e))return e;throw Ng("Incorrect invocation");},Wg=oi,Hg=af,Fg=_,jg=gt("species"),Yg=function Yg(e,t){var i,r=Wg(e).constructor;return void 0===r||Fg(i=Wg(r)[jg])?t:Hg(i);},Xg=TypeError,qg=function qg(e,t){if(e<t)throw Xg("Not enough arguments");return e;},Zg=/(?:ipad|iphone|ipod).*applewebkit/i.test(he),_g=s,Gg=v,Kg=Jt,$g=B,Qg=et,Jg=l,em=In,tm=Ts,im=Pt,rm=qg,nm=Zg,om=Dg,am=_g.setImmediate,sm=_g.clearImmediate,lm=_g.process,um=_g.Dispatch,cm=_g.Function,hm=_g.MessageChannel,dm=_g.String,fm=0,vm={},gm="onreadystatechange";try{Ig=_g.location;}catch(e){}var mm=function mm(e){if(Qg(vm,e)){var t=vm[e];delete vm[e],t();}},ym=function ym(e){return function(){mm(e);};},pm=function pm(e){mm(e.data);},wm=function wm(e){_g.postMessage(dm(e),Ig.protocol+"//"+Ig.host);};am&&sm||(am=function am(e){rm(arguments.length,1);var t=$g(e)?e:cm(e),i=tm(arguments,1);return vm[++fm]=function(){Gg(t,void 0,i);},Eg(fm),fm;},sm=function sm(e){delete vm[e];},om?Eg=function Eg(e){lm.nextTick(ym(e));}:um&&um.now?Eg=function Eg(e){um.now(ym(e));}:hm&&!nm?(Bg=(Pg=new hm()).port2,Pg.port1.onmessage=pm,Eg=Kg(Bg.postMessage,Bg)):_g.addEventListener&&$g(_g.postMessage)&&!_g.importScripts&&Ig&&"file:"!==Ig.protocol&&!Jg(wm)?(Eg=wm,_g.addEventListener("message",pm,!1)):Eg=gm in im("script")?function(e){em.appendChild(im("script"))[gm]=function(){em.removeChild(this),mm(e);};}:function(e){setTimeout(ym(e),0);});var bm,km,xm,Sm,Cm,Vm,Tm,Im,Em={set:am,clear:sm},Pm=s,Bm=/ipad|iphone|ipod/i.test(he)&&void 0!==Pm.Pebble,Dm=/web0s(?!.*chrome)/i.test(he),Mm=s,Am=Jt,zm=D.f,Um=Em.set,Rm=Zg,Lm=Bm,Nm=Dm,Om=Dg,Wm=Mm.MutationObserver||Mm.WebKitMutationObserver,Hm=Mm.document,Fm=Mm.process,jm=Mm.Promise,Ym=zm(Mm,"queueMicrotask"),Xm=Ym&&Ym.value;Xm||(bm=function bm(){var e,t;for(Om&&(e=Fm.domain)&&e.exit();km;){t=km.fn,km=km.next;try{t();}catch(e){throw km?Sm():xm=void 0,e;}}xm=void 0,e&&e.enter();},Rm||Om||Nm||!Wm||!Hm?!Lm&&jm&&jm.resolve?((Tm=jm.resolve(void 0)).constructor=jm,Im=Am(Tm.then,Tm),Sm=function Sm(){Im(bm);}):Om?Sm=function Sm(){Fm.nextTick(bm);}:(Um=Am(Um,Mm),Sm=function Sm(){Um(bm);}):(Cm=!0,Vm=Hm.createTextNode(""),new Wm(bm).observe(Vm,{characterData:!0}),Sm=function Sm(){Vm.data=Cm=!Cm;}));var qm=Xm||function(e){var t={fn:e,next:void 0};xm&&(xm.next=t),km||(km=t,Sm()),xm=t;},Zm=s,_m=function _m(e){try{return{error:!1,value:e()};}catch(e){return{error:!0,value:e};}},Gm=function Gm(){this.head=null,this.tail=null;};Gm.prototype={add:function add(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t;},get:function get(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item;}};var Km=Gm,$m=s.Promise,Qm="object"==(typeof Deno==="undefined"?"undefined":_typeof(Deno))&&Deno&&"object"==_typeof(Deno.version),Jm=!Qm&&!Dg&&"object"==(typeof window==="undefined"?"undefined":_typeof(window))&&"object"==(typeof document==="undefined"?"undefined":_typeof(document)),ey=s,ty=$m,iy=B,ry=Gt,ny=lr,oy=gt,ay=Jm,sy=Qm,ly=pe,uy=ty&&ty.prototype,cy=oy("species"),hy=!1,dy=iy(ey.PromiseRejectionEvent),fy=ry("Promise",function(){var e=ny(ty),t=e!==String(ty);if(!t&&66===ly)return!0;if(!uy.catch||!uy.finally)return!0;if(!ly||ly<51||!/native code/.test(e)){var i=new ty(function(e){e(1);}),r=function r(e){e(function(){},function(){});};if((i.constructor={})[cy]=r,!(hy=i.then(function(){})instanceof r))return!0;}return!t&&(ay||sy)&&!dy;}),vy={CONSTRUCTOR:fy,REJECTION_EVENT:dy,SUBCLASSING:hy},gy={},my=Ae,yy=TypeError,py=function py(e){var t,i;this.promise=new e(function(e,r){if(void 0!==t||void 0!==i)throw yy("Bad Promise constructor");t=e,i=r;}),this.resolve=my(t),this.reject=my(i);};gy.f=function(e){return new py(e);};var wy,by,ky=Di,xy=Dg,Sy=s,Cy=U,Vy=lo,Ty=Ao,Iy=Rg,Ey=Ae,Py=B,By=re,Dy=Og,My=Yg,Ay=Em.set,zy=qm,Uy=function Uy(e,t){var i=Zm.console;i&&i.error&&(1==arguments.length?i.error(e):i.error(e,t));},Ry=_m,Ly=Km,Ny=Go,Oy=$m,Wy=vy,Hy=gy,Fy="Promise",jy=Wy.CONSTRUCTOR,Yy=Wy.REJECTION_EVENT,Xy=Ny.getterFor(Fy),qy=Ny.set,Zy=Oy&&Oy.prototype,_y=Oy,Gy=Zy,Ky=Sy.TypeError,$y=Sy.document,Qy=Sy.process,Jy=Hy.f,ep=Jy,tp=!!($y&&$y.createEvent&&Sy.dispatchEvent),ip="unhandledrejection",rp=function rp(e){var t;return!(!By(e)||!Py(t=e.then))&&t;},np=function np(e,t){var i,r,n,o=t.value,a=1==t.state,s=a?e.ok:e.fail,l=e.resolve,u=e.reject,c=e.domain;try{s?(a||(2===t.rejection&&up(t),t.rejection=1),!0===s?i=o:(c&&c.enter(),i=s(o),c&&(c.exit(),n=!0)),i===e.promise?u(Ky("Promise-chain cycle")):(r=rp(i))?Cy(r,i,l,u):l(i)):u(o);}catch(e){c&&!n&&c.exit(),u(e);}},op=function op(e,t){e.notified||(e.notified=!0,zy(function(){for(var i,r=e.reactions;i=r.get();)np(i,e);e.notified=!1,t&&!e.rejection&&sp(e);}));},ap=function ap(e,t,i){var r,n;tp?((r=$y.createEvent("Event")).promise=t,r.reason=i,r.initEvent(e,!1,!0),Sy.dispatchEvent(r)):r={promise:t,reason:i},!Yy&&(n=Sy["on"+e])?n(r):e===ip&&Uy("Unhandled promise rejection",i);},sp=function sp(e){Cy(Ay,Sy,function(){var t,i=e.facade,r=e.value;if(lp(e)&&(t=Ry(function(){xy?Qy.emit("unhandledRejection",r,i):ap(ip,i,r);}),e.rejection=xy||lp(e)?2:1,t.error))throw t.value;});},lp=function lp(e){return 1!==e.rejection&&!e.parent;},up=function up(e){Cy(Ay,Sy,function(){var t=e.facade;xy?Qy.emit("rejectionHandled",t):ap("rejectionhandled",t,e.value);});},cp=function cp(e,t,i){return function(r){e(t,r,i);};},hp=function hp(e,t,i){e.done||(e.done=!0,i&&(e=i),e.value=t,e.state=2,op(e,!0));},dp=function dp(e,t,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===t)throw Ky("Promise can't be resolved itself");var r=rp(t);r?zy(function(){var i={done:!1};try{Cy(r,t,cp(dp,i,e),cp(hp,i,e));}catch(t){hp(i,t,e);}}):(e.value=t,e.state=1,op(e,!1));}catch(t){hp({done:!1},t,e);}}};jy&&(Gy=(_y=function _y(e){Dy(this,Gy),Ey(e),Cy(wy,this);var t=Xy(this);try{e(cp(dp,t),cp(hp,t));}catch(e){hp(t,e);}}).prototype,(wy=function wy(e){qy(this,{type:Fy,done:!1,notified:!1,parent:!1,reactions:new Ly(),rejection:!1,state:0,value:void 0});}).prototype=Vy(Gy,"then",function(e,t){var i=Xy(this),r=Jy(My(this,_y));return i.parent=!0,r.ok=!Py(e)||e,r.fail=Py(t)&&t,r.domain=xy?Qy.domain:void 0,0==i.state?i.reactions.add(r):zy(function(){np(r,i);}),r.promise;}),by=function by(){var e=new wy(),t=Xy(e);this.promise=e,this.resolve=cp(dp,t),this.reject=cp(hp,t);},Hy.f=Jy=function Jy(e){return e===_y||undefined===e?new by(e):ep(e);}),ky({global:!0,constructor:!0,wrap:!0,forced:jy},{Promise:_y}),Ty(_y,Fy,!1,!0),Iy(Fy);var fp=$m,vp=vy.CONSTRUCTOR||!lh(function(e){fp.all(e).then(void 0,function(){});}),gp=U,mp=Ae,yp=gy,pp=_m,wp=og;Di({target:"Promise",stat:!0,forced:vp},{all:function all(e){var t=this,i=yp.f(t),r=i.resolve,n=i.reject,o=pp(function(){var i=mp(t.resolve),o=[],a=0,s=1;wp(e,function(e){var l=a++,u=!1;s++,gp(i,t,e).then(function(e){u||(u=!0,o[l]=e,--s||r(o));},n);}),--s||r(o);});return o.error&&n(o.value),i.promise;}});var bp=Di,kp=vy.CONSTRUCTOR;$m&&$m.prototype,bp({target:"Promise",proto:!0,forced:kp,real:!0},{catch:function _catch(e){return this.then(void 0,e);}});var xp=U,Sp=Ae,Cp=gy,Vp=_m,Tp=og;Di({target:"Promise",stat:!0,forced:vp},{race:function race(e){var t=this,i=Cp.f(t),r=i.reject,n=Vp(function(){var n=Sp(t.resolve);Tp(e,function(e){xp(n,t,e).then(i.resolve,r);});});return n.error&&r(n.value),i.promise;}});var Ip=U,Ep=gy;Di({target:"Promise",stat:!0,forced:vy.CONSTRUCTOR},{reject:function reject(e){var t=Ep.f(this);return Ip(t.reject,void 0,e),t.promise;}});var Pp=oi,Bp=re,Dp=gy,Mp=function Mp(e,t){if(Pp(e),Bp(t)&&t.constructor===e)return t;var i=Dp.f(e);return(0,i.resolve)(t),i.promise;},Ap=Di,zp=$m,Up=vy.CONSTRUCTOR,Rp=Mp,Lp=ue("Promise"),Np=!Up;Ap({target:"Promise",stat:!0,forced:true},{resolve:function resolve(e){return Rp(Np&&this===Lp?zp:this,e);}});var Op=U,Wp=Ae,Hp=gy,Fp=_m,jp=og;Di({target:"Promise",stat:!0},{allSettled:function allSettled(e){var t=this,i=Hp.f(t),r=i.resolve,n=i.reject,o=Fp(function(){var i=Wp(t.resolve),n=[],o=0,a=1;jp(e,function(e){var s=o++,l=!1;a++,Op(i,t,e).then(function(e){l||(l=!0,n[s]={status:"fulfilled",value:e},--a||r(n));},function(e){l||(l=!0,n[s]={status:"rejected",reason:e},--a||r(n));});}),--a||r(n);});return o.error&&n(o.value),i.promise;}});var Yp=U,Xp=Ae,qp=ue,Zp=gy,_p=_m,Gp=og,Kp="No one promise resolved";Di({target:"Promise",stat:!0},{any:function any(e){var t=this,i=qp("AggregateError"),r=Zp.f(t),n=r.resolve,o=r.reject,a=_p(function(){var r=Xp(t.resolve),a=[],s=0,l=1,u=!1;Gp(e,function(e){var c=s++,h=!1;l++,Yp(r,t,e).then(function(e){h||u||(u=!0,n(e));},function(e){h||u||(h=!0,a[c]=e,--l||o(new i(a,Kp)));});}),--l||o(new i(a,Kp));});return a.error&&o(a.value),r.promise;}});var $p=Di,Qp=$m,Jp=l,ew=ue,tw=B,iw=Yg,rw=Mp,nw=Qp&&Qp.prototype;$p({target:"Promise",proto:!0,real:!0,forced:!!Qp&&Jp(function(){nw.finally.call({then:function then(){}},function(){});})},{finally:function _finally(e){var t=iw(this,ew("Promise")),i=tw(e);return this.then(i?function(i){return rw(t,e()).then(function(){return i;});}:e,i?function(i){return rw(t,e()).then(function(){throw i;});}:e);}});var ow=ne.Promise,aw=ow,sw=gy,lw=_m;Di({target:"Promise",stat:!0,forced:!0},{try:function _try(e){var t=sw.f(this),i=lw(e);return(i.error?t.reject:t.resolve)(i.value),t.promise;}});var uw=aw;!function(e){e.exports=uw;}(Ev),function(e){e.exports=Iv;}(Tv);var cw=t(Vv),hw={},dw={get exports(){return hw;},set exports(e){hw=e;}},fw={},vw={get exports(){return fw;},set exports(e){fw=e;}},gw=Di,mw=Ai,yw=w([].reverse),pw=[1,2];gw({target:"Array",proto:!0,forced:String(pw)===String(pw.reverse())},{reverse:function reverse(){return mw(this)&&(this.length=this.length),yw(this);}});var ww=Ah("Array").reverse,bw=ce,kw=ww,xw=Array.prototype,Sw=function Sw(e){var t=e.reverse;return e===xw||bw(xw,e)&&t===xw.reverse?kw:t;},Cw=Sw,Vw=Cw;!function(e){e.exports=Vw;}(vw),function(e){e.exports=fw;}(dw);var Tw=t(hw);function Iw(){Iw=function Iw(){return e;};var e={},t=Object.prototype,i=t.hasOwnProperty,r=Xf||function(e,t,i){e[t]=i.value;},n="function"==typeof Mu?Mu:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",s=n.toStringTag||"@@toStringTag";function l(e,t,i){return Xf(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t];}try{l({},"");}catch(e){l=function l(e,t,i){return e[t]=i;};}function u(e,t,i,n){var o=t&&t.prototype instanceof d?t:d,a=Jf(o.prototype),s=new C(n||[]);return r(a,"_invoke",{value:b(e,i,s)}),a;}function c(e,t,i){try{return{type:"normal",arg:e.call(t,i)};}catch(e){return{type:"throw",arg:e};}}e.wrap=u;var h={};function d(){}function f(){}function v(){}var g={};l(g,o,function(){return this;});var m=lv&&lv(lv(V([])));m&&m!==t&&i.call(m,o)&&(g=m);var y=v.prototype=d.prototype=Jf(g);function p(e){var t;Cv(t=["next","throw","return"]).call(t,function(t){l(e,t,function(e){return this._invoke(t,e);});});}function w(e,t){function n(r,o,a,s){var l=c(e[r],e,o);if("throw"!==l.type){var u=l.arg,h=u.value;return h&&"object"==ic(h)&&i.call(h,"__await")?t.resolve(h.__await).then(function(e){n("next",e,a,s);},function(e){n("throw",e,a,s);}):t.resolve(h).then(function(e){u.value=e,a(u);},function(e){return n("throw",e,a,s);});}s(l.arg);}var o;r(this,"_invoke",{value:function value(e,i){function r(){return new t(function(t,r){n(e,i,t,r);});}return o=o?o.then(r,r):r();}});}function b(e,t,i){var r="suspendedStart";return function(n,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===n)throw o;return T();}for(i.method=n,i.arg=o;;){var a=i.delegate;if(a){var s=k(a,i);if(s){if(s===h)continue;return s;}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===r)throw r="completed",i.arg;i.dispatchException(i.arg);}else"return"===i.method&&i.abrupt("return",i.arg);r="executing";var l=c(e,t,i);if("normal"===l.type){if(r=i.done?"completed":"suspendedYield",l.arg===h)continue;return{value:l.arg,done:i.done};}"throw"===l.type&&(r="completed",i.method="throw",i.arg=l.arg);}};}function k(e,t){var i=t.method,r=e.iterator[i];if(void 0===r)return t.delegate=null,"throw"===i&&e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method)||"return"!==i&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),h;var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,h;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h);}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t);}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t;}function C(e){this.tryEntries=[{tryLoc:"root"}],Cv(e).call(e,x,this),this.reset(!0);}function V(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t;};return n.next=n;}}return{next:T};}function T(){return{value:void 0,done:!0};}return f.prototype=v,r(y,"constructor",{value:v,configurable:!0}),r(v,"constructor",{value:f,configurable:!0}),f.displayName=l(v,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name));},e.mark=function(e){return Ef?Ef(e,v):(e.__proto__=v,l(e,s,"GeneratorFunction")),e.prototype=Jf(y),e;},e.awrap=function(e){return{__await:e};},p(w.prototype),l(w.prototype,a,function(){return this;}),e.AsyncIterator=w,e.async=function(t,i,r,n,o){void 0===o&&(o=cw);var a=new w(u(t,i,r,n),o);return e.isGeneratorFunction(i)?a:a.next().then(function(e){return e.done?e.value:a.next();});},p(y),l(y,s,"Generator"),l(y,o,function(){return this;}),l(y,"toString",function(){return"[object Generator]";}),e.keys=function(e){var t=Object(e),i=[];for(var r in t)i.push(r);return Tw(i).call(i),function e(){for(;i.length;){var r=i.pop();if(r in t)return e.value=r,e.done=!1,e;}return e.done=!0,e;};},e.values=V,C.prototype={constructor:C,reset:function reset(e){var t;if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,Cv(t=this.tryEntries).call(t,S),!e)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+Hh(r).call(r,1))&&(this[r]=void 0);},stop:function stop(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval;},dispatchException:function dispatchException(e){if(this.done)throw e;var t=this;function r(i,r){return a.type="throw",a.arg=e,t.next=i,r&&(t.method="next",t.arg=void 0),!!r;}for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=i.call(o,"catchLoc"),l=i.call(o,"finallyLoc");if(s&&l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc);}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc);}}}},abrupt:function abrupt(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break;}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(a);},complete:function complete(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h;},finish:function finish(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),S(i),h;}},catch:function _catch(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var r=i.completion;if("throw"===r.type){var n=r.arg;S(i);}return n;}}throw new Error("illegal catch attempt");},delegateYield:function delegateYield(e,t,i){return this.delegate={iterator:V(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),h;}},e;}function Ew(e,t,i,r,n,o,a){try{var s=e[o](a),l=s.value;}catch(e){return void i(e);}s.done?t(l):cw.resolve(l).then(r,n);}function Pw(e){return function(){var t=this,i=arguments;return new cw(function(r,n){var o=e.apply(t,i);function a(e){Ew(o,r,n,a,s,"next",e);}function s(e){Ew(o,r,n,a,s,"throw",e);}a(void 0);});};}var Bw={},Dw={get exports(){return Bw;},set exports(e){Bw=e;}},Mw={},Aw={get exports(){return Mw;},set exports(e){Mw=e;}},zw=et,Uw=U,Rw=re,Lw=oi,Nw=function Nw(e){return void 0!==e&&(zw(e,"value")||zw(e,"writable"));},Ow=D,Ww=xl;Di({target:"Reflect",stat:!0},{get:function e(t,i){var r,n,o=arguments.length<3?t:arguments[2];return Lw(t)===o?t[i]:(r=Ow.f(t,i))?Nw(r)?r.value:void 0===r.get?void 0:Uw(r.get,o):Rw(n=Ww(t))?e(n,i,o):void 0;}});var Hw=ne.Reflect.get;!function(e){e.exports=Hw;}(Aw),function(e){e.exports=Mw;}(Dw);var Fw=t(Bw),jw={},Yw={get exports(){return jw;},set exports(e){jw=e;}},Xw={},qw={get exports(){return Xw;},set exports(e){Xw=e;}},Zw={},_w={get exports(){return Zw;},set exports(e){Zw=e;}},Gw=Di,Kw=l,$w=ee,Qw=D.f,Jw=M,eb=Kw(function(){Qw(1);});Gw({target:"Object",stat:!0,forced:!Jw||eb,sham:!Jw},{getOwnPropertyDescriptor:function getOwnPropertyDescriptor(e,t){return Qw($w(e),t);}});var tb=ne.Object,ib=_w.exports=function(e,t){return tb.getOwnPropertyDescriptor(e,t);};tb.getOwnPropertyDescriptor.sham&&(ib.sham=!0);var rb=Zw;!function(e){e.exports=rb;}(qw),function(e){e.exports=Xw;}(Yw);var nb=t(jw);function ob(e){var t;return ob=Ef?$d(t=lv).call(t):function(e){return e.__proto__||lv(e);},ob(e);}function ab(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ob(e)););return e;}function sb(){var e;"undefined"!=typeof Reflect&&Fw?sb=$d(e=Fw).call(e):sb=function sb(e,t,i){var r=ab(e,t);if(r){var n=nb(r,t);return n.get?n.get.call(arguments.length<3?e:i):n.value;}};return sb.apply(this,arguments);}function lb(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Jf(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Xf(e,"prototype",{writable:!1}),t&&Pf(e,t);}function ub(e){var t=Bf();return function(){var i,r=ob(e);if(t){var n=ob(this).constructor;i=xf(r,arguments,n);}else i=r.apply(this,arguments);return nc(this,i);};}function cb(e,t){return dc(e)||function(e,t){var i=null==e?null:void 0!==Mu&&Cc(e)||e["@@iterator"];if(null!=i){var r,n,o,a,s=[],l=!0,u=!1;try{if(o=(i=i.call(e)).next,0===t){if(Object(i)!==i)return;l=!1;}else for(;!(l=(r=o.call(i)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){u=!0,n=e;}finally{try{if(!l&&null!=i.return&&(a=i.return(),Object(a)!==a))return;}finally{if(u)throw n;}}return s;}}(e,t)||jh(e,t)||Yh();}function hb(e){return function(e){if(hc(e))return Fh(e);}(e)||fh(e)||jh(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}();}var db={},fb={get exports(){return db;},set exports(e){db=e;}},vb={},gb={get exports(){return vb;},set exports(e){vb=e;}},mb=ra.filter;Di({target:"Array",proto:!0,forced:!Ar("filter")},{filter:function filter(e){return mb(this,e,arguments.length>1?arguments[1]:void 0);}});var yb=Ah("Array").filter,pb=ce,wb=yb,bb=Array.prototype,kb=function kb(e){var t=e.filter;return e===bb||pb(bb,e)&&t===bb.filter?wb:t;},xb=kb,Sb=xb;!function(e){e.exports=Sb;}(gb),function(e){e.exports=vb;}(fb);var Cb=t(db),Vb={},Tb={get exports(){return Vb;},set exports(e){Vb=e;}},Ib={},Eb={get exports(){return Ib;},set exports(e){Ib=e;}},Pb=zv,Bb=ee,Db=D,Mb=Gi;Di({target:"Object",stat:!0,sham:!M},{getOwnPropertyDescriptors:function getOwnPropertyDescriptors(e){for(var t,i,r=Bb(e),n=Db.f,o=Pb(r),a={},s=0;o.length>s;)void 0!==(i=n(r,t=o[s++]))&&Mb(a,t,i);return a;}});var Ab=ne.Object.getOwnPropertyDescriptors;!function(e){e.exports=Ab;}(Eb),function(e){e.exports=Ib;}(Tb);var zb=t(Vb),Ub={},Rb={get exports(){return Ub;},set exports(e){Ub=e;}},Lb={},Nb={get exports(){return Lb;},set exports(e){Lb=e;}},Ob={},Wb={get exports(){return Ob;},set exports(e){Ob=e;}},Hb=Di,Fb=M,jb=Qr.f;Hb({target:"Object",stat:!0,forced:Object.defineProperties!==jb,sham:!Fb},{defineProperties:jb});var Yb=ne.Object,Xb=Wb.exports=function(e,t){return Yb.defineProperties(e,t);};Yb.defineProperties.sham&&(Xb.sham=!0);var qb=Ob;!function(e){e.exports=qb;}(Nb),function(e){e.exports=Lb;}(Rb);var Zb=t(Ub),_b={},Gb={get exports(){return _b;},set exports(e){_b=e;}},Kb={},$b={get exports(){return Kb;},set exports(e){Kb=e;}},Qb=uo.f("toPrimitive");!function(e){e.exports=Qb;}($b),function(e){e.exports=Kb;}(Gb);var Jb=t(_b);function ek(e){var t=function(e,t){if("object"!==ic(e)||null===e)return e;var i=e[Jb];if(void 0!==i){var r=i.call(e,t||"default");if("object"!==ic(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.");}return("string"===t?String:Number)(e);}(e,"string");return"symbol"===ic(t)?t:String(t);}function tk(e,t,i){return(t=ek(t))in e?Xf(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e;}function ik(e,t){var i=Vd(e);if(Kh){var r=Kh(e);t&&(r=Cb(r).call(r,function(t){return nb(e,t).enumerable;})),i.push.apply(i,r);}return i;}function rk(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?Cv(i=ik(Object(n),!0)).call(i,function(t){tk(e,t,n[t]);}):zb?Zb(e,zb(n)):Cv(r=ik(Object(n))).call(r,function(t){Xf(e,t,nb(n,t));});}return e;}function nk(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Xf(e,ek(r.key),r);}}function ok(e,t,i){return t&&nk(e.prototype,t),i&&nk(e,i),Xf(e,"prototype",{writable:!1}),e;}function ak(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function");}var sk={},lk={get exports(){return sk;},set exports(e){sk=e;}};!function(e){e.exports=uc;}(lk);var uk=t(sk),ck={},hk={get exports(){return ck;},set exports(e){ck=e;}};!function(e){e.exports=xv;}(hk);var dk=t(ck),fk={},vk={get exports(){return fk;},set exports(e){fk=e;}};!function(e){e.exports=Sd;}(vk);var gk=t(fk),mk={},yk={get exports(){return mk;},set exports(e){mk=e;}},pk=Ah("Array").concat,wk=ce,bk=pk,kk=Array.prototype,xk=function xk(e){var t=e.concat;return e===kk||wk(kk,e)&&t===kk.concat?bk:t;},Sk=xk;!function(e){e.exports=Sk;}(yk);var Ck=t(mk),Vk={},Tk={get exports(){return Vk;},set exports(e){Vk=e;}};Di({target:"Number",stat:!0},{isNaN:function isNaN(e){return e!=e;}});var Ik=ne.Number.isNaN;!function(e){e.exports=Ik;}(Tk);var Ek=t(Vk),Pk={},Bk={get exports(){return Pk;},set exports(e){Pk=e;}},Dk="\t\n\x0B\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF",Mk=$,Ak=$r,zk=Dk,Uk=w("".replace),Rk="["+zk+"]",Lk=RegExp("^"+Rk+Rk+"*"),Nk=RegExp(Rk+Rk+"*$"),Ok=function Ok(e){return function(t){var i=Ak(Mk(t));return 1&e&&(i=Uk(i,Lk,"")),2&e&&(i=Uk(i,Nk,"")),i;};},Wk={start:Ok(1),end:Ok(2),trim:Ok(3)},Hk=fl.PROPER,Fk=l,jk=Dk,Yk=Wk.trim;Di({target:"String",proto:!0,forced:function(e){return Fk(function(){return!!jk[e]()||"âÂá "!=="âÂá "[e]()||Hk&&jk[e].name!==e;});}("trim")},{trim:function trim(){return Yk(this);}});var Xk=Ah("String").trim,qk=ce,Zk=Xk,_k=String.prototype,Gk=function Gk(e){var t=e.trim;return"string"==typeof e||e===_k||qk(_k,e)&&t===_k.trim?Zk:t;},Kk=Gk;!function(e){e.exports=Kk;}(Bk);var $k=t(Pk),Qk={},Jk={get exports(){return Qk;},set exports(e){Qk=e;}},ex=s,tx=l,ix=w,rx=$r,nx=Wk.trim,ox=Dk,ax=ex.parseInt,sx=ex.Symbol,lx=sx&&sx.iterator,ux=/^[+-]?0x/i,cx=ix(ux.exec),hx=8!==ax(ox+"08")||22!==ax(ox+"0x16")||lx&&!tx(function(){ax(Object(lx));})?function(e,t){var i=nx(rx(e));return ax(i,t>>>0||(cx(ux,i)?16:10));}:ax;Di({global:!0,forced:parseInt!=hx},{parseInt:hx});var dx=ne.parseInt;!function(e){e.exports=dx;}(Jk);var fx=t(Qk),vx={},gx={get exports(){return vx;},set exports(e){vx=e;}},mx=Ae,yx=$e,px=Z,wx=ji,bx=TypeError,kx=function kx(e){return function(t,i,r,n){mx(i);var o=yx(t),a=px(o),s=wx(o),l=e?s-1:0,u=e?-1:1;if(r<2)for(;;){if(l in a){n=a[l],l+=u;break;}if(l+=u,e?l<0:s<=l)throw bx("Reduce of empty array with no initial value");}for(;e?l>=0:s>l;l+=u)l in a&&(n=i(n,a[l],l,o));return n;};},xx={left:kx(!1),right:kx(!0)}.left,Sx=pe,Cx=Dg;Di({target:"Array",proto:!0,forced:!id("reduce")||!Cx&&Sx>79&&Sx<83},{reduce:function reduce(e){var t=arguments.length;return xx(this,e,t,t>1?arguments[1]:void 0);}});var Vx=Ah("Array").reduce,Tx=ce,Ix=Vx,Ex=Array.prototype,Px=function Px(e){var t=e.reduce;return e===Ex||Tx(Ex,e)&&t===Ex.reduce?Ix:t;},Bx=Px;!function(e){e.exports=Bx;}(gx);var Dx=t(vx),Mx={},Ax={get exports(){return Mx;},set exports(e){Mx=e;}};!function(e){e.exports=xb;}(Ax);var zx=t(Mx),Ux={},Rx={get exports(){return Ux;},set exports(e){Ux=e;}},Lx=l,Nx=gt("iterator"),Ox=!Lx(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,i="";return e.pathname="c%20d",t.forEach(function(e,r){t.delete("b"),i+=r+e;}),!e.toJSON||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[Nx]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://ÑÐµÑÑ").host||"#%D0%B1"!==new URL("http://a#Ð±").hash||"a1c3"!==i||"x"!==new URL("http://x",void 0).host;}),Wx=ei,Hx=M,Fx=w,jx=U,Yx=l,Xx=wn,qx=ao,Zx=R,_x=$e,Gx=Z,Kx=Object.assign,$x=Object.defineProperty,Qx=Fx([].concat),Jx=!Kx||Yx(function(){if(Hx&&1!==Kx({b:1},Kx($x({},"a",{enumerable:!0,get:function get(){$x(this,"b",{value:3,enumerable:!1});}}),{b:2})).b)return!0;var e={},t={},i=Symbol(),r="abcdefghijklmnopqrst";return e[i]=7,r.split("").forEach(function(e){t[e]=e;}),7!=Kx({},e)[i]||Xx(Kx({},t)).join("")!=r;})?function(e,t){for(var i=_x(e),r=arguments.length,n=1,o=qx.f,a=Zx.f;r>n;)for(var s,l=Gx(arguments[n++]),u=o?Qx(Xx(l),o(l)):Xx(l),c=u.length,h=0;c>h;)s=u[h++],Hx&&!jx(a,l,s)||(i[s]=l[s]);return i;}:Kx,eS=w,tS=2147483647,iS=/[^\0-\u007E]/,rS=/[.\u3002\uFF0E\uFF61]/g,nS="Overflow: input needs wider integers to process",oS=RangeError,aS=eS(rS.exec),sS=Math.floor,lS=String.fromCharCode,uS=eS("".charCodeAt),cS=eS([].join),hS=eS([].push),dS=eS("".replace),fS=eS("".split),vS=eS("".toLowerCase),gS=function gS(e){return e+22+75*(e<26);},mS=function mS(e,t,i){var r=0;for(e=i?sS(e/700):e>>1,e+=sS(e/t);e>455;)e=sS(e/35),r+=36;return sS(r+36*e/(e+38));},yS=function yS(e){var t=[];e=function(e){for(var t=[],i=0,r=e.length;i<r;){var n=uS(e,i++);if(n>=55296&&n<=56319&&i<r){var o=uS(e,i++);56320==(64512&o)?hS(t,((1023&n)<<10)+(1023&o)+65536):(hS(t,n),i--);}else hS(t,n);}return t;}(e);var i,r,n=e.length,o=128,a=0,s=72;for(i=0;i<e.length;i++)(r=e[i])<128&&hS(t,lS(r));var l=t.length,u=l;for(l&&hS(t,"-");u<n;){var c=tS;for(i=0;i<e.length;i++)(r=e[i])>=o&&r<c&&(c=r);var h=u+1;if(c-o>sS((tS-a)/h))throw oS(nS);for(a+=(c-o)*h,o=c,i=0;i<e.length;i++){if((r=e[i])<o&&++a>tS)throw oS(nS);if(r==o){for(var d=a,f=36;;){var v=f<=s?1:f>=s+26?26:f-s;if(d<v)break;var g=d-v,m=36-v;hS(t,lS(gS(v+g%m))),d=sS(g/m),f+=36;}hS(t,lS(gS(d))),s=mS(a,h,u==l),a=0,u++;}}a++,o++;}return cS(t,"");},pS=lo,wS=function wS(e,t,i){for(var r in t)i&&i.unsafe&&e[r]?e[r]=t[r]:pS(e,r,t[r],i);return e;},bS=eo,kS=Math.floor,xS=function xS(e,t){var i=e.length,r=kS(i/2);return i<8?SS(e,t):CS(e,xS(bS(e,0,r),t),xS(bS(e,r),t),t);},SS=function SS(e,t){for(var i,r,n=e.length,o=1;o<n;){for(r=o,i=e[o];r&&t(e[r-1],i)>0;)e[r]=e[--r];r!==o++&&(e[r]=i);}return e;},CS=function CS(e,t,i,r){for(var n=t.length,o=i.length,a=0,s=0;a<n||s<o;)e[a+s]=a<n&&s<o?r(t[a],i[s])<=0?t[a++]:i[s++]:a<n?t[a++]:i[s++];return e;},VS=xS,TS=Di,IS=s,ES=U,PS=w,BS=M,DS=Ox,MS=lo,AS=wS,zS=Ao,US=Ol,RS=Go,LS=Og,NS=B,OS=et,WS=Jt,HS=nr,FS=oi,jS=re,YS=$r,XS=Yn,qS=F,ZS=Xc,_S=xc,GS=qg,KS=VS,$S=gt("iterator"),QS="URLSearchParams",JS=QS+"Iterator",eC=RS.set,tC=RS.getterFor(QS),iC=RS.getterFor(JS),rC=Object.getOwnPropertyDescriptor,nC=function nC(e){if(!BS)return IS[e];var t=rC(IS,e);return t&&t.value;},oC=nC("fetch"),aC=nC("Request"),sC=nC("Headers"),lC=aC&&aC.prototype,uC=sC&&sC.prototype,cC=IS.RegExp,hC=IS.TypeError,dC=IS.decodeURIComponent,fC=IS.encodeURIComponent,vC=PS("".charAt),gC=PS([].join),mC=PS([].push),yC=PS("".replace),pC=PS([].shift),wC=PS([].splice),bC=PS("".split),kC=PS("".slice),xC=/\+/g,SC=Array(4),CC=function CC(e){return SC[e-1]||(SC[e-1]=cC("((?:%[\\da-f]{2}){"+e+"})","gi"));},VC=function VC(e){try{return dC(e);}catch(t){return e;}},TC=function TC(e){var t=yC(e,xC," "),i=4;try{return dC(t);}catch(e){for(;i;)t=yC(t,CC(i--),VC);return t;}},IC=/[!'()~]|%20/g,EC={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},PC=function PC(e){return EC[e];},BC=function BC(e){return yC(fC(e),IC,PC);},DC=US(function(e,t){eC(this,{type:JS,iterator:ZS(tC(e).entries),kind:t});},"Iterator",function(){var e=iC(this),t=e.kind,i=e.iterator.next(),r=i.value;return i.done||(i.value="keys"===t?r.key:"values"===t?r.value:[r.key,r.value]),i;},!0),MC=function MC(e){this.entries=[],this.url=null,void 0!==e&&(jS(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===vC(e,0)?kC(e,1):e:YS(e)));};MC.prototype={type:QS,bindURL:function bindURL(e){this.url=e,this.update();},parseObject:function parseObject(e){var t,i,r,n,o,a,s,l=_S(e);if(l)for(i=(t=ZS(e,l)).next;!(r=ES(i,t)).done;){if(o=(n=ZS(FS(r.value))).next,(a=ES(o,n)).done||(s=ES(o,n)).done||!ES(o,n).done)throw hC("Expected sequence with length 2");mC(this.entries,{key:YS(a.value),value:YS(s.value)});}else for(var u in e)OS(e,u)&&mC(this.entries,{key:u,value:YS(e[u])});},parseQuery:function parseQuery(e){if(e)for(var t,i,r=bC(e,"&"),n=0;n<r.length;)(t=r[n++]).length&&(i=bC(t,"="),mC(this.entries,{key:TC(pC(i)),value:TC(gC(i,"="))}));},serialize:function serialize(){for(var e,t=this.entries,i=[],r=0;r<t.length;)e=t[r++],mC(i,BC(e.key)+"="+BC(e.value));return gC(i,"&");},update:function update(){this.entries.length=0,this.parseQuery(this.url.query);},updateURL:function updateURL(){this.url&&this.url.update();}};var AC=function AC(){LS(this,zC);var e=arguments.length>0?arguments[0]:void 0;eC(this,new MC(e));},zC=AC.prototype;if(AS(zC,{append:function append(e,t){GS(arguments.length,2);var i=tC(this);mC(i.entries,{key:YS(e),value:YS(t)}),i.updateURL();},delete:function _delete(e){GS(arguments.length,1);for(var t=tC(this),i=t.entries,r=YS(e),n=0;n<i.length;)i[n].key===r?wC(i,n,1):n++;t.updateURL();},get:function get(e){GS(arguments.length,1);for(var t=tC(this).entries,i=YS(e),r=0;r<t.length;r++)if(t[r].key===i)return t[r].value;return null;},getAll:function getAll(e){GS(arguments.length,1);for(var t=tC(this).entries,i=YS(e),r=[],n=0;n<t.length;n++)t[n].key===i&&mC(r,t[n].value);return r;},has:function has(e){GS(arguments.length,1);for(var t=tC(this).entries,i=YS(e),r=0;r<t.length;)if(t[r++].key===i)return!0;return!1;},set:function set(e,t){GS(arguments.length,1);for(var i,r=tC(this),n=r.entries,o=!1,a=YS(e),s=YS(t),l=0;l<n.length;l++)(i=n[l]).key===a&&(o?wC(n,l--,1):(o=!0,i.value=s));o||mC(n,{key:a,value:s}),r.updateURL();},sort:function sort(){var e=tC(this);KS(e.entries,function(e,t){return e.key>t.key?1:-1;}),e.updateURL();},forEach:function forEach(e){for(var t,i=tC(this).entries,r=WS(e,arguments.length>1?arguments[1]:void 0),n=0;n<i.length;)r((t=i[n++]).value,t.key,this);},keys:function keys(){return new DC(this,"keys");},values:function values(){return new DC(this,"values");},entries:function entries(){return new DC(this,"entries");}},{enumerable:!0}),MS(zC,$S,zC.entries,{name:"entries"}),MS(zC,"toString",function(){return tC(this).serialize();},{enumerable:!0}),zS(AC,QS),TS({global:!0,constructor:!0,forced:!DS},{URLSearchParams:AC}),!DS&&NS(sC)){var UC=PS(uC.has),RC=PS(uC.set),LC=function LC(e){if(jS(e)){var t,i=e.body;if(HS(i)===QS)return t=e.headers?new sC(e.headers):new sC(),UC(t,"content-type")||RC(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),XS(e,{body:qS(0,YS(i)),headers:qS(0,t)});}return e;};if(NS(oC)&&TS({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function fetch(e){return oC(e,arguments.length>1?LC(arguments[1]):{});}}),NS(aC)){var NC=function NC(e){return LS(this,lC),new aC(e,arguments.length>1?LC(arguments[1]):{});};lC.constructor=NC,NC.prototype=lC,TS({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:NC});}}var OC,WC=Di,HC=M,FC=Ox,jC=s,YC=Jt,XC=w,qC=lo,ZC=function ZC(e,t,i){return Wx.f(e,t,i);},_C=Og,GC=et,KC=Jx,$C=rh,QC=eo,JC=Xu.codeAt,eV=function eV(e){var t,i,r=[],n=fS(dS(vS(e),rS,"."),".");for(t=0;t<n.length;t++)i=n[t],hS(r,aS(iS,i)?"xn--"+yS(i):i);return cS(r,".");},tV=$r,iV=Ao,rV=qg,nV={URLSearchParams:AC,getState:tC},oV=Go,aV=oV.set,sV=oV.getterFor("URL"),lV=nV.URLSearchParams,uV=nV.getState,cV=jC.URL,hV=jC.TypeError,dV=jC.parseInt,fV=Math.floor,vV=Math.pow,gV=XC("".charAt),mV=XC(/./.exec),yV=XC([].join),pV=XC(1..toString),wV=XC([].pop),bV=XC([].push),kV=XC("".replace),xV=XC([].shift),SV=XC("".split),CV=XC("".slice),VV=XC("".toLowerCase),TV=XC([].unshift),IV="Invalid scheme",EV="Invalid host",PV="Invalid port",BV=/[a-z]/i,DV=/[\d+-.a-z]/i,MV=/\d/,AV=/^0x/i,zV=/^[0-7]+$/,UV=/^\d+$/,RV=/^[\da-f]+$/i,LV=/[\0\t\n\r #%/:<>?@[\\\]^|]/,NV=/[\0\t\n\r #/:<>?@[\\\]^|]/,OV=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,WV=/[\t\n\r]/g,HV=function HV(e){var t,i,r,n;if("number"==typeof e){for(t=[],i=0;i<4;i++)TV(t,e%256),e=fV(e/256);return yV(t,".");}if("object"==_typeof(e)){for(t="",r=function(e){for(var t=null,i=1,r=null,n=0,o=0;o<8;o++)0!==e[o]?(n>i&&(t=r,i=n),r=null,n=0):(null===r&&(r=o),++n);return n>i&&(t=r,i=n),t;}(e),i=0;i<8;i++)n&&0===e[i]||(n&&(n=!1),r===i?(t+=i?":":"::",n=!0):(t+=pV(e[i],16),i<7&&(t+=":")));return"["+t+"]";}return e;},FV={},jV=KC({},FV,{" ":1,'"':1,"<":1,">":1,"`":1}),YV=KC({},jV,{"#":1,"?":1,"{":1,"}":1}),XV=KC({},YV,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),qV=function qV(e,t){var i=JC(e,0);return i>32&&i<127&&!GC(t,e)?e:encodeURIComponent(e);},ZV={ftp:21,file:null,http:80,https:443,ws:80,wss:443},_V=function _V(e,t){var i;return 2==e.length&&mV(BV,gV(e,0))&&(":"==(i=gV(e,1))||!t&&"|"==i);},GV=function GV(e){var t;return e.length>1&&_V(CV(e,0,2))&&(2==e.length||"/"===(t=gV(e,2))||"\\"===t||"?"===t||"#"===t);},KV=function KV(e){return"."===e||"%2e"===VV(e);},$V={},QV={},JV={},eT={},tT={},iT={},rT={},nT={},oT={},aT={},sT={},lT={},uT={},cT={},hT={},dT={},fT={},vT={},gT={},mT={},yT={},pT=function pT(e,t,i){var r,n,o,a=tV(e);if(t){if(n=this.parse(a))throw hV(n);this.searchParams=null;}else{if(void 0!==i&&(r=new pT(i,!0)),n=this.parse(a,null,r))throw hV(n);(o=uV(new lV())).bindURL(this),this.searchParams=o;}};pT.prototype={type:"URL",parse:function parse(e,t,i){var r,n,o,a,s,l=this,u=t||$V,c=0,h="",d=!1,f=!1,v=!1;for(e=tV(e),t||(l.scheme="",l.username="",l.password="",l.host=null,l.port=null,l.path=[],l.query=null,l.fragment=null,l.cannotBeABaseURL=!1,e=kV(e,OV,"")),e=kV(e,WV,""),r=$C(e);c<=r.length;){switch(n=r[c],u){case $V:if(!n||!mV(BV,n)){if(t)return IV;u=JV;continue;}h+=VV(n),u=QV;break;case QV:if(n&&(mV(DV,n)||"+"==n||"-"==n||"."==n))h+=VV(n);else{if(":"!=n){if(t)return IV;h="",u=JV,c=0;continue;}if(t&&(l.isSpecial()!=GC(ZV,h)||"file"==h&&(l.includesCredentials()||null!==l.port)||"file"==l.scheme&&!l.host))return;if(l.scheme=h,t)return void(l.isSpecial()&&ZV[l.scheme]==l.port&&(l.port=null));h="","file"==l.scheme?u=cT:l.isSpecial()&&i&&i.scheme==l.scheme?u=eT:l.isSpecial()?u=nT:"/"==r[c+1]?(u=tT,c++):(l.cannotBeABaseURL=!0,bV(l.path,""),u=gT);}break;case JV:if(!i||i.cannotBeABaseURL&&"#"!=n)return IV;if(i.cannotBeABaseURL&&"#"==n){l.scheme=i.scheme,l.path=QC(i.path),l.query=i.query,l.fragment="",l.cannotBeABaseURL=!0,u=yT;break;}u="file"==i.scheme?cT:iT;continue;case eT:if("/"!=n||"/"!=r[c+1]){u=iT;continue;}u=oT,c++;break;case tT:if("/"==n){u=aT;break;}u=vT;continue;case iT:if(l.scheme=i.scheme,n==OC)l.username=i.username,l.password=i.password,l.host=i.host,l.port=i.port,l.path=QC(i.path),l.query=i.query;else if("/"==n||"\\"==n&&l.isSpecial())u=rT;else if("?"==n)l.username=i.username,l.password=i.password,l.host=i.host,l.port=i.port,l.path=QC(i.path),l.query="",u=mT;else{if("#"!=n){l.username=i.username,l.password=i.password,l.host=i.host,l.port=i.port,l.path=QC(i.path),l.path.length--,u=vT;continue;}l.username=i.username,l.password=i.password,l.host=i.host,l.port=i.port,l.path=QC(i.path),l.query=i.query,l.fragment="",u=yT;}break;case rT:if(!l.isSpecial()||"/"!=n&&"\\"!=n){if("/"!=n){l.username=i.username,l.password=i.password,l.host=i.host,l.port=i.port,u=vT;continue;}u=aT;}else u=oT;break;case nT:if(u=oT,"/"!=n||"/"!=gV(h,c+1))continue;c++;break;case oT:if("/"!=n&&"\\"!=n){u=aT;continue;}break;case aT:if("@"==n){d&&(h="%40"+h),d=!0,o=$C(h);for(var g=0;g<o.length;g++){var m=o[g];if(":"!=m||v){var y=qV(m,XV);v?l.password+=y:l.username+=y;}else v=!0;}h="";}else if(n==OC||"/"==n||"?"==n||"#"==n||"\\"==n&&l.isSpecial()){if(d&&""==h)return"Invalid authority";c-=$C(h).length+1,h="",u=sT;}else h+=n;break;case sT:case lT:if(t&&"file"==l.scheme){u=dT;continue;}if(":"!=n||f){if(n==OC||"/"==n||"?"==n||"#"==n||"\\"==n&&l.isSpecial()){if(l.isSpecial()&&""==h)return EV;if(t&&""==h&&(l.includesCredentials()||null!==l.port))return;if(a=l.parseHost(h))return a;if(h="",u=fT,t)return;continue;}"["==n?f=!0:"]"==n&&(f=!1),h+=n;}else{if(""==h)return EV;if(a=l.parseHost(h))return a;if(h="",u=uT,t==lT)return;}break;case uT:if(!mV(MV,n)){if(n==OC||"/"==n||"?"==n||"#"==n||"\\"==n&&l.isSpecial()||t){if(""!=h){var p=dV(h,10);if(p>65535)return PV;l.port=l.isSpecial()&&p===ZV[l.scheme]?null:p,h="";}if(t)return;u=fT;continue;}return PV;}h+=n;break;case cT:if(l.scheme="file","/"==n||"\\"==n)u=hT;else{if(!i||"file"!=i.scheme){u=vT;continue;}if(n==OC)l.host=i.host,l.path=QC(i.path),l.query=i.query;else if("?"==n)l.host=i.host,l.path=QC(i.path),l.query="",u=mT;else{if("#"!=n){GV(yV(QC(r,c),""))||(l.host=i.host,l.path=QC(i.path),l.shortenPath()),u=vT;continue;}l.host=i.host,l.path=QC(i.path),l.query=i.query,l.fragment="",u=yT;}}break;case hT:if("/"==n||"\\"==n){u=dT;break;}i&&"file"==i.scheme&&!GV(yV(QC(r,c),""))&&(_V(i.path[0],!0)?bV(l.path,i.path[0]):l.host=i.host),u=vT;continue;case dT:if(n==OC||"/"==n||"\\"==n||"?"==n||"#"==n){if(!t&&_V(h))u=vT;else if(""==h){if(l.host="",t)return;u=fT;}else{if(a=l.parseHost(h))return a;if("localhost"==l.host&&(l.host=""),t)return;h="",u=fT;}continue;}h+=n;break;case fT:if(l.isSpecial()){if(u=vT,"/"!=n&&"\\"!=n)continue;}else if(t||"?"!=n){if(t||"#"!=n){if(n!=OC&&(u=vT,"/"!=n))continue;}else l.fragment="",u=yT;}else l.query="",u=mT;break;case vT:if(n==OC||"/"==n||"\\"==n&&l.isSpecial()||!t&&("?"==n||"#"==n)){if(".."===(s=VV(s=h))||"%2e."===s||".%2e"===s||"%2e%2e"===s?(l.shortenPath(),"/"==n||"\\"==n&&l.isSpecial()||bV(l.path,"")):KV(h)?"/"==n||"\\"==n&&l.isSpecial()||bV(l.path,""):("file"==l.scheme&&!l.path.length&&_V(h)&&(l.host&&(l.host=""),h=gV(h,0)+":"),bV(l.path,h)),h="","file"==l.scheme&&(n==OC||"?"==n||"#"==n))for(;l.path.length>1&&""===l.path[0];)xV(l.path);"?"==n?(l.query="",u=mT):"#"==n&&(l.fragment="",u=yT);}else h+=qV(n,YV);break;case gT:"?"==n?(l.query="",u=mT):"#"==n?(l.fragment="",u=yT):n!=OC&&(l.path[0]+=qV(n,FV));break;case mT:t||"#"!=n?n!=OC&&("'"==n&&l.isSpecial()?l.query+="%27":l.query+="#"==n?"%23":qV(n,FV)):(l.fragment="",u=yT);break;case yT:n!=OC&&(l.fragment+=qV(n,jV));}c++;}},parseHost:function parseHost(e){var t,i,r;if("["==gV(e,0)){if("]"!=gV(e,e.length-1))return EV;if(t=function(e){var t,i,r,n,o,a,s,l=[0,0,0,0,0,0,0,0],u=0,c=null,h=0,d=function d(){return gV(e,h);};if(":"==d()){if(":"!=gV(e,1))return;h+=2,c=++u;}for(;d();){if(8==u)return;if(":"!=d()){for(t=i=0;i<4&&mV(RV,d());)t=16*t+dV(d(),16),h++,i++;if("."==d()){if(0==i)return;if(h-=i,u>6)return;for(r=0;d();){if(n=null,r>0){if(!("."==d()&&r<4))return;h++;}if(!mV(MV,d()))return;for(;mV(MV,d());){if(o=dV(d(),10),null===n)n=o;else{if(0==n)return;n=10*n+o;}if(n>255)return;h++;}l[u]=256*l[u]+n,2!=++r&&4!=r||u++;}if(4!=r)return;break;}if(":"==d()){if(h++,!d())return;}else if(d())return;l[u++]=t;}else{if(null!==c)return;h++,c=++u;}}if(null!==c)for(a=u-c,u=7;0!=u&&a>0;)s=l[u],l[u--]=l[c+a-1],l[c+--a]=s;else if(8!=u)return;return l;}(CV(e,1,-1)),!t)return EV;this.host=t;}else if(this.isSpecial()){if(e=eV(e),mV(LV,e))return EV;if(t=function(e){var t,i,r,n,o,a,s,l=SV(e,".");if(l.length&&""==l[l.length-1]&&l.length--,(t=l.length)>4)return e;for(i=[],r=0;r<t;r++){if(""==(n=l[r]))return e;if(o=10,n.length>1&&"0"==gV(n,0)&&(o=mV(AV,n)?16:8,n=CV(n,8==o?1:2)),""===n)a=0;else{if(!mV(10==o?UV:8==o?zV:RV,n))return e;a=dV(n,o);}bV(i,a);}for(r=0;r<t;r++)if(a=i[r],r==t-1){if(a>=vV(256,5-t))return null;}else if(a>255)return null;for(s=wV(i),r=0;r<i.length;r++)s+=i[r]*vV(256,3-r);return s;}(e),null===t)return EV;this.host=t;}else{if(mV(NV,e))return EV;for(t="",i=$C(e),r=0;r<i.length;r++)t+=qV(i[r],FV);this.host=t;}},cannotHaveUsernamePasswordPort:function cannotHaveUsernamePasswordPort(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme;},includesCredentials:function includesCredentials(){return""!=this.username||""!=this.password;},isSpecial:function isSpecial(){return GC(ZV,this.scheme);},shortenPath:function shortenPath(){var e=this.path,t=e.length;!t||"file"==this.scheme&&1==t&&_V(e[0],!0)||e.length--;},serialize:function serialize(){var e=this,t=e.scheme,i=e.username,r=e.password,n=e.host,o=e.port,a=e.path,s=e.query,l=e.fragment,u=t+":";return null!==n?(u+="//",e.includesCredentials()&&(u+=i+(r?":"+r:"")+"@"),u+=HV(n),null!==o&&(u+=":"+o)):"file"==t&&(u+="//"),u+=e.cannotBeABaseURL?a[0]:a.length?"/"+yV(a,"/"):"",null!==s&&(u+="?"+s),null!==l&&(u+="#"+l),u;},setHref:function setHref(e){var t=this.parse(e);if(t)throw hV(t);this.searchParams.update();},getOrigin:function getOrigin(){var e=this.scheme,t=this.port;if("blob"==e)try{return new wT(e.path[0]).origin;}catch(e){return"null";}return"file"!=e&&this.isSpecial()?e+"://"+HV(this.host)+(null!==t?":"+t:""):"null";},getProtocol:function getProtocol(){return this.scheme+":";},setProtocol:function setProtocol(e){this.parse(tV(e)+":",$V);},getUsername:function getUsername(){return this.username;},setUsername:function setUsername(e){var t=$C(tV(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<t.length;i++)this.username+=qV(t[i],XV);}},getPassword:function getPassword(){return this.password;},setPassword:function setPassword(e){var t=$C(tV(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<t.length;i++)this.password+=qV(t[i],XV);}},getHost:function getHost(){var e=this.host,t=this.port;return null===e?"":null===t?HV(e):HV(e)+":"+t;},setHost:function setHost(e){this.cannotBeABaseURL||this.parse(e,sT);},getHostname:function getHostname(){var e=this.host;return null===e?"":HV(e);},setHostname:function setHostname(e){this.cannotBeABaseURL||this.parse(e,lT);},getPort:function getPort(){var e=this.port;return null===e?"":tV(e);},setPort:function setPort(e){this.cannotHaveUsernamePasswordPort()||(""==(e=tV(e))?this.port=null:this.parse(e,uT));},getPathname:function getPathname(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+yV(e,"/"):"";},setPathname:function setPathname(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,fT));},getSearch:function getSearch(){var e=this.query;return e?"?"+e:"";},setSearch:function setSearch(e){""==(e=tV(e))?this.query=null:("?"==gV(e,0)&&(e=CV(e,1)),this.query="",this.parse(e,mT)),this.searchParams.update();},getSearchParams:function getSearchParams(){return this.searchParams.facade;},getHash:function getHash(){var e=this.fragment;return e?"#"+e:"";},setHash:function setHash(e){""!=(e=tV(e))?("#"==gV(e,0)&&(e=CV(e,1)),this.fragment="",this.parse(e,yT)):this.fragment=null;},update:function update(){this.query=this.searchParams.serialize()||null;}};var wT=function wT(e){var t=_C(this,bT),i=rV(arguments.length,1)>1?arguments[1]:void 0,r=aV(t,new pT(e,!1,i));HC||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash());},bT=wT.prototype,kT=function kT(e,t){return{get:function get(){return sV(this)[e]();},set:t&&function(e){return sV(this)[t](e);},configurable:!0,enumerable:!0};};if(HC&&(ZC(bT,"href",kT("serialize","setHref")),ZC(bT,"origin",kT("getOrigin")),ZC(bT,"protocol",kT("getProtocol","setProtocol")),ZC(bT,"username",kT("getUsername","setUsername")),ZC(bT,"password",kT("getPassword","setPassword")),ZC(bT,"host",kT("getHost","setHost")),ZC(bT,"hostname",kT("getHostname","setHostname")),ZC(bT,"port",kT("getPort","setPort")),ZC(bT,"pathname",kT("getPathname","setPathname")),ZC(bT,"search",kT("getSearch","setSearch")),ZC(bT,"searchParams",kT("getSearchParams")),ZC(bT,"hash",kT("getHash","setHash"))),qC(bT,"toJSON",function(){return sV(this).serialize();},{enumerable:!0}),qC(bT,"toString",function(){return sV(this).serialize();},{enumerable:!0}),cV){var xT=cV.createObjectURL,ST=cV.revokeObjectURL;xT&&qC(wT,"createObjectURL",YC(xT,cV)),ST&&qC(wT,"revokeObjectURL",YC(ST,cV));}iV(wT,"URL"),WC({global:!0,constructor:!0,forced:!FC,sham:!HC},{URL:wT});var CT=ne.URL;!function(e){e.exports=CT;}(Rx);var VT=t(Ux),TT={},IT={get exports(){return TT;},set exports(e){TT=e;}};!function(e){e.exports=Oh;}(IT);var ET=t(TT),PT={},BT={get exports(){return PT;},set exports(e){PT=e;}};!function(e){e.exports=vd;}(BT);var DT=t(PT),MT={},AT={get exports(){return MT;},set exports(e){MT=e;}},zT=M,UT=Ai,RT=TypeError,LT=Object.getOwnPropertyDescriptor,NT=zT&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1;}catch(e){return e instanceof TypeError;}}()?function(e,t){if(UT(e)&&!LT(e,"length").writable)throw RT("Cannot set read only .length");return e.length=t;}:function(e,t){return e.length=t;},OT=Pe,WT=TypeError,HT=function HT(e,t){if(!delete e[t])throw WT("Cannot delete property "+OT(t)+" of "+OT(e));},FT=Di,jT=$e,YT=rn,XT=Ni,qT=ji,ZT=NT,_T=Xi,GT=Pr,KT=Gi,$T=HT,QT=Ar("splice"),JT=Math.max,eI=Math.min;FT({target:"Array",proto:!0,forced:!QT},{splice:function splice(e,t){var i,r,n,o,a,s,l=jT(this),u=qT(l),c=YT(e,u),h=arguments.length;for(0===h?i=r=0:1===h?(i=0,r=u-c):(i=h-2,r=eI(JT(XT(t),0),u-c)),_T(u+i-r),n=GT(l,r),o=0;o<r;o++)(a=c+o)in l&&KT(n,o,l[a]);if(n.length=r,i<r){for(o=c;o<u-r;o++)s=o+i,(a=o+r)in l?l[s]=l[a]:$T(l,s);for(o=u;o>u-r+i;o--)$T(l,o-1);}else if(i>r)for(o=u-r;o>c;o--)s=o+i-1,(a=o+r-1)in l?l[s]=l[a]:$T(l,s);for(o=0;o<i;o++)l[o+c]=arguments[o+2];return ZT(l,u-r+i),n;}});var tI=Ah("Array").splice,iI=ce,rI=tI,nI=Array.prototype,oI=function oI(e){var t=e.splice;return e===nI||iI(nI,e)&&t===nI.splice?rI:t;},aI=oI;!function(e){e.exports=aI;}(AT);var sI=t(MT),lI={},uI={get exports(){return lI;},set exports(e){lI=e;}},cI=Di,hI=ra.findIndex,dI="findIndex",fI=!0;dI in[]&&Array(1)[dI](function(){fI=!1;}),cI({target:"Array",proto:!0,forced:fI},{findIndex:function findIndex(e){return hI(this,e,arguments.length>1?arguments[1]:void 0);}});var vI=Ah("Array").findIndex,gI=ce,mI=vI,yI=Array.prototype,pI=function pI(e){var t=e.findIndex;return e===yI||gI(yI,e)&&t===yI.findIndex?mI:t;},wI=pI;!function(e){e.exports=wI;}(uI);var bI=t(lI),kI={},xI={get exports(){return kI;},set exports(e){kI=e;}},SI=Di,CI=Math.hypot,VI=Math.abs,TI=Math.sqrt;SI({target:"Math",stat:!0,arity:2,forced:!!CI&&CI(1/0,NaN)!==1/0},{hypot:function hypot(e,t){for(var i,r,n=0,o=0,a=arguments.length,s=0;o<a;)s<(i=VI(arguments[o++]))?(n=n*(r=s/i)*r+1,s=i):n+=i>0?(r=i/s)*r:i;return s===1/0?1/0:s*TI(n);}});var II=ne.Math.hypot;!function(e){e.exports=II;}(xI);var EI=t(kI),PI={},BI={get exports(){return PI;},set exports(e){PI=e;}},DI=Math.sign||function(e){var t=+e;return 0==t||t!=t?t:t<0?-1:1;};Di({target:"Math",stat:!0},{sign:DI});var MI=ne.Math.sign;!function(e){e.exports=MI;}(BI);var AI=t(PI),zI={},UI={get exports(){return zI;},set exports(e){zI=e;}},RI=ra.map;Di({target:"Array",proto:!0,forced:!Ar("map")},{map:function map(e){return RI(this,e,arguments.length>1?arguments[1]:void 0);}});var LI=Ah("Array").map,NI=ce,OI=LI,WI=Array.prototype,HI=function HI(e){var t=e.map;return e===WI||NI(WI,e)&&t===WI.map?OI:t;},FI=HI;!function(e){e.exports=FI;}(UI);var jI=t(zI),YI={},XI={get exports(){return YI;},set exports(e){YI=e;}},qI=$e,ZI=rn,_I=ji,GI=function GI(e){for(var t=qI(this),i=_I(t),r=arguments.length,n=ZI(r>1?arguments[1]:void 0,i),o=r>2?arguments[2]:void 0,a=void 0===o?i:ZI(o,i);a>n;)t[n++]=e;return t;};Di({target:"Array",proto:!0},{fill:GI});var KI=Ah("Array").fill,$I=ce,QI=KI,JI=Array.prototype,eE=function eE(e){var t=e.fill;return e===JI||$I(JI,e)&&t===JI.fill?QI:t;},tE=eE;!function(e){e.exports=tE;}(XI);var iE=t(YI),rE={},nE={get exports(){return rE;},set exports(e){rE=e;}},oE=Di,aE=ra.find,sE="find",lE=!0;sE in[]&&Array(1)[sE](function(){lE=!1;}),oE({target:"Array",proto:!0,forced:lE},{find:function find(e){return aE(this,e,arguments.length>1?arguments[1]:void 0);}});var uE=Ah("Array").find,cE=ce,hE=uE,dE=Array.prototype,fE=function fE(e){var t=e.find;return e===dE||cE(dE,e)&&t===dE.find?hE:t;},vE=fE;!function(e){e.exports=vE;}(nE);var gE=t(rE),mE={},yE={get exports(){return mE;},set exports(e){mE=e;}},pE="function"==typeof Bun&&Bun&&"string"==typeof Bun.version,wE=s,bE=v,kE=B,xE=pE,SE=he,CE=Ts,VE=qg,TE=wE.Function,IE=/MSIE .\./.test(SE)||xE&&function(){var e=wE.Bun.version.split(".");return e.length<3||0==e[0]&&(e[1]<3||3==e[1]&&0==e[2]);}(),EE=function EE(e,t){var i=t?2:1;return IE?function(r,n){var o=VE(arguments.length,1)>i,a=kE(r)?r:TE(r),s=o?CE(arguments,i):[],l=o?function(){bE(a,this,s);}:a;return t?e(l,n):e(l);}:e;},PE=Di,BE=s,DE=EE(BE.setInterval,!0);PE({global:!0,bind:!0,forced:BE.setInterval!==DE},{setInterval:DE});var ME=Di,AE=s,zE=EE(AE.setTimeout,!0);ME({global:!0,bind:!0,forced:AE.setTimeout!==zE},{setTimeout:zE});var UE=ne.setTimeout;!function(e){e.exports=UE;}(yE);var RE=t(mE),LE={},NE={get exports(){return LE;},set exports(e){LE=e;}},OE=M,WE=w,HE=wn,FE=ee,jE=WE(R.f),YE=WE([].push),XE=function XE(e){return function(t){for(var i,r=FE(t),n=HE(r),o=n.length,a=0,s=[];o>a;)i=n[a++],OE&&!jE(r,i)||YE(s,e?[i,r[i]]:r[i]);return s;};},qE={entries:XE(!0),values:XE(!1)},ZE=qE.entries;Di({target:"Object",stat:!0},{entries:function entries(e){return ZE(e);}});var _E=ne.Object.entries;!function(e){e.exports=_E;}(NE);var GE=t(LE),KE={},$E={get exports(){return KE;},set exports(e){KE=e;}};!function(e){e.exports=ow;}($E);var QE=t(KE),JE={},eP={get exports(){return JE;},set exports(e){JE=e;}},tP=ln.includes;Di({target:"Array",proto:!0,forced:l(function(){return!Array(1).includes();})},{includes:function includes(e){return tP(this,e,arguments.length>1?arguments[1]:void 0);}});var iP=Ah("Array").includes,rP=re,nP=S,oP=gt("match"),aP=function aP(e){var t;return rP(e)&&(void 0!==(t=e[oP])?!!t:"RegExp"==nP(e));},sP=TypeError,lP=function lP(e){if(aP(e))throw sP("The method doesn't accept regular expressions");return e;},uP=gt("match"),cP=function cP(e){var t=/./;try{"/./"[e](t);}catch(i){try{return t[uP]=!1,"/./"[e](t);}catch(e){}}return!1;},hP=Di,dP=lP,fP=$,vP=$r,gP=cP,mP=w("".indexOf);hP({target:"String",proto:!0,forced:!gP("includes")},{includes:function includes(e){return!!~mP(vP(fP(this)),vP(dP(e)),arguments.length>1?arguments[1]:void 0);}});var yP=Ah("String").includes,pP=ce,wP=iP,bP=yP,kP=Array.prototype,xP=String.prototype,SP=function SP(e){var t=e.includes;return e===kP||pP(kP,e)&&t===kP.includes?wP:"string"==typeof e||e===xP||pP(xP,e)&&t===xP.includes?bP:t;},CP=SP;!function(e){e.exports=CP;}(eP);var VP=t(JE),TP={},IP={get exports(){return TP;},set exports(e){TP=e;}};!function(e){e.exports=ch;}(IP);var EP=t(TP),PP={},BP={get exports(){return PP;},set exports(e){PP=e;}},DP=Ah("Array").keys,MP=nr,AP=et,zP=ce,UP=DP,RP=Array.prototype,LP={DOMTokenList:!0,NodeList:!0},NP=function NP(e){var t=e.keys;return e===RP||zP(RP,e)&&t===RP.keys||AP(LP,MP(e))?UP:t;};!function(e){e.exports=NP;}(BP);var OP=t(PP),WP={},HP={get exports(){return WP;},set exports(e){WP=e;}},FP={},jP={get exports(){return FP;},set exports(e){FP=e;}},YP=l(function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8});}}),XP=l,qP=re,ZP=S,_P=YP,GP=Object.isExtensible,KP=XP(function(){GP(1);})||_P?function(e){return!!qP(e)&&(!_P||"ArrayBuffer"!=ZP(e))&&(!GP||GP(e));}:GP,$P=!l(function(){return Object.isExtensible(Object.preventExtensions({}));}),QP=Di,JP=w,eB=un,tB=re,iB=et,rB=ei.f,nB=Xn,oB=_n,aB=KP,sB=$P,lB=!1,uB=ot("meta"),cB=0,hB=function hB(e){rB(e,uB,{value:{objectID:"O"+cB++,weakData:{}}});},dB=jP.exports={enable:function enable(){dB.enable=function(){},lB=!0;var e=nB.f,t=JP([].splice),i={};i[uB]=1,e(i).length&&(nB.f=function(i){for(var r=e(i),n=0,o=r.length;n<o;n++)if(r[n]===uB){t(r,n,1);break;}return r;},QP({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:oB.f}));},fastKey:function fastKey(e,t){if(!tB(e))return"symbol"==_typeof(e)?e:("string"==typeof e?"S":"P")+e;if(!iB(e,uB)){if(!aB(e))return"F";if(!t)return"E";hB(e);}return e[uB].objectID;},getWeakData:function getWeakData(e,t){if(!iB(e,uB)){if(!aB(e))return!0;if(!t)return!1;hB(e);}return e[uB].weakData;},onFreeze:function onFreeze(e){return sB&&lB&&aB(e)&&!iB(e,uB)&&hB(e),e;}};eB[uB]=!0;var fB=Di,vB=s,gB=FP,mB=l,yB=wi,pB=og,wB=Og,bB=B,kB=re,xB=Ao,SB=ei.f,CB=ra.forEach,VB=M,TB=Go.set,IB=Go.getterFor,EB=ei.f,PB=Yn,BB=wS,DB=Jt,MB=Og,AB=_,zB=og,UB=uu,RB=cu,LB=Rg,NB=M,OB=FP.fastKey,WB=Go.set,HB=Go.getterFor,FB={getConstructor:function getConstructor(e,t,i,r){var n=e(function(e,n){MB(e,o),WB(e,{type:t,index:PB(null),first:void 0,last:void 0,size:0}),NB||(e.size=0),AB(n)||zB(n,e[r],{that:e,AS_ENTRIES:i});}),o=n.prototype,a=HB(t),s=function s(e,t,i){var r,n,o=a(e),s=l(e,t);return s?s.value=i:(o.last=s={index:n=OB(t,!0),key:t,value:i,previous:r=o.last,next:void 0,removed:!1},o.first||(o.first=s),r&&(r.next=s),NB?o.size++:e.size++,"F"!==n&&(o.index[n]=s)),e;},l=function l(e,t){var i,r=a(e),n=OB(t);if("F"!==n)return r.index[n];for(i=r.first;i;i=i.next)if(i.key==t)return i;};return BB(o,{clear:function clear(){for(var e=a(this),t=e.index,i=e.first;i;)i.removed=!0,i.previous&&(i.previous=i.previous.next=void 0),delete t[i.index],i=i.next;e.first=e.last=void 0,NB?e.size=0:this.size=0;},delete:function _delete(e){var t=this,i=a(t),r=l(t,e);if(r){var n=r.next,o=r.previous;delete i.index[r.index],r.removed=!0,o&&(o.next=n),n&&(n.previous=o),i.first==r&&(i.first=n),i.last==r&&(i.last=o),NB?i.size--:t.size--;}return!!r;},forEach:function forEach(e){for(var t,i=a(this),r=DB(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:i.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous;},has:function has(e){return!!l(this,e);}}),BB(o,i?{get:function get(e){var t=l(this,e);return t&&t.value;},set:function set(e,t){return s(this,0===e?0:e,t);}}:{add:function add(e){return s(this,e=0===e?0:e,e);}}),NB&&EB(o,"size",{get:function get(){return a(this).size;}}),n;},setStrong:function setStrong(e,t,i){var r=t+" Iterator",n=HB(t),o=HB(r);UB(e,t,function(e,t){WB(this,{type:r,target:e,state:n(e),kind:t,last:void 0});},function(){for(var e=o(this),t=e.kind,i=e.last;i&&i.removed;)i=i.previous;return e.target&&(e.last=i=i?i.next:e.state.first)?RB("keys"==t?i.key:"values"==t?i.value:[i.key,i.value],!1):(e.target=void 0,RB(void 0,!0));},i?"entries":"values",!i,!0),LB(t);}},jB=function jB(e,t,i){var r,n=-1!==e.indexOf("Map"),o=-1!==e.indexOf("Weak"),a=n?"set":"add",s=vB[e],l=s&&s.prototype,u={};if(VB&&bB(s)&&(o||l.forEach&&!mB(function(){new s().entries().next();}))){var c=(r=t(function(t,i){TB(wB(t,c),{type:e,collection:new s()}),null!=i&&pB(i,t[a],{that:t,AS_ENTRIES:n});})).prototype,h=IB(e);CB(["add","clear","delete","forEach","get","has","set","keys","values","entries"],function(e){var t="add"==e||"set"==e;!(e in l)||o&&"clear"==e||yB(c,e,function(i,r){var n=h(this).collection;if(!t&&o&&!kB(i))return"get"==e&&void 0;var a=n[e](0===i?0:i,r);return t?this:a;});}),o||SB(c,"size",{configurable:!0,get:function get(){return h(this).collection.size;}});}else r=i.getConstructor(t,e,n,a),gB.enable();return xB(r,e,!1,!0),u[e]=r,fB({global:!0,forced:!0},u),o||i.setStrong(r,e,n),r;};jB("Set",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0);};},FB);var YB=ne.Set;!function(e){e.exports=YB;}(HP);var XB=t(WP),qB={},ZB={get exports(){return qB;},set exports(e){qB=e;}},_B=Ai,GB=ji,KB=Xi,$B=Jt,QB=function QB(e,t,i,r,n,o,a,s){for(var l,u,c=n,h=0,d=!!a&&$B(a,s);h<r;)h in i&&(l=d?d(i[h],h,t):i[h],o>0&&_B(l)?(u=GB(l),c=QB(e,t,l,u,c,o-1)-1):(KB(c+1),e[c]=l),c++),h++;return c;},JB=QB,eD=$e,tD=ji,iD=Ni,rD=Pr;Di({target:"Array",proto:!0},{flat:function flat(){var e=arguments.length?arguments[0]:void 0,t=eD(this),i=tD(t),r=rD(t,0);return r.length=JB(r,t,t,i,0,void 0===e?1:iD(e)),r;}});var nD=Ah("Array").flat,oD=ce,aD=nD,sD=Array.prototype,lD=function lD(e){var t=e.flat;return e===sD||oD(sD,e)&&t===sD.flat?aD:t;},uD=lD;!function(e){e.exports=uD;}(ZB);var cD=t(qB),hD={},dD={get exports(){return hD;},set exports(e){hD=e;}},fD=s.isFinite,vD=Number.isFinite||function(e){return"number"==typeof e&&fD(e);};Di({target:"Number",stat:!0},{isFinite:vD});var gD=ne.Number.isFinite;!function(e){e.exports=gD;}(dD);var mD=t(hD),yD={},pD={get exports(){return yD;},set exports(e){yD=e;}},wD=s,bD=l,kD=$r,xD=Wk.trim,SD=Dk,CD=w("".charAt),VD=wD.parseFloat,TD=wD.Symbol,ID=TD&&TD.iterator,ED=1/VD(SD+"-0")!=-1/0||ID&&!bD(function(){VD(Object(ID));})?function(e){var t=xD(kD(e)),i=VD(t);return 0===i&&"-"==CD(t,0)?-0:i;}:VD;Di({global:!0,forced:parseFloat!=ED},{parseFloat:ED});var PD=ne.parseFloat;!function(e){e.exports=PD;}(pD);var BD=t(yD),DD={},MD={get exports(){return DD;},set exports(e){DD=e;}},AD=Di,zD=T;D.f;var UD=Hi,RD=$r,LD=lP,ND=$,OD=cP,WD=zD("".startsWith),HD=zD("".slice),FD=Math.min;AD({target:"String",proto:!0,forced:!OD("startsWith")},{startsWith:function startsWith(e){var t=RD(ND(this));LD(e);var i=UD(FD(arguments.length>1?arguments[1]:void 0,t.length)),r=RD(e);return WD?WD(t,r,i):HD(t,i,i+r.length)===r;}});var jD=Ah("String").startsWith,YD=ce,XD=jD,qD=String.prototype,ZD=function ZD(e){var t=e.startsWith;return"string"==typeof e||e===qD||YD(qD,e)&&t===qD.startsWith?XD:t;},_D=ZD;!function(e){e.exports=_D;}(MD);var GD=t(DD),KD={},$D={get exports(){return KD;},set exports(e){KD=e;}},QD=Jx;Di({target:"Object",stat:!0,arity:2,forced:Object.assign!==QD},{assign:QD});var JD=ne.Object.assign;!function(e){e.exports=JD;}($D);var eM=t(KD),tM={},iM={get exports(){return tM;},set exports(e){tM=e;}},rM=he.match(/firefox\/(\d+)/i),nM=!!rM&&+rM[1],oM=/MSIE|Trident/.test(he),aM=he.match(/AppleWebKit\/(\d+)\./),sM=!!aM&&+aM[1],lM=Di,uM=w,cM=Ae,hM=$e,dM=ji,fM=HT,vM=$r,gM=l,mM=VS,yM=id,pM=nM,wM=oM,bM=pe,kM=sM,xM=[],SM=uM(xM.sort),CM=uM(xM.push),VM=gM(function(){xM.sort(void 0);}),TM=gM(function(){xM.sort(null);}),IM=yM("sort"),EM=!gM(function(){if(bM)return bM<70;if(!(pM&&pM>3)){if(wM)return!0;if(kM)return kM<603;var e,t,i,r,n="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2;}for(r=0;r<47;r++)xM.push({k:t+r,v:i});}for(xM.sort(function(e,t){return t.v-e.v;}),r=0;r<xM.length;r++)t=xM[r].k.charAt(0),n.charAt(n.length-1)!==t&&(n+=t);return"DGBEFHACIJK"!==n;}});lM({target:"Array",proto:!0,forced:VM||!TM||!IM||!EM},{sort:function sort(e){void 0!==e&&cM(e);var t=hM(this);if(EM)return void 0===e?SM(t):SM(t,e);var i,r,n=[],o=dM(t);for(r=0;r<o;r++)r in t&&CM(n,t[r]);for(mM(n,function(e){return function(t,i){return void 0===i?-1:void 0===t?1:void 0!==e?+e(t,i)||0:vM(t)>vM(i)?1:-1;};}(e)),i=dM(n),r=0;r<i;)t[r]=n[r++];for(;r<o;)fM(t,r++);return t;}});var PM=Ah("Array").sort,BM=ce,DM=PM,MM=Array.prototype,AM=function AM(e){var t=e.sort;return e===MM||BM(MM,e)&&t===MM.sort?DM:t;},zM=AM;!function(e){e.exports=zM;}(iM);var UM=t(tM),RM={},LM={get exports(){return RM;},set exports(e){RM=e;}},NM={},OM={get exports(){return NM;},set exports(e){NM=e;}},WM=s;Di({global:!0,forced:WM.globalThis!==WM},{globalThis:WM});var HM={},FM={get exports(){return HM;},set exports(e){HM=e;}};!function(e){e.exports=s;}(FM);var jM=HM;!function(e){e.exports=jM;}(OM),function(e){e.exports=NM;}(LM);var YM=t(RM),XM={},qM={get exports(){return XM;},set exports(e){XM=e;}};!function(e){e.exports=Cw;}(qM);var ZM=t(XM),_M={},GM={get exports(){return _M;},set exports(e){_M=e;}},KM=Di,$M=Date,QM=w($M.prototype.getTime);KM({target:"Date",stat:!0},{now:function now(){return QM(new $M());}});var JM=ne.Date.now;!function(e){e.exports=JM;}(GM);var eA=t(_M),tA={},iA={get exports(){return tA;},set exports(e){tA=e;}},rA=ne,nA=v;rA.JSON||(rA.JSON={stringify:JSON.stringify});var oA=function oA(e,t,i){return nA(rA.JSON.stringify,null,arguments);},aA=oA;!function(e){e.exports=aA;}(iA);var sA=t(tA),lA={},uA={get exports(){return lA;},set exports(e){lA=e;}},cA=qE.values;Di({target:"Object",stat:!0},{values:function values(e){return cA(e);}});var hA=ne.Object.values;!function(e){e.exports=hA;}(uA);var dA=t(lA),fA={},vA={get exports(){return fA;},set exports(e){fA=e;}};!function(e){e.exports=Gd;}(vA);var gA=t(fA),mA={},yA={get exports(){return mA;},set exports(e){mA=e;}},pA=ra.some;Di({target:"Array",proto:!0,forced:!id("some")},{some:function some(e){return pA(this,e,arguments.length>1?arguments[1]:void 0);}});var wA=Ah("Array").some,bA=ce,kA=wA,xA=Array.prototype,SA=function SA(e){var t=e.some;return e===xA||bA(xA,e)&&t===xA.some?kA:t;},CA=SA;!function(e){e.exports=CA;}(yA);var VA=t(mA),TA={},IA={get exports(){return TA;},set exports(e){TA=e;}};!function(e){e.exports=jf;}(IA);var EA,PA,BA,DA,MA,AA,zA,UA,RA,LA=t(TA),NA=["style"],OA=["style"],WA=["style"],HA=["style"],FA=["style"],jA=["style"],YA=["style"],XA=["style"],qA={code:0,message:"ok."},ZA={code:8e4,message:"The parameter type is wrong."},_A={code:80002,message:"The parameter is out of range."},GA={code:80003,message:"The image does not exist."},KA={code:80013,message:"The parameter is invalid."},$A={code:80021,message:"The size is invalid."},QA=function QA(e){return e.replace(/[A-Z]/g,function(e){return"-".concat(e.toLowerCase());});},JA=function JA(e){return Object.prototype.toString.call(e);},ez=function ez(e){return uk?uk(e):"[object Array]"===JA(e);},tz=function tz(e){return null!==e&&"[object Object]"===JA(e);},iz=function e(t){var i,r=null;return ez(t)&&(r||(r=[]),dk(t).call(t,function(t){r.push(e(t));})),tz(t)&&(r||(r={}),dk(i=gk(t)).call(i,function(i){r[i]=e(t[i]);})),r||t;};function rz(e,t){for(var i in t)e[i]=e[i]&&"[object Object]"===e[i].toString()?rz(e[i],t[i]):e[i]=t[i];return e;}var nz=function nz(e){return void 0===e;},oz=function oz(e,t){var i,r;e=null!==(i=e)&&void 0!==i?i:"yyyy-MM-dd hh:mm:ss";var n=nz(t)?new Date():new Date(t),o={"M+":(n.getMonth()+1).toString(),"d+":n.getDate().toString(),"h+":n.getHours().toString(),"m+":n.getMinutes().toString(),"s+":n.getSeconds().toString(),"q+":Math.floor((n.getMonth()+3)/3).toString(),S:n.getMilliseconds().toString()};return /(y+)/.test(e)&&(e=e.replace(RegExp.$1,"".concat(n.getFullYear()).substring(4-RegExp.$1.length))),dk(r=gk(o)).call(r,function(t){new RegExp("(".concat(t,")")).test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?o[t]:"00".concat(o[t]).substring("".concat(o[t]).length)));}),e;},az=function az(e){return"string"==typeof e;};function sz(e,t){return Math.pow(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2),.5);}function lz(e){var t=e.type,i=e.value;return"hex"===t?"#".concat(i):"literal"===t?i:"rgb"===t?"rgb(".concat(i.join(","),")"):"rgba(".concat(i.join(","),")");}var uz=function(){var e=/^(linear\-gradient)/i,t=/^(repeating\-linear\-gradient)/i,i=/^(radial\-gradient)/i,r=/^(repeating\-radial\-gradient)/i,n=/^(conic\-gradient)/i,o=/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,a=/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,s=/^(left|center|right|top|bottom)/i,l=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,u=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,c=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,h=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,d=/^\(/,f=/^\)/,v=/^,/,g=/^\#([0-9a-fA-F]+)/,m=/^([a-zA-Z]+)/,y=/^rgb/i,p=/^rgba/i,w=/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/,b="";function k(e){var t;throw new Error(Ck(t="".concat(b,": ")).call(t,e));}function x(){return S("linear-gradient",e,V)||S("repeating-linear-gradient",t,V)||S("radial-gradient",i,T)||S("repeating-radial-gradient",r,T)||S("conic-gradient",n,T);}function S(e,t,i){return C(t,function(t){var r=i();return r&&(L(v)||k("Missing comma before color stops")),{type:e,orientation:r,colorStops:D(M)};});}function C(e,t){var i=L(e);if(i){L(d)||k("Missing (");var r=t(i);return L(f)||k("Missing )"),r;}}function V(){return R("directional",o,1)||R("angular",h,1);}function T(){var e,t,i=I();return i&&((e=[]).push(i),t=b,L(v)&&((i=I())?e.push(i):b=t)),e;}function I(){var e=function(){var e=R("shape",/^(circle)/i,0);return e&&(e.style=U()||E()),e;}()||function(){var e=R("shape",/^(ellipse)/i,0);return e&&(e.style=z()||E()),e;}();if(e)e.at=P();else{var t=E();if(t){e=t;var i=P();i&&(e.at=i);}else{var r=B();r&&(e={type:"default-radial",at:r});}}return e;}function E(){return R("extent-keyword",a,1);}function P(){if(R("position",/^at/,0)){var e=B();return e||k("Missing positioning value"),e;}}function B(){var e={x:z(),y:z()};if(e.x||e.y)return{type:"position",value:e};}function D(e){var t=e(),i=[];if(t)for(i.push(t);L(v);)(t=e())?i.push(t):k("One extra comma");return i;}function M(){var e=R("hex",g,1)||C(p,function(){return{type:"rgba",value:D(A)};})||C(y,function(){return{type:"rgb",value:D(A)};})||R("literal",m,0);return e||k("Expected color definition"),e.length=z(),e;}function A(){return L(w)[1];}function z(){return R("%",u,1)||R("position-keyword",s,1)||U();}function U(){return R("px",l,1)||R("em",c,1);}function R(e,t,i){var r=L(t);if(r)return{type:e,value:r[i]};}function L(e){var t=/^[\n\r\t\s]+/.exec(b);t&&N(t[0].length);var i=e.exec(b);return i&&N(i[0].length),i;}function N(e){b=b.substring(e);}return function(e){return b=e,function(){var e=D(x);return b.length>0&&k("Invalid input not EOF"),e;}();};}(),cz=function cz(e){return"number"==typeof e&&!Ek(e);},hz=function hz(e){return"[object Boolean]"===JA(e);},dz=function dz(e){return"function"==typeof e;},fz=function fz(){return void 0!==document.documentMode;},vz=function vz(){return"ontouchstart"in document.documentElement;};function gz(e){return null==e;}var mz=function mz(e,t){return e in t;},yz=function yz(e,t){for(var i=[];e;){var r=e.match(t);if(!r)break;i.push(r),e=e.substring(r.index+r[0].length);}return i;};function pz(e,t){var i;return dk(i=gk(e)).call(i,function(i){nz(t[i])?t[i]=e[i]:tz(e[i])?pz(e[i],t[i]):t[i]=e[i];}),t;}var wz=0,bz=function bz(){var e;return wz+=1,Ck(e="".concat(new Date().getTime().toString(36))).call(e,wz.toString(36));},kz=function kz(e,t,i){return Math.min(Math.max(e,t),i);},xz="\\s*([+-]?\\d+)\\s*",Sz="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Cz="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Vz=/^#([0-9a-f]{3,8})$/,Tz=new RegExp(Ck(EA="^rgb\\(".concat(xz,",").concat(xz,",")).call(EA,xz,"\\)$")),Iz=new RegExp(Ck(PA="^rgb\\(".concat(Cz,",").concat(Cz,",")).call(PA,Cz,"\\)$")),Ez=new RegExp(Ck(BA=Ck(DA="^rgba\\(".concat(xz,",").concat(xz,",")).call(DA,xz,",")).call(BA,Sz,"\\)$")),Pz=new RegExp(Ck(MA=Ck(AA="^rgba\\(".concat(Cz,",").concat(Cz,",")).call(AA,Cz,",")).call(MA,Sz,"\\)$")),Bz=new RegExp(Ck(zA="^hsl\\(".concat(Sz,",").concat(Cz,",")).call(zA,Cz,"\\)$")),Dz=new RegExp(Ck(UA=Ck(RA="^hsla\\(".concat(Sz,",").concat(Cz,",")).call(RA,Cz,",")).call(UA,Sz,"\\)$")),Mz={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Az=ok(function e(t,i,r,n){ak(this,e),tk(this,"r",void 0),tk(this,"g",void 0),tk(this,"b",void 0),tk(this,"opacity",void 0),this.r=t,this.g=i,this.b=r,this.opacity=n;});function zz(e){return new Az(e>>16&255,e>>8&255,255&e,1);}function Uz(e,t,i,r){return r<=0&&(e=NaN,t=NaN,i=NaN),new Az(e,t,i,r);}function Rz(e,t,i,r){return r<=0?(e=NaN,t=NaN,i=NaN):i<=0||i>=1?(e=NaN,t=NaN):t<=0&&(e=NaN),{h:e,s:t,l:i,opacity:r};}function Lz(e,t,i){return e<60?(t+(i-t)*e)/60*255:e<180?255*i:e<240?(t+(i-t)*(240-e))/60*255:255*t;}function Nz(e){var t=e.h<0?e.h%360+360:e.h%360,i=Ek(t)||Ek(e.s)?0:e.s,r=e.l,n=r+(r<.5?r:1-r)*i,o=2*r-n;return new Az(Lz(t>=240?t-240:t+120,o,n),Lz(t,o,n),Lz(t<120?t+240:t-120,o,n),e.opacity);}var Oz=function Oz(e){var t,i,r;if(e=$k(t="".concat(e)).call(t).toLowerCase(),Vz.exec(e))switch(i=Vz.exec(e),r=i[1].length,i=fx(i[1],16),r){case 6:return zz(i);case 3:return new Az(i>>8&15|i>>4&240,i>>4&15|240&i,(15&i)<<4|15&i,1);case 8:return Uz(i>>24&255,i>>16&255,i>>8&255,(255&i)/255);case 4:return Uz(i>>12&15|i>>8&240,i>>8&15|i>>4&240,i>>4&15|240&i,((15&i)<<4|15&i)/255);default:return null;}return Tz.exec(e)?(i=Tz.exec(e),new Az(i[1],i[2],i[3],1)):Iz.exec(e)?(i=Iz.exec(e),new Az(255*i[1]/100,255*i[2]/100,255*i[3]/100,1)):Ez.exec(e)?Uz((i=Ez.exec(e))[1],i[2],i[3],i[4]):Pz.exec(e)?Uz(255*(i=Pz.exec(e))[1]/100,255*i[2]/100,255*i[3]/100,i[4]):Bz.exec(e)?Nz(Rz((i=Bz.exec(e))[1],i[2]/100,i[3]/100,1)):Dz.exec(e)?Nz(Rz((i=Dz.exec(e))[1],i[2]/100,i[3]/100,i[4])):Mz.hasOwnProperty(e)?zz(Mz[e]):"transparent"===e?new Az(NaN,NaN,NaN,0):null;};function Wz(e){var t,i;return e?Dx(t=zx(i=gk(e)).call(i,function(t){return null!==e[t]&&void 0!==e[t];})).call(t,function(t,i){return rk(rk({},t),{},tk({},i,e[i]));},{}):{};}function Hz(e){return 0===(e=String(e)).length?"":e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&#39;/g,"'").replace(/&quot;/g,'"');}var Fz=function Fz(e,t,i){void 0===t?i.appendChild(e):i.insertBefore(e,t);},jz=function jz(e,t){var i=t.parentNode;i.lastChild===t?i.appendChild(e):Fz(e,t.nextSibling,i);},Yz=function Yz(e){e&&(e.stopPropagation?e.stopPropagation():e.cancelBubble=!0);},Xz=function Xz(e){var t=VT||window.webkitURL,i="string";return az(e)?i="string":"[object Blob]"===JA(e)?(i="blob",e=t.createObjectURL(e)):("[object ArrayBuffer]"===JA(e)||ez(e))&&(i="blob",e=t.createObjectURL(new Blob([e]))),{type:i,data:e};},qz=function qz(){var e=window;if(e){if(e.devicePixelRatio)return e.devicePixelRatio;if(e.screen.deviceXDPI&&e.screen.logicalXDPI)return e.screen.deviceXDPI/e.screen.logicalXDPI;}return 1;},Zz=function Zz(e){var t=VT||window.webkitURL;/^blob:/.test(e)&&t.revokeObjectURL(e);},_z=function _z(){return{scrollX:void 0===window.scrollX?window.pageXOffset:window.scrollX,scrollY:void 0===window.scrollY?window.pageYOffset:window.scrollY};},Gz=function Gz(e){return(e/=.5)<1?Math.pow(e,3):.5*(Math.pow(e-2,3)+2);},Kz=function Kz(e){return Math.pow(e-1,3)+1;},$z=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";ak(this,e),tk(this,"prefix",void 0),tk(this,"postfix",void 0),tk(this,"isDestroyed",!1),tk(this,"uid",bz()),tk(this,"cacheEvents",void 0),tk(this,"events",void 0),tk(this,"isCached",void 0),this.cacheEvents=[],this.events={},this.isCached=!1,this.prefix=t,this.postfix=i;}return ok(e,[{key:"save",value:function value(){this.isCached=!0;}},{key:"restore",value:function value(){var e,t=this;this.isCached=!1,dk(e=this.cacheEvents).call(e,function(e){var i,r=e.eventName,n=e.param;t.emit.apply(t,Ck(i=[r]).call(i,hb(n)));}),this.cacheEvents.length=0;}},{key:"destroy",value:function value(){var e=this;if(!this.isDestroyed){for(var t in this.events)if(Object.prototype.hasOwnProperty.call(this.events,t)){var i,r=this.events[t];r&&dk(i=ET(r).call(r)).call(i,function(t){var i=t.name,r=t.fn,n=t.context,o=t.once;e.off(i,r,n,o);});}this.events={},this.isDestroyed=!0;}}},{key:"on",value:function value(e,t,i){var r,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=this.events,a={name:e=this.format(e),uid:bz(),context:i,once:n,fn:t};return o[e]||(o[e]=[]),DT(r=o[e]).call(r,a)<0&&o[e].push(a),a;}},{key:"once",value:function value(e,t,i){return this.on(e,t,i,!0);}},{key:"emit",value:function value(e){for(var t,i,r=this,n=arguments.length,o=new Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];if(this.isCached)return this.cacheEvents.push({eventName:e,param:o}),!0;var s=this.events,l=s[e=this.format(e)];return!(!l||!l.length||(dk(t=ET(l).call(l)).call(t,function(e){var t,i=e.fn,r=e.context;i.call.apply(i,Ck(t=[r||null]).call(t,o));}),dk(i=ET(l).call(l)).call(i,function(t){var i=t.fn,n=t.context,o=t.once;o&&r.off(e,i,n,o);}),0));}},{key:"off",value:function value(e,t,i,r){var n=this.events,o=n[e=this.format(e)];if(!o)return!1;if(!arguments.length)return o.length=0,!0;for(var a=o.length-1;a>=0;a--){var s=o[a];t&&s.fn!==t||i&&s.context!==i||r&&s.once!==r||sI(o).call(o,a,1);}return!0;}},{key:"removeAllEventListeners",value:function value(e){if(e){var t,i;e=this.format(e);var r=bI(t=this.cacheEvents).call(t,function(t){return t.eventName===e;});r>-1&&sI(i=this.cacheEvents).call(i,r,1),this.events[e]&&delete this.events[e];}else this.cacheEvents=[],this.events={};}},{key:"getAllEvents",value:function value(){return this.events;}},{key:"format",value:function value(e){var t,i;return Ck(t=Ck(i="".concat(this.prefix||"")).call(i,e)).call(t,this.postfix||"");}}],[{key:"create",value:function value(t,i){return new e(t,i);}}]),e;}(),Qz="default",Jz=function(){function e(){ak(this,e),tk(this,"emitter",new $z());}return ok(e,[{key:"on",value:function value(e){this.emitter.on(Qz,e);}},{key:"emit",value:function value(){for(var e,t,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];(e=this.emitter).emit.apply(e,Ck(t=[Qz]).call(t,r));}},{key:"off",value:function value(e){this.emitter.off(Qz,e);}}],[{key:"create",value:function value(){return new e();}}]),e;}(),eU=function eU(e){return e/180*Math.PI;},tU=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;ak(this,e),tk(this,"x",void 0),tk(this,"y",void 0),tk(this,"z",void 0),this.x=t,this.y=i,this.z=r;}return ok(e,[{key:"setFromVector",value:function value(e){var t;this.x=e.x,this.y=e.y,this.z=null!==(t=e.z)&&void 0!==t?t:0;}},{key:"clone",value:function value(){return new e(this.x,this.y,this.z);}},{key:"norm",value:function value(){return EI(this.x,this.y,this.z);}},{key:"dot",value:function value(e){var t;return this.x*e.x+this.y*e.y+this.z*(null!==(t=e.z)&&void 0!==t?t:0);}},{key:"projectionTo",value:function value(e){var t=EI(e.x,e.y,e.z);return this.dot(e)/t;}},{key:"angle",value:function value(e){var t=this.norm()*EI(e.x,e.y,e.z),i=t&&this.dot(e)/t;return Math.acos(kz(i,-1,1));}},{key:"equals",value:function value(e){var t;return this.x===e.x&&this.y===e.y&&this.z===(null!==(t=e.z)&&void 0!==t?t:0);}},{key:"distance",value:function value(e){var t;return EI(this.x-e.x,this.y-e.y,this.z-(null!==(t=e.z)&&void 0!==t?t:0));}},{key:"lerp",value:function value(t){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=this.x,o=this.y,a=this.z;return new e(n+r*(t.x-n),o+r*(t.y-o),a+r*((null!==(i=t.z)&&void 0!==i?i:0)-a));}},{key:"normalize",value:function value(){var e=this,t=e.norm();return e.x/=t,e.y/=t,e.z/=t,this;}},{key:"negate",value:function value(){return this.x*=-1,this.y*=-1,this.z*=-1,this;}},{key:"cross",value:function value(e){var t=this;return{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x};}},{key:"add",value:function value(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this;}},{key:"multiply",value:function value(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this;}}],[{key:"fromPoint",value:function value(t){return new e(t.x,t.y,t.z);}},{key:"fromTwoPoint",value:function value(t,i){var r,n,o,a,s,l;return new e((null!==(r=i.x)&&void 0!==r?r:0)-(null!==(n=t.x)&&void 0!==n?n:0),(null!==(o=i.y)&&void 0!==o?o:0)-(null!==(a=t.y)&&void 0!==a?a:0),(null!==(s=i.z)&&void 0!==s?s:0)-(null!==(l=t.z)&&void 0!==l?l:0));}},{key:"fromValue",value:function value(t,i,r){return new e(t,i,r);}}]),e;}();function iU(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return cz(e)?tU.fromValue(e,t,i):tU.fromPoint(e);}function rU(e,t){return tU.fromTwoPoint(e,t);}var nU=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;ak(this,e),tk(this,"x",void 0),tk(this,"y",void 0),tk(this,"z",void 0),this.x=t,this.y=i,this.z=r;}return ok(e,[{key:"matrixTransform",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.x,i=this.y,r=this.z,n=e.m11,o=e.m21,a=e.m31,s=e.m41,l=e.m12,u=e.m22,c=e.m32,h=e.m42,d=e.m13,f=e.m23,v=e.m33,g=e.m43,m=e.m14,y=e.m24,p=e.m34,w=e.m44,b=m*t+y*i+p*r+w;return oU({x:(n*t+o*i+a*r+s)/b,y:(l*t+u*i+c*r+h)/b,z:(d*t+f*i+v*r+g)/b});}},{key:"setFromPoint",value:function value(e){return this.x=e.x||0,this.y=e.y||0,this.z=e.z||0,this;}},{key:"clone",value:function value(){return oU(this);}},{key:"equals",value:function value(e){var t=e.x,i=void 0===t?0:t,r=e.y,n=void 0===r?0:r,o=e.z,a=void 0===o?0:o,s=this;return s.x===i&&s.y===n&&s.z===a;}},{key:"distanceTo",value:function value(e){var t=e.x,i=void 0===t?0:t,r=e.y,n=void 0===r?0:r,o=e.z,a=void 0===o?0:o,s=this;return EI(s.x-i,s.y-n,s.z-a);}},{key:"lerpTo",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,i=e.x,r=void 0===i?0:i,n=e.y,o=void 0===n?0:n,a=e.z,s=void 0===a?0:a,l=this;return oU({x:l.x+t*(r-l.x),y:l.y+t*(o-l.y),z:l.z+t*(s-l.z)});}},{key:"footPointInSegment",value:function value(e,t){var i=rU(e,this),r=rU(e,t),n=r.norm(),o=oU(e);if(0===n)return o;var a=i.projectionTo(r)/n;return o.lerpTo(t,a);}},{key:"perpendicularToSegment",value:function value(e,t){var i=this.footPointInSegment(e,t);return this.distanceTo(i);}}],[{key:"fromPoint",value:function value(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new e(t.x,t.y,t.z);}}]),e;}();function oU(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return cz(e)?new nU(e,t,i):new nU(e.x,e.y,e.z);}var aU=function aU(e){return e/Math.PI*180;},sU=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;ak(this,e),tk(this,"x",void 0),tk(this,"y",void 0),tk(this,"z",void 0),tk(this,"w",void 0),this.x=t,this.y=i,this.z=r,this.w=n;}return ok(e,[{key:"clone",value:function value(){var t=new e();return t.setFromQuat(this),t;}},{key:"setFromQuat",value:function value(e){var t,i,r,n,o=this;return o.x=null!==(t=e.x)&&void 0!==t?t:0,o.y=null!==(i=e.y)&&void 0!==i?i:0,o.z=null!==(r=e.z)&&void 0!==r?r:0,o.w=null!==(n=e.w)&&void 0!==n?n:1,this;}},{key:"toEuler",value:function value(){var e=this.x,t=this.y,i=this.z,r=this.w,n=.4990234375,o=this.w*this.y-this.x*this.z;if(o<-n||o>n){var a=AI(o);return{z:-2*a*Math.atan2(this.x,this.w),y:a*(Math.PI/2),x:0};}return{x:aU(Math.atan2(2*(t*i+r*e),r*r-e*e-t*t+i*i)),y:aU(Math.asin(-2*(e*i-r*t))),z:aU(Math.atan2(2*(e*t+r*i),r*r+e*e-t*t-i*i))};}},{key:"invert",value:function value(){var e=this.x,t=this.y,i=this.z,r=this.w,n=e*e+t*t+i*i+r*r,o=n?1/n:0;return this.x=-e*o,this.y=-t*o,this.z=-i*o,this.w=r*o,this;}},{key:"multiply",value:function value(e){var t=this.x,i=this.y,r=this.z,n=this.w,o=e.x,a=e.y,s=e.z,l=e.w;return this.x=t*l+n*o+i*s-r*a,this.y=i*l+n*a+r*o-t*s,this.z=r*l+n*s+t*a-i*o,this.w=n*l-t*o-i*a-r*s,this;}},{key:"normalize",value:function value(){var e=this.x,t=this.y,i=this.z,r=this.w,n=e*e+t*t+i*i+r*r;return this.x/=n,this.y/=n,this.z/=n,this.w/=n,this;}}],[{key:"fromQuat",value:function value(t){return new e().setFromQuat(t);}},{key:"fromEuler",value:function value(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t=eU(t)/2,i=eU(i)/2,r=eU(r)/2;var n=Math.sin(t),o=Math.cos(t),a=Math.sin(i),s=Math.cos(i),l=Math.sin(r),u=Math.cos(r),c=new e();return c.setFromQuat({x:n*s*u-o*a*l,y:o*a*u+n*s*l,z:o*s*l-n*a*u,w:o*s*u+n*a*l}),c;}}]),e;}();function lU(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return cz(e)?new sU(e,t,i,r):sU.fromQuat(e);}function uU(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return sU.fromEuler(e,t,i);}var cU=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;ak(this,e),tk(this,"x",void 0),tk(this,"y",void 0),tk(this,"z",void 0),tk(this,"w",void 0),this.x=t,this.y=i,this.z=r,this.w=n;}return ok(e,[{key:"negate",value:function value(){this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1;}},{key:"normalize",value:function value(){var e=this.norm();this.x/=e,this.y/=e,this.z/=e,this.w/=e;}},{key:"norm",value:function value(){return EI(this.x,this.y,this.z,this.w);}}]),e;}();function hU(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return cz(e)?new cU(e,t,i,r):new cU(e.x,e.y,e.z,e.w);}var dU=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],fU=function(){function e(t){if(ak(this,e),tk(this,"a",1),tk(this,"b",0),tk(this,"c",0),tk(this,"d",1),tk(this,"e",0),tk(this,"f",0),tk(this,"m11",1),tk(this,"m12",0),tk(this,"m13",0),tk(this,"m14",0),tk(this,"m21",0),tk(this,"m22",1),tk(this,"m23",0),tk(this,"m24",0),tk(this,"m31",0),tk(this,"m32",0),tk(this,"m33",1),tk(this,"m34",0),tk(this,"m41",0),tk(this,"m42",0),tk(this,"m43",0),tk(this,"m44",1),tk(this,"is2D",void 0),t||(t=dU),az(t));else{if(!ez(t))throw new Error("DefaultMatrix error.");yU(t,this);}}return ok(e,[{key:"isIdentity",get:function get(){for(var e=this.toArray(),t=0;t<16;t++)if(e[t]!==dU[t])return!1;return!0;}},{key:"translate",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.clone().translateSelf(e,t,i);}},{key:"scale",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return nz(t)&&(t=e),this.clone().scaleSelf(e,t,i,r,n,o);}},{key:"scale3d",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.clone().scale3dSelf(e,t,i,r);}},{key:"rotate",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;return this.clone().rotateSelf(e,t,i);}},{key:"rotateFromVector",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.clone().rotateFromVectorSelf(e,t);}},{key:"rotateAxisAngle",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.clone().rotateAxisAngleSelf(e,t,i,r);}},{key:"skewX",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.clone().skewXSelf(e);}},{key:"skewY",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.clone().skewYSelf(e);}},{key:"multiply",value:function value(e){return this.clone().multiplySelf(e);}},{key:"flipX",value:function value(){return this.clone().multiplySelf(new e([-1,0,0,1,0,0]));}},{key:"flipY",value:function value(){return this.clone().multiplySelf(new e([1,0,0,-1,0,0]));}},{key:"inverse",value:function value(){return this.clone().invertSelf();}},{key:"transformPoint",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return oU(e).matrixTransform(this);}},{key:"toFloat32Array",value:function value(){var e=this.toArray();return new Float32Array(e);}},{key:"toFloat64Array",value:function value(){var e=this.toArray();return new Float64Array(e);}},{key:"toJSON",value:function value(){}},{key:"multiplySelf",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=pU(this,e);return this.setFromMatrix(t),this;}},{key:"preMultiplySelf",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=pU(e,this);return this.setFromMatrix(t),this;}},{key:"translateSelf",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r={m11:1,m21:0,m31:0,m41:e,m12:0,m22:1,m32:0,m42:t,m13:0,m23:0,m33:1,m43:i,m14:0,m24:0,m34:0,m44:1};return r;}(e,t,i);return this.multiplySelf(r),i&&(this.is2D=!1),this;}},{key:"scaleSelf",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.translateSelf(r,n,o),nz(t)&&(t=e);var a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r={m11:e,m21:0,m31:0,m41:0,m12:0,m22:t,m32:0,m42:0,m13:0,m23:0,m33:i,m43:0,m14:0,m24:0,m34:0,m44:1};return r;}(e,t,i);return this.multiplySelf(a),this.translateSelf(-r,-n,-o),1!==i&&(this.is2D=!1),this;}},{key:"scale3dSelf",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.scaleSelf(e,e,e,t,i,r);}},{key:"rotateSelf",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;nz(t)&&nz(i)&&(i=e,e=0,t=0),nz(t)&&(t=0),nz(i)&&(i=0),0===e&&0===t||(this.is2D=!1);var r=wU(i,[0,0,1]),n=wU(t,[0,1,0]),o=wU(e,[1,0,0]);return this.multiplySelf(r),this.multiplySelf(n),this.multiplySelf(o),this;}},{key:"rotateFromVectorSelf",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=iU(e,t),r=iU(1,0),n=wU(i.angle(r),[0,0,1]);return this.multiplySelf(n),this;}},{key:"rotateAxisAngleSelf",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=wU(r,[e,t,i]);return this.multiplySelf(n),this;}},{key:"skewXSelf",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=bU(e,0);return this.multiplySelf(t),this;}},{key:"skewYSelf",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=bU(0,e);return this.multiplySelf(t),this;}},{key:"invertSelf",value:function value(){var e=function(e){if(e[0].length!==e.length)throw new Error();for(var t=gU(e),i=function(e){var t,i;if(e[0].length!==e.length)throw new Error("Not square matrix.");for(var r=e.length,n=jI(t=iE(i=new Array(r)).call(i,0)).call(t,function(e){var t;return iE(t=new Array(r)).call(t,0);}),o=0;o<r;o++)for(var a=0;a<r;a++)n[o][a]=mU(e,o,a);return function(e){for(var t,i,r=jI(t=iE(i=new Array(e.length)).call(i,0)).call(t,function(t){var i;return iE(i=new Array(e[0].length)).call(i,0);}),n=0;n<r.length;n++)for(var o=0;o<r[0].length;o++)r[n][o]=e[o][n];return r;}(n);}(e),r=0;r<i.length;r++)for(var n=0;n<i.length;n++)i[r][n]/=t;return i;}(this.toTwoDimensionalArray());return this.setFromTwoDimensionalArray(e),this;}},{key:"setMatrixValue",value:function value(e){}},{key:"setFromMatrix",value:function value(e){var t=this;t.m11=e.m11,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m21=e.m21,t.m22=e.m22,t.m23=e.m23,t.m24=e.m24,t.m31=e.m31,t.m32=e.m32,t.m33=e.m33,t.m34=e.m34,t.m41=e.m41,t.m42=e.m42,t.m43=e.m43,t.m44=e.m44,t.a=e.m11,t.b=e.m12,t.c=e.m21,t.d=e.m22,t.e=e.m41,t.f=e.m42,!1===e.is2D&&(t.is2D=!1);}},{key:"setFromTwoDimensionalArray",value:function value(e){var t=cb(e,4),i=cb(t[0],4),r=i[0],n=i[1],o=i[2],a=i[3],s=cb(t[1],4),l=s[0],u=s[1],c=s[2],h=s[3],d=cb(t[2],4),f=d[0],v=d[1],g=d[2],m=d[3],y=cb(t[3],4),p=y[0],w=y[1],b=y[2],k=y[3];this.setFromMatrix({m11:r,m21:n,m31:o,m41:a,m12:l,m22:u,m32:c,m42:h,m13:f,m23:v,m33:g,m43:m,m14:p,m24:w,m34:b,m44:k});}},{key:"clone",value:function value(){return e.fromMatrix(this);}},{key:"determinant",value:function value(){return gU(this.toTwoDimensionalArray());}},{key:"toTwoDimensionalArray",value:function value(){var e=this;return[[e.m11,e.m21,e.m31,e.m41],[e.m12,e.m22,e.m32,e.m42],[e.m13,e.m23,e.m33,e.m43],[e.m14,e.m24,e.m34,e.m44]];}},{key:"toArray",value:function value(){var e=this;return[e.m11,e.m12,e.m13,e.m14,e.m21,e.m22,e.m23,e.m24,e.m31,e.m32,e.m33,e.m34,e.m41,e.m42,e.m43,e.m44];}},{key:"decompose",value:function value(){if(0===this.m44)return{};var e=hU(0,0,0,1),t=lU(0,0,0,1),i=iU(0,0,0),r=iU(0,0,0),n=iU(0,0,0),o=this;o.normalize();var a=o.clone();if(a.m14=0,a.m24=0,a.m34=0,a.m44=1,0===a.determinant())return!1;if(0!==o.m14||0!==o.m24||0!==o.m34){var s={x:o.m14,y:o.m24,z:o.m34,w:o.m44};e=a.invertSelf().transposeSelf().multiplyVector(s);}else e.x=0,e.y=0,e.z=0,e.w=1;n.x=o.m41,n.y=o.m42,n.z=o.m43;var l=[iU(o.m11,o.m12,o.m13),iU(o.m21,o.m22,o.m23),iU(o.m31,o.m32,o.m33)];i.x=l[0].norm(),l[0].normalize(),r.x=l[0].dot(l[1]),l[1]=iU(vU(l[1],l[0],1,-r.x)),i.y=l[1].norm(),l[1].normalize(),r.x/=i.y,r.y=l[0].dot(l[2]),l[2]=iU(vU(l[2],l[0],1,-r.y)),r.z=l[1].dot(l[2]),l[2]=iU(vU(l[2],l[1],1,-r.z)),i.z=l[2].norm(),l[2].normalize(),r.y/=i.z,r.z/=i.z;var u,c=l[1].cross(l[2]);if(l[0].dot(c)<0&&(i.negate(),l[0].negate(),l[1].negate(),l[2].negate()),t.x=.5*Math.pow(Math.max(1+l[0].x-l[1].y-l[2].z,0),.5),t.y=.5*Math.pow(Math.max(1-l[0].x+l[1].y-l[2].z,0),.5),t.z=.5*Math.pow(Math.max(1-l[0].x-l[1].y+l[2].z,0),.5),t.w=.5*Math.pow(Math.max(1+l[0].x+l[1].y+l[2].z,0),.5),l[2].y>l[1].z&&(t.x*=-1),l[0].z>l[2].x&&(t.y*=-1),l[1].x>l[0].y&&(t.z*=-1),t.x<.001&&t.x>=0&&t.y<.001&&t.y>=0){var h=Math.atan2(l[0].y,l[0].x);u={x:0,y:0,z:Number(aU(h).toFixed(3))};}else u=t.toEuler();return{rotation:u,scale:i,translation:n,skew:r,quaternion:t,perspective:e};}},{key:"multiplyVector",value:function value(e){var t=this,i=e.x,r=e.y,n=e.z,o=e.w;return{x:t.m11*i+t.m21*r+t.m31*n+t.m41*o,y:t.m12*i+t.m22*r+t.m32*n+t.m42*o,z:t.m13*i+t.m23*r+t.m33*n+t.m43*o,w:t.m14*i+t.m24*r+t.m34*n+t.m44*o};}},{key:"transpose",value:function value(){var e=this.clone();return e.transposeSelf(),e;}},{key:"transposeSelf",value:function value(){var e=this.m11,t=this.m21,i=this.m31,r=this.m41,n=this.m12,o=this.m22,a=this.m32,s=this.m42,l=this.m13,u=this.m23,c=this.m33,h=this.m43,d=this.m14,f=this.m24,v=this.m34,g=this.m44;return this.setFromMatrix({m11:e,m21:n,m31:l,m41:d,m12:t,m22:o,m32:u,m42:f,m13:i,m23:a,m33:c,m43:v,m14:r,m24:s,m34:h,m44:g}),this;}},{key:"normalize",value:function value(){var e=this,t=e.m44;e.m11/=t,e.m12/=t,e.m13/=t,e.m14/=t,e.m21/=t,e.m22/=t,e.m23/=t,e.m24/=t,e.m31/=t,e.m32/=t,e.m33/=t,e.m34/=t,e.m41/=t,e.m42/=t,e.m43/=t,e.m44/=t;}},{key:"getTranslation",value:function value(){return iU(this.m41,this.m42,this.m43);}},{key:"getRotation",value:function value(){var e=this,t=.5*Math.pow(e.m11+e.m22+e.m33+1,.5);return lU(.25*(e.m23-e.m32)/t,.25*(e.m31-e.m13)/t,.25*(e.m12-e.m21)/t,t);}},{key:"getScaling",value:function value(){var e=this;return iU(EI(e.m11,e.m12,e.m13),EI(e.m21,e.m22,e.m23),EI(e.m31,e.m32,e.m33));}},{key:"toEuler",value:function value(){var e=this.getRotation().toEuler();return iU(e.x,e.y,e.z);}}],[{key:"fromQuat",value:function value(t){var i=t.x,r=t.y,n=t.z,o=t.w,a=new e();return a.m11=1-2*(r*r+n*n),a.m12=2*(i*r+n*o),a.m13=2*(i*n-r*o),a.m21=2*(i*r-n*o),a.m22=1-2*(i*i+n*n),a.m23=2*(r*n+i*o),a.m31=2*(i*n+r*o),a.m32=2*(r*n-i*o),a.m33=1-2*(i*i+r*r),a.setFromMatrix(a),a;}},{key:"fromMatrix",value:function value(t){var i=new e();return i.setFromMatrix(t),i.is2D=!!t.is2D,i;}},{key:"fromFloat32Array",value:function value(t){var i=new e();return yU(t,i),i;}},{key:"fromFloat64Array",value:function value(t){var i=new e();return yU(t,i),i;}}]),e;}();function vU(e,t,i,r){return{x:i*e.x+r*t.x,y:i*e.y+r*t.y,z:i*e.z+r*t.z};}function gU(e){var t;if(e.length!==e[0].length)throw new Error();var i=e.length,r=0;if(i>3)for(var n=0;n<i;n++)r+=e[0][n]*mU(e,0,n);else 3===i?r=e[0][0]*e[1][1]*e[2][2]+e[0][1]*e[1][2]*e[2][0]+e[0][2]*e[1][0]*e[2][1]-e[0][2]*e[1][1]*e[2][0]-e[0][1]*e[1][0]*e[2][2]-e[0][0]*e[1][2]*e[2][1]:2===i?r=e[0][0]*e[1][1]-e[0][1]*e[1][0]:1===i&&(t=cb(e,1),r=cb(t[0],1)[0]);return r;}function mU(e){for(var t,i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=e.length,a=jI(t=iE(i=new Array(o-1)).call(i,0)).call(t,function(e){var t;return iE(t=new Array(o-1)).call(t,0);}),s=0;s<o-1;s++)for(var l=0;l<o-1;l++){var u=s<r?s:s+1,c=l<n?l:l+1;a[s][l]=e[u][c];}return Math.pow(-1,r+n)*gU(a);}function yU(e,t){var i=cb(e,16),r=i[0],n=i[1],o=i[2],a=i[3],s=i[4],l=i[5],u=i[6],c=i[7],h=i[8],d=i[9],f=i[10],v=i[11],g=i[12],m=i[13],y=i[14],p=i[15];if(6===e.length)t.m11=r,t.m12=n,t.m21=o,t.m22=a,t.m41=s,t.m42=l,t.m13=0,t.m14=0,t.m23=0,t.m24=0,t.m31=0,t.m32=0,t.m34=0,t.m33=1,t.m44=1,t.is2D=!0;else{if(16!==e.length)throw new Error();t.m11=r,t.m12=n,t.m13=o,t.m14=a,t.m21=s,t.m22=l,t.m23=u,t.m24=c,t.m31=h,t.m32=d,t.m33=f,t.m34=v,t.m41=g,t.m42=m,t.m43=y,t.m44=p,t.is2D=!1;}}function pU(e,t){var i={},r=e.m11,n=e.m21,o=e.m31,a=e.m41,s=e.m12,l=e.m22,u=e.m32,c=e.m42,h=e.m13,d=e.m23,f=e.m33,v=e.m43,g=e.m14,m=e.m24,y=e.m34,p=e.m44,w=t.m11,b=t.m21,k=t.m31,x=t.m41,S=t.m12,C=t.m22,V=t.m32,T=t.m42,I=t.m13,E=t.m23,P=t.m33,B=t.m43,D=t.m14,M=t.m24,A=t.m34,z=t.m44;return i.m11=r*w+n*S+o*I+a*D,i.m21=r*b+n*C+o*E+a*M,i.m31=r*k+n*V+o*P+a*A,i.m41=r*x+n*T+o*B+a*z,i.m12=s*w+l*S+u*I+c*D,i.m22=s*b+l*C+u*E+c*M,i.m32=s*k+l*V+u*P+c*A,i.m42=s*x+l*T+u*B+c*z,i.m13=h*w+d*S+f*I+v*D,i.m23=h*b+d*C+f*E+v*M,i.m33=h*k+d*V+f*P+v*A,i.m43=h*x+d*T+f*B+v*z,i.m14=g*w+m*S+y*I+p*D,i.m24=g*b+m*C+y*E+p*M,i.m34=g*k+m*V+y*P+p*A,i.m44=g*x+m*T+y*B+p*z,i;}function wU(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,1];e=eU(e);var i=Math.sin(e/2)*Math.cos(e/2),r=Math.pow(Math.sin(e/2),2),n=cb(t,3),o=n[0],a=n[1],s=n[2];return{m11:1-2*(Math.pow(a,2)+Math.pow(s,2))*r,m21:2*(o*a*r-s*i),m31:2*(o*s*r+a*i),m41:0,m12:2*(o*a*r+s*i),m22:1-2*(Math.pow(o,2)+Math.pow(a,2))*r,m32:2*(a*s*r-o*i),m42:0,m13:2*(o*s*r-a*i),m23:2*(a*s*r+o*i),m33:1-2*(Math.pow(o,2)+Math.pow(a,2))*r,m43:0,m14:0,m24:0,m34:0,m44:1};}function bU(e,t){var i=new fU();return e&&(i.m21=Math.tan(eU(e))),t&&(i.m12=Math.tan(eU(t))),i;}function kU(e,t,i){var r=e.x-t.x,n=e.y-t.y,o=(i.x-e.x)*r+(i.y-e.y)*n;return o/=r*r+n*n,new nU(e.x+o*r,e.y+o*n);}function xU(e,t){return Math.pow(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2),.5);}function SU(e,t,i){return(i.x-e.x)*(t.y-e.y)==(t.x-e.x)*(i.y-e.y)&&Math.min(e.x,t.x)<=i.x&&i.x<=Math.max(e.x,t.x)&&Math.min(e.y,t.y)<=i.y&&i.y<=Math.max(e.y,t.y);}var CU=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;ak(this,e),tk(this,"x",0),tk(this,"y",0),tk(this,"left",0),tk(this,"top",0),tk(this,"right",0),tk(this,"bottom",0),tk(this,"width",0),tk(this,"height",0),this.update(t,i,r,n);}return ok(e,[{key:"update",value:function value(e,t,i,r){this.x=e,this.y=t,this.left=e,this.top=t,this.right=e+i,this.bottom=t+r,this.width=i,this.height=r;}},{key:"toJSON",value:function value(){}}]),e;}();function VU(e,t,i,r,n){var o=Math.cos,a=Math.sin;return{x:(e-i)*o(n)-(t-r)*a(n)+i,y:(e-i)*a(n)+(t-r)*o(n)+r};}var TU=function(){function e(t){ak(this,e),tk(this,"uid",void 0),tk(this,"children",void 0),this.uid=t.uid,this.children=t.children||[];}return ok(e,[{key:"append",value:function value(e){var t=this.children;return DT(t).call(t,e)<0&&(t.push(e),!0);}},{key:"insert",value:function value(e,t){var i=this.children;return!(t<0||(t>i.length&&(t=i.length),sI(i).call(i,t,0,e),0));}},{key:"remove",value:function value(e){var t=this.children,i=DT(t).call(t,e);return!(i<0||(sI(t).call(t,i,1),0));}},{key:"clear",value:function value(){return this.children=[],!0;}},{key:"move",value:function value(e,t){if(e===t)return!0;var i=this.children,r=cb(sI(i).call(i,e,1),1)[0];return sI(i).call(i,t,0,r),!0;}},{key:"switch",value:function value(e,t){if(e===t)return!0;var i=this.children,r=i[e];return i[e]=i[t],i[t]=r,!0;}},{key:"reorder",value:function value(e){var t=this.children,i=e.length,r=[],n=0;if(t.length!==i||0===i)return!1;for(var o=0;o<i;o++)e[o]===o&&(n+=1);if(n===i)return!0;for(var a=0;a<i;a++)r[a]=t[e[a]];for(var s=0;s<i;s++)t[s]=r[s];return!0;}}]),e;}(),IU=function(){function e(){ak(this,e),tk(this,"strategies",{});}return ok(e,[{key:"executeStrategy",value:function value(e){for(var t,i,r,n=arguments.length,o=new Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];return null===(t=(i=this.strategies)[e])||void 0===t?void 0:t.call.apply(t,Ck(r=[i]).call(r,o));}},{key:"addStrategy",value:function value(e,t){var i=this.strategies;return!i[e]&&(i[e]=t,!0);}}]),e;}(),EU=new(function(){function e(){ak(this,e),tk(this,"tasks",[]);}return ok(e,[{key:"createTimer",value:function value(e,t){var i=bz();return this.tasks.push({uid:i,callback:e,time:t}),this.executeTimer(i),i;}},{key:"executeTimer",value:function value(e){var t,i=gE(t=this.tasks).call(t,function(t){return t.uid===e;});if(i){i.timer=RE(function e(){i.callback(),null!==i.timer&&(i.timer=RE(e,i.time));},i.time);}}},{key:"clearTimer",value:function value(e){var t,i,r=bI(t=this.tasks).call(t,function(t){return t.uid===e;});r>-1&&(clearTimeout(this.tasks[r].timer),this.tasks[r].timer=null,sI(i=this.tasks).call(i,r,1));}}]),e;}())(),PU=function(){function e(t,i){ak(this,e),tk(this,"isDestroyed",!1),tk(this,"data",void 0),tk(this,"table",["database","table","item"]),tk(this,"dbName",void 0),tk(this,"tableName",void 0),this.data={},this.dbName=t,this.tableName=i,this.createDatabase(t,i);}return ok(e,[{key:"destroy",value:function value(){if(!this.isDestroyed){for(var e=0,t=GE(this.data);e<t.length;e++){var i=cb(t[e],2),r=i[0];i[1],this.data[r]=null;}this.data=null,this.isDestroyed=!0;}}},{key:"createDatabase",value:function value(e,t){this.data[e]={},this.data[e][t]={};}},{key:"set",value:function value(e,t){var i=this,r=this.dbName,n=this.tableName;return new QE(function(o,a){i.checkId(e)?a(new Error("The ".concat(e," already exists."))):(i.data[r][n][e]=t,o("Save ".concat(e," to database successful.")));});}},{key:"get",value:function value(e){var t=this,i=this.dbName,r=this.tableName;return new QE(function(n,o){t.checkId(e)?n(t.data[i][r][e]):o(t.erMsg(2,e));});}},{key:"remove",value:function value(e){var t=this,i=this.dbName,r=this.tableName;return new QE(function(n,o){delete t.data[i][r][e],n("Remove ".concat(e," successful."));});}},{key:"update",value:function value(e,t){var i=this,r=this.dbName,n=this.tableName;return new QE(function(o,a){i.checkId(e)?(i.data[r][n][e]=t,o("Update ".concat(e," successful."))):a(i.erMsg(2,e));});}},{key:"checkId",value:function value(e){var t=this.dbName,i=this.tableName;return void 0!==this.data[t][i][e];}},{key:"erMsg",value:function value(e,t){var i;return Ck(i="The ".concat(this.table[e]," ")).call(i,t," does not exist.");}}]),e;}(),BU=function(){function e(){ak(this,e),tk(this,"isDestroyed",!1),tk(this,"data",void 0),this.data={};}return ok(e,[{key:"destroy",value:function value(){if(!this.isDestroyed){for(var e=0,t=GE(this.data);e<t.length;e++){var i,r=cb(t[e],2),n=r[0];r[1],null!==(i=this.data[n])&&void 0!==i&&i.destroy(),this.data[n]=null;}this.data=null,this.isDestroyed=!0;}}},{key:"set",value:function value(e,t){return!this.check(e)&&(this.data[e]=t,!0);}},{key:"get",value:function value(e){return this.data[e];}},{key:"remove",value:function value(e){return!!this.check(e)&&(delete this.data[e],!0);}},{key:"update",value:function value(e,t){return!!this.check(e)&&(this.data[e]=t,!0);}},{key:"check",value:function value(e){return void 0!==this.data[e];}}]),e;}(),DU=function(e){lb(i,e);var t=ub(i);function i(e){var r;return ak(this,i),tk(rc(r=t.call(this,e)),"name",void 0),tk(rc(r),"type",void 0),tk(rc(r),"fileType",void 0),tk(rc(r),"createdDate",void 0),tk(rc(r),"modifiedDate",void 0),tk(rc(r),"parent",void 0),tk(rc(r),"isRoot",!1),r.name=e.name,r.type=e.type,r.fileType=e.fileType,r.parent=e.parent||null,r.isRoot=e.isRoot||!1,r.createdDate=oz(),r.modifiedDate=r.createdDate,r;}return ok(i,[{key:"updateDate",value:function value(){this.modifiedDate=oz();}},{key:"setName",value:function value(e){this.name=e;}},{key:"reorder",value:function value(e){var t=this.type;return("file"===t||"default"===t)&&sb(ob(i.prototype),"reorder",this).call(this,e);}}]),i;}(TU),MU=function(){function e(){ak(this,e),tk(this,"root",void 0),tk(this,"currentNode",void 0),tk(this,"selectedUid",void 0),tk(this,"defaultNode",void 0),tk(this,"hooks",{fileChanged:Jz.create(),beforeRemoveFile:Jz.create(),removeFile:Jz.create(),afterRemoveFile:Jz.create(),afterRenameFile:Jz.create(),destroy:Jz.create()}),this.root=new DU({uid:bz(),children:[],name:"root",type:"file",fileType:"folder",parent:void 0,isRoot:!0}),this.defaultNode=this.root,this.currentNode=this.root;}return ok(e,[{key:"appendChildrenToFile",value:function value(e,t,i){var r=i,n=AU(this.defaultNode,e);return n||(n=this.createFile(e),this.hooks.fileChanged.emit(this.defaultNode)),dk(t).call(t,function(e){nz(r)?n.append(e):(n.insert(e,r),r+=1);}),n;}},{key:"removeChildFromFile",value:function value(e,t){az(t)&&(t=[t]);var i=this.getFileByUid(e);i&&dk(t).call(t,function(e){i.remove(e);});}},{key:"findChild",value:function value(e,t){var i;return gE(i=e.children).call(i,function(e){return e.name===t;});}},{key:"createFile",value:function value(e){var t=this.defaultNode;t||(t=this.root);var i=AU(t,e);return i&&"file"===i.type||(i=new DU({uid:bz(),children:[],name:e,type:"file",fileType:"file",parent:t,isRoot:!1}),this.currentNode.append(i),this.hooks.fileChanged.emit(this.currentNode.children)),i;}},{key:"removeFile",value:function value(e){for(var t=this.defaultNode.children,i=0;i<t.length;i++){var r=t[i];if(r.name===e)return this.hooks.beforeRemoveFile.emit(r),sI(t).call(t,i,1),this.hooks.afterRemoveFile.emit(r),this.hooks.fileChanged.emit(r),!0;}return!1;}},{key:"renameFile",value:function value(e,t){var i=this.findChild(this.defaultNode,e),r=this.findChild(this.defaultNode,t);return!!i&&!r&&(i.name=t,this.hooks.afterRenameFile.emit(i),this.hooks.fileChanged.emit(this.currentNode.children),!0);}},{key:"getFile",value:function value(e){return this.findChild(this.defaultNode,e);}},{key:"getFileByUid",value:function value(e){return gE(this).call(this,e,this.root);}},{key:"getCurrentFileList",value:function value(){return this.currentNode.children;}},{key:"isFileExist",value:function value(e){return!!this.findChild(this.defaultNode,e);}},{key:"createFolder",value:function value(){}},{key:"find",value:function value(e,t){for(var i=t.children,r=i.length,n=0;n<r;n++){if(i[n].uid===e)return i[n];if(i[n].children){var o=gE(this).call(this,e,i[n]);if(o)return o;}}return null;}}]),e;}();function AU(e,t){var i,r=zx(i=e.children).call(i,function(e){return e.name===t;});return 0===r.length?null:r[0];}var zU,UU=function(e){lb(i,e);var t=ub(i);function i(e){var r;return ak(this,i),tk(rc(r=t.call(this,e)),"name",void 0),tk(rc(r),"type","tag"),r.name=e.name,r.uid=e.uid||bz(),r.type="tag",r;}return ok(i);}(TU),RU=function(){function e(){ak(this,e),tk(this,"tags",void 0),tk(this,"defaultName",void 0),tk(this,"defaultUid",void 0),tk(this,"selectedUid",void 0),tk(this,"emptyItem",void 0),tk(this,"hooks",{beforeRemoveTag:Jz.create(),afterRenameTag:Jz.create(),destroy:Jz.create(),load:Jz.create()}),this.tags=[],this.defaultName=null,this.defaultUid=null,this.selectedUid=null,this.emptyItem=new UU({name:"defaultTag",children:[]});}return ok(e,[{key:"appendChildToTag",value:function value(e,t){var i=this.createTag(e);az(t)&&(t=[t]);var r=!1;return dk(t).call(t,function(e){i.append(e)&&(r=!0);}),r;}},{key:"removeChildFromTag",value:function value(e,t){var i=this.getTag(e);return!!i&&(az(t)&&(t=[t]),dk(t).call(t,function(e){i.remove(e);}),!0);}},{key:"createTag",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=this.getTag(e);return i||(i=new UU({name:e,children:t}),this.tags.push(i)),i;}},{key:"removeTag",value:function value(e){var t,i,r=this.getTag(e);if(!r)return!1;this.hooks.beforeRemoveTag.emit(r);var n=bI(t=this.tags).call(t,function(t){return t.name===e;});return e===this.defaultName&&(this.defaultName=null,this.selectedUid=null),sI(i=this.tags).call(i,n,1),!0;}},{key:"renameTag",value:function value(e,t){if(!az(e)||!az(t))return!1;var i=this.isTagExisted(t),r=this.getTag(e);return!(!r||i||(r.name=t,this.hooks.afterRenameTag.emit(r),0));}},{key:"getTag",value:function value(e){var t;return gE(t=this.tags).call(t,function(t){return t.name===e;});}},{key:"getTagByUid",value:function value(e){var t;return gE(t=this.tags).call(t,function(t){return t.uid===e;});}},{key:"getTagList",value:function value(){var e;return ET(e=this.tags).call(e);}},{key:"setDefaultTag",value:function value(e){if(!e)return this.defaultName=null,this.defaultUid=null,!0;var t=this.getTag(e);return!!t&&(this.defaultName=e,this.defaultUid=t.uid,!0);}},{key:"getDefaultTag",value:function value(){return this.defaultName;}},{key:"isTagExisted",value:function value(e){return!!this.getTag(e);}}]),e;}(),LU=function(){function e(){ak(this,e);}return ok(e,[{key:"apply",value:function value(e){var t=e.hooks,i={beforeStatus:null,afterStatus:null,operation:null,docUid:null},r=function r(e){i.beforeStatus={uids:[],selectedUids:[],currentUid:"",modifiedUid:e.modifiedUid,removedUids:e.removedUids};},n=function n(t){i.afterStatus={uids:[],selectedUids:[],currentUid:"",modifiedUid:t.modifiedUid,removedUids:t.removedUids},i.docUid="",i.operation=t.operation,e.emit("bufferChanged",rk({},i)),i={beforeStatus:null,afterStatus:null,operation:null,docUid:null};};t.beforeBufferChanged.on(r),t.afterBufferChanged.on(n),t.destroy.on(function(){t.beforeBufferChanged.off(r),t.afterBufferChanged.off(n);});}}]),e;}(),NU=function(){function e(){ak(this,e);}return ok(e,[{key:"apply",value:function value(e){var t=e.hooks;e.customStore=new BU();var i=function i(t){var i=t.data;dk(i).call(i,function(t){var i=t.customData;i||(i={}),e.customStore.set(t.uid,i);});},r=function r(t){var i=t.removedUids;dk(i).call(i,function(t){e.customStore.remove(t);});},n=function n(t){var i=t.data.customData;i&&e.customStore.update(t.modifiedUid,i);};t.loadSource.on(i),t.removeSource.on(r),t.updateSource.on(n),t.destroy.on(function(){t.loadSource.off(i),t.removeSource.off(r),t.updateSource.off(n);});}}]),e;}(),OU=function(e){lb(i,e);var t=ub(i);function i(){var e;return ak(this,i),tk(rc(e=t.call(this,{uid:bz(),children:[]})),"name","dvs-default"),tk(rc(e),"isDestroyed",!1),tk(rc(e),"type",void 0),e;}return ok(i,[{key:"destroy",value:function value(){this.isDestroyed||(this.isDestroyed=!0);}}]),i;}(TU),WU=function(){function e(){ak(this,e);}return ok(e,[{key:"apply",value:function value(e){e.defaultFile=new OU();var t=e.hooks,i=function i(t){var i,r,n,o=t.filename,a=t.index,s=t.data;if(nz(o)){var l=jI(s).call(s,function(e){return e.uid;});void 0===a?(i=e.defaultFile.children).push.apply(i,hb(l)):sI(r=e.defaultFile.children).apply(r,Ck(n=[a,0]).call(n,hb(l)));var u={docUid:e.defaultFile.uid,sourceUids:l,type:"default",index:a};e.hooks.loadToDoc.emit(u);}},r=function r(t){var i=t.removedUids,r=[];dk(i).call(i,function(t){var i=e.statusStore.get(t);i&&i.ownerDefaultFile&&(e.defaultFile.remove(t),r.push(t));}),r.length&&e.hooks.removeFromDoc.emit({docUid:e.defaultFile.uid,sourceUids:i,type:"default"});};t.loadSource.on(i),t.removeSource.on(r),t.destroy.on(function(){t.loadSource.off(i),t.removeSource.off(r);});}}]),e;}(),HU=function(){function e(){ak(this,e);}return ok(e,[{key:"apply",value:function value(e){e.dir=new MU(),this.listenDirectoryHooks(e),this.listenSpaceHooks(e);}},{key:"listenDirectoryHooks",value:function value(e){var t=e.dir.hooks,i=function i(t){var i;dk(i=t.children).call(i,function(i){var r=e.statusStore.get(i);r&&r.ownerFiles.remove(t.uid);}),e.hooks.removeDoc.emit(t);},r=function r(t){e.hooks.renameDoc.emit(t);};t.beforeRemoveFile.on(i),t.afterRenameFile.on(r),t.destroy.on(function(){t.beforeRemoveFile.off(i),t.afterRenameFile.off(r);});}},{key:"listenSpaceHooks",value:function value(e){var t=e.hooks,i=function i(t){var i=t.data,r=t.filename,n=t.index;if(!nz(r)){var o=jI(i).call(i,function(e){return e.uid;}),a={docUid:e.dir.appendChildrenToFile(r,o,n).uid,sourceUids:o,type:"file",index:n};e.hooks.loadToDoc.emit(a);}},r=function r(t){var i=t.removedUids,r={};dk(i).call(i,function(t){var i,n,o=e.statusStore.get(t);o&&dk(i=ET(n=o.ownerFiles.children).call(n)).call(i,function(e){r[e]||(r[e]=[]),r[e].push(t);});});for(var n=0,o=GE(r);n<o.length;n++){var a=cb(o[n],2),s=a[0],l=a[1];e.dir.removeChildFromFile(s,l),e.hooks.removeFromDoc.emit({docUid:s,sourceUids:l});}};t.loadSource.on(i),t.removeSource.on(r),t.destroy.on(function(){t.loadSource.off(i),t.removeSource.off(r);});}}]),e;}(),FU=function(){function e(){ak(this,e);}return ok(e,[{key:"apply",value:function value(e){var t=e.hooks;e.metadataStore=new BU();var i=function i(t){var i=t.data;dk(i).call(i,function(t){var i=t.metadata;i||(i={width:void 0,height:void 0}),e.metadataStore.set(t.uid,i);});},r=function r(t){var i=t.removedUids;dk(i).call(i,function(t){e.metadataStore.remove(t);});},n=function n(t){var i=t.data.metadata;i&&e.metadataStore.update(t.modifiedUid,i);};t.loadSource.on(i),t.removeSource.on(r),t.updateSource.on(n),t.destroy.on(function(){t.loadSource.off(i),t.removeSource.off(r),t.updateSource.off(n);});}}]),e;}(),jU=function(){function e(t){ak(this,e),tk(this,"uid",null),tk(this,"minData",null),tk(this,"oriData",null),tk(this,"customData",{}),tk(this,"activeOri",!1),tk(this,"activeMin",!1),tk(this,"minTask",null),tk(this,"oriTask",null),tk(this,"load",!1),tk(this,"preload",[]),tk(this,"visible",[]),tk(this,"overlays",[]),tk(this,"img",null),tk(this,"minImg",null),tk(this,"imageScale",1),tk(this,"owners",[]),tk(this,"oriType",null),tk(this,"minType",null),tk(this,"metadata",null),tk(this,"realTimeWidth",0),tk(this,"realTimeHeight",0),tk(this,"isFromFile",!1),tk(this,"isCached",!1),tk(this,"isDestroyed",!1),tk(this,"isLoading",!1),tk(this,"isMinLoading",!1),tk(this,"isSaving",!1),tk(this,"annotations",void 0),tk(this,"ownerFiles",new TU({children:[]})),tk(this,"ownerTags",new TU({children:[]})),tk(this,"ownerDefaultFile",void 0),tk(this,"operations",[]),tk(this,"useFillColor",!1),this.uid=t.uid,this.metadata=rk({},t.metadata),this.setRealTimeSize(this.metadata.width,this.metadata.height);}return ok(e,[{key:"setRealTimeSize",value:function value(e,t){this.realTimeWidth=e,this.realTimeHeight=t;}},{key:"destroy",value:function value(){this.isDestroyed||(this.customData=null,this.img=null,this.owners=null,this.metadata=null,this.isDestroyed=!0);}},{key:"addOwner",value:function value(e){var t=this.owners;DT(t).call(t,e)<0&&t.push(e);}},{key:"removeOwner",value:function value(e){var t=this.owners,i=DT(t).call(t,e);i>-1&&sI(t).call(t,i,1);}},{key:"removeViewer",value:function value(e){var t=this.owners,i=DT(t).call(t,e);i>-1&&sI(t).call(t,i,1);}},{key:"setVisible",value:function value(e){var t;DT(t=this.visible).call(t,e)<0&&this.visible.push(e);}},{key:"cancelVisible",value:function value(e){var t,i,r=DT(t=this.visible).call(t,e);r>-1&&sI(i=this.visible).call(i,r,1);}},{key:"setPreload",value:function value(e){var t;DT(t=this.preload).call(t,e)<0&&this.preload.push(e);}},{key:"cancelPreload",value:function value(e){var t,i,r=DT(t=this.preload).call(t,e);r>-1&&sI(i=this.preload).call(i,r,1);}},{key:"reset",value:function value(){this.minData=null,this.oriData=null,this.img=null,this.activeOri=!1,this.activeMin=!1,this.minTask=null,this.oriTask=null,this.operations=[];}}]),e;}(),YU=function(){function e(){ak(this,e);}return ok(e,[{key:"apply",value:function value(e){var t=e.hooks;e.statusStore=new BU();var i=function i(t){var i=t.data;t.filename,t.index,dk(i).call(i,function(t){var i=new jU(t);e.statusStore.set(t.uid,i);});},r=function r(t){var i=t.removedUids;dk(i).call(i,function(t){var i,r,n=e.statusStore.get(t);n&&(Zz(n.minData),Zz(n.oriData),n.ownerFiles.clear(),n.ownerTags.clear(),n.ownerDefaultFile=!1,null!==(i=n.img)&&void 0!==i&&i.src&&(n.img.src=""),null!==(r=n.minImg)&&void 0!==r&&r.src&&(n.minImg.src=""),n.img=null,n.minImg=null),e.statusStore.remove(t);});},n=function n(t){var i=t.modifiedUid,r=t.data,n=t.revoke,o=e.statusStore.get(i);if(o){o.img=null,o.minImg=null;var a=r.metadata;a&&(o.metadata=rk({},a),o.setRealTimeSize(a.width,a.height)),n&&(Zz(o.oriData),Zz(o.minData)),o.reset(),e.statusStore.update(i,o);}},o=function o(t){var i;dk(i=t.children).call(i,function(i){var r=e.statusStore.get(i);r&&("file"===t.type?r.ownerFiles.remove(t.uid):"tag"===t.type&&r.ownerTags.remove(t.uid));});},a=function a(t){var i=t.docUid,r=t.sourceUids,n=t.type;dk(r).call(r,function(t){var r=e.statusStore.get(t);r&&("file"===n?r.ownerFiles.append(i):"tag"===n?r.ownerTags.append(i):"default"===n&&(r.ownerDefaultFile=!0));});},s=function s(t){var i=t.docUid,r=t.sourceUids,n=t.type;dk(r).call(r,function(t){var r=e.statusStore.get(t);r&&("file"===n?r.ownerFiles.remove(i):"tag"===n?r.ownerTags.remove(i):"default"===n&&(r.ownerDefaultFile=!0));});};t.loadSource.on(i),t.afterRemoveSource.on(r),t.updateSource.on(n),t.removeDoc.on(o),t.loadToDoc.on(a),t.removeFromDoc.on(s),t.destroy.on(function(){t.loadSource.off(i),t.afterRemoveSource.off(r),t.updateSource.off(n),t.removeDoc.off(o),t.loadToDoc.off(a),t.removeFromDoc.off(s);});}}]),e;}(),XU=function(){function e(){ak(this,e);}return ok(e,[{key:"apply",value:function value(e){var t=e.hooks;e.store=new PU("space_db","space_doc");var i=function i(t){var i=t.data;i&&dk(i).call(i,function(t){e.store.set(t.uid,t);});},r=function r(t){var i;dk(i=t.removedUids).call(i,function(t){e.store.remove(t);});},n=function n(t){e.store.update(t.modifiedUid,t.data);};t.loadSource.on(i),t.removeSource.on(r),t.updateSource.on(n),t.destroy.on(function(){t.loadSource.off(i),t.removeSource.off(r),t.updateSource.off(n);});}}]),e;}(),qU=function(){function e(){ak(this,e);}return ok(e,[{key:"apply",value:function value(e){e.tag=new RU(),this.listenSpaceHooks(e),this.listenTagHooks(e);}},{key:"listenTagHooks",value:function value(e){var t=e.tag.hooks,i=function i(t){var i;dk(i=t.children).call(i,function(i){var r=e.statusStore.get(i);r&&r.ownerFiles.remove(t.uid);}),e.hooks.removeDoc.emit(t);},r=function r(t){e.hooks.renameDoc.emit(t);};t.beforeRemoveTag.on(i),t.afterRenameTag.on(r),t.destroy.on(function(){t.beforeRemoveTag.off(i),t.afterRenameTag.off(r);});}},{key:"listenSpaceHooks",value:function value(e){var t=e.hooks,i=function i(t){var i=t.data,r=e.tag.defaultName;dk(i).call(i,function(e){var t;(e.tags||(e.tags=[]),r)&&DT(t=e.tags).call(t,r)<0&&e.tags.push(r);});},r=function r(t){var i=t.data;dk(i).call(i,function(t){var i;null!==(i=t.tags)&&void 0!==i&&dk(i).call(i,function(i){e.tag.appendChildToTag(i,t.uid);var r={docUid:e.tag.getTag(i).uid,sourceUids:[t.uid],type:"tag"};e.hooks.loadToDoc.emit(r);}),t.tags.length=0;});},n=function n(t){var i=t.removedUids,r={};dk(i).call(i,function(t){var i,n,o=e.statusStore.get(t);o&&dk(i=ET(n=o.ownerTags.children).call(n)).call(i,function(e){r[e]||(r[e]=[]),r[e].push(t);});});for(var n=0,o=GE(r);n<o.length;n++){var a=cb(o[n],2),s=a[0],l=a[1],u=e.tag.getTagByUid(s);u&&e.tag.removeChildFromTag(u.name,l),e.hooks.removeFromDoc.emit({docUid:s,sourceUids:l,type:"tag"});}},o=function o(e){"tag"!==e.type&&n({removedUids:e.children});},a=function a(t){var i=t.docUid,r=t.sourceUids;if("tag"===t.type){var n=e.tag.getTagByUid(i);n&&dk(r).call(r,function(){var t=Pw(Iw().mark(function t(i){var r,o;return Iw().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.store.get(i);case 3:if(o=t.sent,t.t0=o&&DT(r=o.tags).call(r,n.name)<0,!t.t0){t.next=9;break;}return o.tags.push(n.name),t.next=9,e.store.update(i,o);case 9:t.next=14;break;case 11:t.prev=11,t.t1=t.catch(0),console.log();case 14:case"end":return t.stop();}},t,null,[[0,11]]);}));return function(e){return t.apply(this,arguments);};}());}},s=function s(t){var i=t.docUid,r=t.sourceUids;if("tag"===t.type){var n=e.tag.getTagByUid(i);n&&dk(r).call(r,function(){var t=Pw(Iw().mark(function t(i){var r,o,a,s;return Iw().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.store.get(i);case 3:if(!(r=t.sent)){t.next=9;break;}return(s=DT(o=r.tags).call(o,n.name))>-1&&sI(a=r.tags).call(a,s,1),t.next=9,e.store.update(i,r);case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),console.log();case 14:case"end":return t.stop();}},t,null,[[0,11]]);}));return function(e){return t.apply(this,arguments);};}());}};t.beforeLoadSource.on(i),t.loadSource.on(r),t.removeSource.on(n),t.removeDoc.on(o),t.loadToDoc.on(a),t.removeFromDoc.on(s),t.destroy.on(function(){t.beforeLoadSource.off(i),t.loadSource.off(r),t.removeSource.off(n),t.removeDoc.off(o),t.loadToDoc.off(a),t.removeFromDoc.off(s);});}}]),e;}(),ZU=function(e){lb(i,e);var t=ub(i);function i(){var e;return ak(this,i),tk(rc(e=t.call(this)),"uid",bz()),tk(rc(e),"hooks",{init:Jz.create(),destroy:Jz.create(),beforeLoadSource:Jz.create(),loadSource:Jz.create(),afterLoadSource:Jz.create(),beforeRemoveSource:Jz.create(),removeSource:Jz.create(),afterRemoveSource:Jz.create(),beforeUpdateSource:Jz.create(),updateSource:Jz.create(),afterUpdateSource:Jz.create(),beforeBufferChanged:Jz.create(),afterBufferChanged:Jz.create(),directoryChanged:Jz.create(),tagChanged:Jz.create(),openDoc:Jz.create(),loadToDoc:Jz.create(),removeFromDoc:Jz.create(),removeDoc:Jz.create(),renameDoc:Jz.create(),move:Jz.create(),afterMove:Jz.create(),switch:Jz.create(),afterSwitch:Jz.create(),reorder:Jz.create(),afterReorder:Jz.create()}),tk(rc(e),"dir",void 0),tk(rc(e),"tag",void 0),tk(rc(e),"store",void 0),tk(rc(e),"customStore",void 0),tk(rc(e),"metadataStore",void 0),tk(rc(e),"statusStore",void 0),tk(rc(e),"defaultFile",void 0),tk(rc(e),"plugins",[]),tk(rc(e),"imageLoader",void 0),e.initPlugins(),e.hooks.init.emit(),e;}return ok(i,[{key:"destroy",value:function value(){this.hooks.destroy.emit();}},{key:"initPlugins",value:function value(){new XU().apply(this),new YU().apply(this),new NU().apply(this),new FU().apply(this),new LU().apply(this),new WU().apply(this),new HU().apply(this),new qU().apply(this);}},{key:"setImageLoader",value:function value(e){this.imageLoader=e;}},{key:"getCustomData",value:function value(e){return this.customStore.get(e);}},{key:"setCustomData",value:function value(e,t){return this.customStore.set(e,t);}},{key:"getMetadata",value:function value(e){return this.metadataStore.get(e);}},{key:"setMetadata",value:function value(e,t){return this.metadataStore.set(e,t);}},{key:"createStore",value:function value(e){var t=e.type,i=void 0===t?"sync":t,r=e.tableName,n=e.dbName;return"sync"===i?new BU():n&&r?new PU(n,r):null;}},{key:"loadSource",value:function value(e,t){if(nz(e))return[];var i=e.data;if(!ez(i))return[];var r=[];return dk(i).call(i,function(e){e.uid=bz(),r.push(e.uid);}),dz(t)&&t(r),this.hooks.beforeBufferChanged.emit(e),this.hooks.beforeLoadSource.emit(e),this.hooks.loadSource.emit(e),this.hooks.afterLoadSource.emit(e),this.hooks.afterBufferChanged.emit(e),r;}},{key:"removeSource",value:function value(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];az(e)&&(e=[e]);var i={removedUids:e,docUid:"",trigger:this.uid,operation:"remove"};return this.hooks.beforeRemoveSource.emit(i),this.hooks.beforeBufferChanged.emit(i),this.hooks.removeSource.emit(i),t&&this.hooks.afterRemoveSource.emit(i),this.hooks.afterBufferChanged.emit(i),!0;}},{key:"updateSource",value:function value(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r={modifiedUid:e,data:t,revoke:i,operation:"modify"};return this.hooks.beforeUpdateSource.emit(r),this.hooks.beforeBufferChanged.emit(r),this.hooks.updateSource.emit(r),this.hooks.afterUpdateSource.emit(r),this.hooks.afterBufferChanged.emit(r),!0;}},{key:"getSource",value:function value(e){return this.store.get(e);}},{key:"openDefault",value:function value(e){var t={node:this.defaultFile,type:"default",config:e};this.hooks.openDoc.emit(t);}},{key:"createFile",value:function value(e){return this.dir.createFile(e);}},{key:"removeFile",value:function value(e){return this.dir.removeFile(e);}},{key:"renameFile",value:function value(e,t){return this.dir.renameFile(e,t);}},{key:"openFile",value:function value(e,t){var i=this.getFile(e);if(!i)return!1;var r={node:i,type:"file",config:t};return this.hooks.openDoc.emit(r),!0;}},{key:"movePagesToFile",value:function value(e,t,i,r){var n=this,o=this.getFile(e),a=this.getFile(i);if(!o||!a)return!1;for(var s=0;s<t.length;s++)if(t[s]<0||t[s]>=o.children.length)return!1;if(r<0)return!1;var l=jI(t).call(t,function(e){return o.children[e];});dk(l).call(l,function(e){var t=n.statusStore.get(e);t&&t.ownerFiles.remove(o.uid);}),this.dir.removeChildFromFile(o.uid,l),this.hooks.removeFromDoc.emit({docUid:o.uid,sourceUids:l}),r>a.children.length&&(r=a.children.length);var u=this.dir.appendChildrenToFile(i,l,r),c={docUid:u.uid,sourceUids:l,type:"file",index:r};return dk(l).call(l,function(e){var t=n.statusStore.get(e);t&&t.ownerFiles.append(u.uid);}),this.hooks.loadToDoc.emit(c),!0;}},{key:"getFile",value:function value(e){return this.dir.getFile(e);}},{key:"getFileList",value:function value(){return this.dir.getCurrentFileList();}},{key:"isFileExisted",value:function value(e){return this.dir.isFileExist(e);}},{key:"createTag",value:function value(e){return this.tag.createTag(e);}},{key:"removeTag",value:function value(e){for(var t=this.getTag(e).children||[],i=0;i<t.length;i++)this.store.get(t[i]).then(function(t){var i,r,n=DT(i=(null==t?void 0:t.tags)||[]).call(i,e);-1!==n&&sI(r=t.tags).call(r,n,1);});return this.tag.removeTag(e);}},{key:"renameTag",value:function value(e,t){var i=this.getTag(e).children||[],r=this.tag.renameTag(e,t);if(r)for(var n=0;n<i.length;n++)this.store.get(i[n]).then(function(i){var r,n,o=DT(r=(null==i?void 0:i.tags)||[]).call(r,e);-1!==o&&sI(n=i.tags).call(n,o,1,t);});return r;}},{key:"openTag",value:function value(e,t){var i=this.getTag(e);if(!i)return!1;var r={node:i,type:"tag",config:t};return this.hooks.openDoc.emit(r),!0;}},{key:"getTag",value:function value(e){return this.tag.getTag(e);}},{key:"getTagList",value:function value(){return this.tag.getTagList();}},{key:"setDefaultTag",value:function value(e){return this.tag.setDefaultTag(e);}},{key:"getDefaultTag",value:function value(){return this.tag.getDefaultTag();}},{key:"isTagExisted",value:function value(e){return this.tag.isTagExisted(e);}},{key:"addTagToSource",value:function value(e,t){if(this.statusStore.get(e)){az(t)&&(t=[t]);for(var i=0;i<t.length;i++)if(!this.addSourceToTag(t[i],e))return!1;return!0;}return!1;}},{key:"removeTagFromSource",value:function value(e,t){if(this.statusStore.get(e)){var i;nz(t)?t=jI(i=this.tag.tags).call(i,function(e){return e.name;}):az(t)&&(t=[t]);for(var r=0;r<t.length;r++)if(!this.removeSourceFromTag(t[r],e))return!1;return!0;}return!1;}},{key:"addSourceToTag",value:function value(e,t){var i=this.tag.getTag(e);if(i&&this.tag.appendChildToTag(e,t)){az(t)&&(t=[t]);for(var r=0;r<t.length;r++)this.store.get(t[r]).then(function(t){var i;t&&(ez(t.tags)||(t.tags=[]),VP(i=t.tags).call(i,e)||t.tags.push(e));});var n={sourceUids:t,docUid:i.uid,type:"tag"};return this.hooks.loadToDoc.emit(n),!0;}return!1;}},{key:"removeSourceFromTag",value:function value(e,t){var i=this.tag.getTag(e);if(i){this.tag.removeChildFromTag(e,t),az(t)&&(t=[t]);for(var r=0;r<t.length;r++)this.store.get(t[r]).then(function(t){var i,r,n=DT(i=(null==t?void 0:t.tags)||[]).call(i,e);-1!==n&&sI(r=t.tags).call(r,n,1);});var n={docUid:i.uid,sourceUids:t,type:"tag"};return this.hooks.removeFromDoc.emit(n),!0;}return!1;}},{key:"getSourceTags",value:function value(e){var t,i=this,r=this.statusStore.get(e);return r?jI(t=r.ownerTags.children).call(t,function(e){return i.tag.getTagByUid(e).name;}):[];}},{key:"switch",value:function value(e){var t=e.one,i=e.other,r=e.type,n=e.docUid,o=e.emit,a=this.getDocNode(n,r);if(a){if(a.switch(t,i),o||nz(o)){var s={one:t,other:i,docUid:n,type:a.type,trigger:this.uid,operation:"shift"};this.hooks.switch.emit(s);}return!0;}return!1;}},{key:"move",value:function value(e){var t=e.from,i=e.to,r=e.type,n=e.docUid,o=e.emit,a=this.getDocNode(n,r);if(a){if(a.move(t,i),o||nz(o)){var s={from:t,to:i,docUid:n,type:a.type,trigger:this.uid,operation:"shift"};this.hooks.move.emit(s);}return!0;}return!1;}},{key:"reorder",value:function value(e){var t=e.indexes,i=e.type,r=e.docUid,n=e.emit,o=this.getDocNode(r,i);if(o&&(o.reorder(t),n||nz(n))){var a={indexes:t,docUid:r,type:o.type,trigger:this.uid,operation:"shift"};this.hooks.move.emit(a);}}},{key:"getDocNode",value:function value(e,t){switch(t){case"default":return this.defaultFile;case"file":return this.dir.getFileByUid(e);case"tag":return this.tag.getTagByUid(e);default:return e===this.defaultFile.uid?this.defaultFile:this.tag.getTagByUid(e)||this.dir.getFileByUid(e)||null;}}}]),i;}($z),_U={Successful:{errorCode:0,errorString:"Successful."},InvalidIndex:{errorCode:-1033,errorString:"Invalid index."},InvalidValue:{errorCode:-1034,errorString:"Invalid value."},NoImage:{errorCode:-1035,errorString:"There is no image."},UnBindViewer:{errorCode:-2210,errorString:"You cannot call this method on this WebTwain instance because it does not use the default viewer."},AlReadyBindViewer:{errorCode:-2211,errorString:"The element is already bound to the viewer."},ParameterCannotEmpty:{errorCode:-2314,errorString:"The parameter cannot be empty."},IndicesNotArray:{errorCode:-2358,errorString:"The type of the parameter indices must be an Array."},IndexOutOfRange:{errorCode:-2359,errorString:"The index is out of range."},InvalidTagName:{errorCode:-2394,errorString:"Invalid tag name."},InvalidLeftOrTopOrRightOrBottom:{errorCode:-2417,errorString:"The left or top or right or bottom you entered is invalid."},InvalidWidth:{errorCode:-2418,errorString:"The width you entered is invalid."},InvalidHeight:{errorCode:-2419,errorString:"The height you entered is invalid."},WidthOrHeightOutOfImageSize:{errorCode:-2420,errorString:"The width or height is out of image size."},MobileServer_InvalidIndex:{errorCode:-2423,errorString:"The index is invalid."},ImageEditorExist:{errorCode:-2500,errorString:"An ImageEditor already exists."},ThumbnailViewerExist:{errorCode:-2501,errorString:"A ThumbnailViewer already exists."},CustomElementExist:{errorCode:-2502,errorString:"A CustomElement already exists."},ImageEditorDispose:{errorCode:-2504,errorString:"The ImageEditor object has been disposed."},ThumbnailViewerNotExist:{errorCode:-2505,errorString:"This ThumbnailViewer doesn't exist."},ThumbnailViewerDispose:{errorCode:-2506,errorString:"The ThumbnailViewer object has been disposed."},CallbackNotAFunction:{errorCode:-2510,errorString:"The callback is not a function."},ElementRequired:{errorCode:-2511,errorString:"Parameter 'element' is required."},ElementNotExist:{errorCode:-2512,errorString:"Parameter 'element' doesn't instanceof HTMLDivElement."},InvalidPropertyValue:{errorCode:-2514,errorString:"Invalid property value."},CursorInvalidMode:{errorCode:-2519,errorString:"The current mode does not support setting the cursor to zoom."},OldTagNameRequired:{errorCode:-2517,errorString:"Old tag name is required."},NewTagNameRequired:{errorCode:-2518,errorString:"New tag name is required."},FileNameCannotEmpty:{errorCode:-2530,errorString:"Document name cannot be empty."},FileNameNotString:{errorCode:-2531,errorString:"Document name is not a string."},FileNotExist:{errorCode:-2540,errorString:"The document does not exist."},FileExist:{errorCode:-2541,errorString:"The document already exists."},CustomElementDispose:{errorCode:-2508,errorString:"The CustomElement object has been disposed."},CustomElementNotExist:{errorCode:-2507,errorString:"This CustomElement doesn't exist."},ParameterOutRange:{errorCode:80002,errorString:"The parameter is out of range."},TagNotExist:{errorCode:80009,errorString:"Tag does not exist."},TagExist:{errorCode:80010,errorString:"The tag already exists."},OperationError:{errorCode:80022,errorString:"The operation mode is wrong."}},GU={visibility:"hidden",width:"24px",height:"24px",background:"#ffffff",borderWidth:"1px",borderColor:"#a79898",borderRadius:"50%",opacity:1,color:"#000000",fontFamily:"sans-serif",fontSize:12,left:"",top:"",right:1,bottom:1,translateX:"",translateY:""},KU={visibility:"hidden"},$U={visibility:"hidden",width:"24px",height:"24px",background:"#ffffff",borderWidth:"2px",borderColor:"#000000",checkMarkColor:"#000000",checkMarkLineWidth:"2px",borderRadius:0,opacity:1,left:1,top:1,right:"",bottom:"",translateX:"",translateY:""},QU=["topPageChanged","click","rightclick","dblclick","mousemove","pageAreaSelected","pageAreaUnselected","dragdone","onDrop","bufferChanged"];!function(e){e[e.Normal=0]="Normal",e[e.Balance=1]="Balance";}(zU||(zU={}));var JU={rows:1,columns:1,show:!1,enableDragPage:!1,enableSlide:!0,enableZoomWithCtrl:!0,enableSelectWithCtrl:!0,enableSelectWithShift:!0,scrollDirection:"vertical",displayMode:"multiple",fitType:"window",tabMode:"single",autoSelectTopPage:!1,autoScroll:!0,autoSelectLatest:!0,margin:0,gap:10,enableOptimizeImage:!0,enableDWT1x1:!0,viewerStyle:{background:"rgb(255, 255, 255)",border:""},canvasStyle:{background:"rgb(255, 255, 255)",border:"",cursor:"crosshair"},pageStyle:{border:"1px solid rgb(204, 204, 204)",background:"rgba(0,0,0,0)"},selectedPageStyle:{border:"1px solid rgb(125, 162, 206)",background:"rgb(199, 222, 252)"},hoveredPageStyle:{border:"1px solid rgb(204, 204, 204)",background:"rgb(239, 246, 253)"},placeholderStyle:{background:"rgb(251, 236, 136)"},checkboxStyle:rk({},$U),pageNumberStyle:rk({},GU),removeBtnStyle:rk({},KU)},eR={size:"30%",columns:1,rows:3,show:!1,scrollDirection:"vertical",gap:10,margin:10,autoChangeIndex:!1,autoSelectTopPage:!1,autoSelectLatest:!0,autoScroll:!0,enableKeyboardControl:!0,enableDragPage:!0,enableResizing:!1,enableDWT1x1:!0,enableOptimizeImage:!0,canvasStyle:{border:"",background:""},thumbnailStyle:{border:"",background:"rgb(255, 255, 255)"},pageStyle:{border:"1px solid rgb(238, 238, 238)",background:"transparent"},selectedPageStyle:{border:"1px solid rgb(125, 162, 206)",background:"rgb(199, 222, 252)"},hoveredPageStyle:{border:"1px solid rgb(238, 238, 238)",background:"rgb(239, 246, 253)"},pageNumberStyle:rk({},GU),checkboxStyle:rk({},$U),removeBtnStyle:rk({},KU),placeholderStyle:{background:"rgb(251, 236, 136)"}},tR={dlgRotateAnyAngle:["Angle :","Interpolation:","Keep size","  OK  ","Cancel"],dlgChangeImageSize:["New Height :","New Width :","Interpolation:","  OK  ","Cancel"],saveChangedImage:["You have changed the image, do you want to keep the change(s)?","  Yes  ","  No  "],selectSource:["Select Source:","Select","Cancel","There is no source available!"]},iR={background:"#434246",innerBorder:"",topMenuBorder:"",border:"1px solid rgb(204, 204, 204)",width:"100%",height:"100%",zoomOrigin:{x:"center",y:"center"},promptToSaveChange:!0,workMode:zU.Normal,selectionRectAspectRatio:1,buttons:{titles:{previous:"Previous Image",next:"Next Image",print:"Print Image",scan:"Acquire new Image(s)",load:"Load local Image(s)",rotateleft:"Rotate Left",rotate:"Rotate",rotateright:"Rotate Right",deskew:"Deskew",crop:"Crop Selected Area",cut:"Cut Selected Area",changeimagesize:"Change Image Size",flip:"Flip Image",mirror:"Mirror Image",zoomin:"Zoom In",originalsize:"Show Original Size",zoomout:"Zoom Out",stretch:"Stretch Mode",fit:"Fit Window",fitw:"Fit Horizontally",fith:"Fit Vertically",hand:"Hand Mode",rectselect:"Select Mode",zoom:"Click to Zoom In",restore:"Restore Original Image",save:"Save Changes",close:"Close the Editor",removeall:"Remove All Images",removeselected:"Remove All Selected Images"},visibility:{scan:!0,load:!0,print:!0,removeall:!0,removeselected:!0,rotateleft:!0,rotate:!0,rotateright:!0,deskew:!0,crop:!0,cut:!0,changeimagesize:!0,flip:!0,mirror:!0,zoomin:!0,originalsize:!0,zoomout:!0,stretch:!0,fit:!0,fitw:!0,fith:!0,hand:!0,rectselect:!0,zoom:!0,restore:!0,save:!0,close:!0}},dialogText:tR},rR={borderColor:"rgba(0,0,0,1)",borderWidth:1,ctrlBorderColor:"rgba(0,0,0,1)",ctrlBorderRadius:1,ctrlBorderWidth:1,ctrlWidth:9,ctrlHeight:9,ctrlSize:9,keepAspectRatio:!1,aspectRatio:1},nR=function(){function e(){ak(this,e),tk(this,"errCode",void 0),tk(this,"errorString",void 0);}return ok(e,[{key:"setError",value:function value(e,t){this.errCode=e,this.errorString=t;}},{key:"getError",value:function value(){return{errCode:this.errCode,errorString:this.errorString};}}]),e;}(),oR=function(){function e(t){ak(this,e),tk(this,"space",void 0),tk(this,"webViewer",void 0),tk(this,"isActiveFile",!1),tk(this,"isActiveTag",!1),tk(this,"currentFileName",""),tk(this,"currentTagName",""),tk(this,"bufferConfig",null),tk(this,"currentSelected",[]),this.space=new ZU(),t&&(this.bufferConfig=t);}return ok(e,[{key:"e",value:function value(){this.setError("Successful");}},{key:"IsFileNameExist",value:function value(e){var t=this.space.getFileList();if("dynamsoft-default-document"===e)return!0;if(t)for(var i=0;i<t.length;i++)if(t[i].name===e)return!0;return!1;}},{key:"getCurrentDataSet",value:function value(){if(this.webViewer){var e=this.webViewer.myViewer.getCurrentTab();if(void 0===e)return!1;var t=e.type;this.isActiveFile="file"===t,this.isActiveTag="tag"===t;}if(this.isActiveFile){var i=this.getCurrentFileName(),r=this.space.getFile(i);if(r)return r;}if(this.isActiveTag){var n=this.space.getTag(this.currentTagName);if(n)return n;}return!1;}},{key:"setError",value:function value(e){var t;if("Default"!==e){if(this.webViewer)this.webViewer.setError(e);else if(this.bufferConfig&&this.bufferConfig.viewerError){var i=_U[e],r=i.errorCode,n=i.errorString;this.bufferConfig.viewerError.setError(r,n);}}else null==this||null===(t=this.webViewer)||void 0===t||t.setDefaultError();}},{key:"emitViewerEvent",value:function value(){var e,t;this.webViewer&&0===this.getHowManyImagesInBuffer()&&(null===(e=this.webViewer)||void 0===e||null===(t=e.myViewer)||void 0===t||t.emit("pageRendered",-1));}},{key:"bindViewer",value:function value(e){this.webViewer=e;}},{key:"getCurrentTag",value:function value(){return this.currentTagName;}},{key:"getCurrentDocument",value:function value(){return this.currentFileName;}},{key:"getCurrentFileName",value:function value(){var e=this,t=this.space.getFileList(),i="";return t&&dk(t).call(t,function(t){t.name===e.currentFileName&&(i=e.currentFileName);}),i;}},{key:"getCurrentIndex",value:function value(){if(this.webViewer)return this.webViewer.getCurrentIndex();var e=this.getSelectedImagesIndices().length;if(e<=0){var t=this.getCurrentDataSet();return!!t&&t.children.length-1;}return this.getSelectedImagesIndices()[e-1];}},{key:"getHowManyImagesInBuffer",value:function value(){if(this.webViewer)return this.webViewer.getHowManyImagesInBuffer();var e=this.getCurrentDataSet();return e?e.children.length:0;}},{key:"getSelectedImagesIndices",value:function value(){return this.webViewer?this.webViewer.getSelectedImagesIndices():this.currentSelected;}},{key:"getIndexByUid",value:function value(e){if(!az(e)||!e)return this.setError("InvalidValue"),!1;if(this.webViewer)return this.webViewer.myViewer.getIndexByUid(e);var t=this.getCurrentDataSet(),i=t.children;return!!(t&&i&&ez(i))&&DT(i).call(i,e);}},{key:"getUidByIndex",value:function value(e){if(e<0||e>=this.getHowManyImagesInBuffer())return this.setError("IndexOutOfRange"),!1;if(this.webViewer)return this.webViewer.myViewer.getUidByIndex(e);var t=this.getCurrentDataSet().children;return!(t&&t.length<e)&&t[e];}},{key:"getDataByUid",value:function value(e){return this.space.getSource(e);}},{key:"updateDataByUid",value:function value(e,t){return this.space.store.set(e,t);}},{key:"setCustomDataByUid",value:function value(e,t){return az(e)&&""!==e?this.space.setCustomData(e,t):(this.setError("InvalidValue"),!1);}},{key:"getCustomDataByUid",value:function value(e){return this.space.getCustomData(e);}},{key:"setMetadataByUid",value:function value(e,t){return az(e)&&""!==e?this.space.setMetadata(e,t):(this.setError("InvalidValue"),!1);}},{key:"getMetadataByUid",value:function value(e){return this.space.getMetadata(e);}},{key:"addImage",value:function value(e,t,i){var r,n,o={},a=this.currentFileName,s="";!nz(i)&&az(i)?(this.IsFileNameExist(i)||this.createDocument(i),s=i):nz(a)||""===a?(this.space.isFileExisted("dynamsoft-default-document")||this.createDocument("dynamsoft-default-document"),this.webViewer&&(this.webViewer.bEmitBufferChanged=!1),this.openDocument("dynamsoft-default-document"),this.webViewer&&(this.webViewer.bEmitBufferChanged=!0),s="dynamsoft-default-document"):s=a,t&&(delete(n=rk({},t)).oriBlobData,t.oriBlobData&&(r=t.oriBlobData));var l=e.imageUrl,u=e.minImageUrl,c=e.imageId,h=e.serverId,d=e.uidFromServer,f=e.index;if(r&&(o=rk({},r)),c&&(o.imageId=c),h&&(o.serverId=h),d&&(o.uidFromServer=d),!nz(f)&&cz(f)){var v=this.getDocumentContents(s).length;f>=v&&(f=v);}var g=this.space.loadSource({data:[{oriData:l,minData:u,metadata:n,customData:o}],filename:s,index:f},function(t){var i=cb(t,1)[0];e.uuid=i;});if(this.isActiveTag){var m=this.getHowManyImagesInBuffer();this.currentSelected=m>0?[m-1]:[];}else this.currentSelected=!nz(f)&&cz(f)?[f]:[];return g;}},{key:"insertImage",value:function value(e,t,i){var r;return i&&i>=0?(r=this.space.loadSource({data:[e],filename:t,index:i}))[0]&&(this.currentSelected=[i]):(r=this.space.loadSource({data:[e],filename:t}),this.currentSelected=[]),r[0];}},{key:"updateImage",value:function value(e,t){var i=e.imageUrl,r=e.minImageUrl,n=e.imageId,o=e.serverId,a=e.uidFromServer,s=e.uuid,l=rk({},t);return s&&""!==s&&-1!==s?(this.space.updateSource(s,{oriData:i,minData:r,metadata:l,customData:{imageId:n,serverId:o,uidFromServer:a}}),s):(this.setError("IndexOutOfRange"),!1);}},{key:"removeImageByUid",value:function value(e){if(this.e(),this.webViewer){var t=this.webViewer.removePageByUid(e);return this.webViewer.resized(),this.emitViewerEvent(),t;}return this.space.removeSource(e);}},{key:"removeImageByIndex",value:function value(e){if(this.e(),e<0||e>=this.getHowManyImagesInBuffer())return this.setError("IndexOutOfRange"),!1;var t=this.getCurrentIndex(),i=!1;if(this.webViewer)i=this.webViewer.removePageByIndexes(e),this.webViewer.resized(),this.emitViewerEvent();else{var r=this.getCurrentDataSet();if(!r)return!1;i=this.space.removeSource(r.children[e]);}return i||this.setError("Default"),this.currentSelected=e===t&&0===e?this.getHowManyImagesInBuffer()>0?[0]:[]:e<=t?[t-1]:[t],i;}},{key:"removeSelectedImages",value:function value(e){this.e();var t=this.getSelectedImagesIndices();ez(e)&&e.length>0&&(t=e);var i=!1;if(this.webViewer)i=this.webViewer.removePageByIndexes(t),this.webViewer.resized(),this.emitViewerEvent();else{var r=[],n=this.getCurrentDataSet();if(!n)return!1;dk(t).call(t,function(e){n.children[e]&&n.children[e]&&r.push(n.children[e]);}),i=this.space.removeSource(r);}return i||this.setError("Default"),i;}},{key:"removeImageByIndexArr",value:function value(e){if(this.e(),!ez(e))return!1;var t=this.getCurrentDataSet();if(!t)return!1;var i,r=[];return dk(e).call(e,function(e){var i=t.children[e];i&&r.push(i);}),(i=this.space.removeSource(r))||this.setError("Default"),this.webViewer&&(this.webViewer.resized(),this.emitViewerEvent()),this.currentSelected=[],i;}},{key:"removeAllImages",value:function value(){this.e();var e=!1;if(this.webViewer)e=this.webViewer.removeAllPages(),this.webViewer.resized(),this.emitViewerEvent();else{var t=this.getCurrentDataSet();t&&(e=this.space.removeSource(hb(t.children)));}return e||this.setError("Default"),this.currentSelected=[],e;}},{key:"tagImages",value:function value(e,t){this.e();var i=this.getHowManyImagesInBuffer();if(!ez(e))return this.setError("IndicesNotArray"),!1;if(!az(t)||""===t)return this.setError("InvalidTagName"),!1;for(var r=0;r<i;r++){var n=e[r];if(Ek(n)||n<0||n>=i)return this.setError("IndexOutOfRange"),!1;}this.space.createTag(t);for(var o=0;o<e.length;o++){var a=e[o];if(a>=0){var s=this.getUidByIndex(a);s&&""!==s&&-1!==fx(s,10)&&this.space.addTagToSource(s,t);}}return!0;}},{key:"removeImageTag",value:function value(e,t){if(this.e(),!cz(e))return this.setError("InvalidValue"),!1;if(e<0||e>this.getHowManyImagesInBuffer())return this.setError("IndexOutOfRange"),!1;var i=this.getUidByIndex(e),r=!1;return i&&""!==i&&-1!==i&&(r=this.space.removeTagFromSource(i,t)),r||this.setError("Default"),r;}},{key:"getDefaultTag",value:function value(){return this.space.getDefaultTag();}},{key:"setDefaultTag",value:function value(e){if(this.e(),!az(e))return this.setError("InvalidValue"),!1;if(""===e)return this.space.setDefaultTag(null),!0;var t;return this.space.createTag(e),(t=this.space.setDefaultTag(e))||this.setError("Default"),t;}},{key:"removeTag",value:function value(e,t){var i=this;if(this.e(),!az(e))return this.setError("InvalidValue"),!1;if(!nz(t)&&!ez(t))return this.setError("IndicesNotArray"),!1;if(!this.space.isTagExisted(e))return this.setError("TagNotExist"),!1;var r=this.currentTagName,n=!1,o=!1;if(r&&(n=r===e),nz(t))o=this.space.removeTag(e),n&&this.clearFilter();else{var a=[];dk(t).call(t,function(e){var t=i.getUidByIndex(e);-1!==t&&a.push(t);});for(var s=0;s<(null==a?void 0:a.length);s++)if(!(o=this.space.removeTagFromSource(a[s],e)))return!1;}return o||this.webViewer.setDefaultError(),o;}},{key:"renameTag",value:function value(e,t){if(this.e(),nz(e)||""===e)return this.setError("OldTagNameRequired"),!1;if(nz(t)||""===t)return this.setError("NewTagNameRequired"),!1;if(!this.space.isTagExisted(e))return this.setError("TagNotExist"),!1;if(this.space.isTagExisted(t))return this.setError("TagExist"),!1;var i;return e===this.currentTagName&&(this.currentTagName=t),(i=this.space.renameTag(e,t))?this.space.setDefaultTag(t):this.setError("Default"),i;}},{key:"getTagContents",value:function value(e){return this.e(),e&&az(e)&&""!==e?this.space.getTag(e).children:[];}},{key:"getTagList",value:function value(){var e=this;this.e();var t=this.space.getTagList(),i=[];return t?dk(t).call(t,function(t){var r,n=[];dk(r=t.children).call(r,function(t){var i=e.getCustomDataByUid(t);if(i){var r=i.uidFromServer;n.push(r);}}),i.push({name:t.name,imageIds:n});}):i=[],i;}},{key:"getTagListByIndex",value:function value(e){if(!cz(e))return!1;var t=this.getUidByIndex(e);return this.space.getSourceTags(t);}},{key:"clearFilter",value:function value(){this.e(),this.currentTagName="",this.space.setDefaultTag(null);var e,t=this.getCurrentFileName();return""===t&&(t="dynamsoft-default-document"),(e=this.openDocument(t))||this.setError("Default"),e;}},{key:"filterImagesByTag",value:function value(e,t,i){this.e();var r=!1;if(nz(e)||null===e||""===e){this.currentTagName="";var n=this.getCurrentFileName();""===n&&(n="dynamsoft-default-document"),(r=this.openDocument(n))?dz(t)&&t():(this.setError("Default"),dz(i)&&i());}else{var o,a;if(!this.space.isTagExisted(e))return this.setError("TagNotExist"),dz(i)&&i(),!1;if(this.isActiveTag=!0,this.isActiveFile=!1,this.currentTagName=e,this.setDefaultTag(e),r=this.space.openTag(e,null==this||null===(o=this.webViewer)||void 0===o||null===(a=o.myViewer)||void 0===a?void 0:a.uid)){var s=this.space.getTag(e);if(s){var l,u=(null==s||null===(l=s.children)||void 0===l?void 0:l.length)||0;this.currentSelected=u>0?[u-1]:[];}dz(t)&&t();}else this.setError("Default"),dz(i)&&i();}return this.webViewer&&this.webViewer.render(),r;}},{key:"createDocument",value:function value(e){if(this.e(),!e||""===e){var t=cz(e)?"FileNameNotString":"FileNameCannotEmpty";return this.setError(t),!1;}return az(e)?this.space.isFileExisted(e)?(this.setError("FileExist"),!1):!!this.space.createFile(e)||(this.setError("Default"),!1):(this.setError("FileNameNotString"),!1);}},{key:"openDocument",value:function value(e,t){var i,r;if(this.e(),!e||""===e){var n=cz(e)?"FileNameNotString":"FileNameCannotEmpty";return this.setError(n),!1;}if(!az(e))return this.setError("FileNameNotString"),!1;if(!this.space.isFileExisted(e))return this.setError("FileNotExist"),!1;var o=t&&""!==t?t:null==this||null===(i=this.webViewer)||void 0===i||null===(r=i.myViewer)||void 0===r?void 0:r.uid;if(!this.space.openFile(e,{viewerUid:o}))return this.setError("Default"),!1;this.currentFileName=e,this.isActiveFile=!0,this.isActiveTag=!1;var a=this.space.getFile(e);if(a){var s,l=null==a||null===(s=a.children)||void 0===s?void 0:s.length;this.currentSelected=l>0?[l-1]:[];}return!0;}},{key:"getDocumentContents",value:function value(e){return this.e(),e&&az(e)&&""!==e?this.space.getFile(e).children:[];}},{key:"renameDocument",value:function value(e,t){return this.e(),az(e)&&az(t)?(e&&""!==e&&t&&""!==t||this.setError("FileNameCannotEmpty"),this.space.isFileExisted(e)?this.space.isFileExisted(t)?(this.setError("FileExist"),!1):this.space.renameFile(e,t)?(this.currentFileName===e&&(this.currentFileName=t),!0):(this.setError("Default"),!1):(this.setError("FileNotExist"),!1)):(this.setError("FileNameNotString"),!1);}},{key:"removeDocument",value:function value(e){if(this.e(),!e||!az(e))return this.setError("FileNameNotString"),!1;if(!this.space.isFileExisted(e))return this.setError("FileNotExist"),!1;var t=this.space.removeFile(e);return t?(t&&this.webViewer&&this.webViewer.resized(),this.currentFileName===e&&(this.currentFileName=""),!0):(this.setError("Default"),!1);}},{key:"getDocumentInfoList",value:function value(){var e=this;this.e();var t=this.space.getFileList(),i=[];return t?(dk(t).call(t,function(t){if(t.children){for(var r=[],n=0;n<t.children.length;n++){var o=t.children[n],a=e.getCustomDataByUid(o);if(a){var s=a.uidFromServer;r.push(s);}}i.push({imageIds:r,name:t.name});}}),i):[];}},{key:"getDocumentInfo",value:function value(e){this.e();var t=this.space.getFile(e);if(!t)return{imageIds:[],length:0};for(var i=[],r=0;r<t.children.length;r++){var n=t.children[r],o=this.getCustomDataByUid(n);if(o){var a=o.uidFromServer;i.push(a);}}return{imageIds:i,length:i.length};}},{key:"selectImages",value:function value(e){this.e();var t=!0;if(!e||!ez(e))return!1;if(this.webViewer){var i=this.webViewer.getIfAutoScroll();!1===i&&this.webViewer.setIfAutoScroll(!0),t=this.webViewer.selectPages(e),!1===i&&this.webViewer.setIfAutoScroll(!1);}else{for(var r=this.getHowManyImagesInBuffer(),n=0;n<e.length;n++)if(!cz(e[n])||e[n]<0||e[n]>=r)return this.setError("ParameterOutRange"),!1;t=!0;}return t?this.currentSelected=e:this.setError("Default"),t;}},{key:"selectAllImages",value:function value(){this.e();var e=!0;if(this.webViewer)e=this.webViewer.myViewer.selectAll(),this.currentSelected=this.webViewer.getSelectedImagesIndices();else{var t,i=this.getCurrentDataSet();this.currentSelected=EP(OP(t=new Array(i.children.length)).call(t));}return e||this.setError("Default"),e;}},{key:"moveImage",value:function value(e,t){this.e();var i=fx(e,10),r=fx(t,10);if(Ek(e)||Ek(t))return this.setError("InvalidIndex"),!1;var n=this.getHowManyImagesInBuffer();if(i<0||i>=n||r<0||r>n)return this.setError("IndexOutOfRange"),!1;var o=!1;if(this.webViewer)o=this.webViewer.myViewer.movePage(e,t);else{var a=this.getCurrentDataSet();if(!a)return!1;o=this.space.move({docUid:a.uid,type:a.type,from:e,to:t});}return o||this.setError("Default"),this.currentSelected=[t],o;}},{key:"switchImage",value:function value(e,t){this.e();var i=fx(e,10),r=fx(t,10);if(Ek(e)||Ek(t))return this.setError("InvalidIndex"),!1;var n=this.getHowManyImagesInBuffer(),o=this.getCurrentIndex();if(i<0||i>=n||r<0||r>n)return this.setError("IndexOutOfRange"),!1;var a=!1;if(this.webViewer)a=this.webViewer.myViewer.switchPage(e,t);else{var s=this.getCurrentDataSet();if(!s)return!1;a=this.space.switch({docUid:s.uid,type:s.type,one:e,other:t});}a||this.setError("Default");var l=o;return i===o?l=r:r===o&&(l=i),this.currentSelected=[l],a;}},{key:"moveImageToFile",value:function value(e,t,i,r){if(!this.space.isFileExisted(e)||!this.space.isFileExisted(i))return this.setError("FileNotExist"),!1;t=hb(new XB(t));var n=this.getDocumentInfo(e).length;if(!ez(t)||t.length>n)return this.setError("ParameterOutRange"),!1;var o=this.getDocumentInfo(i).length,a=this.space.movePagesToFile(e,t,i,r);if(!this.webViewer&&this.isActiveFile){var s=this.getHowManyImagesInBuffer();e===this.currentFileName&&(this.currentSelected=s>0?[s-1]:[]),i===this.currentFileName&&(cz(r)&&r<o&&r>=0?this.currentSelected=[r+t.length-1]:this.currentSelected=s>0?[s-1]:[]);}return a;}}]),e;}(),aR=function(){function e(t){var i,r,n,o,a=this;ak(this,e),tk(this,"uid",null),tk(this,"mode","default"),tk(this,"vertexes",[]),tk(this,"midpoints",[]),tk(this,"probePoints",[]),tk(this,"slopeRatio",[]),tk(this,"sensorRadius",4),tk(this,"isPointSelected",!1),tk(this,"activeProbePoint",null),tk(this,"isConvex",!0),tk(this,"isMoveBox",!1),tk(this,"width",0),tk(this,"height",0),tk(this,"zoom",1),tk(this,"keepAspectRatio",!1),tk(this,"aspectRatio",0),tk(this,"startX",null),tk(this,"startY",null),tk(this,"lastX",null),tk(this,"lastY",null),tk(this,"lastWhr",1),tk(this,"b1",void 0),tk(this,"b2",void 0),tk(this,"k1",void 0),tk(this,"k2",void 0),this.uid=bz(),dk(i=gk(t)).call(i,function(e){a[e]=t[e];}),this.midpoints=sR(this.vertexes),this.probePoints=Ck(r=ET(n=this.vertexes).call(n)).call(r,ET(o=this.midpoints).call(o)),this.slopeRatio=lR(this.vertexes);}return ok(e,[{key:"getRect",value:function value(){if("free"===this.mode)return null;var e=this.getBounds(),t=e.minX,i=e.maxX,r=e.minY;return{x:t,y:r,width:i-t||1,height:e.maxY-r||1};}},{key:"isBoxSelected",value:function value(e,t){var i=this.isPointOnBox(e,t),r=this.isCtrlPointSelected(e,t);return null!==r?r:i?8:-1;}},{key:"isCtrlPointSelected",value:function value(e,t){for(var i=qz(),r=this.sensorRadius,n=this.zoom,o=this.probePoints,a=this.width,s=this.height,l=r/n,u=kz(l,0,3*l)*i,c=kz(l,0,3*l)*i,h=0;h<8;h++){var d=o[2*h],f=o[2*h+1];if(e<=d+u&&e>=d-u&&t<=f+c&&t>=f-c&&e>=0-u&&e<=a+u&&t>=0-c&&t<=s+c)return h;}return null;}},{key:"checkOrientation",value:function value(e){if(e<0||e>7)return null;var t=this.getBounds(),i=t.minX,r=t.maxX,n=t.minY,o=t.maxY,a=this.probePoints,s=a[2*e],l=a[2*e+1],u=null,c=null;return s===r?u="e":s===i&&(u="w"),l===o?c="s":l===n&&(c="n"),e<4?c+u:c||u;}},{key:"onStartHandler",value:function value(e,t,i){if(void 0===i&&(i=this.isBoxSelected(e,t)),!(i<0)){this.startX=e,this.startY=t,this.lastX=e,this.lastY=t,8===i?(this.isPointSelected=!1,this.activeProbePoint=null,this.isMoveBox=!0):(this.isPointSelected=!0,this.activeProbePoint=i,this.isMoveBox=!1);var r=this.mode,n=this.probePoints,o=this.slopeRatio;if("free"===r&&i>3&&i<8){var a=i-4;this.k1=o[(a+1)%4],this.b1=n[(2*a+3)%8]-this.k1*n[(2*a+2)%8],this.k2=o[(a+3)%4],this.b2=n[(2*a+1)%8]-this.k2*n[(2*a+0)%8];}}}},{key:"onMoveHandler",value:function value(e,t,i){var r,n,o=this.isPointSelected,a=this.isMoveBox,s=this.probePoints,l=this.activeProbePoint,u=this.lastX,c=this.lastY,h=this.mode;if(o||a){var d=e-u,f=t-c;if(0!==d||0!==f){var v=ET(s).call(s);o?(void 0===i&&(i=l),"default"===h?v=this.movePointNormal(v,i,e,t):(v=this.movePointFree(v,i,e,t),this.slopeRatio=ET(r=lR(s)).call(r,0,4),this.isConvex=this.checkConvexity(v))):a&&(v=this.moveBox(v,d,f));var g=sR(v);this.probePoints=Ck(n=ET(v).call(v,0,8)).call(n,g),this.midpoints=g,this.lastX=e,this.lastY=t;}}}},{key:"onEndHandler",value:function value(){var e,t,i,r,n=this.isPointSelected,o=this.isMoveBox,a=this.startX,s=this.startY,l=this.vertexes,u=this.midpoints,c=this.lastX,h=this.lastY;if(this.startX=0,this.startY=0,n||o){this.isPointSelected=!1,this.isMoveBox=!1,this.activeProbePoint=null;var d=ET(e=this.probePoints).call(e),f=this.checkConvexity(d);(a===c&&s===h||!f)&&(d=Ck(t=ET(l).call(l)).call(t,u)),this.isConvex=!0,this.vertexes=ET(d).call(d,0,8),this.midpoints=sR(d),this.probePoints=Ck(i=ET(d).call(d,0,8)).call(i,this.midpoints),this.slopeRatio=ET(r=lR(d)).call(r,0,4);}}},{key:"getBounds",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.probePoints;return{minX:Math.min(e[0],e[2],e[4],e[6]),maxX:Math.max(e[0],e[2],e[4],e[6]),minY:Math.min(e[1],e[3],e[5],e[7]),maxY:Math.max(e[1],e[3],e[5],e[7])};}},{key:"movePointNormal",value:function value(e,t,i,r){i=Math.max(0,Math.min(this.width,i)),r=Math.max(0,Math.min(this.height,r));var n=0,o=0;if(this.keepAspectRatio){var a=this.getBounds(),s=a.minX,l=a.maxX,u=a.minY,c=a.maxY,h=this.checkOrientation(t),d=(l-s)/(c-u);0===d||d===1/0||d===-1/0||Ek(d)?d=this.lastWhr:this.lastWhr=d,n=0,o=0;var f="w";if(t<4){if(n=i-e[2*t],o=r-e[2*t+1],0===n||0===o)return e;f="w";}else{var v=t-4;if("e"===h?(t=(v+1)%4,f="w"):"s"===h?(t=v,f="h"):"w"===h?(t=v,f="w"):"n"===h&&(t=(v+1)%4,f="h"),n=i-e[2*v],o=r-e[2*v+1],0===n||0===o)return e;}"h"===f?(n=o*d,"ne"!==h&&"sw"!==h&&"n"!==h&&"w"!==h||(n=-n)):(o=n/d,"ne"!==h&&"sw"!==h&&"n"!==h&&"w"!==h||(o=-o));var g=e[2*t]+n,m=e[2*t+1]+o,y=this.width,p=this.height;g<0?(n=0-e[2*t],o=0):g>y?(n=y-e[2*t],o=0):m<0?(o=0-e[2*t+1],n=0):m>p&&(o=p-e[2*t+1],n=0),e[2*t]+=n,e[2*t+1]+=o;var w=(t+1)%4,b=(t+3)%4;t%2?(e[2*w]+=n,e[2*b+1]+=o):(e[2*w+1]+=o,e[2*b]+=n);}else if(t<4){if(n=i-e[2*t],o=r-e[2*t+1],0===n&&0===o)return e;e[2*t]=i,e[2*t+1]=r;var k=(t+1)%4,x=(t+3)%4;t%2?(e[2*k]=i,e[2*x+1]=r):(e[2*k+1]=r,e[2*x]=i);}else{var S=t-4,C=this.slopeRatio[S%4];0===C?(e[(2*S+3)%8]=r,e[(2*S+1)%8]=r):C!==1/0&&C!==-1/0||(e[(2*S+2)%8]=i,e[(2*S+0)%8]=i);}return e;}},{key:"movePointFree",value:function value(e,t,i,r){i=Math.max(0,Math.min(this.width,i)),r=Math.max(0,Math.min(this.height,r));var n=ET(e).call(e);if(t<4){var o=i-e[2*t],a=r-e[2*t+1];if(0===o&&0===a)return e;e[2*t]=i,e[2*t+1]=r;}else{var s=t-4,l=this.slopeRatio[s%4],u=r-l*i,c=-u/l,h=u,d=e[(2*s+9)%8]-l*e[(2*s+8)%8],f=-d/l,v=this.k1,g=this.b1,m=this.k2,y=this.b2;0===l?(e[(2*s+3)%8]=r,v!==1/0&&v!==-1/0&&(e[(2*s+2)%8]=(r-g)/v),e[(2*s+1)%8]=r,m!==1/0&&m!==-1/0&&(e[(2*s+0)%8]=(r-y)/m)):l===1/0||l===-1/0?(e[(2*s+2)%8]=i,e[(2*s+3)%8]=v*i+g,e[(2*s+0)%8]=i,e[(2*s+1)%8]=m*i+y):(0===v?e[(2*s+2)%8]+=c-f:v===1/0||v===-1/0?e[(2*s+3)%8]+=h-d:(e[(2*s+2)%8]=(g-u)/(l-v),e[(2*s+3)%8]=(l*g-v*u)/(l-v)),0===m?e[(2*s+0)%8]+=c-f:m===1/0||m===-1/0?e[(2*s+1)%8]+=h-d:(e[(2*s+0)%8]=(y-u)/(l-m),e[(2*s+1)%8]=(l*y-m*u)/(l-m)));for(var p=0;p<4;p++){var w=e[2*p],b=e[2*p+1];if(w<0||w>this.width||b<0||b>this.height)return n;}}return e;}},{key:"moveBox",value:function value(e,t,i){var r=this.getBounds(e),n=r.minX,o=r.maxX,a=r.minY,s=r.maxY,l=this.width,u=this.height;n+t<0&&(t=0-n),o+t>l&&(t=l-o),a+i<0&&(i=0-a),s+i>u&&(i=u-s);for(var c=0;c<4;c++)e[2*c]+=t,e[2*c+1]+=i;return e;}},{key:"isPointOnBox",value:function value(e,t){var i=this.getBounds(),r=i.minX,n=i.maxX,o=i.minY,a=i.maxY;if(e<r||e>n||t<o||t>a)return!1;if("free"===this.mode){for(var s=hb(this.vertexes),l=hb(this.midpoints),u=[],c=0;c<4;c++)u.push(sI(s).call(s,0,2)),u.push(sI(l).call(l,0,2));var h=function(e,t){var i,r,n,o,a=0,s=t.length;for(n=cb(t,1)[0],i=1;i<=s;i++){o=t[i%s],e[0]>Math.min(n[0],o[0])&&e[0]<=Math.max(n[0],o[0])&&e[1]<=Math.max(n[1],o[1])&&n[0]!==o[0]&&(r=(e[0]-n[0])*(o[1]-n[1])/(o[0]-n[0])+n[1],(n[1]===o[1]||e[1]<=r)&&(a+=1)),n=o;}return a%2!=0;}([e,t],u);return h;}return!0;}},{key:"checkConvexity",value:function value(e){var t,i=cb(e,8),r=i[0],n=i[1],o=i[2],a=i[3],s=i[4],l=i[5],u=i[6],c=i[7],h=(u-r)*(a-n)-(c-n)*(o-r),d=(r-o)*(l-a)-(n-a)*(s-o),f=(o-s)*(c-l)-(a-l)*(u-s),v=(s-u)*(n-c)-(l-c)*(r-u);if(h*d*f*v<0)return!1;var g=Ck(t=ET(e).call(e)).call(t,ET(e).call(e,0,2)),m=this.slopeRatio;if(m.length)for(var y=0;y<2;y++)if(m[y]!==m[y+2]&&uR(ET(g).call(g,2*y,2*y+2),ET(g).call(g,2*y+2,2*y+4),ET(g).call(g,2*y+4,2*y+6),ET(g).call(g,2*y+6,2*y+8)))return!1;return h*d*f*v>0;}}]),e;}();function sR(e){for(var t,i=Ck(t=ET(e).call(e,0,8)).call(t,e[0],e[1]),r=[],n=0;n<4;n++){var o=(i[2*n]+i[2*n+2])/2,a=(i[2*n+1]+i[2*n+3])/2;r.push(o,a);}return r;}function lR(e){for(var t,i=[],r=null,n=Ck(t=ET(e).call(e,0,8)).call(t,e[0],e[1]),o=0;o<4;o++)r=n[2*o+3]-n[2*o+1]==0&&n[2*o+2]-n[2*o]==0?0:(n[2*o+3]-n[2*o+1])/(n[2*o+2]-n[2*o]),i.push(r);return i;}function uR(e,t,i,r){if(function(e,t,i,r){var n=Math.min,o=Math.max;return n(e[0],t[0])<=o(i[0],r[0])&&n(i[0],r[0])<=o(e[0],t[0])&&n(e[1],t[1])<=o(i[1],r[1])&&n(i[1],r[1])<=o(e[1],t[1]);}(e,t,i,r)&&function(e,t,i,r){var n=e[0]*(i[1]-t[1])+t[0]*(e[1]-i[1])+i[0]*(t[1]-e[1]),o=e[0]*(r[1]-t[1])+t[0]*(e[1]-r[1])+r[0]*(t[1]-e[1]);return!((n^o)>=0&&0!==n&&0!==o||(n=i[0]*(e[1]-r[1])+r[0]*(i[1]-e[1])+e[0]*(r[1]-i[1]),o=i[0]*(t[1]-r[1])+r[0]*(i[1]-t[1])+t[0]*(r[1]-i[1]),(n^o)>=0&&0!==n&&0!==o));}(e,t,i,r)){var n=(r[0]-i[0])*(e[1]-t[1])-(t[0]-e[0])*(i[1]-r[1]),o=(e[1]-i[1])*(t[0]-e[0])*(r[0]-i[0])+i[0]*(r[1]-i[1])*(t[0]-e[0])-e[0]*(t[1]-e[1])*(r[0]-i[0]);if(0===n||0===o){var a=cR(e,t),s=cR(i,r),l=a[0],u=a[1],c=s[0],h=s[1];if(u[0]===c[0]&&u[1]===c[1])return u;if(l[0]===h[0]&&l[1]===h[1])return l;if(hR(u,s)&&hR(c,a))return[c,u];if(hR(l,s)&&hR(h,a))return[l,h];if(hR(l,s)&&hR(u,s))return[l,u];if(hR(c,s)&&hR(h,s))return[c,h];}var d=o/n;return n=(e[0]-t[0])*(r[1]-i[1])-(t[1]-e[1])*(i[0]-r[0]),[d,(o=t[1]*(e[0]-t[0])*(r[1]-i[1])+(r[0]-t[0])*(r[1]-i[1])*(e[1]-t[1])-r[1]*(i[0]-r[0])*(t[1]-e[1]))/n];}return!1;}function cR(e,t){return e[0]===t[0]?e[1]<t[1]?[e,t]:[t,e]:e[0]<t[0]?[e,t]:[t,e];}function hR(e,t){return t[0][0]===t[1][0]?e[1]>=t[0][1]&&e[1]<=t[1][1]:e[0]>=t[0][0]&&e[0]<=t[1][0];}var dR={aspectRatio:1,keepAspectRatio:!1,keepAspectRatioEdit:!1,keepAspectRatioWithShift:!0,multipleCropping:!0,enableCreateBoxByPointer:!0,enableCursor:!0,enableMagnifier:!0,borderColor:"orange",borderWidth:2,background:"rgba(255,255,255,0)",dashLine:[5,2],ctrlSize:16,ctrlBorderWidth:2,ctrlBorderRadius:4,ctrlBorderColor:"orange",ctrlBackground:"rgba(255,0,0,0)",invalidCtrlBorderColor:"red",invalidBorderColor:"red",magnifier:{fixed:!1,fixedTop:0,fixedLeft:0,size:50,magnification:2}},fR=function(){function e(t,i){ak(this,e),tk(this,"activeBoxId",null),tk(this,"startX",null),tk(this,"startY",null),tk(this,"addNewFlag",null),tk(this,"drawingFlag",!1),tk(this,"lastKeepAspectRatio",!1),tk(this,"area",null),tk(this,"canvasItem",null),tk(this,"cropBoxes",[]),tk(this,"width",0),tk(this,"height",0),tk(this,"scrollTop",0),tk(this,"scrollLeft",0),tk(this,"zoom",1),tk(this,"aspectRatio",0),tk(this,"keepAspectRatio",!1),tk(this,"keepAspectRatioEdit",!1),tk(this,"mouseDown",!1),tk(this,"cropSetting",{}),tk(this,"currentBoxId",void 0),tk(this,"unselectedCallback",null),tk(this,"selectedCallback",null),this.width=t,this.height=i,this.cropSetting=iz(dR);}return ok(e,[{key:"count",value:function value(){return this.cropBoxes.length;}},{key:"setCanvas",value:function value(e){this.canvasItem=e;}},{key:"setCanvasSize",value:function value(e,t){this.width=e,this.height=t,this.area||this.setArea(0,0,e,t);}},{key:"setKeepAspectRatio",value:function value(e){var t;this.keepAspectRatio=e,this.drawingFlag||dk(t=this.cropBoxes).call(t,function(t){t.keepAspectRatio=e;});}},{key:"setAspectRatio",value:function value(e){this.aspectRatio=e;}},{key:"setZoom",value:function value(e){var t;this.zoom=e,dk(t=this.cropBoxes).call(t,function(t){t.zoom=e;});}},{key:"setScrollTop",value:function value(e){this.scrollTop=e;}},{key:"setScrollLeft",value:function value(e){this.scrollLeft=e;}},{key:"setCropSetting",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=pz(e,iz(this.cropSetting));this.cropSetting=t;var i=this.cropSetting,r=i.keepAspectRatioEdit,n=i.keepAspectRatio;return this.keepAspectRatioEdit=r,n?(this.setKeepAspectRatio(!0),this.setAspectRatio(this.cropSetting.aspectRatio)):this.setKeepAspectRatio(!1),!0;}},{key:"getCropBoxes",value:function value(){var e,t=[];return dk(e=this.cropBoxes).call(e,function(e,i){var r=e.getRect();null!==r&&t.push({index:i,left:r.x,top:r.y,width:r.width,height:r.height});}),t;}},{key:"getRectArr",value:function value(){var e;return jI(e=this.cropBoxes).call(e,function(e,t){return rk({index:t},e.getRect());});}},{key:"clear",value:function value(){var e;this.cropBoxes.length>0&&null!==(e=this.unselectedCallback)&&void 0!==e&&e.call(this),this.cropBoxes=[];}},{key:"addFreeBox",value:function value(e){var t=this.cropSetting,i=t.ctrlSize,r=t.ctrlHeight,n=t.ctrlWidth,o=i;(n||r)&&(o=Math.max(n,r));var a=new aR({vertexes:ET(e).call(e),width:this.area.width,height:this.area.height,sensorRadius:o/2,mode:"free"});return this.cropBoxes.push(a),a;}},{key:"addBox",value:function value(e){var t=this.cropSetting,i=t.ctrlSize,r=t.ctrlHeight,n=t.ctrlWidth,o=i;(n||r)&&(o=Math.max(n,r));var a=new aR({vertexes:ET(e).call(e),width:this.area.width,height:this.area.height,mode:"default",aspectRatio:this.aspectRatio,keepAspectRatio:this.keepAspectRatio,sensorRadius:o/2,zoom:this.zoom});return a.isScaled=!1,this.cropBoxes.push(a),a;}},{key:"removeBox",value:function value(e){var t=this.cropBoxes;return nz(e)?(this.clear(),!0):!(e<0||e>=t.length||(sI(t).call(t,e,1),0));}},{key:"getBoxByUid",value:function value(e){var t;return gE(t=this.cropBoxes).call(t,function(t){return t.uid===e;});}},{key:"setArea",value:function value(e,t,i,r){var n;this.area={left:e,top:t,width:i,height:r},dk(n=this.cropBoxes).call(n,function(e){e.width=i,e.height=r;});}},{key:"isInArea",value:function value(e,t){var i=this.area,r=i.width,n=i.height;return!(e<0||e>r||t<0||t>n);}},{key:"checkSelect",value:function value(e,t){var i;return bI(i=this.cropBoxes).call(i,function(i){return i.isBoxSelected(e,t)>-1;});}},{key:"checkSelectForCursor",value:function value(e,t){for(var i=this.cropBoxes.length-1;i>=0;i--){var r=this.cropBoxes[i],n=r.isBoxSelected(e,t);if(n>-1){var o="move";return n<8&&(o=r.checkOrientation(n)),{part:n,position:o,mode:r.mode};}}return null;}},{key:"checkSelectVertex",value:function value(e,t){for(var i=this.cropBoxes.length-1;i>=0;i--){var r=this.cropBoxes[i].isBoxSelected(e,t);if(r>-1&&r<4)return!0;}return!1;}},{key:"onStartHandler",value:function value(e,t,i){var r=this.area,n=r.width,o=r.height,a=this.checkSelect(e,t);if(e=kz(e,0,n),t=kz(t,0,o),this.startX=e,this.startY=t,this.mouseDown=!0,a<0)return i||this.clear(),this.activeBoxId=null,void(this.lastKeepAspectRatio&&!this.keepAspectRatio&&this.setKeepAspectRatio(!0));var s=this.cropBoxes[a].uid;this.currentBoxId=s,this.activeBoxId=s,this.getBoxByUid(s).onStartHandler(e,t),!this.keepAspectRatioEdit&&this.keepAspectRatio&&(this.lastKeepAspectRatio=this.keepAspectRatio,this.setKeepAspectRatio(!1));}},{key:"onMoveHandler",value:function value(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.mouseDown){var r=null,n=this.activeBoxId,o=this.startX,a=this.startY,s=this.aspectRatio,l=this.area,u=l.width,c=l.height;e=kz(e,0,u);var h=(t=kz(t,0,c))-a,d=e-o,f=2/this.zoom,v=null;if(n||(d<-f&&h<-f?v=0:d>f&&h<-f?v=1:d>f&&h>f?v=2:d<-f&&h>f&&(v=3),null!==v&&s>0&&(h=d/s,v%2&&(h=-d/s))),null!==v&&i){for(var g=[],m=v%2?[o,a,o,a+h,e,a+h,e,a]:[e,a+h,o,a+h,o,a,e,a],y=0;y<4;y++)g.push(m[2*(v+y)%8]),g.push(m[(2*(v+y)+1)%8]);return(r=this.addBox(g)).keepAspectRatio=this.keepAspectRatio&&s>0,this.drawingFlag=!0,this.addNewFlag=this.keepAspectRatio,this.currentBoxId=r.uid,this.activeBoxId=r.uid,r.onStartHandler(this.startX,this.startY,v),r.onMoveHandler(e,t,v),void(v=null);}this.activeBoxId&&(r=this.getBoxByUid(this.activeBoxId)),r&&r.onMoveHandler(e,t);}}},{key:"onEndHandler",value:function value(){var e;if(this.mouseDown&&this.activeBoxId){this.mouseDown=!1,this.drawingFlag=!1;var t=this.getBoxByUid(this.activeBoxId);t&&(null!==this.addNewFlag&&(t.keepAspectRatio=this.addNewFlag,this.addNewFlag=null),t.onEndHandler(),this.cropBoxes.length>0&&null!==(e=this.selectedCallback)&&void 0!==e&&e.call(this,this.getRectArr()),this.activeBoxId=null);}}}]),e;}(),vR=function(){function e(){ak(this,e),tk(this,"cropMng",void 0),tk(this,"originalBoxes",[]),tk(this,"mouseDown",!1),tk(this,"imgData",null),this.cropMng=new fR(0,0);}return ok(e,[{key:"getBoxesData",value:function value(e,t){for(var i=e.length,r=[],n=[],o=0;o<i;o++){var a=e[o];if(cz(a.left)&&cz(a.top)&&cz(a.width)&&cz(a.height)){var s=a.left,l=a.top,u=a.width,c=a.height;r.push(rk({},a)),t.width>0&&t.height>0&&(s=s<0||s>t.width?0:s,l=l<0||l>t.height?0:l,c=c<=0?1:c,(u=u<=0?1:u)+s>t.width&&(u=t.width-s),c+l>t.height&&(c=t.height-l));var h={left:s,top:l,width:u,height:c};n.push(h);}}return{oriBoxes:r,newBoxes:n};}},{key:"resetBoxes",value:function value(){if(this.originalBoxes.length<1)return!1;var e=this.cropMng;e.removeBox();for(var t=this.getBoxesData(this.originalBoxes,e.area).newBoxes,i=t.length,r=0;r<i;r++){var n=t[r],o=n.left,a=n.top,s=n.width,l=n.height;this.cropMng.addBox([o,a,o+s,a,o+s,a+l,o,a+l]);}return!0;}},{key:"initCrop",value:function value(e,t,i,r){this.cropMng.setCanvas(i),this.cropMng.setCanvasSize(e,t),this.cropMng.setCropSetting(r);}},{key:"setCropArea",value:function value(e,t,i,r){this.cropMng.setArea(e,t,i,r);}},{key:"setCropConfig",value:function value(e){var t=e.zoom,i=e.scrollTop,r=e.scrollLeft;t&&this.cropMng.setZoom(t),nz(i)||this.cropMng.setScrollTop(i),nz(r)||this.cropMng.setScrollLeft(r);}},{key:"updateCropSetting",value:function value(e){return this.cropMng.setCropSetting(e),!0;}},{key:"setFreeBox",value:function value(e){var t,i;if(!this.cropMng.canvasItem)return!1;if(!e){var r=this.cropMng.area,n=r.width,o=r.height;e=[0,0,n,0,n,o,0,o];}return this.cropMng.addFreeBox(e),null!==(t=(i=this.cropMng).selectedCallback)&&void 0!==t&&t.call(i,this.cropMng.getRectArr()),!0;}},{key:"setNormalBoxes",value:function value(e){var t,i,r,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.cropMng,s=a.canvasItem,l=a.area;if(!s)return!1;var u=null;if(ez(e)){if(0===(u=e).length)return!1;}else{if(!tz(e))return!1;u=[e];}var c=this.getBoxesData(u,l),h=c.oriBoxes,d=c.newBoxes,f=d.length;n||this.cropMng.count()>0&&this.clearBox();for(var v=0;v<f;v++){var g=d[v],m=g.left,y=g.top,p=g.width,w=g.height;this.cropMng.addBox([m,y,m+p,y,m+p,y+w,m,y+w],o);}return(t=this.originalBoxes).push.apply(t,hb(h)),null!==(i=(r=this.cropMng).selectedCallback)&&void 0!==i&&i.call(r,this.cropMng.getRectArr()),!0;}},{key:"clearSelectedBoxes",value:function value(e){var t,i=this.cropMng;return!!i.canvasItem&&(sI(t=this.originalBoxes).call(t,e,1),i.removeBox(e),this.render(),!0);}},{key:"clearBox",value:function value(){var e=this.cropMng;return!(!e.canvasItem||e.cropBoxes.length&&0!==e.cropBoxes.length&&(this.originalBoxes=[],e.canvasItem.style.cursor="crosshair",e.removeBox(),this.render(),0));}},{key:"getCropBoxes",value:function value(){return this.cropMng.getCropBoxes();}},{key:"getBoxCount",value:function value(){var e=this.cropMng;return e.cropBoxes.length?e.cropBoxes.length:0;}},{key:"getCropCoordinate",value:function value(e){var t=this.cropMng;return!(!t.canvasItem||0===t.cropBoxes.length)&&(void 0!==e?!!(cz(e)&&e<t.cropBoxes.length)&&t.cropBoxes[e].probePoints:t.getBoxByUid(t.currentBoxId).probePoints);}},{key:"setMagnifier",value:function value(e){this.imgData=e;}},{key:"render",value:function value(){var e,t=this,i=this.cropMng,r=i.canvasItem,n=i.zoom,o=i.area,a=i.scrollTop,s=i.scrollLeft,l=i.cropSetting;if(r&&i.cropBoxes.length){var u=r.getContext("2d"),c=l.dashLine,h=l.borderColor,d=l.borderWidth,f=l.ctrlBorderColor,v=l.ctrlBackground,g=l.ctrlBorderWidth,m=l.ctrlBorderRadius,y=l.background,p=l.invalidBorderColor,w=l.invalidCtrlBorderColor,b=l.ctrlSize,k=l.ctrlWidth,x=l.ctrlHeight;u.setTransform(1,0,0,1,0,0),dk(e=i.cropBoxes).call(e,function(e){for(var i,r,l=ET(i=e.probePoints).call(i,0,8),S=ET(r=e.midpoints).call(r,0,8),C=0;C<4;C++)l[2*C]=l[2*C]*n+o.left-s,l[2*C+1]=l[2*C+1]*n+o.top-a,S[2*C]=S[2*C]*n+o.left-s,S[2*C+1]=S[2*C+1]*n+o.top-a;u.save();var V=qz();try{u.setLineDash([c[0]*V,c[1]*V]);}catch(e){console.error("your browser does not support setLineDash().");}u.strokeStyle=e.isConvex?h:p,u.fillStyle=y,u.lineWidth=d*V,u.beginPath(),u.moveTo(l[0]*V,l[1]*V);for(var T=1;T<4;T++)u.lineTo(l[2*T]*V,l[2*T+1]*V);u.closePath(),iE(u).call(u),u.stroke(),u.strokeStyle=e.isConvex?f:w,u.fillStyle=v,u.lineWidth=g*V;var I=b,E=b;I=cz(k)?k*V:cz(x)?x*V:b*V,cz(x)?E=x*V:I=cz(k)?k*V:b*V;for(var P=0;P<4;P++){u.setLineDash([0,0]),u.beginPath();for(var B=l[2*P],D=l[2*P+1],M=0;M<4;M++)t.drawRoundedRectangle(u,{x:B*V,y:D*V,width:I,height:E,radius:Math.min(m*V,b*V/2)});u.closePath(),iE(u).call(u),u.stroke();}for(var A=0;A<4;A++){u.beginPath();for(var z=S[2*A],U=S[2*A+1],R=0;R<4;R++)t.drawRoundedRectangle(u,{x:z*V,y:U*V,width:I,height:E,radius:Math.min(m*V,b*V/2)});u.closePath(),iE(u).call(u),u.stroke();}u.restore();});}}},{key:"drawRoundedRectangle",value:function value(e,t){var i=t.width,r=t.height,n=t.radius,o=t.x,a=t.y,s=[{x:o-i/2+n,y:a-r/2+n,start:Math.PI,end:3*Math.PI/2},{x:o+i/2-n,y:a-r/2+n,start:3*Math.PI/2,end:2*Math.PI},{x:o+i/2-n,y:a+r/2-n,start:0,end:Math.PI/2},{x:o-i/2+n,y:a+r/2-n,start:Math.PI/2,end:Math.PI}];if(e.beginPath(),e.arc)for(var l=0;l<4;l++){var u=s[l];e.arc(u.x,u.y,n,u.start,u.end);}else e.rect(o-i/2,a-r/2,i,r);e.closePath();}},{key:"toCanvas",value:function value(e){var t=window.TouchEvent&&e instanceof window.TouchEvent?e.targetTouches[0]:e,i=this.cropMng.canvasItem.getBoundingClientRect(),r=_z(),n=r.scrollX,o=r.scrollY;return{offsetX:t.pageX-n-i.left,offsetY:t.pageY-o-i.top};}},{key:"onStartHandler",value:function value(e){var t=this.cropMng.cropSetting.multipleCropping,i=this.toCanvas(e),r=this.toAreaCoordinate(i.offsetX,i.offsetY);this.mouseDown=!0,this.cropMng.onStartHandler(r.x,r.y,e.ctrlKey&&t);}},{key:"onMoveHandler",value:function value(e){var t=this.cropMng,i=t.canvasItem,r=t.cropSetting,n=t.cropBoxes;if(this.mouseDown||0!==n.length){var o=r.enableCreateBoxByPointer,a=r.keepAspectRatioWithShift,s=r.keepAspectRatio,l=r.enableCursor,u=r.enableMagnifier,c=this.toCanvas(e),h=this.toAreaCoordinate(c.offsetX,c.offsetY);if(!this.mouseDown&&l){var d=this.cropMng.checkSelectForCursor(h.x,h.y);if(null===d)return void(i.style.cursor="crosshair");"default"===d.mode?i.style.cursor="move"===d.position?"move":"".concat(d.position,"-resize"):i.style.cursor=["move","nw-resize","ne-resize","se-resize","sw-resize","sw-resize","n-resize","e-resize","s-resize","w-resize"][d.part+1];}if(this.mouseDown){this.cropMng.onMoveHandler(h.x,h.y,o),e.shiftKey&&a?this.cropMng.setKeepAspectRatio(!0):s||this.cropMng.setKeepAspectRatio(!1);var f=this.cropMng.isInArea(h.x,h.y),v=this.cropMng.checkSelectVertex(h.x,h.y);this.mouseDown&&u&&f&&v&&this.renderMagnifier(e,h.x,h.y);}}else"crosshair"!==i.style.cursor&&(i.style.cursor="crosshair");}},{key:"onEndHandler",value:function value(e){this.mouseDown=!1,this.cropMng.onEndHandler();}},{key:"renderMagnifier",value:function value(e,t,i){var r=this.cropMng;if(this.imgData&&r.canvasItem){var n=r.cropSetting,o=n.dashLine,a=n.borderColor,s=n.borderWidth,l=n.magnifier,u=l.fixed,c=l.fixedLeft,h=l.fixedTop,d=l.size,f=l.magnification,v=this.cropMng.canvasItem.getContext("2d"),g=this.toCanvas(e),m=2*d*f,y=g.offsetX,p=g.offsetY,w=f*d,b=g.offsetX-w,k=g.offsetY-w;u&&(y=h+d,p=c+d,b=h-(w=(f-1)*d),k=c-w),v.save(),v.beginPath(),v.arc(y,p,d,0,2*Math.PI),v.closePath(),v.clip(),v.drawImage(this.imgData,t-d,i-d,2*d,2*d,b,k,m,m),v.lineWidth=s,v.strokeStyle=a,v.setLineDash([o[0],o[1]]);var x=u?h+d:g.offsetX,S=u?c+d:g.offsetY;v.beginPath(),v.moveTo(x,S-d),v.lineTo(x,S+d),v.moveTo(x-d,S),v.lineTo(x+d,S),v.stroke(),v.restore();}}},{key:"toAreaCoordinate",value:function value(e,t){var i=this.cropMng,r=i.area,n=i.scrollLeft,o=i.scrollTop,a=i.zoom;return{x:e=(e-r.left+n)/a,y:t=(t-r.top+o)/a};}}]),e;}(),gR=function(){function e(){ak(this,e);}return ok(e,[{key:"init",value:function value(e){var t=e.rendererService.canvasDom,i=new vR();e.boxRenderer=i,i.cropMng.selectedCallback=function(){var t=e.getCurrentTab(),r=i.cropMng.getRectArr(),n=e.getStatus(t.currentPage.uid).imageScale;"single"===e.config.displayMode&&(n=1);var o=[];dk(r).call(r,function(e){var i={index:t.current,x:Math.floor(e.x*n),y:Math.floor(e.y*n),width:Math.floor(e.width*n),height:Math.floor(e.height*n)};o.push(i);}),e.emit("pageAreaSelected",t.current,o);},i.cropMng.unselectedCallback=function(){var t=e.getCurrentTab();e.emit("pageAreaUnselected",t.current);},i.initCrop(t.width,t.height,t,{}),this.listenNativeEvents(e),this.listenViewerHooks(e);}},{key:"listenNativeEvents",value:function value(e){var t=e.rendererService.canvasDom,i=!1,r=function r(t){var r=cb(e.formatTouches(t),1)[0];if("crop"===e.config.toolType){e.getPointerOverPageInfo(r.pageX,r.pageY).pageInfo.obj;var n=e.getCurrentTab();n&&n.currentPage&&(i=!0,e.boxRenderer.onStartHandler(t));}},n=function n(t){if("crop"===e.config.toolType&&(e.boxRenderer.onMoveHandler(t),i)){var r=e.getCurrentTab();e.rendererService.render(r);}},o=function o(t){if("crop"===e.config.toolType&&(e.boxRenderer.onEndHandler(t),i)){i=!1;var r=e.getCurrentTab();e.rendererService.render(r);}},a=function a(e){e.cancelable&&e.preventDefault();};t.addEventListener("touchmove",a,{passive:!1}),window.PointerEvent?(t.addEventListener("pointerdown",r),document.addEventListener("pointermove",n),document.addEventListener("pointerup",o)):window.MSPointerEvent&&(t.addEventListener("MSPointerDown",r),document.addEventListener("MSPointerMove",n),document.addEventListener("MSPointerUp",o)),e.hooksService.hooks.destroy.on(function(){t.removeEventListener("touchmove",a),window.PointerEvent?(t.removeEventListener("pointerdown",r),document.removeEventListener("pointermove",n),document.removeEventListener("pointerup",o)):window.MSPointerEvent&&(t.removeEventListener("MSPointerDown",r),document.removeEventListener("MSPointerMove",n),document.removeEventListener("MSPointerUp",o));});}},{key:"listenViewerHooks",value:function value(e){var t=function t(_t3,i){if("min"===i&&"multiple"===e.config.displayMode){var r=e.getCurrentTab();if(r){var n=r.currentPage;if(n&&n.uid===_t3){var o=e.getStatus(n.uid).imageScale,a=e.boxRenderer.cropMng.cropBoxes;e.boxRenderer.clearBox(),dk(a).call(a,function(t){var i=t.getRect();if(!t.isScaled){var r=i.x,n=i.y,a=i.width,s=i.height,l=r/o,u=n/o;a/=o,s/=o,e.boxRenderer.cropMng.addBox([l,u,l+a,u,l+a,u+s,l,u+s]).isScaled=!0;}}),e.renderOnly();}}}},i=e.hooksService.hooks,r=function r(){if("crop"===e.config.toolType){var t=e.getCurrentTab();t&&t.isTopPageChanged&&!t.isLoadPage&&e.config.autoSelectTopPage&&e.boxRenderer.clearBox();}},n=function n(){if("crop"===e.config.toolType){var t=e.getCurrentTab();if(t){var i=t.currentPage;if(i){var r,n,o,a=i.imageContainer.getPosition(),s=i.imageContainer.parsedStyle,l=s.width,u=s.height;null!==(r=e.boxRenderer)&&void 0!==r&&r.setCropArea(a.x,a.y,l.value,u.value),null!==(n=e.boxRenderer)&&void 0!==n&&n.setCropConfig({zoom:(null==i?void 0:i.zoom)||1}),null===(o=e.boxRenderer)||void 0===o||o.render();}}}},o=function o(){e.viewer.clearCropBox();};e.rendererService.hooks.beforeRender.on(r),e.rendererService.hooks.afterRender.on(n),i.afterBufferChanged.on(o),e.dvsContext.hooksService.hooks.afterLoadImage.on(t),e.hooksService.hooks.destroy.on(function(){e.rendererService.hooks.beforeRender.off(r),e.rendererService.hooks.afterRender.off(n),i.afterBufferChanged.off(o),e.dvsContext.hooksService.hooks.afterLoadImage.off(t);});}}]),e;}(),mR={name:"dvsBoxRenderer",install:function install(e){var t=e.getClassStore(),i=t.Viewer;if(i){var r=function(e){var t;return t=function(e){lb(i,e);var t=ub(i);function i(e){var r;return ak(this,i),tk(rc(r=t.call(this,e)),"boxRenderer",void 0),r.context.config.pure||new gR().init(r.context),r.context.configService.registerHandler("cropBoxConfig",function(e,t){tz(t)&&(r.context.boxRenderer.updateCropSetting(t),r.context.renderOnly());}),r.context.config.cropBoxConfig||(r.context.config.cropBoxConfig=r.cropBoxConfig),r;}return ok(i,[{key:"cropBoxConfig",get:function get(){return this.context.boxRenderer.cropMng.cropSetting;},set:function set(e){tz(e)&&(this.context.boxRenderer.updateCropSetting(e),this.context.renderOnly());}},{key:"setFreeCropBox",value:function value(e){var t=this.getCurrentTab();if(t){var i=t.currentPage;if(i){var r=this.context.getStatus(i.uid);r&&this.context.boxRenderer.setCropArea(0,0,r.realTimeWidth||0,r.realTimeHeight||0);}}var n=this.context.boxRenderer.setFreeBox(cD(e).call(e));return n&&this.context.renderOnly(),n;}},{key:"setCropBox",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.getCurrentTab(),r=!1;if(i){var n=i.currentPage;if(n){var o=this.context.getStatus(n.uid);if(o&&(this.context.boxRenderer.setCropArea(0,0,n.realTimeWidth||0,n.realTimeHeight||0),"multiple"===this.context.config.displayMode&&this.context.config.useMinImage)){var a=o.imageScale;ez(e)||(e=[e]);var s=[];dk(e).call(e,function(e){var t={left:e.left/a,top:e.top/a,width:e.width/a,height:e.height/a};s.push(t);}),e=s,r=!0;}}}var l=this.context.boxRenderer.setNormalBoxes(e,t,r);return l&&this.context.renderOnly(),l;}},{key:"clearCropBox",value:function value(){var e=this.context.boxRenderer.clearBox();return e&&this.context.boxRenderer.getBoxCount()>0&&this.context.renderOnly(),e;}},{key:"getCropBoxes",value:function value(){var e=this.context.boxRenderer.getCropBoxes(),t=this.getCurrentTab();if(t){var i=t.currentPage;if(i){var r=this.context.getStatus(i.uid);if(r&&"multiple"===this.context.config.displayMode&&this.context.config.useMinImage){var n=r.imageScale;e=jI(e).call(e,function(e){return{left:e.left*n,top:e.top*n,width:e.width*n,height:e.height*n};});}}}return e;}}]),i;}(e),tk(t,"use",e.use),t;}(i);t.Viewer=r;}}};function yR(e,t){if(Ek(t))return{unit:"px",value:0};if(gz(t))return{unit:"px",value:0};if(cz(t))return{unit:"px",value:t};if(t=$k(t).call(t).toLowerCase(),mD(Number(t))&&"px".search(e)>=0)return{unit:"px",value:Number(t)};var i=[];t=t.replace(e,function(e){return i.push(e),"U".concat(e);});var r="U(".concat(e.source,")");return jI(i).call(i,function(e){return{unit:e,value:Number(t.replace(new RegExp("U".concat(e),"g"),"").replace(new RegExp(r,"g"),"*0"))};})[0];}var pR=function pR(e){return yR(/px/g,e);},wR=function wR(e){return yR(/px|%|em/g,e);},bR=function bR(e){return yR(/deg|rad|grad|turn/g,e);},kR=function(){function e(t,i,r){var n,o,a,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,l=arguments.length>4&&void 0!==arguments[4]&&arguments[4];ak(this,e),tk(this,"r",void 0),tk(this,"g",void 0),tk(this,"b",void 0),tk(this,"alpha",void 0),tk(this,"isNone",void 0),tk(this,"formatted",""),this.r=t,this.g=i,this.b=r,this.alpha=s,this.isNone=l,this.formatted=Ck(n=Ck(o=Ck(a="rgba(".concat(t,", ")).call(a,i,", ")).call(o,r,", ")).call(n,s,")");}return ok(e,[{key:"clone",value:function value(){return new e(this.r,this.g,this.b,this.alpha);}}]),e;}(),xR=function(){function e(t,i){ak(this,e),tk(this,"type",void 0),tk(this,"value",void 0),this.type=t,this.value=i;}return ok(e,[{key:"clone",value:function value(){return new e(this.type,this.value);}}]),e;}(),SR={left:180,top:-90,bottom:90,right:0,"left top":225,"top left":225,"left bottom":135,"bottom left":135,"right top":-45,"top right":-45,"right bottom":45,"bottom right":45},CR=function CR(e){return{value:"angular"===e.type?Number(e.value):SR[e.value]||0,unit:"deg"};},VR=function VR(e){var t;if(DT(e).call(e,"linear")>-1||DT(e).call(e,"radial")>-1)return jI(t=uz(e)).call(t,function(e){var t=e.type,i=e.orientation,r=e.colorStops;!function(e){var t,i,r=e.length;e[r-1].length=null!==(t=e[r-1].length)&&void 0!==t?t:{type:"%",value:"100"},r>1&&(e[0].length=null!==(i=e[0].length)&&void 0!==i?i:{type:"%",value:"0"});for(var n=0,o=Number(e[0].length.value),a=1;a<r;a++){var s,l=null===(s=e[a].length)||void 0===s?void 0:s.value;if(!gz(l)&&!gz(o)){for(var u=1;u<a-n;u++)e[n+u].length={type:"%",value:"".concat(o+(Number(l)-o)*u/(a-n))};n=a,o=Number(l);}}}(r);var n=jI(r).call(r,function(e){return{offset:{value:e.length.value,unit:"%"},color:lz(e)};});if("linear-gradient"===t)return new xR(1,{angle:i?CR(i):{value:0,unit:"deg"},steps:n});if("radial-gradient"===t&&(i||(i=[{type:"shape",value:"circle"}]),"shape"===i[0].type&&"circle"===i[0].value)){var o,a=function(e){var t=50,i=50,r="%",n="%";if("position"===(null==e?void 0:e.type)){var o=e.value,a=o.x,s=o.y;"position-keyword"===(null==a?void 0:a.type)&&("left"===a.value?t=0:"center"===a.value?t=50:"right"===a.value?t=100:"top"===a.value?i=0:"bottom"===a.value&&(i=100)),"position-keyword"===(null==s?void 0:s.type)&&("left"===s.value?t=0:"center"===s.value?i=50:"right"===s.value?t=100:"top"===s.value?i=0:"bottom"===s.value&&(i=100)),"px"!==(null==a?void 0:a.type)&&"%"!==(null==a?void 0:a.type)&&"em"!==(null==a?void 0:a.type)||(r=null==a?void 0:a.type,t=Number(a.value)),"px"!==(null==s?void 0:s.type)&&"%"!==(null==s?void 0:s.type)&&"em"!==(null==s?void 0:s.type)||(n=null==s?void 0:s.type,i=Number(s.value));}return{cx:{value:t,unit:r},cy:{value:i,unit:n}};}(i[0].at),s=a.cx,l=a.cy;if(i[0].style){var u=i[0].style,c=u.type,h=u.value;o="extent-keyword"===c?h:{value:h,unit:c};}return new xR(2,{cx:s,cy:l,size:o,steps:n});}});};function TR(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(gz(e))return null;if("currentColor"===e&&(e="black"),"transparent"===e)return new kR(0,0,0,0);var t=VR(e);if(t)return t;var i=Oz(e),r=[0,0,0,0];return null!==i&&(r[0]=fx(i.r,10)||0,r[1]=fx(i.g,10)||0,r[2]=fx(i.b,10)||0,r[3]=BD(i.opacity)),Df(kR,r);}function IR(e){var t=null;ez(e)&&(t=e),az(e)&&(t=e.split(" "));for(var i=0;i<3;i++)t[i]?t[i]=pR(t[i]).value:t[i]=0;var r=TR(t[3]);return t[3]=r?r.formatted:"black",ET(t).call(t,0,4);}function ER(e){var t,i=[];return az(e)?dk(t=e.split(" ")).call(t,function(e){var t=pR(e);t&&i.push(t.value);}):i.push.apply(i,hb(e)),1===i.length?[i[0],i[0]]:i;}var PR=function PR(e){var t=e;if(az(e)){var i=wR(e);"%"===i.unit&&(t=i.value/100),"px"===i.unit&&(t=i.value);}return t>1&&(t=1),t;};function BR(e,t,i){var r=i.parsedStyle,n=r.x,o=void 0===n?0:n,a=r.y,s=void 0===a?0:a;r.z,e!==t&&i.setLocalPosition(o,s);}var DR=function(){function e(t){ak(this,e),tk(this,"bubbles",!0),tk(this,"cancelBubble",!0),tk(this,"cancelable",!1),tk(this,"composed",!1),tk(this,"currentTarget",void 0),tk(this,"defaultPrevented",!1),tk(this,"eventPhase",e.prototype.NONE),tk(this,"isTrusted",void 0),tk(this,"returnValue",void 0),tk(this,"srcElement",void 0),tk(this,"target",void 0),tk(this,"timeStamp",void 0),tk(this,"type",void 0),tk(this,"detail",void 0),tk(this,"view",void 0),tk(this,"which",void 0),tk(this,"path",void 0),tk(this,"immediatePropagationStopped",!1),tk(this,"propagationStopped",!1),tk(this,"nativeEvent",void 0),tk(this,"originalEvent",void 0),tk(this,"eventService",void 0),tk(this,"AT_TARGET",1),tk(this,"BUBBLING_PHASE",2),tk(this,"CAPTURING_PHASE",3),tk(this,"NONE",0),this.eventService=t;}return ok(e,[{key:"initUIEvent",value:function value(e,t,i,r,n){}},{key:"composedPath",value:function value(){var e=this.path,t=this.eventService,i=this.target;return!t||e&&e[this.path.length-1]===i||(this.path=i?t.getPropagationPath(i):[]),this.path;}},{key:"initEvent",value:function value(e,t,i){}},{key:"preventDefault",value:function value(){var e=this.nativeEvent;e instanceof Event&&e.cancelable&&e.preventDefault(),this.defaultPrevented=!0;}},{key:"stopImmediatePropagation",value:function value(){this.immediatePropagationStopped=!0;}},{key:"stopPropagation",value:function value(){this.propagationStopped=!0;}}]),e;}(),MR=function(e){lb(i,e);var t=ub(i);function i(e,r){var n;return ak(this,i),(n=t.call(this,null)).type=e,n.detail=r,n;}return ok(i);}(DR),AR=function(){function e(){ak(this,e),tk(this,"pubsub",$z.create());}return ok(e,[{key:"addEventListener",value:function value(e,t,i){var r,n=hz(i)&&i;tz(i)&&(n=i.capture,r=i.once),e=n?"".concat(e,":capture"):e,t=dz(t)?t:t.handleEvent,this.pubsub.on(e,t,this,r);}},{key:"dispatchEvent",value:function value(e){var t,i=this.ownerDocument||this.document;return i&&(e.eventService=(null===(t=i.defaultView)||void 0===t?void 0:t.eventService)||null,e.defaultPrevented=!1,e.path=[],e.target=this,function(e,t){var i;if(t=null!==(i=t)&&void 0!==i?i:e.type,e.propagationStopped=!1,e.immediatePropagationStopped=!1,e.target){var r=e.composedPath(),n=r.length;e.eventPhase=e.CAPTURING_PHASE;for(var o=0;o<n-1;o++)if(e.currentTarget=r[o],zR(e,"".concat(t,":capture")),UR(e))return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,zR(e,t),!UR(e)){e.eventPhase=e.BUBBLING_PHASE;for(var a=n-2;a>=0;a--)if(e.currentTarget=r[a],zR(e,t),UR(e))return;}}}(e)),!e.defaultPrevented;}},{key:"removeEventListener",value:function value(e,t,i){var r=hz(i)&&i;tz(i)&&(r=i.capture),e=r?"".concat(e,":capture"):e,t=dz(t)?t:t.handleEvent,this.pubsub.off(e,t,context);}},{key:"removeAllEventListeners",value:function value(){this.pubsub.removeAllEventListeners();}},{key:"getAllEvents",value:function value(){return this.pubsub.getAllEvents();}}]),e;}();function zR(e,t){for(var i=e.currentTarget.getAllEvents()[t]||[],r=0,n=i.length;r<n;r++){if(e.immediatePropagationStopped)return;var o=i[r],a=o.context;o.fn.call(a,e);}}function UR(e){return e.propagationStopped||e.immediatePropagationStopped;}var RR=function(e){lb(i,e);var t=ub(i);function i(e,r,n,o,a,s,l,u){var c;return ak(this,i),tk(rc(c=t.call(this,null)),"relatedNode",void 0),tk(rc(c),"prevValue",void 0),tk(rc(c),"newValue",void 0),tk(rc(c),"attrName",void 0),tk(rc(c),"attrChange",void 0),tk(rc(c),"prevParsedValue",void 0),tk(rc(c),"newParsedValue",void 0),c.type=e,c.relatedNode=r,c.prevValue=n,c.newValue=o,c.attrName=a,c.attrChange=s,c.prevParsedValue=l,c.newParsedValue=u,c;}return ok(i);}(DR);tk(RR,"ADDITION",2),tk(RR,"MODIFICATION",1),tk(RR,"REMOVAL",3);var LR=new(function(){function e(){ak(this,e);}return ok(e,[{key:"querySelector",value:function value(e,t){return GD(e).call(e,"#")?gE(t).call(t,function(t){return t.id===e.substring(1);}):null;}},{key:"querySelectorAll",value:function value(e,t){return[];}}]),e;}())(),NR=new(function(){function e(t){ak(this,e),tk(this,"selector",void 0),this.selector=t;}return ok(e,[{key:"recursiveUpdateHierarchy",value:function value(e){var t=this,i=e.transform,r=e.childNodes;i.frozen||(i.frozen=!0,(i.localDirty||i.worldDirty)&&this.updateHierarchy(e),dk(r).call(r,function(e){t.recursiveUpdateHierarchy(e);}));}},{key:"querySelector",value:function value(e,t){return this.selector.querySelector(e,t);}},{key:"querySelectorAll",value:function value(e,t){return this.selector.querySelectorAll(e,t);}},{key:"append",value:function value(e,t,i){e.parentNode&&this.remove(e),e.parentNode=t;var r=t.childNodes,n=t.sortable;void 0!==i?sI(r).call(r,i,0,e):r.push(e),n&&(n.dirty=!0);var o=e.transform;o&&this.dirtyWorld(e,o),o.frozen&&this.unfreezeParentToRoot(e);}},{key:"remove",value:function value(e){var t=e.parentNode,i=!0;if(!t)return i=!1;var r=t.sortable;r&&(r.dirty=!0);var n=t.childNodes,o=DT(n).call(n,e);o>-1?(i=!0,sI(n).call(n,o,1)):i=!1;var a=e.transform;return a&&this.dirtyWorld(e,a),e.parentNode=null,i;}},{key:"isChildExist",value:function value(e){var t=e.parentNode;if(!t)return!1;var i=t.childNodes;return!(DT(i).call(i,e)<0);}},{key:"setOrigin",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;cz(t)&&(t=tU.fromValue(t,i));var r=e.transform;r.origin.equals(t)||(r.origin.setFromVector(t),this.dirtyLocal(e,r));}},{key:"getOrigin",value:function value(e){return e.transform.origin;}},{key:"setPosition",value:function value(e,t){var i=e.transform;t=tU.fromValue(t.x,t.y,t.z||0);var r=this.getPosition(e);if(!t.equals(r)){var n=this.getWorldTransform(e),o=this.getPosition(e),a=t.x-o.x,s=t.y-o.y,l=t.z-o.z;if(i.position=t,e.hasParentTransform()){n=new fU().translateSelf(a,s,l).multiply(n);var u=e.parentNode.transform.worldTransform,c=this.getWorldTransform(e);c.m41=t.x,c.m42=t.y,c.m43=t.z;var h=u.inverse().multiply(n),d=this.getOrigin(e),f=h.getScaling(),v=this.createScaleMatrix(f.x,f.y,f.z),g=fU.fromMatrix(v).inverse(),m=h.translate(d.x,d.y,d.z).multiply(g),y=m.getRotation(),p=fU.fromQuat(y).inverse(),w=m.multiply(p).getTranslation();w.x-=d.x,w.y-=d.y,w.z-=d.z,i.localPosition.setFromVector(w);}else i.localPosition=t;this.dirtyLocal(e,i);}}},{key:"setLocalPosition",value:function value(e,t){var i=e.transform;(t=tU.fromValue(t.x,t.y,t.z||0)).equals(i.localPosition)||(i.localPosition=t,this.dirtyLocal(e,i));}},{key:"getPosition",value:function value(e){var t=this.getWorldTransform(e),i=e.transform,r=t.getTranslation();return i.position.setFromVector(r),e.transform.position;}},{key:"getLocalPosition",value:function value(e){return e.transform.localPosition;}},{key:"translate",value:function value(e,t){if(!t.equals(new tU())){var i=this.getPosition(e),r=this.getWorldTransform(e),n=r.getScaling(),o=this.createScaleMatrix(n.x,n.y,n.z),a=r.multiply(fU.fromMatrix(o).inverse()).getRotation(),s=fU.fromQuat(a).transformPoint(t);i.add(s),this.setPosition(e,i);}}},{key:"translateLocal",value:function value(e,t){var i=e.transform;if(!t.equals(new tU())){t.multiply(i.localScale);var r=fU.fromQuat(i.localRotation).transformPoint(t);i.localPosition.add(r),this.dirtyLocal(e,i);}}},{key:"scaleLocal",value:function value(e,t){var i=e.transform;i.localScale.multiply(t),this.dirtyLocal(e,i);}},{key:"setLocalScale",value:function value(e,t){var i=e.transform,r=tU.fromValue(t.x,t.y,t.z||i.localScale.z);r.equals(i.localScale)||(i.localScale=r,this.dirtyLocal(e,i));}},{key:"getScale",value:function value(e){var t=e.transform,i=this.getWorldTransform(e).getScaling();return t.scale.setFromVector(i),t.scale;}},{key:"getLocalScale",value:function value(e){return e.transform.localScale;}},{key:"getRotation",value:function value(e){var t=e.transform,i=this.getWorldTransform(e),r=i.getScaling(),n=this.createScaleMatrix(r.x,r.y,r.z),o=i.multiply(fU.fromMatrix(n).inverse()).getRotation();return t.rotation.setFromQuat(o),t.rotation;}},{key:"getLocalRotation",value:function value(e){return e.transform.localRotation;}},{key:"rotate",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=e.transform;if(cz(t)&&(t=iU(t,i,r)),e.hasParentTransform()){var o=uU(t.x,t.y,t.z),a=this.getRotation(e),s=this.getRotation(e.parentNode).clone().invert().multiply(o).multiply(a).normalize();n.localRotation.setFromQuat(s),this.dirtyLocal(e,n);}else this.rotateLocal(e,t);}},{key:"rotateLocal",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;cz(t)&&(t=iU(t,i,r));var n=e.transform,o=uU(t.x,t.y,t.z);n.localRotation.multiply(o),this.dirtyLocal(e,n);}},{key:"setAngle",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;cz(t)&&(t=iU(t,i,r));var n=e.transform;if(e.hasParentTransform()){var o=uU(t.x,t.y,t.z);n.localRotation.setFromQuat(o);var a=this.getRotation(e.parentNode);a.invert(),n.localRotation.setFromQuat(a.multiply(n.localRotation)),this.dirtyLocal(e,n);}else this.setLocalAngle(e,t);}},{key:"setLocalAngle",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;cz(t)&&(t=iU(t,i,r));var n=e.transform,o=uU(t.x,t.y,t.z);n.localRotation.setFromQuat(o),this.dirtyLocal(e,n);}},{key:"setRotation",value:function value(e,t){var i=e.transform;if(e.hasParentTransform()){var r=this.getRotation(e.parentNode);r=r.clone().invert().multiply(t).normalize(),i.localRotation.setFromQuat(r),this.dirtyLocal(e,i);}else this.setLocalRotation(e,t);}},{key:"setLocalRotation",value:function value(e,t){var i=e.transform;i.localRotation.setFromQuat(t),this.dirtyLocal(e,i);}},{key:"getAngle",value:function value(e){var t=this.getWorldTransform(e);return sU.fromQuat(t.decompose().quaternion).toEuler();}},{key:"getLocalAngle",value:function value(e){return this.getLocalTransform(e),this.getLocalRotation(e).toEuler();}},{key:"setLocalTransform",value:function value(e,t){var i=this.getOrigin(e),r=t.decompose();r.quaternion;var n=r.rotation,o=r.scale,a=this.createScaleMatrix(o.x,o.y,o.z),s=fU.fromMatrix(a).inverse(),l=t.translate(i.x,i.y,i.z).multiply(s).getTranslation();l.x-=i.x,l.y-=i.y,l.z-=i.z,this.setLocalPosition(e,l),this.setLocalAngle(e,n.x,n.y,n.z),this.setLocalScale(e,o);}},{key:"createScaleMatrix",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return{m11:e,m21:0,m31:0,m41:0,m12:0,m22:t,m32:0,m42:0,m13:0,m23:0,m33:i,m43:0,m14:0,m24:0,m34:0,m44:1};}},{key:"resetLocalTransform",value:function value(e){this.setLocalScale(e,new tU(1,1,1)),this.setLocalPosition(e,new tU(0,0,0)),this.setLocalAngle(e,0);}},{key:"getWorldTransform",value:function value(e){var t=e.transform;if(!t.worldDirty&&!t.localDirty)return t.worldTransform;var i=e.parentNode;return i&&i.transform&&this.getWorldTransform(i),this.updateHierarchy(e),t.worldTransform;}},{key:"getLocalTransform",value:function value(e){var t=e.transform;return t.localDirty&&t.updateLocalTransform(),t.localTransform;}},{key:"getBounds",value:function value(e,t){var i=this,r=e.renderable,n=e.childNodes;if(t&&!r.renderBoundsDirty&&r)return r.renderBounds;if(!t&&!r.boundsDirty&&r.bounds)return r.bounds;var o=this.getTransformedGeometryBounds(e,t);dk(n).call(n,function(e){var r=i.getBounds(e,t);r&&(o?o.addBounds(r):o=CL.fromBounds(r));});var a=e.style.clipPath;if(a){var s=this.getTransformedGeometryBounds(a,!0),l=null;s&&(l=CL.create()).setFromTransformedBounds(this.getWorldTransform(e),s),o?l&&(o=l.intersection(o)):o=l;}return t?(r.renderBoundsDirty=!1,o&&(r.renderBounds=o)):(r.boundsDirty=!1,o&&(r.bounds=o)),o||CL.create();}},{key:"getLocalBounds",value:function value(e){var t=e.parentNode;if(t){var i=new fU();t.transform&&(i=this.getWorldTransform(t).inverse());var r=this.getBounds(e);if(!CL.isEmpty(r)){var n=CL.create();return n.setFromTransformedBounds(i,r),n;}}return this.getBounds(e);}},{key:"getGeometryBounds",value:function value(e,t){var i=e.geometry;return(t?i.renderBounds:i.contentBounds)||CL.create();}},{key:"getBoundingClientRect",value:function value(e){var t,i,r=this.getGeometryBounds(e);CL.isEmpty(r)||(i=CL.create()).setFromTransformedBounds(this.getWorldTransform(e),r);var n=null===(t=e.ownerDocument)||void 0===t?void 0:t.defaultView.getContextService().getBoundingClientRect();return i?{x:i.minX+((null==n?void 0:n.left)||0),y:i.minY+((null==n?void 0:n.top)||0),width:i.maxX-i.minX,height:i.maxY-i.minY}:{x:(null==n?void 0:n.left)||0,y:(null==n?void 0:n.top)||0,width:0,height:0};}},{key:"updateHierarchy",value:function value(e){var t=e.transform;if(t.localDirty&&t.updateLocalTransform(),t.worldDirty){var i,r=null==e||null===(i=e.parentNode)||void 0===i?void 0:i.transform;e.parentNode&&r||(r=new jR()),t.updateWorldTransform(r);}}},{key:"getTransformedGeometryBounds",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.getGeometryBounds(e,t);if(!CL.isEmpty(i)){var r=CL.create();return this.getWorldTransform(e),r.setFromTransformedBounds(this.getWorldTransform(e),i),r;}return null;}},{key:"dirtyLocal",value:function value(e,t){t.localDirty||(t.localDirty=!0,t.worldDirty||this.dirtyWorld(e,t));}},{key:"dirtyWorld",value:function value(e,t){t.worldDirty||this.unfreezeParentToRoot(e),this.recursiveDirtyWorld(e,t),function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e;i;){var r=i,n=r.renderable;n&&(n.boundsDirty=!0,n.renderBoundsDirty=!0),i=i.parentNode;}e.dispatchEvent(new MR("bounds-changed",{affectChildren:t}));}(e,!0);}},{key:"recursiveDirtyWorld",value:function value(e,t){var i,r=this;if(!t.worldDirty){t.worldDirty=!0,t.frozen=!1,dk(i=e.childNodes).call(i,function(e){var t=e.transform;t.worldDirty||r.recursiveDirtyWorld(e,t);});var n=e.renderable;n&&(n.boundsDirty=!0,n.renderBoundsDirty=!0);var o=new RR("DOMAttrModified",e,null,null,"modelMatrix",RR.MODIFICATION,null,null);e.dispatchEvent(o);}}},{key:"unfreezeParentToRoot",value:function value(e){for(var t=e;t;){var i=t.transform;i&&(i.frozen=!1),t=t.parentNode;}}}]),e;}())(LR),OR=function(e){lb(i,e);var t=ub(i);function i(){var e,r;ak(this,i);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return tk(rc(r=t.call.apply(t,Ck(e=[this]).call(e,o))),"baseURI",""),tk(rc(r),"childNodes",[]),tk(rc(r),"nodeName",""),tk(rc(r),"nodeType",0),tk(rc(r),"nodeValue",null),tk(rc(r),"ownerDocument",null),tk(rc(r),"parentNode",null),tk(rc(r),"isConnected",!1),tk(rc(r),"textContent",void 0),r;}return ok(i,[{key:"firstChild",get:function get(){return this.childNodes.length>0?this.childNodes[0]:null;}},{key:"lastChild",get:function get(){var e=this.childNodes;return e.length>0?e[e.length-1]:null;}},{key:"nextSibling",get:function get(){var e=this.parentNode;if(e){var t,i=DT(t=e.childNodes).call(t,this);return e.childNodes[i+1];}return null;}},{key:"parentElement",get:function get(){return this.parentNode;}},{key:"previousSibling",get:function get(){var e=this.parentNode;if(e){var t,i=DT(t=e.childNodes).call(t,this);return e.childNodes[i-1];}return null;}},{key:"contains",value:function value(e){for(var t=e;t&&this!==t;)t=t.parentNode;return!!t;}},{key:"getRootNode",value:function value(e){return this.parentNode?this.parentNode.getRootNode(e):this;}},{key:"hasChildNodes",value:function value(){return this.childNodes.length>0;}},{key:"isEqualNode",value:function value(e){return this===e;}},{key:"isSameNode",value:function value(e){return this.isEqualNode(e);}},{key:"compareDocumentPosition",value:function value(e){throw new Error("Method to be implemented");}},{key:"isDefaultNamespace",value:function value(e){throw new Error("Method to be implemented");}},{key:"lookupNamespaceURI",value:function value(e){throw new Error("Method to be implemented");}},{key:"lookupPrefix",value:function value(e){throw new Error("Method to be implemented");}},{key:"normalize",value:function value(){throw new Error("Method to be implemented");}},{key:"recursiveCall",value:function value(e){var t;e(this)||dk(t=this.childNodes).call(t,function(t){t.recursiveCall(e);});}},{key:"hasParentTransform",value:function value(){return!(!this.parentNode||!this.parentNode.transform);}}],[{key:"isNode",value:function value(e){return!!e.childNodes;}}]),i;}(AR);tk(OR,"ELEMENT_NODE",1),tk(OR,"ATTRIBUTE_NODE",2),tk(OR,"TEXT_NODE",3),tk(OR,"CDATA_SECTION_NODE",4),tk(OR,"ENTITY_REFERENCE_NODE",5),tk(OR,"ENTITY_NODE",6),tk(OR,"PROCESSING_INSTRUCTION_NODE",7),tk(OR,"COMMENT_NODE",8),tk(OR,"DOCUMENT_NODE",9),tk(OR,"DOCUMENT_TYPE_NODE",10),tk(OR,"DOCUMENT_FRAGMENT_NODE",11),tk(OR,"NOTATION_NODE",12),tk(OR,"DOCUMENT_POSITION_DISCONNECTED",1),tk(OR,"DOCUMENT_POSITION_PRECEDING",2),tk(OR,"DOCUMENT_POSITION_FOLLOWING",4),tk(OR,"DOCUMENT_POSITION_CONTAINS",8),tk(OR,"DOCUMENT_POSITION_CONTAINED_BY",16),tk(OR,"DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC",32);var WR=ok(function e(){ak(this,e),tk(this,"contentBounds",void 0),tk(this,"renderBounds",void 0);}),HR=function(){function e(){ak(this,e),tk(this,"boundsDirty",!0),tk(this,"bounds",void 0),tk(this,"renderBoundsDirty",!0),tk(this,"renderBounds",void 0);}return ok(e,[{key:"isRenderable",value:function value(){return this.boundsDirty||this.renderBoundsDirty;}},{key:"toRenderable",value:function value(){this.boundsDirty=!0,this.renderBoundsDirty=!0;}}]),e;}(),FR=ok(function e(){ak(this,e),tk(this,"renderOrder",0),tk(this,"lastSortedIndex",void 0),tk(this,"sorted",void 0),tk(this,"dirty",!1);}),jR=function(){function e(){ak(this,e),tk(this,"frozen",!0),tk(this,"worldDirty",!1),tk(this,"localDirty",!1),tk(this,"localRotation",lU(0,0,0,1)),tk(this,"rotation",lU(0,0,0,1)),tk(this,"localScale",iU(1,1,1)),tk(this,"scale",iU(1,1,1)),tk(this,"localPosition",iU(0,0,0)),tk(this,"position",iU(0,0,0)),tk(this,"localSkew",iU(0,0,0)),tk(this,"skew",iU(0,0,0)),tk(this,"origin",iU(0,0,0)),tk(this,"worldTransform",new fU()),tk(this,"localTransform",new fU());}return ok(e,[{key:"updateLocalTransform",value:function value(){var e=this.origin,t=this.localScale,i=this.localPosition,r=this.localRotation,n=this.localSkew,o=new fU();o.translateSelf(e.x,e.y,e.z);var a=hU(0,0,0,1),s=this.compose(a,i,r,n,t);o.multiplySelf(s),o.translateSelf(-e.x,-e.y,-e.z),this.localTransform.setFromMatrix(o),this.localDirty=!1;}},{key:"updateWorldTransform",value:function value(e){var t=e.worldTransform.clone();t.multiplySelf(this.localTransform),this.worldTransform.setFromMatrix(t),this.worldDirty=!1;}},{key:"compose",value:function value(e,t,i,r,n){var o=new fU();o.m14=e.x,o.m24=e.y,o.m34=e.z,o.m44=e.w,o.translateSelf(t.x,t.y,t.z);var a=fU.fromQuat(i);o.multiplySelf(a);var s=new fU();return r.z&&(s.m32=r.z,o.multiplySelf(s)),r.y&&(s.m32=0,s.m31=r.y,o.multiplySelf(s)),r.x&&(s.m31=0,s.m21=r.x,o.multiplySelf(s)),o.scaleSelf(n.x,n.y,n.z),o;}}]),e;}(),YR=function(e){lb(i,e);var t=ub(i);function i(){var e,r;ak(this,i);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return tk(rc(r=t.call.apply(t,Ck(e=[this]).call(e,o))),"attributes",{}),tk(rc(r),"id",void 0),tk(rc(r),"pageUid",void 0),tk(rc(r),"index",void 0),tk(rc(r),"name",void 0),tk(rc(r),"scrollLeft",void 0),tk(rc(r),"scrollTop",void 0),tk(rc(r),"scrollWidth",void 0),tk(rc(r),"scrollHeight",void 0),tk(rc(r),"renderable",new HR()),tk(rc(r),"sortable",new FR()),tk(rc(r),"geometry",new WR()),tk(rc(r),"transform",new jR()),tk(rc(r),"parsedStyle",{}),tk(rc(r),"style",void 0),tk(rc(r),"isDestroyed",!1),r;}return ok(i,[{key:"className",get:function get(){return this.getAttribute("class")||"";},set:function set(e){this.setAttribute("class",e);}},{key:"classList",get:function get(){var e;return zx(e=this.className.split(" ")).call(e,function(e){return""!==e;});}},{key:"tagName",get:function get(){return this.nodeName;}},{key:"children",get:function get(){return this.childNodes;}},{key:"childElementCount",get:function get(){return this.childNodes.length;}},{key:"firstElementChild",get:function get(){return this.firstChild;}},{key:"lastElementChild",get:function get(){return this.lastChild;}},{key:"getAttribute",value:function value(e){var t=this.attributes[e];return null==t?null:t;}},{key:"getElementsByName",value:function value(e){return NR.querySelectorAll('[name="'.concat(e,'"]'),this);}},{key:"getElementsByClassName",value:function value(e){return NR.querySelectorAll(".".concat(e),this);}},{key:"getElementsByTagName",value:function value(e){return NR.querySelectorAll(e,this);}},{key:"hasAttribute",value:function value(e){var t;return DT(t=gk(this.attributes)).call(t,e)>-1;}},{key:"removeAttribute",value:function value(e){this.setAttribute(e,null),delete this.attributes[e];}},{key:"setAttribute",value:function value(e,t){this.attributes[e]=t;}},{key:"appendChild",value:function value(e,t){NR.append(e,this,t);var i=new MR("child-inserted",{child:e});this.dispatchEvent(i);var r=new RR("DOMNodeInserted",this,"","","",0,"","");return e.dispatchEvent(r),e;}},{key:"cloneNode",value:function value(e){return null;}},{key:"insertBefore",value:function value(e,t){if(t){var i,r=DT(i=this.childNodes).call(i,t);this.appendChild(e,r-1);}else this.appendChild(e);return e;}},{key:"removeChild",value:function value(e){var t=new RR("removed",this,"","","",0,"","");e.dispatchEvent(t);var i=new MR("child-removed",{child:e});return this.dispatchEvent(i),NR.remove(e),e;}},{key:"isChildExist",value:function value(e){return NR.isChildExist(e);}},{key:"replaceChild",value:function value(e,t){var i,r=DT(i=this.childNodes).call(i,t);return this.removeChild(t),this.appendChild(e,r),t;}},{key:"destroy",value:function value(){var e=new MR("destroy",{});this.dispatchEvent(e),this.remove(),this.removeAllEventListeners(),this.isDestroyed=!0;}},{key:"after",value:function value(){var e=this.parentNode;if(e){for(var t,i=DT(t=e.childNodes).call(t,this),r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];dk(n).call(n,function(t,r){null==e||e.appendChild(t,i+r+1);});}}},{key:"before",value:function value(){var e=this.parentNode;if(e){for(var t,i=DT(t=e.childNodes).call(t,this),r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];dk(n).call(n,function(t,r){null==e||e.appendChild(t,i+r);});}}},{key:"remove",value:function value(){this.parentNode&&this.parentNode.removeChild(this);}},{key:"replaceWith",value:function value(){this.after.apply(this,arguments),this.remove();}},{key:"append",value:function value(){for(var e=this,t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];dk(i).call(i,function(t){e.appendChild(t);});}},{key:"prepend",value:function value(){for(var e=this,t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];dk(i).call(i,function(t,i){e.appendChild(t,i);});}},{key:"querySelector",value:function value(e){return NR.querySelector(e,this);}},{key:"querySelectorAll",value:function value(e){return NR.querySelectorAll(e,this);}},{key:"find",value:function value(e){var t=this,i=null;return this.recursiveCall(function(r){return!(r!==t||!e(r)||(i=r,0));}),i;}},{key:"findAll",value:function value(e){var t=this,i=[];return this.recursiveCall(function(r){r===t&&e(r)&&i.push(r);}),i;}},{key:"getGeometryBounds",value:function value(){return NR.getGeometryBounds(this);}},{key:"getRenderBounds",value:function value(){return NR.getBounds(this,!0);}},{key:"getBounds",value:function value(){return NR.getBounds(this);}},{key:"getLocalBounds",value:function value(){return NR.getLocalBounds(this);}},{key:"getBoundingClientRect",value:function value(){return NR.getBoundingClientRect(this);}}]),i;}(OR),XR=function(){function e(t){ak(this,e),tk(this,"lineAlign",void 0),tk(this,"owner",void 0),this.owner=t,this.reset();}return ok(e,[{key:"reset",value:function value(){this.lineAlign=.5;}},{key:"x",get:function get(){return this.owner.getAttribute("x");},set:function set(e){this.owner.setAttribute("x",e);}},{key:"y",get:function get(){return this.owner.getAttribute("y");},set:function set(e){this.owner.setAttribute("y",e);}},{key:"r",get:function get(){return this.owner.getAttribute("r");},set:function set(e){this.owner.setAttribute("r",e);}},{key:"width",get:function get(){return this.owner.getAttribute("width");},set:function set(e){this.owner.setAttribute("width",e);}},{key:"height",get:function get(){return this.owner.getAttribute("height");},set:function set(e){this.owner.setAttribute("height",e);}},{key:"points",get:function get(){return this.owner.getAttribute("points");},set:function set(e){this.owner.setAttribute("points",e);}},{key:"selectable",get:function get(){return this.owner.getAttribute("selectable");},set:function set(e){this.owner.setAttribute("selectable",e);}},{key:"origin",get:function get(){return this.owner.getAttribute("origin");},set:function set(e){this.owner.setAttribute("origin",e);}},{key:"anchor",get:function get(){return this.owner.getAttribute("anchor");},set:function set(e){this.owner.setAttribute("anchor",e);}},{key:"visibility",get:function get(){return this.owner.getAttribute("visibility");},set:function set(e){this.owner.setAttribute("visibility",e);}},{key:"zIndex",get:function get(){return this.owner.getAttribute("zIndex");},set:function set(e){this.owner.setAttribute("zIndex",e);}},{key:"transformOrigin",get:function get(){return this.owner.getAttribute("transformOrigin");},set:function set(e){this.owner.setAttribute("transformOrigin",e);}},{key:"borderWidth",get:function get(){return this.owner.getAttribute("borderWidth");},set:function set(e){this.owner.setAttribute("borderWidth",e);}},{key:"borderColor",get:function get(){return this.owner.getAttribute("borderColor");},set:function set(e){this.owner.setAttribute("borderColor",e);}},{key:"opacity",get:function get(){return this.owner.getAttribute("opacity");},set:function set(e){this.owner.setAttribute("opacity",e);}},{key:"fillOpacity",get:function get(){return this.owner.getAttribute("fillOpacity");},set:function set(e){this.owner.setAttribute("fillOpacity",e);}},{key:"borderOpacity",get:function get(){return this.owner.getAttribute("borderOpacity");},set:function set(e){this.owner.setAttribute("borderOpacity",e);}},{key:"background",get:function get(){return this.owner.getAttribute("background");},set:function set(e){this.owner.setAttribute("background",e);}},{key:"clipPath",get:function get(){return this.owner.getAttribute("clipPath");},set:function set(e){this.owner.setAttribute("clipPath",e);}},{key:"cursor",get:function get(){return this.owner.getAttribute("cursor");},set:function set(e){this.owner.setAttribute("cursor",e);}},{key:"hitArea",get:function get(){return this.owner.getAttribute("hitArea");},set:function set(e){this.owner.setAttribute("hitArea",e);}},{key:"pointerEvents",get:function get(){return this.owner.getAttribute("pointerEvents");},set:function set(e){this.owner.setAttribute("pointerEvents",e);}},{key:"miterLimit",get:function get(){return this.owner.getAttribute("miterLimit");},set:function set(e){this.owner.setAttribute("miterLimit",e);}},{key:"lineCap",get:function get(){return this.owner.getAttribute("lineCap");},set:function set(e){this.owner.setAttribute("lineCap",e);}},{key:"lineJoin",get:function get(){return this.owner.getAttribute("lineJoin");},set:function set(e){this.owner.setAttribute("lineJoin",e);}},{key:"lineDash",get:function get(){return this.owner.getAttribute("lineDash");},set:function set(e){this.owner.setAttribute("lineDash",e);}},{key:"lineDashOffset",get:function get(){return this.owner.getAttribute("lineDashOffset");},set:function set(e){this.owner.setAttribute("lineDashOffset",e);}},{key:"shadow",get:function get(){return this.owner.getAttribute("shadow");},set:function set(e){this.owner.setAttribute("shadow",e);}},{key:"shadowOffsetX",get:function get(){return this.owner.getAttribute("shadowOffsetX");},set:function set(e){this.owner.setAttribute("shadowOffsetX",e);}},{key:"shadowOffsetY",get:function get(){return this.owner.getAttribute("shadowOffsetY");},set:function set(e){this.owner.setAttribute("shadowOffsetY",e);}},{key:"shadowBlur",get:function get(){return this.owner.getAttribute("shadowBlur");},set:function set(e){this.owner.setAttribute("shadowBlur",e);}},{key:"shadowColor",get:function get(){return this.owner.getAttribute("shadowColor");},set:function set(e){this.owner.setAttribute("shadowColor",e);}},{key:"startAngle",get:function get(){return this.owner.getAttribute("startAngle");},set:function set(e){this.owner.setAttribute("startAngle",e);}},{key:"endAngle",get:function get(){return this.owner.getAttribute("endAngle");},set:function set(e){this.owner.setAttribute("endAngle",e);}},{key:"rx",get:function get(){return this.owner.getAttribute("rx");},set:function set(e){this.owner.setAttribute("rx",e);}},{key:"ry",get:function get(){return this.owner.getAttribute("ry");},set:function set(e){this.owner.setAttribute("ry",e);}},{key:"img",get:function get(){return this.owner.getAttribute("img");},set:function set(e){this.owner.setAttribute("img",e);}},{key:"src",get:function get(){return this.owner.getAttribute("src");},set:function set(e){this.owner.setAttribute("src",e);}},{key:"x1",get:function get(){return this.owner.getAttribute("x1");},set:function set(e){this.owner.setAttribute("x1",e);}},{key:"y1",get:function get(){return this.owner.getAttribute("y1");},set:function set(e){this.owner.setAttribute("y1",e);}},{key:"x2",get:function get(){return this.owner.getAttribute("x2");},set:function set(e){this.owner.setAttribute("x2",e);}},{key:"y2",get:function get(){return this.owner.getAttribute("y2");},set:function set(e){this.owner.setAttribute("y2",e);}},{key:"text",get:function get(){return this.owner.getAttribute("text");},set:function set(e){this.owner.setAttribute("text",e);}},{key:"wordWarp",get:function get(){return this.owner.getAttribute("wordWarp");},set:function set(e){this.owner.setAttribute("wordWarp",e);}},{key:"wordBreak",get:function get(){return this.owner.getAttribute("wordBreak");},set:function set(e){this.owner.setAttribute("wordBreak",e);}},{key:"underline",get:function get(){return this.owner.getAttribute("underline");},set:function set(e){this.owner.setAttribute("underline",e);}},{key:"strikeout",get:function get(){return this.owner.getAttribute("strikeout");},set:function set(e){this.owner.setAttribute("strikeout",e);}},{key:"textMaxWidth",get:function get(){return this.owner.getAttribute("textMaxWidth");},set:function set(e){this.owner.setAttribute("textMaxWidth",e);}},{key:"letterSpacing",get:function get(){return this.owner.getAttribute("letterSpacing");},set:function set(e){this.owner.setAttribute("letterSpacing",e);}},{key:"textAlign",get:function get(){return this.owner.getAttribute("textAlign");},set:function set(e){this.owner.setAttribute("textAlign",e);}},{key:"textBaseLine",get:function get(){return this.owner.getAttribute("textBaseLine");},set:function set(e){this.owner.setAttribute("textBaseLine",e);}},{key:"textTransform",get:function get(){return this.owner.getAttribute("textTransform");},set:function set(e){this.owner.setAttribute("textTransform",e);}},{key:"color",get:function get(){return this.owner.getAttribute("color");},set:function set(e){this.owner.setAttribute("color",e);}},{key:"fontStyle",get:function get(){return this.owner.getAttribute("fontStyle");},set:function set(e){this.owner.setAttribute("fontStyle",e);}},{key:"fontVariant",get:function get(){return this.owner.getAttribute("fontVariant");},set:function set(e){this.owner.setAttribute("fontVariant",e);}},{key:"fontWeight",get:function get(){return this.owner.getAttribute("fontWeight");},set:function set(e){this.owner.setAttribute("fontWeight",e);}},{key:"fontSize",get:function get(){return this.owner.getAttribute("fontSize");},set:function set(e){this.owner.setAttribute("fontSize",e);}},{key:"lineHeight",get:function get(){return this.owner.getAttribute("lineHeight");},set:function set(e){this.owner.setAttribute("lineHeight",e);}},{key:"fontFamily",get:function get(){return this.owner.getAttribute("fontFamily");},set:function set(e){this.owner.setAttribute("fontFamily",e);}},{key:"startPoint",get:function get(){return this.owner.getAttribute("startPoint");},set:function set(e){this.owner.setAttribute("startPoint",e);}},{key:"endPoint",get:function get(){return this.owner.getAttribute("endPoint");},set:function set(e){this.owner.setAttribute("endPoint",e);}},{key:"lineEnding",get:function get(){return this.owner.getAttribute("lineEnding");},set:function set(e){this.owner.setAttribute("lineEnding",e);}},{key:"stampPoints",get:function get(){return this.owner.getAttribute("stampPoints");},set:function set(e){this.owner.setAttribute("stampPoints",e);}}]),e;}(),qR={},ZR={},_R=function(e){lb(i,e);var t=ub(i);function i(e){var r;return ak(this,i),tk(rc(r=t.call(this)),"shapeType",void 0),tk(rc(r),"config",void 0),tk(rc(r),"path",void 0),tk(rc(r),"steps",void 0),tk(rc(r),"externalMatrixes",[]),tk(rc(r),"clippable",!1),tk(rc(r),"imageData",null),r.config=e,r.id=e.id||e.uid||"",r.name=e.name||"",r.index=e.index,r.nodeName=e.type||"container",r.pageUid=e.pageUid||"",(e.className||e.class)&&(r.className=e.className||e.class),r.style=new XR(rc(r)),r.initAttributes(e),r;}return ok(i,[{key:"isVisible",get:function get(){return"visible"===this.parsedStyle.visibility;}},{key:"isInteractive",get:function get(){return"none"!==this.parsedStyle.pointerEvents;}},{key:"width",get:function get(){return this.parsedStyle.width.value*Math.abs(this.getScale().x);}},{key:"height",get:function get(){return this.parsedStyle.height.value*Math.abs(this.getScale().y);}},{key:"initAttributes",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var t in e)if(mz(t,e)){if("style"===t)continue;this.attributes[t]=e[t];}for(var i in e.style)mz(i,e.style)&&(this.parseStyleProperty(i,e.style[i]),this.attributes[i]=e.style[i]);this.renderable.toRenderable();}},{key:"setAttribute",value:function value(e,t){if(!nz(t)&&t!==this.attributes[e]){var r=this.attributes[e];sb(ob(i.prototype),"setAttribute",this).call(this,e,t),this.config.hasOwnProperty(e)||(this.parseStyleProperty(e,t),this.updateStyleProperty(e,r,t));}}},{key:"parseStyleProperty",value:function value(e,t){var i=qR[e];this.parsedStyle[e]=i?i(t,this,e):t;}},{key:"updateStyleProperty",value:function value(e,t,i){var r=this,n=ZR[e];n&&dk(n).call(n,function(n){n(t,i,r,e);});}},{key:"toFront",value:function value(){var e=this.parentNode;if(e){var t,i=Math.max.apply(Math,hb(jI(t=e.children).call(t,function(e){return e.style.zIndex;})));this.style.zIndex=i+1;}return this;}},{key:"toBack",value:function value(){var e=this.parentNode;if(e){var t,i=Math.min.apply(Math,hb(jI(t=e.children).call(t,function(e){return e.style.zIndex;})));this.style.zIndex=i-1;}return this;}},{key:"setOrigin",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return NR.setOrigin(this,e,t),this;}},{key:"getOrigin",value:function value(){return NR.getOrigin(this);}},{key:"setPosition",value:function value(e){return NR.setPosition(this,e),this;}},{key:"setLocalPosition",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=iU(e,t,i);return NR.setLocalPosition(this,r),this;}},{key:"getPosition",value:function value(){return NR.getPosition(this);}},{key:"getLocalPosition",value:function value(){return NR.getLocalPosition(this);}},{key:"translate",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=iU(e,t,i);return NR.translate(this,r),this;}},{key:"translateLocal",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=iU(e,t,i);return NR.translateLocal(this,r),this;}},{key:"scale",value:function value(e,t,i){return this.scaleLocal(e,t,i);}},{key:"scaleLocal",value:function value(e,t,i){return cz(e)&&(e=iU(e,t=t||e,i=i||e)),NR.scaleLocal(this,e),this;}},{key:"setLocalScale",value:function value(e,t,i){return cz(e)&&(e=iU(e,t=t||e,i=i||e)),NR.setLocalScale(this,e),this;}},{key:"getScale",value:function value(){return NR.getScale(this);}},{key:"getLocalScale",value:function value(){return NR.getLocalScale(this);}},{key:"rotate",value:function value(e,t,i){return nz(t)&&nz(i)?NR.rotate(this,0,0,e):NR.rotate(this,e,t,i),this;}},{key:"rotateLocal",value:function value(e,t,i){return nz(t)&&nz(i)?NR.rotateLocal(this,0,0,e):NR.rotateLocal(this,e,t,i),this;}},{key:"setAngle",value:function value(e){return NR.setAngle(this,0,0,e),this;}},{key:"setLocalAngle",value:function value(e){return NR.setLocalAngle(this,0,0,e),this;}},{key:"getAngle",value:function value(){return NR.getAngle(this).z;}},{key:"getLocalAngle",value:function value(){return NR.getLocalAngle(this).z;}},{key:"getLocalTransform",value:function value(){return NR.getLocalTransform(this);}},{key:"getWorldTransform",value:function value(){return NR.getWorldTransform(this);}},{key:"setLocalTransform",value:function value(e){return NR.setLocalTransform(this,e),this;}},{key:"resetLocalTransform",value:function value(){NR.resetLocalTransform(this);}},{key:"getPath",value:function value(){}},{key:"getConfig",value:function value(){}},{key:"getBoundingRect",value:function value(){}},{key:"getBoundingRectObject",value:function value(){}},{key:"updateStyle",value:function value(e){}},{key:"isPointInPath",value:function value(e){}}]),i;}(YR);function GR(e,t){return{type:e,data:t};}function KR(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=[],r=cb(e,1),n=r[0];i.push(GR("moveTo",[n]));for(var o=1;o<e.length;o++)n=e[o],i.push(GR("lineTo",[n]));return t&&e.length>2&&(n=cb(e,1)[0],i.push(GR("lineTo",[n]))),i;}function $R(e,t){var i=t.data,r=t.type,n=cb(i,3),o=n[0],a=n[1],s=n[2];switch(r){case"moveTo":e.moveTo(o.x,o.y);break;case"lineTo":e.lineTo(o.x,o.y);break;case"bezierCurveTo":e.bezierCurveTo(o.x,o.y,a.x,a.y,s.x,s.y);break;case"quadraticCurveTo":e.quadraticCurveTo(o.x,o.y,a.x,a.y);}}function QR(e){for(var t=Math.min,i=Math.max,r=e[0],n=r.x,o=r.y,a=n,s=o,l=n,u=o,c=1;c<e.length;c++){var h=e[c];a=t(a,h.x),l=i(l,h.x),s=t(s,h.y),u=i(u,h.y);}return{left:a,top:s,right:l,bottom:u,width:l-a,height:u-s};}var JR={opacity:1,fillOpacity:1,borderOpacity:1,lineJoin:"miter",lineCap:"butt",zIndex:0,visibility:"visible",anchor:[0,0],borderColor:"black",miterLimit:10,lineDash:[0,0],lineDashOffset:0};function eL(e){if(e.length<1)return[];for(var t=[],i=[],r=0;r<e.length;r++){var n=e[r];if(0===n.step)r>0&&t.push({step:i,close:e[r-1].close}),(i=[]).push(GR("moveTo",[{x:n.x,y:n.y}]));else if(1===n.step)i.push(GR("lineTo",[{x:n.x,y:n.y}]));else if(2===n.step&&r+2<e.length&&2===e[r+1].step&&2===e[r+2].step){var o=e[r+1],a=e[r+2];i.push(GR("bezierCurveTo",[n,o,a])),r+=2;}}return t.push({step:i,close:e[e.length-1].close}),t;}function tL(e,t,i,r){var n=0,o=0,a=0,s=0,l=[e,t],u=QR(l),c=function(e,t,i,r){var n=r/2,o=r/2,a=t.y-e.y,s=t.x-e.x;if(0===a||0===s)return[s,a];var l=-1/((t.y-e.y)/(t.x-e.x)),u=Math.atan(l);return"square"===i?(n=Math.sqrt(2)*r/2,o=Math.sqrt(2)*r/2):"round"===i?(n=r/2,o=r/2):(n=Math.abs(Math.cos(u)*r)/2,o=Math.abs(Math.sin(u)*r)/2),[n,o];}(l[0],l[1],r,i||0);return 0===c[1]?(n=u.left,o=u.top-i/2,a=u.width,s=u.height+i,"square"!==r&&"round"!==r||(n-=i/2,a+=i)):0===c[0]?(n=u.left-i/2,o=u.top,a=u.width+i,s=u.height,"square"!==r&&"round"!==r||(o-=i/2,s+=i)):(n=u.left-c[0],o=u.top-c[1],a=u.width+2*c[0],s=u.height+2*c[1]),{x:n,y:o,width:a,height:s};}function iL(e){return Math.abs(e)<1e-6?0:e<0?-1:1;}function rL(e,t,i,r){var n=e.x,o=e.y,a=t.x,s=t.y,l=r.x,u=r.y,c=Math.min(n,a),h=Math.max(n,a),d=Math.min(o,s),f=Math.max(o,s),v=i/2;return l>=c-v&&l<=h+v&&u>=d-v&&u<=f+v&&function(e,t,i,r,n,o){var a=[i-e,r-t];if(new tU(a[0],a[1]).equals({x:0,y:0}))return Math.sqrt((n-e)*(n-e)+(o-t)*(o-t));var s=[-a[1],a[0]],l=new tU(s[0],s[1]);l.normalize();var u=[n-e,o-t],c=new tU(u[0],u[1]);return Math.abs(c.dot(l));}(n,o,a,s,l,u)<=i/2;}function nL(e,t,i,r,n){var o=e.length;if(o<2)return!1;for(var a=0;a<o-1;a++)if(rL(e[a],e[a+1],t,{x:i,y:r}))return!0;return!(!n||!rL(e[0],e[o-1],t,{x:i,y:r}));}function oL(e,t,i,r,n,o){return n>=e&&n<=e+i&&o>=t&&o<=t+r;}function aL(e,t,i,r,n,o){var a=o,s=r.x,l=r.y,u=n.x,c=n.y;0===t&&(s=n.x,l=n.y,u=r.x,c=r.y);var h=Math.PI/2,d=u-s>=0?1:-1,f=c-l>=0?1:-1;s!==u&&(h=Math.atan(Math.abs(c-l)/Math.abs(u-s)));var v=Math.cos(h),g=Math.sin(h),m=i?1:-1,y={x:u+9*m*a*v*d-4.5*a*g*d,y:c+9*m*a*g*f+4.5*a*v*f,step:0,close:!1},p={x:u+m*a*v*d,y:c+m*a*g*f,step:1,close:!1},w={x:u+9*m*a*v*d+4.5*a*g*d,y:c+9*m*a*g*f-4.5*a*v*f,step:1,close:!1};e.push(y,p,w);}function sL(e,t,i,r,n,o){var a=o,s=r.x,l=r.y,u=n.x,c=n.y;0===t&&(s=n.x,l=n.y,u=r.x,c=r.y);var h=Math.PI/2,d=u-s>=0?1:-1,f=c-l>=0?1:-1;s!==u&&(h=Math.atan(Math.abs(c-l)/Math.abs(u-s)));var v=Math.cos(h),g=Math.sin(h),m=i?1:-1,y={x:u+9*m*a*v*d-4.5*a*g*d,y:c+9*m*a*g*f+4.5*a*v*f,step:0,close:!1},p={x:u+m*a*v*d,y:c+m*a*g*f,step:1,close:!1},w={x:u+9*m*a*v*d+4.5*a*g*d,y:c+9*m*a*g*f-4.5*a*v*f,step:1,close:!0};e.push(y,p,w);}function lL(e,t,i,r,n){var o=n,a=i.x,s=i.y,l=r.x,u=r.y;0===t&&(a=r.x,s=r.y,l=i.x,u=i.y);var c=Math.PI/2,h=l-a>=0?1:-1,d=u-s>=0?1:-1;a!==l&&(c=Math.atan(Math.abs(u-s)/Math.abs(l-a)));var f=Math.cos(c),v=Math.sin(c),g={x:l-3*o*v*h,y:u+3*o*f*d,step:0,close:!1},m={x:l+3*o*v*h,y:u-3*o*f*d,step:1,close:!1};e.push(g,m);}function uL(e,t,i,r,n){var o=n,a=i.x,s=i.y,l=r.x,u=r.y;0===t&&(a=r.x,s=r.y,l=i.x,u=i.y);var c=Math.PI/2,h=l-a>=0?1:-1,d=u-s>=0?1:-1,f=u>=s&&l>=a||u<=s&&l<=a?-1:1;a!==l&&(c=Math.atan(Math.abs(u-s)/Math.abs(l-a)));var v=Math.cos(c),g=Math.sin(c),m=4.5*Math.sqrt(3)*o,y={x:l+4.5*o*v*h-m*g*h*f,y:u+4.5*o*g*d+m*v*d*f,step:0,close:!1},p={x:l-4.5*o*v*h+m*g*h*f,y:u-4.5*o*g*d-m*v*d*f,step:1,close:!1};e.push(y,p);}function cL(e,t,i,r,n){var o=n,a=r.x,s=r.y;0===t&&(a=i.x,s=i.y);var l={x:a-3*o,y:s,step:0,close:!1},u={x:a,y:s-3*o,step:1,close:!1},c={x:a+3*o,y:s,step:1,close:!1},h={x:a,y:s+3*o,step:1,close:!0};e.push(l,u,c,h);}function hL(e,t,i,r,n){var o=n,a=r.x,s=r.y;0===t&&(a=i.x,s=i.y);var l=3*o-0*o,u=function(e,t,i,r){var n=e-i,o=e+i,a=t-r,s=t+r,l=.551915024494,u=l*i,c=l*r,h=[];return h.push({x:o,y:t}),h.push({x:o,y:t+c},{x:e+u,y:s},{x:e,y:s}),h.push({x:e-u,y:s},{x:n,y:t+c},{x:n,y:t}),h.push({x:n,y:t-c},{x:e-u,y:a},{x:e,y:a}),h.push({x:e+u,y:a},{x:o,y:t-c},{x:o,y:t}),h;}(a,s,l,l);dk(u).call(u,function(t,i){var r=0===i?0:2,n=i===u.length-1,o={x:t.x,y:t.y,step:r,close:n};e.push(o);});}function dL(e,t){if(nz(e)||""===e)return null;var i=wR(e);return"%"===i.unit?.01*t*i.value:i.value;}var fL=function(e){lb(i,e);var t=ub(i);function i(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.style,o=Td(r,NA);ak(this,i),tk(rc(e=t.call(this,rk({type:"rect",style:rk(rk({},JR),{},{x:0,y:0,width:0,height:0},n)},o))),"shapeType","rect");var a=e.parsedStyle,s=a.x,l=a.y;return e.setLocalPosition(s,l),e.updateOrigin(),e;}return ok(i,[{key:"updateStyle",value:function value(e){var t,i=this;dk(t=gk(e)).call(t,function(t){mz(t,e)&&(i.style[t]=e[t]);});}},{key:"updateOrigin",value:function value(){var e=this.parsedStyle,t=e.width,i=e.height;this.setOrigin(t.value/2,i.value/2);}},{key:"updatePosition",value:function value(e,t){this.style.x=e,this.style.y=t;}},{key:"getPath",value:function value(){var e=this.parsedStyle,t=e.width,i=e.height,r=e.borderWidth,n=.5*((null==r?void 0:r.value)||0),o=0,a=0;o+=n,a+=n;var s=t.value-2*n,l=i.value-2*n;return this.path=[{x:o,y:a},{x:o+s,y:a},{x:o+s,y:a+l},{x:o,y:a+l}],this.steps=KR(this.path),this.path;}},{key:"getBoundingRect",value:function value(){var e=this.parsedStyle,t=e.x,i=e.y,r=e.width,n=e.height;return e.borderWidth,{x:t,y:i,width:r.value,height:n.value};}},{key:"getBoundingRectObject",value:function value(){var e=this.getBoundingRect();return new i({style:{x:e.x,y:e.y,width:e.width,height:e.height,borderWidth:1,background:"rgba(0,0,0,0)"}});}},{key:"isPointInPath",value:function value(e){var t=this.parsedStyle,i=t.x,r=t.y,n=t.background,o=t.borderWidth,a=t.width,s=t.height,l=o&&o.value,u=((null==o?void 0:o.value)||0)/2;return n&&l?oL(i-u,r-u,a.value+u,s.value+u,e.x,e.y):n?oL(i,r,a.value,s.value,e.x,e.y):!!l&&function(e,t,i,r,n,o,a){var s=n/2;return oL(e-s,t-s,i,n,o,a)||oL(e+i-s,t-s,n,r,o,a)||oL(e+s,t+r-s,i,n,o,a)||oL(e-s,t+s,n,r,o,a);}(i-u,r-u,a.value,s.value,o.value,e.x,e.y);}}]),i;}(_R);function vL(e,t,i,r,n){for(var o=n||[],a=e[t],s=e[i-1],l=0,u=1,c=t+1;c<i-1;c++){var h=xU(kU(a,s,e[c]),e[c]);h>l&&(l=h,u=c);}return l>=r?(vL(e,t,u,r,o),vL(e,u,i,r,o)):(o.length||o.push(a),o.push(s)),o;}var gL=function(e){lb(i,e);var t=ub(i);function i(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.style,o=Td(r,OA);ak(this,i),tk(rc(e=t.call(this,rk({type:"image",style:rk(rk({},JR),{},{x:0,y:0,width:0,height:0,img:""},n)},o))),"shapeType","image"),tk(rc(e),"meteData",void 0),e.meteData=(null==o?void 0:o.meteData)||null;var a=e.parsedStyle,s=a.x,l=a.y;return e.setLocalPosition(s,l),e.updateOrigin(),e;}return ok(i,[{key:"updateStyle",value:function value(e){var t,i=this;dk(t=gk(e)).call(t,function(t){mz(t,e)&&(i.style[t]=e[t]);});}},{key:"updateOrigin",value:function value(){var e=this.parsedStyle,t=e.width,i=e.height;this.setOrigin(t.value/2,i.value/2);}},{key:"updatePosition",value:function value(e,t){this.style.x=e,this.style.y=t;}},{key:"getBoundingRect",value:function value(){var e=this.parsedStyle,t=e.x,i=e.y,r=e.width,n=e.height;return{x:t,y:i,width:r.value,height:n.value};}},{key:"getBoundingRectObject",value:function value(){var e=this.getBoundingRect(),t=e.x,i=e.y,r=e.width,n=e.height;return new fL({style:{x:t,y:i,width:r,height:n,borderWidth:1,background:"rgba(0,0,0,0)"}});}},{key:"isPointInPath",value:function value(e){return this.getBoundingRectObject().isPointInPath(e);}}]),i;}(_R),mL=function(e){lb(i,e);var t=ub(i);function i(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.style,o=Td(r,WA);ak(this,i),tk(rc(e=t.call(this,rk({type:"line",style:rk(rk({},JR),{},{x1:0,y1:0,x2:0,y2:0,borderWidth:2},n)},o))),"shapeType","line"),tk(rc(e),"renderPath",void 0);var a=e.getBoundingRect(),s=a.x,l=a.y;return e.updatePosition(s,l),e.updateOrigin(),e;}return ok(i,[{key:"updateOrigin",value:function value(){var e=this.getBoundingRect(),t=e.width,i=e.height;this.setOrigin(t/2,i/2);}},{key:"updatePoints",value:function value(){var e=this.renderPath,t=this.getLocalPosition(),i=[];dk(e).call(e,function(e){i.push({x:e.x+t.x,y:e.y+t.y});}),this.updateStyle({x1:i[0].x||0,y1:i[0].y||0,x2:i[1].x||0,y2:i[1].y||0});}},{key:"updateStyle",value:function value(e){var t,i=this;dk(t=gk(e)).call(t,function(t){mz(t,e)&&(i.style[t]=e[t]);});}},{key:"updatePosition",value:function value(e,t){this.style.x=e,this.style.y=t;}},{key:"getPath",value:function value(){var e=this.renderable,t=this.parsedStyle,i=t.x1,r=t.x2,n=t.y1,o=t.y2,a=this.getBoundingRect(),s=a.x,l=a.y;return this.path&&!e.isRenderable()||(this.renderPath=[{x:i-s,y:n-l},{x:r-s,y:o-l}],this.path=[{x:i,y:n},{x:r,y:o}],this.steps=KR(this.renderPath,!1),e.toRenderable()),this.path;}},{key:"getBoundingRect",value:function value(){var e=this.parsedStyle,t=e.x1,i=e.x2,r=e.y1,n=e.y2,o=e.borderWidth,a=e.lineCap;return tL({x:t,y:r},{x:i,y:n},o.value,a);}},{key:"getBoundingRectObject",value:function value(){var e=this.getBoundingRect(),t=e.x,i=e.y,r=e.width,n=e.height;return new fL({style:{x:t,y:i,width:r,height:n,borderWidth:1,background:"rgba(0,0,0,0)"}});}},{key:"isPointInPath",value:function value(e){if(!this.getBoundingRectObject().isPointInPath(e))return!1;var t=this.parsedStyle,i=t.x1,r=t.x2,n=t.y1,o=t.y2,a=t.borderWidth;return rL({x:i,y:n},{x:r,y:o},a.value<20?10:a.value/2,e);}}]),i;}(_R),yL=function(e){lb(i,e);var t=ub(i);function i(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.style,o=Td(r,HA);return ak(this,i),tk(rc(e=t.call(this,rk({type:"path",style:rk(rk({},JR),{},{points:[],lineJoin:"miter",lineCap:"butt",borderWidth:2,miterLimit:4},n)},o))),"shapeType","path"),tk(rc(e),"renderPath",void 0),tk(rc(e),"pointArray",[]),tk(rc(e),"pointLength",0),tk(rc(e),"initialRect",void 0),e.getPath(),e.initialRect=e.getBoundingRect(),e.updatePosition(e.initialRect.x,e.initialRect.y),e.setOrigin(e.initialRect.width,e.initialRect.height),e;}return ok(i,[{key:"addPoint",value:function value(e){var t=hb(this.style.points);t.push(e),this.style.points=t;}},{key:"updateStyle",value:function value(e){var t,i=this;dk(t=gk(e)).call(t,function(t){mz(t,e)&&(i.style[t]=e[t]);});}},{key:"updateOrigin",value:function value(){var e=this.getBoundingRect(),t=e.width,i=e.height;this.setOrigin(t/2,i/2);}},{key:"updatePosition",value:function value(e,t){this.style.x=e,this.style.y=t;}},{key:"getPath",value:function value(){var e,t,i=jI(e=this.parsedStyle.points).call(e,function(e){return new nU(e.x,e.y);});return i=Ck(t=this.pointArray).call(t,vL(i,this.pointLength,i.length,2)),this.parsedStyle.points.length-this.pointLength==30&&(this.pointArray=iz(i),this.pointLength=this.parsedStyle.points.length),i.length<=3&&i.push(i[i.length-1].clone()),i=function(e){var t=e.length;if(t<3)return e;var i=[];if(3===t)i.push(e[0].clone(),e[1].clone(),e[2].clone(),e[2].clone());else{var r=ET(e).call(e);i.push(r[0]);for(var n=0;n+2<r.length;n++){var o=r[n+1],a=r[n+2],s=o,l=new nU(((null==o?void 0:o.x)+(null==a?void 0:a.x))/2,((null==o?void 0:o.y)+(null==a?void 0:a.y))/2);i.push(s),n+3===r.length?i.push(a):i.push(l);}}return i;}(i),this.path=i,this.renderPath=this.getRenderPath(this.path),this.steps=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e.length;if(i<=1)return[];var r=[],n=cb(e,1),o=n[0];r.push(GR("moveTo",[o]));for(var a=0;a+2<i;a+=2){var s=e[a+1],l=e[a+2];r.push(GR("quadraticCurveTo",[s,l]));}return t&&e.length>2&&r.push(GR("lineTo",[o])),r;}(this.renderPath),this.path;}},{key:"getRenderPath",value:function value(e){var t=this.getBoundingRect(),i=t.x,r=t.y,n=[];return dk(e).call(e,function(e){!e||Ek(e.x)||Ek(e.y)||n.push({x:e.x-i,y:e.y-r});}),n;}},{key:"getBoundingRect",value:function value(){var e=this.parsedStyle,t=e.borderWidth,i=e.points,r=e.lineCap,n=jI(i).call(i,function(e){return new nU(e.x,e.y);}),o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=e.length;if(i<3)return e;var r=[];if(3===i)r.push(e[0].clone(),e[1].clone(),e[2].clone(),e[2].clone());else{var n=ET(e).call(e);n.unshift(e[0]),n.push(e[e.length-1]);var o=[],a=1-t;r.push(iz(n[0]));for(var s=1;s+2<n.length;s++){var l=n[s],u=n[s-1],c=n[s+1],h=n[s+2];o[0]=iz(l),o[1]=new nU(l.x+a*(c.x-u.x)/8,l.y+a*(c.y-u.y)/8),o[2]=new nU(c.x-a*(h.x-l.x)/8,c.y-a*(h.y-l.y)/8),o[3]=iz(c),r.push(o[1],o[2],o[3]);}}return r;}(vL(n,0,n.length,1)),a=QR(o);if(2===i.length)return tL(i[0],i[1],t.value,r);var s=t.value/2;return{x:a.left-s,y:a.top-s,width:a.width+2*s,height:a.height+2*s};}},{key:"getBoundingRectObject",value:function value(){var e=this.getBoundingRect(),t=e.x,i=e.y,r=e.width,n=e.height;return new fL({style:{x:t,y:i,width:r,height:n,borderWidth:1,background:"rgba(0,0,0,0)"}});}},{key:"isPointInPath",value:function value(e){if(!this.getBoundingRectObject().isPointInPath(e))return!1;var t=this.parsedStyle.borderWidth,i=t.value<20?10:t.value/2;return function(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=0;r<t.length;r++)if(xU(e,t[r])<=i)return!0;return!1;}(e,this.style.points,i);}}]),i;}(_R),pL=function(e){lb(i,e);var t=ub(i);function i(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.style,o=Td(r,FA);ak(this,i),tk(rc(e=t.call(this,rk({type:"polygon",style:rk(rk({},JR),{},{points:[{x:0,y:0},{x:10,y:10}],miterLimit:4,borderWidth:2},n)},o))),"shapeType","polygon"),tk(rc(e),"renderPath",void 0),0===e.parsedStyle.points.length&&(e.style.points=[{x:0,y:0},{x:10,y:10}]);var a=e.getBoundingRect(),s=a.x,l=a.y,u=a.width,c=a.height;return e.updatePosition(s,l),e.setOrigin(u/2,c/2),e;}return ok(i,[{key:"addPoint",value:function value(e){var t=hb(this.style.points);t.push(e),this.style.points=t;}},{key:"updatePoints",value:function value(){var e=this.renderPath,t=this.getLocalPosition(),i=[];dk(e).call(e,function(e){i.push({x:e.x+t.x,y:e.y+t.y});}),this.style.points=i;}},{key:"updateStyle",value:function value(e){var t,i=this;dk(t=gk(e)).call(t,function(t){mz(t,e)&&(i.style[t]=e[t]);});}},{key:"updateOrigin",value:function value(){var e=this.getBoundingRect(),t=e.width,i=e.height;this.setOrigin(t/2,i/2);}},{key:"updatePosition",value:function value(e,t){this.style.x=e,this.style.y=t;}},{key:"getPath",value:function value(){var e,t=this.getBoundingRect(),i=t.x,r=t.y;return this.path=this.parsedStyle.points,this.renderPath=jI(e=this.parsedStyle.points).call(e,function(e){return{x:e.x-i,y:e.y-r};}),this.steps=KR(this.renderPath,!0),this.path;}},{key:"getBoundingRect",value:function value(){var e=this.parsedStyle,t=e.borderWidth,i=e.points,r=e.lineCap;if(2===i.length)return tL(i[0],i[1],t.value,r);var n=QR(i),o=t.value/2||0;return{x:n.left-o,y:n.top-o,width:n.width+2*o,height:n.height+2*o};}},{key:"getBoundingRectObject",value:function value(){var e=this.getBoundingRect(),t=e.x,i=e.y,r=e.width,n=e.height;return new fL({style:{x:t,y:i,width:r,height:n,borderWidth:1,background:"rgba(0,0,0,0)"}});}},{key:"isPointInPath",value:function value(e){if(!this.getBoundingRectObject().isPointInPath(e))return!1;var t=this.parsedStyle,i=t.borderWidth,r=t.background,n=t.points,o=i&&i.value;null==i||i.value;var a=i.value<20?10:i.value/2,s=!1;return o&&(s=nL(n,a,e.x,e.y,!0)),!s&&r&&(s=function(e,t,i){var r=!1,n=e.length;if(n<=2)return!1;for(var o=0;o<n;o++){var a=e[o],s=e[(o+1)%n];if(SU(a,s,{x:t,y:i}))return!0;iL(a.y-i)>0!=iL(s.y-i)>0&&iL(t-(i-a.y)*(a.x-s.x)/(a.y-s.y)-a.x)<0&&(r=!r);}return r;}(n,e.x,e.y)),s;}}]),i;}(_R),wL=function(e){lb(i,e);var t=ub(i);function i(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.style,o=Td(r,jA);ak(this,i),tk(rc(e=t.call(this,rk({type:"polyline",style:rk(rk({},JR),{},{points:[{x:0,y:0},{x:0,y:0}],lineEnding:null,borderWidth:2,miterLimit:4},n)},o))),"shapeType","polyline"),tk(rc(e),"renderPath",void 0),e.getPath();var a=e.getBoundingRect(),s=a.x,l=a.y;return e.updatePosition(s,l),e.updateOrigin(),e;}return ok(i,[{key:"initPath",value:function value(){var e=this.parsedStyle,t=e.points,i=e.lineEnding;t.length;var r=[];if(dk(t).call(t,function(e,t){0===t?r.push({x:e.x,y:e.y,step:0,close:!1}):r.push({x:e.x,y:e.y,step:1,close:!1});}),i)for(var n=0;n<i.length;n++)switch(i[n]){case"OpenArrow":this.addOpenArrow(r,n,!1);break;case"ROpenArrow":this.addOpenArrow(r,n,!0);break;case"ClosedArrow":this.addCloseArrow(r,n,!1);break;case"RClosedArrow":this.addCloseArrow(r,n,!0);break;case"Butt":this.addButt(r,n);break;case"Slash":this.addSlash(r,n);break;case"Square":this.addSquare(r,n);break;case"Diamond":this.addDiamond(r,n);break;case"Circle":this.addCircle(r,n);}return r;}},{key:"getRenderPath",value:function value(e){var t=this.getBoundingRect(),i=t.x,r=t.y,n=[];return dk(e).call(e,function(e){!e||Ek(e.x)||Ek(e.y)||n.push({x:e.x-i,y:e.y-r,step:e.step,close:e.close});}),n;}},{key:"addPoint",value:function value(e){var t=hb(this.style.points);t.push(e),this.style.points=t;}},{key:"updatePoints",value:function value(){var e,t,i=this.parsedStyle.points.length,r=this.getLocalPosition(),n=[];dk(e=ET(t=this.renderPath).call(t,0,i)).call(e,function(e){n.push({x:e.x+r.x,y:e.y+r.y});}),this.style.points=n;}},{key:"updateStyle",value:function value(e){var t,i=this;dk(t=gk(e)).call(t,function(t){mz(t,e)&&(i.style[t]=e[t]);});}},{key:"updateOrigin",value:function value(){var e=this.getBoundingRect(),t=e.width,i=e.height;this.setOrigin(t/2,i/2);}},{key:"updatePosition",value:function value(e,t){this.style.x=e,this.style.y=t;}},{key:"updatePoint",value:function value(){for(var e=this.getLocalPosition(),t=this.parsedStyle.points.length,i=[],r=0;r<t;r++)i.push({x:this.renderPath[r].x+e.x,y:this.renderPath[r].y+e.y});this.updateStyle({points:i});}},{key:"getPath",value:function value(){this.path=this.initPath(),this.renderPath=this.getRenderPath(this.path),this.steps=eL(this.renderPath);}},{key:"getBoundingRect",value:function value(){var e=this.parsedStyle,t=e.borderWidth,i=e.lineCap;if(2===this.path.length)return tL(this.path[0],this.path[1],t.value,i);var r=QR(this.path),n=t.value/2;return{x:r.left-n,y:r.top-n,width:r.width+2*n,height:r.height+2*n};}},{key:"getBoundingRectObject",value:function value(){var e=this.getBoundingRect(),t=e.x,i=e.y,r=e.width,n=e.height;return new fL({style:{x:t,y:i,width:r,height:n,borderWidth:1,background:"rgba(0,0,0,0)"}});}},{key:"isPointInPath",value:function value(e){if(!this.getBoundingRectObject().isPointInPath(e))return!1;var t=this.parsedStyle,i=t.borderWidth,r=t.points;return null==i||i.value,nL(r,i.value<20?10:i.value/2,e.x,e.y,!1);}},{key:"isLineArrow",value:function value(){var e=this.parsedStyle.lineEnding;return!!e&&("None"!==e[0]||"None"!==e[1]);}},{key:"addOpenArrow",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.parsedStyle,n=r.points,o=r.borderWidth,a=n.length,s=n[a-2],l=n[a-1];0===t&&(s=rk({},n[1]),l=rk({},n[0])),aL(e,t,i,s,l,o.value);}},{key:"addCloseArrow",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.parsedStyle,n=r.points,o=r.borderWidth,a=n.length,s=n[a-2],l=n[a-1];0===t&&(s=rk({},n[1]),l=rk({},n[0])),sL(e,t,i,s,l,o.value);}},{key:"addCircle",value:function value(e,t){var i=this.parsedStyle,r=i.points,n=i.borderWidth,o=r.length;hL(e,t,r[0],r[o-1],n.value);}},{key:"addDiamond",value:function value(e,t){var i=this.parsedStyle,r=i.points,n=i.borderWidth,o=r.length;cL(e,t,r[0],r[o-1],n.value);}},{key:"addSquare",value:function value(e,t){var i=this.parsedStyle,r=i.points,n=i.borderWidth,o=r.length;uL(e,t,r[0],r[o-1],n.value);}},{key:"addSlash",value:function value(e,t){var i=this.parsedStyle,r=i.points,n=i.borderWidth,o=r.length,a=r[o-2],s=r[o-1];0===t&&(a=rk({},r[1]),s=rk({},r[0])),uL(e,t,a,s,n.value);}},{key:"addButt",value:function value(e,t){var i=this.parsedStyle,r=i.points,n=i.borderWidth,o=r.length,a=r[o-2],s=r[o-1];0===t&&(a=rk({},r[1]),s=rk({},r[0])),lL(e,t,a,s,n.value);}}]),i;}(_R),bL=function(e){lb(i,e);var t=ub(i);function i(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.style,o=Td(r,YA);ak(this,i),tk(rc(e=t.call(this,rk({type:"text",style:rk(rk({},JR),{},{x:0,y:0,text:"",width:300,wordWarp:!0,wordBreak:!0,underline:!1,strikeout:!1,textAlign:"left",textBaseLine:"top",textTransform:"none",letterSpacing:0,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",fontFamily:"Microsoft YaHei",color:"white",fontSize:12,lineHeight:12},n)},o))),"shapeType","text"),tk(rc(e),"lines",[]),tk(rc(e),"chars",[]),tk(rc(e),"totalHeight",void 0),tk(rc(e),"textX",void 0),tk(rc(e),"textY",void 0),tk(rc(e),"rowWidth",void 0),tk(rc(e),"realWidth",void 0),tk(rc(e),"cacheWidth",void 0),tk(rc(e),"font",void 0);var a=e.parsedStyle,s=a.x,l=a.y;return e.setFont(),e.calculateTextPosition(),e.lineWrap(),e.saveCharPosition(),e.setLocalPosition(s,l),e.updateOrigin(),e;}return ok(i,[{key:"setFont",value:function value(){var e,t,i,r,n,o=this.parsedStyle,a=o.fontStyle,s=o.fontVariant,l=o.fontWeight,u=o.fontFamily,c=o.fontSize;this.font=Ck(e=Ck(t=Ck(i=Ck(r=Ck(n="".concat(a," ")).call(n,s," ")).call(r,l," ")).call(i,c.value)).call(t,c.unit," ")).call(e,u);}},{key:"updateStyle",value:function value(e){var t,i=this;dk(t=gk(e)).call(t,function(t){mz(t,e)&&(i.style[t]=e[t]);});}},{key:"updateOrigin",value:function value(){if(this.chars[0]){var e=this.getBoundingRect(),t=e.width,i=e.height,r=this.chars[0].height/10||0,n=this.chars[0].height/2||0,o=0;switch(this.parsedStyle.textBaseLine){case"top":o=i/2-r;break;case"hanging":o=i/2;break;case"middle":o=-r+n*(this.lines.length-1);break;case"ideographic":o=1.5*-r+n*(this.lines.length-2);break;case"bottom":o=-r+n*(this.lines.length-2);break;default:o=r+n*(this.lines.length-2);}this.setOrigin(t/2-r,o);}}},{key:"updatePosition",value:function value(e,t){this.style.x=e,this.style.y=t;}},{key:"calculateTextPosition",value:function value(){var e=this.parsedStyle,t=e.x,i=e.y,r=e.width,n=e.letterSpacing,o=e.borderWidth,a=((null==o?void 0:o.value)||0)/2;this.textX=t+a+n.value,this.textY=i+a+n.value,this.rowWidth=r.value-2*a-2*n.value;}},{key:"lineWrap",value:function value(){this.totalHeight=0,this.realWidth=0;var e=this.textX,t=this.rowWidth,i=this.parsedStyle,r=i.lineHeight,n=i.wordWarp,o=i.fontSize,a=i.borderWidth,s=document.createElement("canvas").getContext("2d"),l=0;s.font=this.font;var u=o.value>r?o.value:r,c=this.transformText(this.parsedStyle.text);if(c.length||(this.lines=[],this.totalHeight=0),c.length){for(var h=[],d=this.textY,f="",v=0;v<c.length;v++){var g=c.charAt(v);if("\n"!==g&&"\r"!==g){if(f+=g,s.measureText(f).width>=t&&n){if(""===(f=f.substring(0,f.length-1))){f=g;continue;}l+=f.length;var m=s.measureText(f).width;m>this.realWidth&&(this.realWidth=s.measureText(f).width),h.push({text:f,x:e,y:d,lineWidth:m,length:f.length,sum:l}),f=g,d+=u,this.totalHeight+=u;}}else{var y=s.measureText(f).width;y>this.realWidth&&(this.realWidth=s.measureText(f).width),l+=(f+=g).length,h.push({text:f,x:e,y:d,lineWidth:y,length:f.length,sum:l}),f="",d+=u,this.totalHeight+=u;}}if(""!==f){l+=f.length;var p=s.measureText(f).width;p>this.realWidth&&(this.realWidth=s.measureText(f).width),h.push({text:f,x:e,y:d,lineWidth:p,length:f.length,sum:l});}this.totalHeight+=u,this.lines=h;}1===this.lines.length&&(this.realWidth=s.measureText(this.lines[0].text).width),a&&a.value&&(this.realWidth+=a.value);}},{key:"getBoundingRect",value:function value(){var e=this.parsedStyle,t=e.x,i=e.y,r=e.textBaseLine,n=e.fontSize,o=e.lineHeight,a=n.value>o?n.value:o,s=a/10;return{x:t-s,y:kL(r,i,a)-s,width:this.realWidth+2*s,height:this.totalHeight};}},{key:"getBoundingRectObject",value:function value(){var e=this.getBoundingRect(),t=e.x,i=e.y,r=e.width,n=e.height;return new fL({style:{x:t,y:i,width:r,height:n,borderWidth:1,background:"rgba(0,0,0,0)"}});}},{key:"isPointInPath",value:function value(e){return this.getBoundingRectObject().isPointInPath(e);}},{key:"saveCharPosition",value:function value(){var e=this;this.chars=[];var t=this.lines,i=this.parsedStyle,r=i.fontSize,n=i.textBaseLine,o=document.createElement("canvas").getContext("2d"),a=r.value;o.font=this.font;var s=0;dk(t).call(t,function(t,i){for(var r=t.x,l=0;l<t.text.length;l++){var u=t.text.charAt(l),c=o.measureText(u).width;"\n"!==u&&"\r"!==u||(c=.1),e.chars.push({char:u,index:s+l+1,charIndex:l+1,lineIndex:i,x:r,y:kL(n,t.y,a),width:c,height:a}),r+=1*o.measureText(u).width,l===t.text.length-1&&(s+=t.text.length);}});}},{key:"getCharByPosition",value:function value(e,t){for(var i={x:e,y:t},r=0;r<this.chars.length;r++)if(this.getCharBounding(r).isPointInPath(i))return this.chars[r];return!1;}},{key:"getCharBounding",value:function value(e){var t=this.chars[e],i=t.x,r=t.y,n=t.width,o=t.height;return new fL({style:{x:i,y:r-o/10,width:n,height:o,borderWidth:1,background:"rgba(0,0,0,0)"}});}},{key:"transformText",value:function value(e){var t=this.parsedStyle.textTransform;return"capitalize"===t?e=e[0].toUpperCase()+e.substring(1):"lowercase"===t?e.toLowerCase():"uppercase"===t?e.toUpperCase():e;}}]),i;}(_R);function kL(e,t,i){var r,n=i/10;switch(e){case"top":r=t-.5*n;break;case"hanging":r=t+.5*n;break;case"middle":r=t-i/2-.5*n;break;case"ideographic":r=t-i-.5*n;break;case"bottom":r=t-i;break;default:r=t+2*n-i;}return r;}var xL=function(e){lb(i,e);var t=ub(i);function i(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.style,o=Td(r,XA);ak(this,i),tk(rc(e=t.call(this,rk({type:"freeline",style:rk(rk({},JR),{},{startPoint:{x:0,y:0},endPoint:{x:0,y:0},lineEnding:null,borderWidth:2},n)},o))),"shapeType","freeline"),tk(rc(e),"renderPath",void 0),e.getPath();var a=e.getBoundingRect(),s=a.x,l=a.y;return e.updatePosition(s,l),e.updateOrigin(),e;}return ok(i,[{key:"initPath",value:function value(){var e=this.parsedStyle,t=e.startPoint,i=e.endPoint,r=e.lineEnding,n=[rk(rk({},t),{},{step:0,close:!1}),rk(rk({},i),{},{step:1,close:!0})];if(r)for(var o=0;o<r.length;o++)switch(r[o]){case"OpenArrow":this.addOpenArrow(n,o,!1);break;case"ROpenArrow":this.addOpenArrow(n,o,!0);break;case"ClosedArrow":this.addCloseArrow(n,o,!1);break;case"RClosedArrow":this.addCloseArrow(n,o,!0);break;case"Butt":this.addButt(n,o);break;case"Slash":this.addSlash(n,o);break;case"Square":this.addSquare(n,o);break;case"Diamond":this.addDiamond(n,o);break;case"Circle":this.addCircle(n,o);}return n;}},{key:"getRenderPath",value:function value(e){var t=this.getBoundingRect(),i=t.x,r=t.y,n=[];return dk(e).call(e,function(e){!e||Ek(e.x)||Ek(e.y)||n.push({x:e.x-i,y:e.y-r,step:e.step,close:e.close});}),n;}},{key:"updatePoints",value:function value(){var e=this.getLocalPosition();this.updateStyle({startPoint:{x:this.renderPath[0].x+e.x,y:this.renderPath[0].y+e.y},endPoint:{x:this.renderPath[1].x+e.x,y:this.renderPath[1].y+e.y}});}},{key:"updateOrigin",value:function value(){var e=this.getBoundingRect(),t=e.width,i=e.height;this.setOrigin(t/2,i/2);}},{key:"updateStyle",value:function value(e){var t,i=this;dk(t=gk(e)).call(t,function(t){mz(t,e)&&(i.style[t]=e[t]);});}},{key:"updatePosition",value:function value(e,t){this.style.x=e,this.style.y=t;}},{key:"getPath",value:function value(){this.path=this.initPath(),this.renderPath=this.getRenderPath(this.path),this.steps=eL(this.renderPath);}},{key:"getBoundingRect",value:function value(){var e=this.parsedStyle,t=e.borderWidth,i=e.lineCap,r=QR(this.path);if(2===this.path.length)return tL(this.path[0],this.path[1],t.value,i);var n=t.value/2||0;return{x:r.left-n,y:r.top-n,width:r.width+2*n,height:r.height+2*n};}},{key:"getBoundingRectObject",value:function value(){var e=this.getBoundingRect(),t=e.x,i=e.y,r=e.width,n=e.height;return new fL({style:{x:t,y:i,width:r,height:n,borderWidth:1,background:"rgba(0,0,0,0)"}});}},{key:"isPointInPath",value:function value(e){if(!this.getBoundingRectObject().isPointInPath(e))return!1;var t=this.parsedStyle,i=t.startPoint,r=t.endPoint,n=t.borderWidth;return rL(i,r,n.value<20?10:n.value,e);}},{key:"isLineArrow",value:function value(){var e=this.parsedStyle.lineEnding;return!!e&&("None"!==e[0]||"None"!==e[1]);}},{key:"addCircle",value:function value(e,t){var i=this.parsedStyle;hL(e,t,i.startPoint,i.endPoint,i.borderWidth.value);}},{key:"addDiamond",value:function value(e,t){var i=this.parsedStyle;cL(e,t,i.startPoint,i.endPoint,i.borderWidth.value);}},{key:"addSquare",value:function value(e,t){var i=this.parsedStyle;!function(e,t,i,r,n){var o=n,a=r.x,s=r.y;0===t&&(a=i.x,s=i.y);var l={x:a-3*o,y:s-3*o,step:0,close:!1},u={x:a+3*o,y:s-3*o,step:1,close:!1},c={x:a+3*o,y:s+3*o,step:1,close:!1},h={x:a-3*o,y:s+3*o,step:1,close:!0};e.push(l,u,c,h);}(e,t,i.startPoint,i.endPoint,i.borderWidth.value);}},{key:"addSlash",value:function value(e,t){var i=this.parsedStyle;uL(e,t,i.startPoint,i.endPoint,i.borderWidth.value);}},{key:"addButt",value:function value(e,t){var i=this.parsedStyle;lL(e,t,i.startPoint,i.endPoint,i.borderWidth.value);}},{key:"addOpenArrow",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.parsedStyle,n=r.startPoint,o=r.endPoint,a=r.borderWidth;aL(e,t,i,n,o,a.value);}},{key:"addCloseArrow",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.parsedStyle,n=r.startPoint,o=r.endPoint,a=r.borderWidth;sL(e,t,i,n,o,a.value);}}]),i;}(_R),SL=1/0,CL=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1/0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1/0;ak(this,e),tk(this,"minX",void 0),tk(this,"maxX",void 0),tk(this,"minY",void 0),tk(this,"maxY",void 0),tk(this,"rect",void 0),tk(this,"updateId",void 0),this.minX=t,this.maxX=i,this.minY=r,this.maxY=n,this.rect=null,this.updateId=-1;}return ok(e,[{key:"setFromBounds",value:function value(e){return this.minX=e.minX,this.minY=e.minY,this.maxX=e.maxX,this.maxY=e.maxY,this;}},{key:"clear",value:function value(){return this.minX=SL,this.maxX=-1/0,this.minY=SL,this.maxY=-1/0,this;}},{key:"getRect",value:function value(e){var t=this.minX,i=this.minY,r=this.maxX,n=this.maxY;if(t>r||i>n)return new CU(0,0,0,0);var o=e||new CU();return o.update(t,i,r-t,n-i),o;}},{key:"addPoint",value:function value(e){return this.addBounds({minX:e.x,maxX:e.x,minY:e.y,maxY:e.y});}},{key:"addBounds",value:function value(e){var t=TL(this,e);return this.setFromBounds(t);}},{key:"addBoundsMask",value:function value(e,t){var i=VL(e,t);if(i.minX<=i.maxX&&i.minY<=i.maxY){var r=TL(i,this);this.setFromBounds(r);}return this;}},{key:"intersection",value:function value(t){if(r=t,!((i=this).minX<=r.maxX&&i.maxX>=r.minX&&i.minY<=r.maxY&&i.maxY>=r.minY))return null;var i,r,n=VL(this,t);return e.fromBounds(n);}},{key:"union",value:function value(t){var i=TL(this,t);return e.fromBounds(i);}},{key:"addBoundsArea",value:function value(e,t){var i=t.x,r=t.y,n={minX:i,minY:r,maxX:i+t.width,maxY:r+t.height};return this.addBoundsMask(e,n);}},{key:"addFrame",value:function value(e,t){return this.setFromTransformedBounds(e.worldTransform,t);}},{key:"setFromTransformedBounds",value:function value(e,t){for(var i=0;i<2;i++){var r=e.transformPoint({x:i?t.maxX:t.minX,y:i?t.maxY:t.minY});this.addPoint(r);}return this;}},{key:"addQuad",value:function value(e){for(var t=0;t<4;t++)this.addPoint({x:e[2*t],y:e[2*t+1]});}}],[{key:"isEmpty",value:function value(e){return e.minX===e.maxX&&e.minY===e.maxY;}},{key:"fromBounds",value:function value(t){return new e().setFromBounds(t);}},{key:"create",value:function value(){return new e();}}]),e;}();function VL(e,t){return{minX:e.minX>t.minX?e.minX:t.minX,minY:e.minY>t.minY?e.minY:t.minY,maxX:e.maxX<t.maxX?e.maxX:t.maxX,maxY:e.maxY<t.maxY?e.maxY:t.maxY};}function TL(e,t){return{minX:e.minX<t.minX?e.minX:t.minX,minY:e.minY<t.minY?e.minY:t.minY,maxX:e.maxX>t.maxX?e.maxX:t.maxX,maxY:e.maxY>t.maxY?e.maxY:t.maxY};}var IL=function(e){lb(i,e);var t=ub(i);function i(){var e;return ak(this,i),tk(rc(e=t.call(this)),"defaultView",void 0),tk(rc(e),"documentElement",void 0),tk(rc(e),"timeLine",void 0),e.nodeName="document",e.documentElement=new _R({id:"root",style:{visibility:"visible"}}),e.documentElement.ownerDocument=rc(e),e.documentElement.parentNode=rc(e),e.childNodes=[e.documentElement],e;}return ok(i,[{key:"children",get:function get(){return this.childNodes;}},{key:"childElementCount",get:function get(){return this.childNodes.length;}},{key:"firstElementChild",get:function get(){return this.firstChild;}},{key:"lastElementChild",get:function get(){return this.lastChild;}},{key:"createElement",value:function value(e,t){var i=this.defaultView.customElements.get(e);return i||console.warn("Unsupported tagName: ",e),new i(t);}},{key:"getElementById",value:function value(e){return null;}},{key:"getElementsByName",value:function value(e){return this.documentElement.getElementsByTagName(e);}},{key:"getElementsByTagName",value:function value(e){return this.documentElement.getElementsByTagName(e);}},{key:"getElementsByClassName",value:function value(e){return this.documentElement.getElementsByClassName(e);}},{key:"append",value:function value(){var e;return(e=this.documentElement).append.apply(e,arguments);}},{key:"prepend",value:function value(){var e;return(e=this.documentElement).prepend.apply(e,arguments);}},{key:"querySelector",value:function value(e){return this.documentElement.querySelector(e);}},{key:"querySelectorAll",value:function value(e){return this.documentElement.querySelectorAll(e);}},{key:"find",value:function value(e){var t;return gE(t=this.documentElement).call(t,e);}},{key:"findAll",value:function value(e){return this.documentElement.findAll(e);}},{key:"appendChild",value:function value(e){return this.documentElement.appendChild(e);}},{key:"cloneNode",value:function value(e){return this.documentElement.cloneNode(e);}},{key:"insertBefore",value:function value(e,t){return this.documentElement.insertBefore(e,t);}},{key:"removeChild",value:function value(e){return this.documentElement.removeChild(e);}},{key:"replaceChild",value:function value(e,t){return this.documentElement.replaceChild(e,t);}},{key:"destroy",value:function value(){}}]),i;}(OR);function EL(e,t,i){i instanceof bL!=0&&e!==t&&(i.calculateTextPosition(),i.lineWrap(),i.saveCharPosition(),i.updateOrigin());}function PL(e,t,i){if(i instanceof mL!=0&&e!==t){var r=i.getBoundingRect(),n=r.x,o=r.y;i.updatePosition(n,o);}}function BL(e,t,i){if((i instanceof pL||i instanceof wL||i instanceof yL)&&e!==t){i.getPath();var r=i.getBoundingRect(),n=r.x,o=r.y;i.updatePosition(n,o),i.updateOrigin();}}function DL(e,t,i){i instanceof bL!=0&&e!==t&&(i.setFont(),i.calculateTextPosition(),i.lineWrap(),i.saveCharPosition(),i.updateOrigin());}function ML(e,t,i){(i instanceof fL||i instanceof gL)&&e!==t&&i.updateOrigin();}function AL(e,t,i){if(i instanceof xL!=0&&e!==t){i.getPath();var r=i.getBoundingRect(),n=r.x,o=r.y;i.updatePosition(n,o),i.updateOrigin();}}function zL(e,t,i){i instanceof xL==0&&i instanceof wL==0||e!==t&&(i.getPath(),i.updateOrigin());}function UL(e,t,i){t&&(qR[e]=t),i&&(ZR[e]||(ZR[e]=[]),ZR[e].push(i));}function RL(e,t,i){for(var r=0;r<e.length;r++)UL(e[r],t,i);}var LL=function(){function e(t){ak(this,e),tk(this,"contextService",void 0),tk(this,"renderingPlugins",[]),tk(this,"config",{autoRendering:!0}),eM(this.config,t);}return ok(e,[{key:"use",value:function value(e){var t;DT(t=this.renderingPlugins).call(t,e)<0&&this.renderingPlugins.push(e);}},{key:"initPlugins",value:function value(e){var t;dk(t=this.renderingPlugins).call(t,function(t){t.init(e);});}},{key:"destroyPlugins",value:function value(){var e;dk(e=this.renderingPlugins).call(e,function(e){e.destroy();});}},{key:"getPlugins",value:function value(){return this.renderingPlugins;}},{key:"getConfig",value:function value(){return this.config;}}]),e;}(),NL=function(){function e(t){ak(this,e),tk(this,"hooks",{init:Jz.create(),beginFrame:Jz.create(),beforeRender:Jz.create(),render:Jz.create(),afterRender:Jz.create(),putImageData:Jz.create(),endFrame:Jz.create(),destroy:Jz.create(),pointerdown:Jz.create(),pointerup:Jz.create(),pointermove:Jz.create(),pointerout:Jz.create(),pointerover:Jz.create(),pointerCancel:Jz.create(),wheel:Jz.create()}),tk(this,"isInited",!1),tk(this,"zIndexCounter",0),tk(this,"renderingContext",void 0),this.renderingContext=t;}return ok(e,[{key:"init",value:function value(){this.hooks.init.emit(),this.isInited=!0;}},{key:"destroy",value:function value(){this.isInited=!1,this.hooks.destroy.emit();}},{key:"render",value:function value(){var e=this.renderingContext.root;this.zIndexCounter=0,NR.recursiveUpdateHierarchy(e),this.isInited&&(this.renderDisplayObject(e),this.renderingContext.dirty&&(this.hooks.endFrame.emit(),this.renderingContext.dirty=!1),this.renderingContext.renderCondition.clear());}},{key:"renderDisplayObject",value:function value(e){var t,i,r=this;if(e.isVisible){var n=e.sortable;if(n.renderOrder=this.zIndexCounter,this.zIndexCounter+=1,this.renderingContext.dirty||(this.renderingContext.dirty=!0,this.hooks.beginFrame.emit()),e.imageData)this.hooks.putImageData.emit(e);else{this.hooks.beforeRender.emit(e),this.hooks.render.emit(e),this.hooks.afterRender.emit(e);var o=!1;n.dirty&&(n.sorted=UM(t=ET(i=e.childNodes).call(i)).call(t,OL),n.dirty=!1,o=!0);var a=n.sorted||e.childNodes;a.length>1&&UM(a).call(a,function(e,t){return e.style.zIndex-t.style.zIndex;}),dk(a).call(a,function(e){r.renderDisplayObject(e);}),UM(a).call(a,function(e,t){return e.index-t.index;}),o&&e.recursiveCall(function(e){var t=new MR("renderOrderChanged",{renderOrder:e.sortable.renderOrder});e.dispatchEvent(t);});}}}},{key:"dirty",value:function value(){this.renderingContext.renderCondition.add(0);}}]),e;}();function OL(e,t){var i=Number(e.style.zIndex),r=Number(t.style.zIndex);if(i===r&&e.parentNode){var n=e.parentNode.childNodes,o=void 0===n?[]:n;return DT(o).call(o,e)-DT(o).call(o,t);}return i-r;}var WL=function(e){lb(i,e);var t=ub(i);function i(e){var r;ak(this,i),tk(rc(r=t.call(this)),"document",void 0),tk(rc(r),"customElements",void 0),tk(rc(r),"devicePixelRatio",void 0),tk(rc(r),"eventService",void 0),tk(rc(r),"renderingService",void 0),tk(rc(r),"renderingContext",void 0),tk(rc(r),"canvasConfig",void 0),tk(rc(r),"renderer",void 0),tk(rc(r),"supportTouchEvent",void 0),tk(rc(r),"supportPointerEvent",void 0),tk(rc(r),"contextService",void 0);var n=e.renderer,o=e.dpr,a=e.width,s=e.height,l=e.canvas,u=e.supportPointerEvent,c=e.supportTouchEvent;r.supportPointerEvent=null!=u?u:!!YM.PointerEvent,r.supportTouchEvent=null!=c?c:"touchstart"in window;var h=a,d=s,f=o;return l&&(f=o||window.devicePixelRatio||1,h=a||l.width/f,d=s||l.height/f),r.canvasConfig=rk(rk({},e),{},{width:h,height:d,dpr:f}),r.canvasConfig=e,r.renderer=n,r.document=new IL(),r.document.defaultView=rc(r),r.initRenderingContext(),r.renderingService=new NL(r.renderingContext),r.initRenderer(n),r;}return ok(i,[{key:"initRenderingContext",value:function value(){var e=this;this.renderingContext={root:this.document.documentElement,force:!1,dirty:!1,renderCondition:new XB()},this.document.documentElement.addEventListener("child-inserted",function(t){e.mountChildren(t.detail.child);}),this.document.documentElement.addEventListener("child-removed",function(t){e.unmountChildren(t.detail.child);});}},{key:"initRenderer",value:function value(e){this.renderingService.init(),e.initPlugins(this),this.contextService.init(),e.getConfig().autoRendering&&this.render(),this.document.documentElement.recursiveCall(function(e){var t=e.renderable;t&&(t.boundsDirty=!0,t.renderBoundsDirty=!0);}),this.mountChildren(this.document.documentElement);}},{key:"render",value:function value(){var e=new MR("beforeRender",{});this.dispatchEvent(e),this.contextService.clearCanvas(),this.renderingService.render();}},{key:"setDPR",value:function value(e){this.canvasConfig.dpr=e,this.contextService.setDPR(e);}},{key:"resize",value:function value(e,t){this.canvasConfig.width=e,this.canvasConfig.height=t,this.contextService.resize(e,t);}},{key:"getContextService",value:function value(){return this.contextService;}},{key:"getEventService",value:function value(){return this.eventService;}},{key:"appendChild",value:function value(e,t){return this.document.documentElement.appendChild(e,t);}},{key:"insertBefore",value:function value(e,t){return this.document.documentElement.insertBefore(e,t);}},{key:"removeChild",value:function value(e){return this.document.documentElement.removeChild(e);}},{key:"getBoundingClientRect",value:function value(){return this.contextService.getBoundingClientRect();}},{key:"mountChildren",value:function value(e){var t=this;e.recursiveCall(function(e){e.isConnected||(e.isConnected=!0,e.ownerDocument=t.document,e.dispatchEvent(new MR("DOMNodeInsertedIntoDocument",{})));});}},{key:"unmountChildren",value:function value(e){var t,i=this,r=[];e.recursiveCall(function(e){e.isConnected&&r.push(e);}),dk(t=ZM(r).call(r)).call(t,function(e){e.isConnected=!1,e.dispatchEvent(new MR("DOMNodeRemovedFromDocument",{})),e!==i.document.documentElement&&(e.ownerDocument=null);});}}]),i;}(AR),HL=ok(function e(){ak(this,e);}),FL=function(e){lb(i,e);var t=ub(i);function i(){var e,r;ak(this,i);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return tk(rc(r=t.call.apply(t,Ck(e=[this]).call(e,o))),"close",!0),tk(rc(r),"shape",void 0),tk(rc(r),"ctx",void 0),r;}return ok(i,[{key:"render",value:function value(e,t){var i=e.parsedStyle,r=i.background,n=i.borderColor;if("hidden"!==i.visibility){this.renderPath(e,t);var o=!gz(r)&&!r.isNone,a=!gz(n)&&!n.isNone;o&&this.renderFill(e,t),a&&this.renderStroke(e,t);}}},{key:"renderPath",value:function value(e,t){var i;e.getPath(),t.beginPath(),dk(i=e.steps).call(i,function(e){$R(t,e);}),this.close&&e.steps.length>2&&t.closePath();}},{key:"renderFill",value:function value(e,t){var i=e.parsedStyle,r=i.background,n=i.opacity,o=i.fillOpacity;if(t.save(),t.globalAlpha=n*o,uk(r)){this.setShapeGradientOrigin(e,t);for(var a=0;a<r.length;a++)0===a&&this.setShadow(e,t),t.fillStyle=this.getColor(e,r[a],t),iE(t).call(t);}else this.setShadow(e,t),t.fillStyle=r.formatted,iE(t).call(t);t.restore();}},{key:"renderStroke",value:function value(e,t){var i=this,r=e.parsedStyle,n=r.borderWidth,o=r.borderColor,a=r.opacity,s=r.lineCap,l=r.lineJoin,u=r.miterLimit,c=r.lineDash,h=r.lineDashOffset,d=r.borderOpacity;n&&n.value>0&&(t.save(),gz(n)||(t.lineWidth=n.value),t.miterLimit=u,t.globalAlpha=a*d,t.lineCap=s,t.lineJoin=l,t.setLineDash(c),t.lineDashOffset=h.value,uk(o)?(this.setShapeGradientOrigin(e,t),dk(o).call(o,function(r){t.strokeStyle=i.getColor(e,r,t),t.stroke();})):(t.strokeStyle=o.formatted,t.stroke()),t.restore());}},{key:"setShadow",value:function value(e,t){var i=e.parsedStyle,r=i.shadow,n=i.shadowOffsetX,o=i.shadowOffsetY,a=i.shadowBlur,s=i.shadowColor;(r||s)&&(t.shadowOffsetX=(null==n?void 0:n.value)||r[0],t.shadowOffsetY=(null==o?void 0:o.value)||r[1],t.shadowBlur=(null==a?void 0:a.value)||r[2],t.shadowColor=(null==s?void 0:s.formatted)||r[3]);}},{key:"getColor",value:function value(e,t,i){var r;if(1===t.type||2===t.type){var n=e.getBoundingRect(),o=n.width,a=n.height;r=function(e,t){var i=e.type,r=e.steps,n=e.width,o=e.height,a=e.angle,s=e.cx,l=e.cy,u=e.size,c=null;if(1===i){var h=function(e,t,i){var r=i*Math.PI/180,n=0+e/2,o=0+t/2,a=Math.abs(e*Math.cos(r))+Math.abs(t*Math.sin(r));return{x1:n-Math.cos(r)*a/2,y1:o-Math.sin(r)*a/2,x2:n+Math.cos(r)*a/2,y2:o+Math.sin(r)*a/2};}(n,o,a.value),d=h.x1,f=h.y1,v=h.x2,g=h.y2;c=t.createLinearGradient(d,f,v,g);}else if(2===i){var m=function(e,t,i,r,n){var o=i.value,a=r.value;"%"===i.unit&&(o=i.value/100*e),"%"===r.unit&&(a=r.value/100*t);var s=Math.max(sz({x:0,y:0},{x:o,y:a}),sz({x:0,y:t},{x:o,y:a}),sz({x:e,y:t},{x:o,y:a}),sz({x:e,y:0},{x:o,y:a}));return n&&(tz(n)?s=n.value:az(n)&&("closest-side"===n?s=Math.min(o,e-o,a,t-a):"farthest-side"===n?s=Math.max(o,e-o,a,t-a):"closest-corner"===n&&(s=Math.min(sz({x:0,y:0},{x:o,y:a}),sz({x:0,y:t},{x:o,y:a}),sz({x:e,y:t},{x:o,y:a}),sz({x:e,y:0},{x:o,y:a}))))),{x:o,y:a,r:s};}(n,o,s,l,u),y=m.x,p=m.y,w=m.r;c=t.createRadialGradient(y,p,0,y,p,w);}return c&&dk(r).call(r,function(e){var t,i=e.offset,r=e.color;"%"===i.unit&&(null===(t=c)||void 0===t||t.addColorStop(i.value/100,r.toString()));}),c;}(rk(rk({type:t.type},t.value),{},{width:o,height:a}),i);}return r;}},{key:"setShapeGradientOrigin",value:function value(e,t){var i=e.config.type,r=e.parsedStyle,n=r.r,o=r.rx,a=r.ry;switch(i){case"circle":case"arc":t.translate(0-n.value,0-n.value);break;case"ellipse":t.translate(0-o.value,0-a.value);break;default:t.translate(0,0);}}}]),i;}(HL),jL=function(e){lb(i,e);var t=ub(i);function i(){var e;return ak(this,i),(e=t.call(this)).close=!1,e;}return ok(i);}(FL),YL=function(e){lb(i,e);var t=ub(i);function i(){return ak(this,i),t.apply(this,arguments);}return ok(i);}(FL),XL=function(e){lb(i,e);var t=ub(i);function i(){return ak(this,i),t.apply(this,arguments);}return ok(i);}(FL),qL=function(e){lb(i,e);var t=ub(i);function i(){return ak(this,i),t.apply(this,arguments);}return ok(i,[{key:"render",value:function value(e,t){var i=e.parsedStyle,r=i.width,n=i.height;i.src;var o=i.img,a=i.opacity;"hidden"!==i.visibility&&(az(o)||o&&(t.save(),t.globalAlpha=a,o instanceof ImageData?t.putImageData(o,0,0):t.drawImage(o,0,0,r.value,n.value),t.restore()));}}]),i;}(FL),ZL=function(e){lb(i,e);var t=ub(i);function i(){var e;return ak(this,i),(e=t.call(this)).close=!1,e;}return ok(i);}(FL),_L=function(e){lb(i,e);var t=ub(i);function i(){var e;return ak(this,i),(e=t.call(this)).close=!1,e;}return ok(i);}(FL),GL=function(e){lb(i,e);var t=ub(i);function i(){return ak(this,i),t.apply(this,arguments);}return ok(i);}(FL),KL=function(e){lb(i,e);var t=ub(i);function i(){return ak(this,i),t.apply(this,arguments);}return ok(i,[{key:"render",value:function value(e,t){var i=e.parsedStyle,r=i.background,n=i.borderColor;if("hidden"!==i.visibility){var o=!gz(r)&&!r.isNone,a=!gz(n)&&!n.isNone;e.getPath();for(var s=e.steps.length,l=0;l<s;l++){var u,c=e.steps[l];t.beginPath(),dk(u=c.step).call(u,function(e){$R(t,e);}),c.close&&(t.closePath(),o&&this.renderFill(e,t)),a&&this.renderStroke(e,t);}}}}]),i;}(FL),$L=function(e){lb(i,e);var t=ub(i);function i(){return ak(this,i),t.apply(this,arguments);}return ok(i);}(FL),QL=function(e){lb(i,e);var t=ub(i);function i(){return ak(this,i),t.apply(this,arguments);}return ok(i,[{key:"render",value:function value(e,t){e&&this.renderText(e,t);}},{key:"renderText",value:function value(e,t){var i,r=this,n=e.parsedStyle,o=e.lines,a=n.color,s=n.borderWidth,l=n.borderColor,u=n.textBaseLine,c=n.opacity,h=n.textAlign,d=n.lineDash,f=n.textMaxWidth,v=n.fillOpacity,g=n.borderOpacity,m=n.letterSpacing;e.setFont(),t.save(),a&&uk(a)?dk(a).call(a,function(i){t.fillStyle=r.getColor(e,i,t);}):t.fillStyle=a.formatted,l&&uk(l)?dk(l).call(l,function(i){t.strokeStyle=r.getColor(e,i,t);}):t.strokeStyle=l.formatted,this.setShadow(e,t),t.font=e.font,t.globalAlpha=c,t.lineWidth=null==s?void 0:s.value,t.textAlign=h,t.textBaseline=u,t.letterSpacing="".concat(m.value,"px"),t.setLineDash(d),t.beginPath();var y=(null===(i=o[0])||void 0===i?void 0:i.y)||0;dk(o).call(o,function(i){var n=i.text,o=i.y-y;n=e.transformText(n),a&&r.fillText(t,n,0,o,v,null==f?void 0:f.value),s&&s.value&&s.value>0&&r.strokeText(t,n,0,o,g,null==f?void 0:f.value);}),t.closePath(),t.restore();}},{key:"fillText",value:function value(e,t,i,r,n,o){var a,s=!gz(n)&&1!==n;s&&(a=e.globalAlpha,e.globalAlpha=n*n),e.fillText(t,i,r,o),s&&(e.globalAlpha=a);}},{key:"strokeText",value:function value(e,t,i,r,n,o){var a,s=!gz(n)&&1!==n;s&&(a=e.globalAlpha,e.globalAlpha=n),e.strokeText(t,i,r,o),s&&(e.globalAlpha=a);}}]),i;}(FL),JL=function(e){lb(i,e);var t=ub(i);function i(){return ak(this,i),t.apply(this,arguments);}return ok(i);}(FL),eN=function(e){lb(i,e);var t=ub(i);function i(){return ak(this,i),t.apply(this,arguments);}return ok(i,[{key:"render",value:function value(e,t){var i,r=this,n=e.parsedStyle,o=n.background,a=n.borderColor;if("hidden"!==n.visibility){var s=!gz(o)&&!o.isNone,l=!gz(a)&&!a.isNone;e.getPath(),t.beginPath();var u=e.steps.length,c=!0;dk(i=e.steps).call(i,function(i,n){for(var o=0;o<i.step.length;o++)$R(t,i.step[o]);i.close&&(c=!1,t.closePath(),s&&r.renderFill(e,t),l&&r.renderStroke(e,t)),i.close&&n<u-1&&(c=!0,t.beginPath());}),c&&l&&this.renderStroke(e,t);}}}]),i;}(FL),tN=function(){function e(t){ak(this,e),tk(this,"canvasConfig",void 0),tk(this,"container",void 0),tk(this,"canvas",void 0),tk(this,"dpr",void 0),tk(this,"context",void 0),tk(this,"shapeRenderers",{}),this.canvasConfig=t;}return ok(e,[{key:"init",value:function value(){var e=this.canvasConfig,t=e.container,i=e.canvas,r=e.dpr,n=e.willReadFrequently;if(i){this.canvas=i;var o=i.parentElement;t&&o!==t&&t.appendChild(i),this.container=o,this.canvasConfig.container=o;}else if(t&&(this.container=t,az(t)&&(this.container=document.getElementById(t)),this.container)){var a=document.createElement("canvas");this.container.appendChild(a),this.canvas=a;}this.context=this.canvas.getContext("2d",{willReadFrequently:n}),this.dpr=r||qz(),this.resize(this.canvasConfig.width,this.canvasConfig.height);}},{key:"registerShapeRenderer",value:function value(e,t){this.shapeRenderers[e]||(this.shapeRenderers[e]=t);}},{key:"getShapeRenderer",value:function value(e){return this.shapeRenderers[e];}},{key:"destroy",value:function value(){var e=this.canvas,t=this.container;t&&(null==e?void 0:e.parentNode)&&t.removeChild(e);}},{key:"resize",value:function value(e,t){var i=this.canvas,r=this.dpr;i&&(i.width=e*r,i.height=t*r,i.style.width="".concat(e,"px"),i.style.height="".concat(t,"px"),this.context.scale(r,r));}},{key:"getDPR",value:function value(){return this.dpr;}},{key:"setDPR",value:function value(e){this.canvasConfig.dpr=e,this.dpr=e;}},{key:"getContext",value:function value(){return this.context;}},{key:"getDomElement",value:function value(){return this.canvas;}},{key:"getCanvas",value:function value(){return this.canvas;}},{key:"setCursor",value:function value(e){var t;(null==this||null===(t=this.container)||void 0===t?void 0:t.style)&&(this.container.style.cursor=e);}},{key:"getBoundingClientRect",value:function value(){var e;return null===(e=this.canvas)||void 0===e?void 0:e.getBoundingClientRect();}},{key:"clearCanvas",value:function value(){this.canvas&&(this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.scale(this.dpr,this.dpr));}}]),e;}(),iN=function(){function e(){ak(this,e),tk(this,"restoreStack",[]);}return ok(e,[{key:"init",value:function value(e){var t=this,i=e.renderingService.hooks;i.init.on(function(){}),i.destroy.on(function(){}),i.beginFrame.on(function(){}),i.endFrame.on(function(){var i,r=e.contextService.getContext();dk(i=t.restoreStack).call(i,function(){r.restore();}),t.restoreStack=[];}),i.render.on(function(i){t.renderDisplayObject(i,e);}),i.putImageData.on(function(t){if(t.imageData){var i=t.getPosition(),r=i.x,n=i.y,o=e.contextService.getContext(),a=e.contextService.getDPR();o.putImageData(t.imageData,Math.floor(r*a+1),Math.floor(n*a+1));}});}},{key:"renderDisplayObject",value:function value(e,t){if(e.isVisible){for(var i=t.contextService,r=i.getContext(),n=this.restoreStack[this.restoreStack.length-1];n&&e.parentNode!==n;)r.restore(),this.restoreStack.pop(),n=this.restoreStack[this.restoreStack.length-1];r.save(),this.applyTransform(r,e);var o=e.style.clipPath;o&&(r.save(),this.applyTransform(r,o),r.restore(),r.clip()),this.useAnchor(r,e);var a=i.getShapeRenderer(e.shapeType);a&&(a.render(e,r),e.clippable&&r.clip()),this.restoreStack.push(e);}}},{key:"applyTransform",value:function value(e,t){var i,r,n;t.externalMatrixes.length&&dk(i=ZM(r=ET(n=t.externalMatrixes).call(n)).call(r)).call(i,function(t){var i=t.a,r=t.b,n=t.c,o=t.d,a=t.e,s=t.f;e.transform(i,r,n,o,a,s);});var o=t.getLocalTransform(),a=o.a,s=o.b,l=o.c,u=o.d,c=o.e,h=o.f;e.transform(a,s,l,u,c,h);}},{key:"applyAttributes",value:function value(e,t,i){}},{key:"useAnchor",value:function value(e,t){var i=(t.parsedStyle||{}).anchor;if(i&&(0!==i.x||0!==i.y)){var r=t.getGeometryBounds().getRect();e.translate(-(i&&i.x||0)*r.width,-(i&&i.y||0)*r.height);}}},{key:"destroy",value:function value(){}}]),e;}();tk(iN,"moduleName",void 0);var rN=function(){function e(){ak(this,e);}return ok(e,[{key:"init",value:function value(e){var t,i=new tN(e.canvasConfig);e.contextService=i,dk(t=[{name:"arc",renderer:new jL()},{name:"circle",renderer:new YL()},{name:"ellipse",renderer:new XL()},{name:"freeline",renderer:new eN()},{name:"image",renderer:new qL()},{name:"line",renderer:new ZL()},{name:"path",renderer:new _L()},{name:"polygon",renderer:new GL()},{name:"polyline",renderer:new KL()},{name:"rect",renderer:new $L()},{name:"stampPath",renderer:new JL()},{name:"text",renderer:new QL()}]).call(t,function(e){var t=e.name,r=e.renderer;i.registerShapeRenderer(t,r);});}},{key:"destroy",value:function value(){}}]),e;}(),nN=function(e){lb(i,e);var t=ub(i);function i(e){var r;return ak(this,i),(r=t.call(this,e)).use(new rN()),r.use(new iN()),r;}return ok(i);}(LL),oN=function(e){lb(i,e);var t=ub(i);function i(e){var r;return ak(this,i),tk(rc(r=t.call(this,e)),"name",void 0),tk(rc(r),"type",void 0),tk(rc(r),"owners",[]),tk(rc(r),"isDestroyed",!1),r.name=e.name,r.type=e.type,r.children=e.children||[],r;}return ok(i,[{key:"destroy",value:function value(){this.isDestroyed||(this.children=null,this.owners=null,this.isDestroyed=!0);}},{key:"count",value:function value(){return this.children.length;}},{key:"addOwner",value:function value(e){var t=this.owners;return DT(t).call(t,e)<0&&(t.push(e),!0);}},{key:"removeOwner",value:function value(e){var t=this.owners,i=DT(t).call(t,e);return!(i<0||(sI(t).call(t,i,1),0));}}]),i;}(TU),aN=function(){function e(t){ak(this,e),tk(this,"docs",[]),tk(this,"isDestroyed",!1),this.docs=[];}return ok(e,[{key:"destroy",value:function value(){var e;this.isDestroyed||(dk(e=this.docs).call(e,function(e){e.destroy();}),this.docs=[],this.isDestroyed=!0);}},{key:"addDoc",value:function value(e,t){var i=this.getDoc(e.uid);return i||(i=new oN(e),this.docs.push(i)),t&&i.addOwner(t),i;}},{key:"getDoc",value:function value(e){var t;return gE(t=this.docs).call(t,function(t){return t.uid===e;});}},{key:"getIndexByUid",value:function value(e){var t;return bI(t=this.docs).call(t,function(t){return t.uid===e;});}},{key:"removeDoc",value:function value(e){var t,i=this.getIndexByUid(e);return i>-1&&(sI(t=this.docs).call(t,i,1),!0);}},{key:"removePage",value:function value(e,t){var i=this.getDoc(e);return!!i&&i.remove(t);}}]),e;}(),sN=function(){function e(){ak(this,e),tk(this,"canvas",void 0),tk(this,"renderer",void 0),tk(this,"root",void 0),this.renderer=new nN(),this.canvas=new WL({renderer:this.renderer,width:10,height:10,canvas:document.createElement("canvas"),dpr:1,willReadFrequently:!0}),this.root=this.canvas.document.documentElement;}return ok(e,[{key:"render",value:function value(e){var t,i,r=this;dk(t=ET(i=this.root.children).call(i)).call(t,function(e){r.root.removeChild(e);}),this.root.appendChild(e),this.canvas.resize(e.width,e.height),this.canvas.render();}},{key:"clear",value:function value(){var e,t,i=this;dk(e=ET(t=this.root.children).call(t)).call(e,function(e){i.root.removeChild(e);}),this.root.sortable.sorted=[];}},{key:"getCanvas",value:function value(){return this.canvas.contextService.getDomElement();}}]),e;}(),lN=function(e){lb(i,e);var t=ub(i);function i(){var e,r;ak(this,i);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return tk(rc(r=t.call.apply(t,Ck(e=[this]).call(e,o))),"next",void 0),r;}return ok(i,[{key:"setNext",value:function value(e){this.next=e;}},{key:"getNext",value:function value(){return this.next;}}]),i;}(IU),uN=function uN(e){if(e.layoutStatus.skipCalcZoom)return e.layoutStatus.skipCalcZoom=!1,!0;var t=e.layoutStatus,i=t.viewWidth,r=t.viewHeight,n=t.calcHeight,o=t.calcViewWidth,a=t.calcViewHeight,s=t.scrollbarWidth;t.validVisualWidth;var l,u=t.validLayoutWidth,c=t.validLayoutHeight,h=t.fixedWidth,d=t.fixedHeight,f=e.layoutStatus,v=f.isScrollbarChanged,g=f.isScrollbarXAppeared,m=e.direction,y=i,p=r,w=0,b=1;(w=u*(b=n<=a?1:a/n))>o?(g||(g=!0,v=!0,b=n<=a-s?1:(a-s)/n),w=u*b):g&&(g=!1,v=!0),l=c*b;var k="vertical"===m?(y-w-h)/2:0,x="vertical"===m?0:(p-l-d)/2;return k<0&&(k=0),x<0&&(x=0),e.updateLayoutStatus({layoutLeft:k,layoutTop:x,zoom:b,visualWidth:y,visualHeight:p,currentLayoutWidth:w+h,currentLayoutHeight:l+d,isScrollbarChanged:v,isScrollbarXAppeared:g}),e.setZoom(b),!v||"break";},cN=function cN(e){if(e.layoutStatus.skipCalcZoom)return e.layoutStatus.skipCalcZoom=!1,!0;var t=e.layoutStatus,i=t.viewWidth,r=t.viewHeight;t.scrollbarWidth;var n,o,a=t.validVisualWidth,s=t.validVisualHeight,l=t.validLayoutWidth,u=t.validLayoutHeight,c=t.fixedWidth,h=t.fixedHeight,d=t.zoom,f=e.layoutStatus,v=f.isScrollbarXAppeared,g=f.isScrollbarYAppeared,m=f.isScrollbarChanged,y=e.direction,p=r,w=i;n=l*d,o=u*d,Math.floor(n)>a?v||(v=!0,m=!0):v&&(v=!1,m=!0),Math.floor(o)>s?g||(g=!0,m=!0):g&&(g=!1,m=!0);var b="vertical"===y?(w-n-c)/2:0,k="vertical"===y?0:(p-o-h)/2;return b<0&&(b=0),k<0&&(k=0),e.updateLayoutStatus({layoutLeft:b,layoutTop:k,visualWidth:w,visualHeight:p,currentLayoutWidth:n+c,currentLayoutHeight:o+h,isScrollbarXAppeared:v,isScrollbarYAppeared:g,isScrollbarChanged:m}),e.setZoom(d),!m||"break";},hN=function hN(e){if(e.layoutStatus.skipCalcZoom)return e.layoutStatus.skipCalcZoom=!1,!0;var t=e.layoutStatus,i=t.viewWidth,r=t.viewHeight,n=t.calcWidth,o=t.calcViewWidth;t.calcViewHeight;var a,s=t.scrollbarWidth,l=t.validVisualHeight,u=t.validLayoutWidth,c=t.validLayoutHeight,h=t.fixedWidth,d=t.fixedHeight,f=e.layoutStatus,v=f.isScrollbarChanged,g=f.isScrollbarYAppeared,m=e.direction,y=r,p=i,w=0,b=1;(w=c*(b=n<=o?1:o/n))>l?(g||(g=!0,v=!0,b=n<=o-s?1:(o-s)/n),w=c*b):g&&(g=!1,v=!0),a=u*b;var k="vertical"===m?0:(p-a-h)/2,x="vertical"===m?(y-w-d)/2:0;return k<0&&(k=0),x<0&&(x=0),e.updateLayoutStatus({layoutLeft:k,layoutTop:x,zoom:b,visualWidth:p,visualHeight:y,currentLayoutWidth:a+h,currentLayoutHeight:w+d,isScrollbarYAppeared:g,isScrollbarChanged:v}),e.setZoom(b),!v||"break";},dN=function dN(e){if(e.layoutStatus.skipCalcZoom)return e.layoutStatus.skipCalcZoom=!1,!0;var t=e.layoutStatus,i=t.calcWidth,r=t.calcHeight;return i/t.calcViewWidth>=r/t.calcViewHeight?hN(e):uN(e);},fN=function(e){lb(i,e);var t=ub(i);function i(){var e;return ak(this,i),(e=t.call(this)).addStrategy("width",hN),e.addStrategy("height",uN),e.addStrategy("window",dN),e.addStrategy("none",cN),e;}return ok(i,[{key:"layout",value:function value(e){var t=this.next,i=e.fitType;"break"!==this.executeStrategy(i,e)&&t&&t.layout(e);}}]),i;}(lN),vN=function vN(e){var t=e.currentPage;if(t){var i=e.layoutStatus,r=i.defaultWidth,n=i.defaultHeight,o=i.viewWidth,a=i.viewHeight,s=e.viewer.context.getMargin(),l=e.borderWidth,u=t.image.style.img,c=t.realTimeWidth||(null==u?void 0:u.naturalWidth)||r,h=t.realTimeHeight||(null==u?void 0:u.naturalHeight)||n;e.viewer.context.config.enableSingleModeBorder||(l=0);var d=2*l,f=2*s,v=o-d-f,g=a-d-f;e.updateLayoutStatus({layoutWidth:c,layoutHeight:h,calcWidth:c,calcHeight:h,calcViewWidth:v,calcViewHeight:g,validVisualWidth:v,validVisualHeight:g,validLayoutWidth:c,validLayoutHeight:h,fixedWidth:f+d,fixedHeight:f+d});}},gN=function gN(e){if(!e.total)return!1;var t=e.layoutStatus,i=t.viewWidth,r=t.viewHeight,n=t.isScrollbarAppeared,o=t.isScrollbarChanged,a=e.layoutStatus.scrollbarWidth,s=e.total,l=e.row,u=e.column,c=e.direction,h=e.enableDWT1x1,d=e.viewer.context.getMargin(),f=e.viewer.context.getGap();1===l&&1===u&&h&&(d=0),u*l<s?n||(n=!0,o=!0,"vertical"===c?i-=a:r-=a):n&&(n=!1,o=!0);var v="vertical"===c,g=(i-(u-1)*f-2*d)/u,m=(r-(l+1)*f)/l;1===l&&1===u&&h&&(m=r),v||(m=(r-(l-1)*f-2*d)/l,g=(i-(u+1)*f)/u,1===l&&1===u&&h&&(g=i));var y=Math.max,p=Math.ceil,w=v?y(l,p(s/u)):l,b=v?u:y(u,p(s/l)),k=g*b+(b-1)*f+2*d,x=m*w+(w-1)*f+2*d;return e.updateLayoutStatus({rowHeightArray:[m],columnWidthArray:[g],layoutWidth:k,layoutHeight:x,skipCalcZoom:!0,layoutLeft:0,layoutTop:0,visualWidth:i,visualHeight:r,currentLayoutWidth:k,currentLayoutHeight:x,isScrollbarAppeared:n,isScrollbarChanged:o,realRow:w,realCol:b}),!o||"break";},mN=function mN(e){if(!e.total)return!1;var t=e.layoutStatus,i=t.viewWidth,r=t.viewHeight,n=e.current,o=e.getChildByIndex(n-1),a=e.getChildByIndex(n+1);if(o){var s=yN(e,o),l=s.left,u=s.top;o.updateStyle({x:-i+l,y:u,width:i,height:r});}if(a){var c=yN(e,a),h=c.left,d=c.top;a.updateStyle({x:i+h,y:d,width:i,height:r});}return"break";};function yN(e,t){var i,r,n=e.layoutStatus,o=n.viewWidth,a=n.viewHeight,s=e.borderWidth;e.viewer.context.config.enableSingleModeBorder||(s=0);var l=e.viewer.context.getMargin(),u=t.image.style.img,c=t.realTimeWidth||(null==u?void 0:u.naturalWidth)||e.layoutStatus.defaultWidth,h=t.realTimeHeight||(null==u?void 0:u.naturalHeight)||e.layoutStatus.defaultHeight,d=o-2*l-2*s,f=a-2*l-2*s,v=0,g=0,m=1;c<=d&&h<=f?(v=c,g=h,m=1):c/h>d/f?(v=d,g=h*(m=d/c)):(g=f,v=c*(m=f/h));var y=(d-c*m)/2+s/2+l,p=(f-h*m)/2+s/2+l;y=Math.max(l+s/2,y),p=Math.max(l+s/2,p);var w=c*(1-m)/2,b=h*(1-m)/2;return t.borderBox.updateStyle({x:0,y:0,width:v+2*s,height:g+2*s,borderWidth:s}),t.imageContainer.setLocalScale(1),t.imageContainer.updateStyle({x:s-w,y:s-b,width:c,height:h}),t.imageContainer.setLocalScale(m,m,1),t.zoom=m,t.image.updateStyle({x:0,y:0,width:(null===(i=t.image.style.img)||void 0===i?void 0:i.naturalWidth)||0,height:(null===(r=t.image.style.img)||void 0===r?void 0:r.naturalHeight)||0}),t.updateStyle({visibility:"visible"}),t.imageContainer.updateStyle({visibility:"visible"}),t.borderBox.updateStyle({visibility:"visible"}),t.image.updateStyle({visibility:"visible"}),{left:y-s/2,top:p-s/2};}var pN=function(e){lb(i,e);var t=ub(i);function i(){var e;return ak(this,i),(e=t.call(this)).addStrategy("single",vN),e.addStrategy("multiple",gN),e.addStrategy("slide",mN),e;}return ok(i,[{key:"layout",value:function value(e){var t=this.next,i=e.displayMode;"break"!==this.executeStrategy(i,e)&&t&&t.layout(e);}}]),i;}(lN),wN=function wN(e){var t=e.layoutStatus,i=t.zoom,r=t.visualWidth,n=t.visualHeight,o=t.defaultWidth,a=t.defaultHeight,s=t.currentLayoutWidth,l=t.currentLayoutHeight,u=e.currentPage,c=e.viewer.context.getMargin(),h=e.borderWidth;if(u){e.viewer.context.uiService.updateScrollContentSize(s,l);var d=e.viewer.context.uiService.scrollContainer,f=d.scrollLeft,v=d.scrollTop;e.setPosition({x:-f,y:-v}),e.viewer.context.config.enableSingleModeBorder||(h=0);var g=u.image.style.img,m=u.realTimeWidth||(null==g?void 0:g.naturalWidth)||o,y=u.realTimeHeight||(null==g?void 0:g.naturalHeight)||a,p=m*i,w=y*i,b=(r-p)/2-h/2,k=(n-w)/2-h/2;b=Math.max(c+h/2,b),k=Math.max(c+h/2,k);var x=m*(1-i)/2,S=y*(1-i)/2;u.updateStyle({x:b-h/2,y:k-h/2,width:p+2*h,height:w+2*h,borderWidth:h}),u.borderBox.updateStyle({x:0,y:0,width:p+2*h,height:w+2*h,borderWidth:h}),u.image.updateStyle({width:(null==g?void 0:g.naturalWidth)||0,height:(null==g?void 0:g.naturalHeight)||0}),u.imageContainer.setLocalScale(1),u.imageContainer.updateStyle({x:h-x,y:h-S,width:m,height:y}),u.imageContainer.setLocalScale(i),u.zoom=i;}},bN=function bN(e){var t=e.layoutStatus,i=t.rowHeightArray,r=t.columnWidthArray,n=t.currentLayoutWidth,o=t.currentLayoutHeight,a=e.children,s=e.row,l=e.column,u=e.direction,c=e.borderWidth,h=e.hoveredBorderWidth,d=e.selectedBorderWidth,f=e.enableDWT1x1,v=e.viewer.context.getMargin(),g=e.viewer.context.getGap();1===s&&1===l&&f&&(v=0);var m=cb(r,1)[0],y=cb(i,1)[0];e.viewer.context.uiService.updateScrollContentSize(n,o);var p=e.viewer.context.uiService.scrollContainer,w=p.scrollLeft,b=p.scrollTop;e.setPosition({x:-w,y:-b}),dk(a).call(a,function(t,i){var r,n=c;t.isHovered&&(n=h),DT(r=e.selected).call(r,t.uid)>-1&&(n=d);var o=i%l,a=Math.floor(i/l);"horizontal"===u&&(o=Math.floor(i/s),a=i%s);var f=v+o*(g+m)+n/2,p=v+a*(g+y)+n/2,w=m-2*n,b=y-2*n,k=t.getImage().style.img,x=t.realTimeWidth||(null==k?void 0:k.naturalWidth)||0,S=t.realTimeHeight||(null==k?void 0:k.naturalHeight)||0,C=0,V=0,T=x,I=S,E=1;(x>w||S>b)&&(x/S>w/b?(T=w,I=S*(E=w/x)):(I=b,T=x*(E=b/S))),C+=(w-T)/2,V+=(b-I)/2,C+=n,V+=n;var P=x*(1-E)/2,B=S*(1-E)/2;t.image.updateStyle({width:(null==k?void 0:k.naturalWidth)||0,height:(null==k?void 0:k.naturalHeight)||0}),t.imageContainer.updateStyle({x:C-P,y:V-B,width:x,height:S}),t.imageContainer.setLocalScale(E,E,1),t.zoom=E,t.updateStyle({x:f-n/2,y:p-n/2,width:m,height:y}),t.borderBox.updateStyle({x:0,y:0,width:m,height:y});});},kN=function(e){lb(i,e);var t=ub(i);function i(){var e;return ak(this,i),(e=t.call(this)).addStrategy("single",wN),e.addStrategy("multiple",bN),e;}return ok(i,[{key:"layout",value:function value(e){var t=this.next,i=e.displayMode;this.executeStrategy(i,e),t&&t.layout(e);}}]),i;}(lN);function xN(e){var t,i=e.current,r=e.total,n=e.currentPage,o=e.preloadCount;if(e.topPageUid,n){var a=i-o;a<0&&(a=0);var s=i+o;s>=r&&(s=r-1),dk(t=e.children).call(t,function(e,t){var i=e.uid===n.uid,r=t>=a&&t<=s,o=e.isEdited,l=e.isUpdated,u=e.isVisible;((o||l)&&i||!u&&i)&&(e.isPageRendered=!0),e.updateStyle({visibility:i?"visible":"hidden"}),e.borderBox.updateStyle({visibility:i?"visible":"hidden"}),e.image.updateStyle({visibility:i?"visible":"hidden"}),e.imageContainer.updateStyle({visibility:i?"visible":"hidden"}),e.isPreload=r;});}}function SN(e){var t,i=e.layoutStatus,r=i.rowHeightArray,n=i.columnWidthArray,o=i.viewWidth,a=i.viewHeight,s=e.total,l=e.row,u=e.column,c=e.direction,h=e.preloadCount,d=e.topPageUid,f=e.enableDWT1x1,v=e.viewer.context.getMargin(),g=e.viewer.context.getGap();1===l&&1===u&&f&&(v=0);var m=Math.ceil,y=Math.floor,p="vertical"===c,w=p?u:m(s/l),b=p?m(s/u):l,k=0,x=w-1,S=0,C=b-1;if(p)for(var V=0;V<b;V++){var T=0===V?v:g,I=V===b-1?v:g,E=e.children[V*w],P=cb(r,1)[0];if(E){var B=E.getPosition().y;if(B-T<=1&&B+P>1&&(S=V),B-a<-1&&B+P+I-a>=-1){C=V;break;}}}else for(var D=0;D<w;D++){var M=0===D?v:g,A=D===w-1?v:g,z=e.children[D*b],U=cb(n,1)[0];if(z){var R=z.getPosition().x;if(R-M<=1&&R+U>1&&(k=D),R-o<=-1&&R+U+A-o>=-1){x=D;break;}}}var L=null;dk(t=e.children).call(t,function(e,t){var i=p?y(t/u):t%l,r=p?t%u:y(t/l),n=i>=S&&i<=C&&r>=k&&r<=x,o=i>=S-h&&i<=C+h&&r>=k-h&&r<=x+h;n&&!L&&(L=e.uid);var a=e.isEdited,s=e.isUpdated,c=e.isVisible;((a||s)&&n||!c&&n)&&(e.isPageRendered=!0),e.updateStyle({visibility:n?"visible":"hidden"}),e.borderBox.updateStyle({visibility:n?"visible":"hidden"}),e.imageContainer.updateStyle({visibility:n?"visible":"hidden"}),e.image.updateStyle({visibility:n?"visible":"hidden"}),e.isPreload=o;var d={x:r<=k?"ahead":r>=x?"behind":"inside",y:i<=S&&i<C?"ahead":i>=C&&i>=S?"behind":"inside",column:r,row:i};e.viewportPosition=d;}),L&&L!==d&&(e.isTopPageChanged=!0,e.topPageUid=L);}var CN=function(e){lb(i,e);var t=ub(i);function i(){var e;return ak(this,i),(e=t.call(this)).addStrategy("single",xN),e.addStrategy("multiple",SN),e;}return ok(i,[{key:"layout",value:function value(e){var t=this.next,i=e.displayMode;this.executeStrategy(i,e),t&&t.layout(e);}}]),i;}(lN),VN=function(){function e(){ak(this,e),tk(this,"viewers",void 0),tk(this,"group",{}),tk(this,"isDestroyed",!1),this.viewers=[];}return ok(e,[{key:"destroy",value:function value(){this.isDestroyed||(this.viewers=[],this.viewers=null,this.group=null,this.isDestroyed=!0);}},{key:"addViewer",value:function value(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(DT(t=this.viewers).call(t,e)>-1)return!1;var r=[];return this.group[i]?r=this.group[i]:this.group[i]=r,r.push(e.uid),this.viewers.push(e),!0;}},{key:"removeViewer",value:function value(e){var t,i,r=bI(t=this.viewers).call(t,function(t){return t.uid===e.uid;});if(r<0)return!1;var n=this.group[e.groupUid],o=DT(n).call(n,e.uid);return sI(n).call(n,o,1),0===n.length&&delete this.group[e.groupUid],sI(i=this.viewers).call(i,r,1),e.destroy(),!0;}},{key:"getViewer",value:function value(e){var t=this.viewers;return e?gE(t).call(t,function(t){return t.uid===e;}):t[0]||null;}},{key:"getAllViewers",value:function value(){var e;return ET(e=this.viewers).call(e);}},{key:"getGroup",value:function value(e){var t=this.getViewer(e);return t?this.group[t.groupUid]:null;}}]),e;}();function TN(){onmessage=function onmessage(e){var t=e.data.core,i=e.data.sourceWidth,r=e.data.sourceHeight,n=e.data.width,o=e.data.height,a=e.data.source.data,s=n*o*4,l=new ArrayBuffer(s),u=null;try{u=new Uint8ClampedArray(l,0,s);}catch(e){u=new Uint8Array(l,0,s);}for(var c=0;c<o;c++)for(var h=c*r/o,d=Math.floor(h),f=1-(h-d),v=d,g=(c+1)*r/o,m=Math.floor(g-1e-5),y=g-m,p=m,w=c*n*4,b=0;b<n;b++){var k=b*i/n,x=Math.floor(k),S=1-(k-x),C=x,V=(b+1)*i/n,T=Math.floor(V-1e-5),I=V-T,E=T,P=0,B=0,D=0,M=0,A=0,z=255,U=void 0,R=void 0,L=(v+1)*i*4+4*C;for(U=v+1;U<p;++U){var N=z;P+=a[L+2]*S*N,B+=a[L+1]*S*N,D+=a[L]*S*N,M+=a[L+3]*S*N,A+=z*S,L+=4*i;}var O=(v+1)*i*4+4*E;for(U=v+1;U<p;++U){var W=z;P+=a[O+2]*I*W,B+=a[O+1]*I*W,D+=a[O]*I*W,M+=a[O+3]*I*W,A+=z*I,O+=4*i;}var H=v*i*4+4*(C+1);for(R=C+1;R<E;++R){var F=z;P+=a[H+2]*f*F,B+=a[H+1]*f*F,D+=a[H]*f*F,M+=a[H+3]*f*F,A+=z*f,H+=4;}var j=p*i*4+4*(C+1);for(R=C+1;R<E;++R){var Y=z;P+=a[j+2]*y*Y,B+=a[j+1]*y*Y,D+=a[j]*y*Y,M+=a[j+3]*y*Y,A+=z*y,j+=4;}for(U=v+1;U<p;++U){var X=U*i*4+4*(C+1);for(R=C+1;R<E;++R){var q=z;P+=a[X+2]*q,B+=a[X+1]*q,D+=a[X]*q,M+=a[X+3]*q,A+=q,X+=4;}}var Z=v*i*4+4*C,_=z;P+=a[Z+2]*(f*S)*_,B+=a[Z+1]*(f*S)*_,D+=a[Z]*(f*S)*_,M+=a[Z+3]*(f*S)*_,A+=z*(f*S);var G=z;P+=a[(Z=v*i*4+4*E)+2]*(f*I)*G,B+=a[Z+1]*(f*I)*G,D+=a[Z]*(f*I)*G,M+=a[Z+3]*(f*I)*G,A+=z*(f*I);var K=z;P+=a[(Z=p*i*4+4*C)+2]*(y*S)*K,B+=a[Z+1]*(y*S)*K,D+=a[Z]*(y*S)*K,M+=a[Z+3]*(y*S)*K,A+=z*(y*S);var $=z;P+=a[(Z=p*i*4+4*E)+2]*(y*I)*$,B+=a[Z+1]*(y*I)*$,D+=a[Z]*(y*I)*$;var Q=(M+=a[Z+3]*(y*I)*$)/(A+=z*(y*I)),J=0,ee=0,te=0;0!==Q&&(J=P/A,ee=B/A,te=D/A),J+=.5,ee+=.5,te+=.5,Q+=.5,u[w]=Math.floor(te),u[w+=1]=Math.floor(ee),u[w+=1]=Math.floor(J),u[w+=1]=Math.floor(Q),w+=1;}var ie={core:t,target:u,taskUid:e.data.taskUid,callbackId:e.data.callbackId};try{postMessage(ie,[u.buffer]);}catch(e){postMessage(ie,null);}u=null;};}var IN=function(){function e(t,i,r){var n=this;ak(this,e),tk(this,"worker",void 0),tk(this,"id",void 0),tk(this,"manager",void 0),tk(this,"callbacks",{}),tk(this,"busy",!1),tk(this,"counter",0),tk(this,"tasks",[]),this.worker=t,this.id=i,this.manager=r,this.worker.addEventListener("message",function(e){n.onMessage(e);},!1);}return ok(e,[{key:"setBusy",value:function value(e){if(this.busy=e,!e)if(this.tasks.length){var t=this.tasks.shift();this.send(t);}else this.worker.terminate(),this.manager.removeActor(this);}},{key:"isBusy",value:function value(){return this.busy;}},{key:"getWorker",value:function value(){return this.worker;}},{key:"onMessage",value:function value(e){this.setBusy(!1);var t=e.data.callbackId,i=t?this.callbacks[t]:null;i&&i(e.data),delete this.callbacks[t];}},{key:"send",value:function value(e,t){var i,r;if(this.busy)this.tasks.push(rk({},e));else{this.setBusy(!0);var n=Ck(i=Ck(r="".concat(this.id,"-")).call(r,e.action,"-cb-")).call(i,this.counter);e.callback&&(this.callbacks[n]=e.callback,this.counter+=1),e.callbackId=n;var o=rk(rk({},e.data),{},{callbackId:n});t?this.worker.postMessage(o,[t.data.buffer]):this.worker.postMessage(o);}}}]),e;}(),EN=function(){function e(t,i){ak(this,e),tk(this,"concurrency",1),tk(this,"actors",[]),tk(this,"workerUrl",void 0),this.workerUrl=t,this.concurrency=i;}return ok(e,[{key:"send",value:function value(e,t){this.getActor().send(e,t);}},{key:"getActor",value:function value(){var e,t=zx(e=this.actors).call(e,function(e){return!e.isBusy();})[0];if(t)return t;if(this.actors.length<this.concurrency){var i=new Worker(this.workerUrl),r=new IN(i,this.actors.length,this);return this.actors.push(r),r;}var n=Math.floor(Math.random()*this.concurrency);return this.actors[n];}},{key:"removeActor",value:function value(e){var t,i,r=DT(t=this.actors).call(t,e);sI(i=this.actors).call(i,r,1);}},{key:"clear",value:function value(){var e,t=function(e,t){var i=void 0!==Mu&&Cc(e)||e["@@iterator"];if(!i){if(hc(e)||(i=jh(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0,n=function n(){};return{s:n,n:function n(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]};},e:function e(_e2){throw _e2;},f:n};}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var o,a=!0,s=!1;return{s:function s(){i=i.call(e);},n:function n(){var e=i.next();return a=e.done,e;},e:function e(_e3){s=!0,o=_e3;},f:function f(){try{a||null==i.return||i.return();}finally{if(s)throw o;}}};}(this.actors);try{for(t.s();!(e=t.n()).done;){e.value.getWorker().terminate();}}catch(e){t.e(e);}finally{t.f();}this.actors=[];}}]),e;}(),PN=function(){function e(){ak(this,e);}return ok(e,[{key:"apply",value:function value(e){this.listenSpaceHooks(e),this.listenDVSHooks(e);}},{key:"listenDVSHooks",value:function value(e){var t=this,i=e.hooksService.hooks,r=function r(t){var i=e.spaceService.space;t.trigger!==i.uid&&i.removeSource(t.removedUids);},n=function n(t){var i=e.spaceService.space;t.trigger!==i.uid&&i.move(rk({emit:!1},t));},o=function o(t){var i=e.spaceService.space;t.trigger!==i.uid&&i.switch(rk({emit:!1},t));},a=function a(t){var i=e.spaceService.space;t.trigger!==i.uid&&i.reorder(rk({emit:!1},t));},s=function s(){t.listenSpaceHooks(e);};i.remove.on(r),i.move.on(n),i.switch.on(o),i.reorder.on(a),i.afterSetSpace.on(s),e.hooksService.hooks.destroy.on(function(){i.remove.off(r),i.move.off(n),i.switch.off(o),i.reorder.off(a),i.afterSetSpace.off(s);});}},{key:"listenSpaceHooks",value:function value(e){var t=e.spaceService.space.hooks,i=e.hooksService.hooks,r=function r(e){var t=e.uid;i.removeDoc.emit(t);},n=function n(e){var t=e.name,r=e.uid;i.renameDoc.emit(t,r);},o=function o(t){var i=t.node,r=t.config,n=t.type;e.viewerService.openDoc(i,n,null==r?void 0:r.viewerUid);},a=function a(e){i.appendPagesToDoc.emit(e);},s=function s(e){i.removePagesFromDoc.emit(e);},l=function l(e){i.afterUpdate.emit(e);},u=function u(e){i.remove.emit(e);},c=function c(e){i.switch.emit(e);},h=function h(e){i.move.emit(e);},d=function d(e){i.reorder.emit(e);};t.removeDoc.on(r),t.renameDoc.on(n),t.openDoc.on(o),t.loadToDoc.on(a),t.removeFromDoc.on(s),t.afterUpdateSource.on(l),t.afterRemoveSource.on(u),t.switch.on(c),t.move.on(h),t.reorder.on(d);var f=function i(){t.removeDoc.off(r),t.renameDoc.off(n),t.openDoc.off(o),t.loadToDoc.off(a),t.removeFromDoc.off(s),t.afterUpdateSource.off(l),t.afterRemoveSource.off(u),t.switch.off(c),t.move.off(h),t.reorder.off(d),e.spaceService.space.hooks.destroy.off(i),e.hooksService.hooks.afterSetSpace.off(i);};e.spaceService.space.hooks.destroy.on(f),e.hooksService.hooks.afterSetSpace.on(f);}}]),e;}(),BN=function(){function e(){ak(this,e);}return ok(e,[{key:"apply",value:function value(e){this.listenDVSHooks(e);}},{key:"listenDVSHooks",value:function value(e){var t=e.hooksService.hooks,i=function i(t){var i=e.viewerService.getDoc(t.docUid);i&&i.move(t.from,t.to);},r=function r(t){var i=e.viewerService.getDoc(t.docUid);i&&i.switch(t.one,t.other);},n=function n(t){var i=e.viewerService.getDoc(t.docUid);i&&i.reorder(t.indexes);},o=function o(t,i){var r=e.viewerService.getDoc(t);r&&r.removeOwner(i);},a=function a(t){var i=t.uid;e.viewerService.removeDoc(i);},s=function s(t){var i=t.name,r=t.uid;e.viewerService.renameDoc(i,r);},l=function l(t){e.viewerService.appendImagesToDoc(t.docUid,t.sourceUids,t.index);},u=function u(t){e.viewerService.removePagesFromDoc(t.docUid,t.sourceUids);};t.move.on(i),t.switch.on(r),t.reorder.on(n),t.removeTab.on(o),t.removeDoc.on(a),t.renameDoc.on(s),t.appendPagesToDoc.on(l),t.removePagesFromDoc.on(u),t.destroy.on(function c(){e.viewerService.destroy(),t.move.off(i),t.switch.off(r),t.reorder.off(n),t.removeTab.off(o),t.removeDoc.off(a),t.renameDoc.off(s),t.appendPagesToDoc.off(l),t.removePagesFromDoc.off(u),t.destroy.off(c);});}}]),e;}(),DN=function(){function e(t){ak(this,e),tk(this,"context",void 0),tk(this,"errorMessage","ok"),tk(this,"errorCode",0),this.context=t;}return ok(e,[{key:"updateErrorMessage",value:function value(e){this.errorMessage=e.message,this.errorCode=e.code;}},{key:"err",value:function value(e){this.errorMessage=e.message,this.errorCode=e.code;}},{key:"destroy",value:function value(){this.errorMessage="",this.errorCode=null;}}]),e;}(),MN=function(){function e(t){ak(this,e),tk(this,"imagePool",{}),tk(this,"tasks",[]),tk(this,"loaders",3),tk(this,"loadTimer",null),tk(this,"context",void 0),tk(this,"isDestroyed",!1),this.context=t;}var t,i;return ok(e,[{key:"destroy",value:function value(){this.context=null,this.tasks=[],this.loaders=0,this.isDestroyed=!0;}},{key:"checkVisibility",value:function value(e){return this.context.viewerService.isPageNeedLoad(e);}},{key:"load",value:function value(e){var t,i=this,r=this.context.spaceService.getStatus(e);r&&!r.isLoading&&(DT(t=this.tasks).call(t,e)<0&&(this.tasks.push(e),this.loading()),this.loadTimer||(this.loadTimer=EU.createTimer(function(){i.loading();},20)));}},{key:"loading",value:function value(){if(this.loaders>0)if(this.tasks.length)for(;this.tasks.length;){var e=this.tasks.shift();if(this.context.viewerService.isPageNeedLoad(e).ori&&(this.loaders-=1,this.run(e).catch(function(){})),this.loaders<1)break;}else this.loadTimer&&(EU.clearTimer(this.loadTimer),this.loadTimer=null);}},{key:"run",value:(i=Pw(Iw().mark(function e(t){var i,r,n,o,a,s,l,u,c,h,d;return Iw().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.context,r=i.spaceService,n=i.hooksService,o=i.viewerService,!(a=r.getStatus(t))){e.next=49;break;}if(a.isLoading=!0,s=bz(),a.oriTask=s,a.oriData){e.next=33;break;}return e.next=7,r.getOriginalData(t);case 7:if(l=e.sent,a.oriTask===s){e.next=12;break;}return e.next=11,this.run(t);case 11:return e.abrupt("return",void e.sent);case 12:if(o.isPageNeedLoad(t).ori){e.next=14;break;}return e.abrupt("return",(this.loaders+=1,void(a.isLoading=!1)));case 14:if(l&&l.oriData){e.next=24;break;}if(u=r.getExternalImageLoader()){e.next=18;break;}return e.abrupt("return",(this.loaders+=1,void(a.isLoading=!1)));case 18:return e.next=20,u.getImage(t);case 20:if(c=e.sent){e.next=23;break;}return e.abrupt("return",(this.loaders+=1,void(a.isLoading=!1)));case 23:l.oriData=c,r.updateOriginalData(t,l);case 24:if(h="",10!==document.documentMode){e.next=31;break;}return e.next=28,this.convertData(l.oriData);case 28:h=e.sent.data,e.next=32;break;case 31:h=Xz(l.oriData).data;case 32:a.oriData=h;case 33:if(a.img&&(!a.img||a.img.src===a.oriData)){e.next=48;break;}if(!this.isDestroyed){e.next=36;break;}return e.abrupt("return");case 36:return e.next=38,this.loadImage(a.oriData);case 38:if(d=e.sent){e.next=41;break;}return e.abrupt("return",(this.loaders+=1,void(a.isLoading=!1)));case 41:if(a.oriTask===s){e.next=45;break;}return e.next=44,this.run(t);case 44:return e.abrupt("return",void e.sent);case 45:if(o.isPageNeedLoad(t).ori){e.next=47;break;}return e.abrupt("return",(this.loaders+=1,void(a.isLoading=!1)));case 47:a.img=d;case 48:a.isLoading=!1,n.hooks.afterLoadImage.emit(t,"ori");case 49:this.loaders+=1;case 50:case"end":return e.stop();}},e,this);})),function(e){return i.apply(this,arguments);})},{key:"convertData",value:function value(e){return new QE(function(t,i){if(tz(e))t(e);else{var r=new XMLHttpRequest();r.onload=function(){var e=Xz(r.response);t(e);},r.open("GET",e,!0),r.responseType="blob",r.send();}});}},{key:"loadImage",value:(t=Pw(Iw().mark(function e(t){return Iw().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new QE(function(e,i){var r=new Image();r.crossOrigin="Anonymous",r.onload=function(){r.onload=null,r.onerror=null,e(r);},r.onerror=function(t){r.onload=null,r.onerror=null,e(null);},r.src=t;}));case 1:case"end":return e.stop();}},e);})),function(e){return t.apply(this,arguments);})}]),e;}(),AN=function(){function e(t){ak(this,e),tk(this,"imagePool",{}),tk(this,"tasks",[]),tk(this,"loaders",3),tk(this,"loadTimer",null),tk(this,"context",void 0),tk(this,"isDestroyed",!1),this.context=t;}var t,i;return ok(e,[{key:"destroy",value:function value(){this.context=null,this.tasks=[],this.loaders=0,this.isDestroyed=!0;}},{key:"checkVisibility",value:function value(e){return this.context.viewerService.isPageNeedLoad(e);}},{key:"load",value:function value(e){var t,i=this,r=this.context.spaceService.getStatus(e);r&&!r.isMinLoading&&(DT(t=this.tasks).call(t,e)<0&&(this.tasks.push(e),this.loading()),this.loadTimer||(this.loadTimer=EU.createTimer(function(){i.loading();},20)));}},{key:"loading",value:function value(){if(this.loaders>0)if(this.tasks.length)for(;this.tasks.length;){var e=this.tasks.shift();if(this.context.viewerService.isPageNeedLoad(e).min&&(this.loaders-=1,this.run(e).catch(function(){})),this.loaders<1)break;}else this.loadTimer&&(EU.clearTimer(this.loadTimer),this.loadTimer=null);}},{key:"run",value:(i=Pw(Iw().mark(function e(t){var i,r,n,o,a,s,l,u,c,h,d;return Iw().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.context,r=i.spaceService,n=i.hooksService,o=i.viewerService,!(a=r.getStatus(t))){e.next=34;break;}if(a.isMinLoading=!0,s=bz(),a.minTask=s,a.minData){e.next=16;break;}return e.next=7,r.getOriginalData(t);case 7:if(l=e.sent,a.minTask===s){e.next=12;break;}return e.next=11,this.run(t);case 11:return e.abrupt("return",void e.sent);case 12:if(o.isPageNeedLoad(t).min){e.next=14;break;}return e.abrupt("return",(this.loaders+=1,void(a.isMinLoading=!1)));case 14:u=Xz(l.minData||l.oriData).data,a.minData=u;case 16:if(a.minImg&&(!a.minImg||a.minImg.src===a.minData)){e.next=33;break;}if(!this.isDestroyed){e.next=19;break;}return e.abrupt("return");case 19:return e.next=21,this.loadImage(a.minData);case 21:if(c=e.sent){e.next=24;break;}return e.abrupt("return",(this.loaders+=1,void(a.isMinLoading=!1)));case 24:if(a.minTask===s){e.next=28;break;}return e.next=27,this.run(t);case 27:return e.abrupt("return",void e.sent);case 28:if(o.isPageNeedLoad(t).min){e.next=30;break;}return e.abrupt("return",(this.loaders+=1,void(a.isMinLoading=!1)));case 30:a.minImg=c,(h=r.space.getMetadata(t))&&(d=h.height/c.naturalHeight,a.imageScale=d);case 33:a.isMinLoading=!1,n.hooks.afterLoadImage.emit(t,"min");case 34:this.loaders+=1;case 35:case"end":return e.stop();}},e,this);})),function(e){return i.apply(this,arguments);})},{key:"loadImage",value:(t=Pw(Iw().mark(function e(t){return Iw().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new QE(function(e,i){var r=new Image();r.crossOrigin="Anonymous",r.onload=function(){r.onload=null,r.onerror=null,e(r);},r.onerror=function(t){r.onload=null,r.onerror=null,e(null);},r.src=t;}));case 1:case"end":return e.stop();}},e);})),function(e){return t.apply(this,arguments);})}]),e;}(),zN=function(){function e(t){ak(this,e),tk(this,"context",void 0),this.context=t;}var t;return ok(e,[{key:"getImageData",value:(t=Pw(Iw().mark(function e(t,i){var r=this;return Iw().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new QE(function(e,n){var o=r.context.spaceService.getStatus(t);o||n(new Error("The page is not exist.")),r.context.hooksService.hooks.afterLoadImage.on(function n(a,s){if("min"!==s&&a===t&&o.isSaving){o.isSaving=!1,r.context.hooksService.hooks.afterLoadImage.off(n);var l=o.img.naturalWidth,u=o.img.naturalHeight,c=[],h=[];if(r.context.editService){var d={operations:o.operations,width:o.img.naturalWidth,height:o.img.naturalHeight},f=r.context.editService.handle(d);l=f.width,u=f.height,c=f.matrixes,h=f.blanks;}var v=new gL({style:{x:0,y:0,img:o.img,width:o.img.naturalWidth,height:o.img.naturalHeight}});v.externalMatrixes=c;var g=new fL({style:{x:0,y:0,width:l,height:u,background:"#fff"}}),m=new fL();dk(h).call(h,function(e){var t=new pL({id:e.uid,style:{background:e.background,points:e.points,borderWidth:0}});m.appendChild(t);}),v.appendChild(m),g.appendChild(v),r.context.commonCanvas.render(g),r.context.commonCanvas.clear();var y=r.context.commonCanvas.getCanvas(),p=(null==i?void 0:i.type)||"imageData",w=(null==i?void 0:i.mime)||"image/png",b=(null==i?void 0:i.mime)||1,k=Math.max(l,u)||1;if(null!=i&&i.min&&k>720){var x=720/k,S=x*l,C=x*u,V=document.createElement("canvas");V.width=S,V.height=C;var T=V.getContext("2d",{willReadFrequently:!0});if(T.drawImage(y,0,0,Math.floor(l),Math.floor(u),0,0,S,C),"imageData"===p){var I=T.getImageData(0,0,S,C);e(I);}else"blob"===p&&V.toBlob(function(t){e(t);},w,b);}else if("imageData"===p){var E=y.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,l,u);e(E);}else"blob"===p&&y.toBlob(function(t){e(t);},w,b);}}),o.isSaving=!0,r.context.imageService.load(t);}));case 1:case"end":return e.stop();}},e);})),function(e,i){return t.apply(this,arguments);})}]),e;}(),UN=function(){function e(t,i){ak(this,e),tk(this,"context",void 0),tk(this,"iSpace",void 0),this.context=t,this.iSpace=i||new ZU();}return ok(e,[{key:"space",get:function get(){return this.iSpace;}},{key:"setSpace",value:function value(e){this.iSpace=e;}},{key:"getStatus",value:function value(e){return this.space.statusStore.get(e);}},{key:"getOriginalData",value:function value(e){return this.space.store.get(e);}},{key:"updateOriginalData",value:function value(e,t){return this.space.store.update(e,t);}},{key:"removeOriginalData",value:function value(e){return this.space.store.remove(e);}},{key:"getExternalImageLoader",value:function value(){return this.space.imageLoader;}},{key:"destroy",value:function value(){this.iSpace.destroy(),this.iSpace=null;}}]),e;}();function RN(e){var t;return Ck(t="".concat(oz()," DVS: ")).call(t,e);}var LN=function(){function e(t){ak(this,e),tk(this,"context",void 0),tk(this,"logs",[]),tk(this,"enableLog",!0),this.context=t,this.logs.push(RN("Initialize Log object."));}return ok(e,[{key:"updateLogMessage",value:function value(e){this.enableLog&&(null==this||this.logs.push(RN(e)));}},{key:"log",value:function value(e){this.enableLog&&(null==this||this.logs.push(RN(e)));}},{key:"clear",value:function value(){this.logs=[];}},{key:"destroy",value:function value(){this.logs=null;}}]),e;}(),NN=function(){function e(t){ak(this,e),tk(this,"context",void 0),tk(this,"docManager",void 0),tk(this,"viewerManager",void 0),tk(this,"isDestroyed",!1),tk(this,"scrollbarWidth",0),this.context=t,this.docManager=new aN(),this.viewerManager=new VN(),this.getScrollbarWidth();}return ok(e,[{key:"isPageNeedLoad",value:function value(e){for(var t={ori:!1,min:!1},i=this.viewerManager.getAllViewers(),r=0,n=i.length;r<n;r++){var o=this.context.spaceService.getStatus(e);o&&o.isSaving&&(t.ori=!0);var a=i[r].checkPageVisibility(e);a.min&&(t.min=!0),a.ori&&(t.ori=!0);}return t;}},{key:"destroy",value:function value(){var e,t=this;this.isDestroyed||(dk(e=this.viewerManager.getAllViewers()).call(e,function(e){return t.removeViewer(e);}),this.docManager.destroy(),this.docManager=null,this.isDestroyed=!0);}},{key:"createViewer",value:function value(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=null,r=null,n=t.syncViewerUid;if(n){if(!(r=this.getViewer(n)))return this.context.errorService.err(KA),null;i=r.groupUid;}else i=bz();var o=$z.create(),a=this.context;o.save();var s,l=rk(rk({},t),{},{groupUid:i,emitter:o,dvsContext:a}),u=new a.dvs.subClasses.Viewer(l),c=u.uid;(o.restore(),this.context.hooksService.hooks.createViewer.emit({viewer:u}),this.viewerManager.addViewer(u,i),r)&&(dk(s=r.getAllTabs()).call(s,function(t){var i;dk(i=t.children).call(i,function(t){var i=e.context.spaceService.getStatus(t.uid);i&&i.addOwner(c);}),e.docManager.getDoc(t.uid).addOwner(c);}),u.context.syncFromViewer(r));return this.context.trackerService.log("Invoking ViewerController#createViewer."),u;}},{key:"removeViewer",value:function value(e){var t,i=this;if(!e)return!1;var r=e;return az(e)&&(r=this.viewerManager.getViewer(e)),!!r&&(this.viewerManager.removeViewer(r),dk(t=this.docManager.docs).call(t,function(e){var t;e.removeOwner(r.uid)&&dk(t=e.children).call(t,function(e){var t=i.context.spaceService.getStatus(e);t&&t.removeViewer(r.uid);});}),this.context.trackerService.log("Invoking ViewerController#removeViewer."),!0);}},{key:"getViewer",value:function value(e){return this.viewerManager.getViewer(e);}},{key:"openDoc",value:function value(e,t,i){var r,n=this,o=ET(r=e.children).call(r),a=this.docManager.getDoc(e.uid);a||(a=this.docManager.addDoc({uid:e.uid,name:e.name,type:t,children:[]},i)),a.children=o;var s=[];if(i){var l=this.viewerManager.getGroup(i);if(!l)return void this.context.errorService.err(KA);s=jI(l).call(l,function(e){return n.viewerManager.getViewer(e);});}else s=this.viewerManager.getAllViewers();dk(s).call(s,function(e){e&&(a.addOwner(e.uid),e.context.hooksService.hooks.openDoc.emit(a));});}},{key:"removeDoc",value:function value(e){this.docManager.getDoc(e)&&this.docManager.removeDoc(e);}},{key:"renameDoc",value:function value(e,t){var i=this.docManager.getDoc(t);i&&(i.name=e);}},{key:"removePagesFromDoc",value:function value(e,t){var i=this.docManager.getDoc(e);i&&dk(t).call(t,function(e){i.remove(e);});}},{key:"appendImagesToDoc",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=this.docManager.getDoc(e);if(r){var n=i>-1;dk(t).call(t,function(e,t){var o;DT(o=r.children).call(o,e)<0&&(n?r.insert(e,i+t):r.append(e));});}}},{key:"getDoc",value:function value(e){return this.docManager.getDoc(e);}},{key:"getScrollbarWidth",value:function value(){var e,t=document.createElement("div"),i=document.createElement("div");t.appendChild(i),t.setAttribute("style","width:60px;height:60px;position:absolute;overflow:auto;"),i.setAttribute("style","width:100px;height:100px;"),document.body.appendChild(t);var r=t.offsetWidth-t.clientWidth;document.body.removeChild(t),this.scrollbarWidth=r,dk(e=this.viewerManager.getAllViewers()).call(e,function(e){e.context.setScrollbarWidth(r);});}}]),e;}(),ON=function(){function e(t){ak(this,e),tk(this,"context",void 0),tk(this,"hermiteWorkerUrl",void 0),tk(this,"workers",[]),tk(this,"concurrency",navigator.hardwareConcurrency||4),tk(this,"cores",0),this.context=t,this.createWorkerUlr();}return ok(e,[{key:"createWorkerUlr",value:function value(){this.hermiteWorkerUrl=VT.createObjectURL(new Blob(["(",TN.toString(),")()"],{type:"application/javascript"}));}},{key:"run",value:function value(e,t){var i=this;return new QE(function(r,n){var o=i.getWorker();o||n(new Error("There is no idle worker.")),o.running=!0,o.worker.onmessage=function(e){o.running=!1,r(e.data);},o.worker.onerror=function(e){o.running=!1,n(e);},t?o.worker.postMessage(e,[t]):o.worker.postMessage(e);});}},{key:"getWorker",value:function value(){for(var e=this.workers.length,t=0;t<e;t++)if(!this.workers[t].running)return this.workers[t];if(e<this.concurrency){var i={running:!1,worker:new Worker(this.hermiteWorkerUrl)};return this.workers.push(i),i;}return null;}},{key:"isWorkerIdle",value:function value(){for(var e=this.workers.length,t=0;t<e;t++)if(!this.workers[t].running)return!0;return e<this.concurrency;}}]),e;}(),WN=function(){function e(t){ak(this,e),tk(this,"actorSystem",void 0),tk(this,"context",void 0),tk(this,"hermiteWorkerUrl",void 0),tk(this,"concurrency",3),this.context=t,this.createWorkerUlr(),this.actorSystem=new EN(this.hermiteWorkerUrl,this.concurrency);}return ok(e,[{key:"createWorkerUlr",value:function value(){this.hermiteWorkerUrl=VT.createObjectURL(new Blob(["(",TN.toString(),")()"],{type:"application/javascript"}));}},{key:"optimize",value:function value(e,t,i,r,n,o){var a=this;return new QE(function(s,l){var u=e.getContext("2d"),c=Math.floor(t)||1,h=Math.floor(i)||1,d=u.getImageData(0,0,c,h),f={action:"optimize",data:{taskUid:o,sourceWidth:c,sourceHeight:h,width:Math.ceil(r)||1,height:Math.ceil(n)||1,source:d},callback:function callback(e){s(e);}};a.actorSystem.send(f,f.data.source);});}}]),e;}();function HN(e){var t,i=document.createElement("div");i.style.border=e,e=$k(t=i.style.border).call(t),i=null;var r=cb(e.match(/(^\d+)p?x?\s+(\w+)\s+(.+)/)||[],4),n=r[1],o=r[2],a=r[3];if(nz(n)||nz(o)||nz(a))return{};var s=[];return"dashed"===o&&(s=[2*fx(n,10),fx(n,10)]),{borderWidth:n,lineDash:s,borderColor:a};}function FN(e,t,i){var r={isOver:!1,pointerX:-1,pointerY:-1,obj:e};if(e&&e.isVisible){var n=e.getPosition(),o=n.x,a=n.y,s=e.width,l=e.height;r.isOver=t>=o&&i>=a&&t<=o+s&&i<=a+l;var u=e.getScale();r.pointerX=(t-o)/u.x,r.pointerY=(i-a)/u.y;}return r;}function jN(e,t){return void 0===t&&(t=[e.getCurrentIndex()]),cz(t)&&(t=[t]),t;}function YN(e,t){var i;if(!ez(t))return e.err(ZA),!1;if(0===t.length)return e.err(KA),!1;var r=e.getCurrentTab();if(!r)return!1;var n=UM(i=ET(t).call(t)).call(i,function(e,t){return e-t;});return n[0]<0||n[n.length-1]>r.total?(e.err(_A),!1):r;}var XN={tag:"div",id:"dvs-viewer",className:"dvs-viewer",children:[{tag:"div",id:"dvs-viewer-middle",className:"dvs-viewer-middle",children:[{tag:"div",id:"dvs-viewer-main",className:"dvs-viewer-main",children:[{tag:"div",id:"dvs-main-container",className:"dvs-main-container",children:[{tag:"div",id:"dvs-scroller-and-canvas",className:"dvs-scroller-and-canvas",children:[{tag:"div",id:"dvs-scroll-container",className:"dvs-scroll-container",children:[{tag:"div",id:"dvs-scroll-content",className:"dvs-scroll-content"}]},{tag:"div",id:"dvs-canvas-container",className:"dvs-canvas-container",children:[]}]},{tag:"div",id:"dvs-video-container",className:"dvs-video-container",children:[{tag:"img",id:"dvs-video-image",class:"dvs-video-image"}]}]}]}]}]},qN={tag:"div",id:"dvs-viewer",className:"dvs-viewer",children:[{tag:"div",id:"dvs-scroll-container",className:"dvs-scroll-container",children:[{tag:"div",id:"dvs-scroll-content",className:"dvs-scroll-content"}]},{tag:"div",id:"dvs-canvas-container",className:"dvs-canvas-container"}]},ZN={viewerStyle:{background:"#434246"},canvasStyle:{cursor:"default"},pageStyle:{border:"4px solid #707070",background:"#e2e2e2"},selectedPageStyle:{background:"#6f76ff",border:"4px solid #e98b1f"},hoveredPageStyle:{background:"#a5a9fb",border:"4px solid #e98b1f"},placeholderStyle:{background:"#b5b5b5",border:"0px solid #f00"},pageNumberStyle:{visibility:"visible",width:24,height:24,background:"#fff",borderWidth:1,borderRadius:0,borderColor:"#000",opacity:.5,color:"#000",fontSize:12,fontFamily:"sans-serif",textAlign:"center",textBaseline:"middle",left:"",top:"",right:0,bottom:0},checkboxStyle:{visibility:"visible",width:24,height:24,background:"#fff",borderWidth:2,borderRadius:0,borderColor:"#000",opacity:.5,left:0,top:0},removeBtnStyle:{visibility:"visible",width:24,height:24,background:"#fff",borderWidth:1,borderRadius:"50%",borderColor:"#515151",opacity:1,left:"",top:-8,right:-8,bottom:"",checkMarkColor:"#ea2e2e"},enableDragPage:!0,enableKeyboardControl:!0,multiselectMode:!1,enableOptimizeImage:!1,zoomOrigin:{x:"center",y:"center"},zoom:1,minZoom:.02,maxZoom:8,enableZoom:!0,enableScrollX:!0,enableScrollY:!0,keepZoom:!0,zoomInDelta:1.2,zoomOutDelta:1.2,wheelZoomDelta:1.2,scrollDirection:"vertical",displayMode:"single",toolType:"default",fitType:"window",enableSlide:!0,show:!0,rows:1,columns:1,pure:!1,margin:10,gap:10,autoScroll:!0,autoChangeIndex:!0,autoSelectLatest:!0,enableSelectWithShift:!0,enableSelectWithCtrl:!0,enableZoomWithCtrl:!0,tabMode:"single",enableSyncSelect:!0,enableSingleModeBorder:!1,blankFillColor:"#fff",dragThreshold:3,slideThreshold:20,maxOptimizationSize:7e3,useMinImage:!0,enableDWT1x1:!1,enableEmitPageRendered:!0,autoSelectTopPage:!1,showVideoContainer:!1},_N=function(){function e(){ak(this,e);}return ok(e,[{key:"init",value:function value(e){this.listenDVSHooks(e),this.listenViewerHooks(e);}},{key:"listenDVSHooks",value:function value(e){var t=e.dvsContext.hooksService.hooks,i=function i(t,_i2){"min"===_i2?e.renderMinPage(t):e.renderPage(t);},r=function r(t){e.tabService.updateTab(t);},n=function n(t){e.tabService.movePage(t);},o=function o(t){e.tabService.switchPage(t);},a=function a(t){e.tabService.reorderPages(t);},s=function s(t){e.tabService.changePage(t);},l=function l(t){e.tabService.selectPage(t);},u=function u(t){e.tabService.appendPagesToDoc(t.docUid,t.sourceUids,t.index);},c=function c(t){e.tabService.removePagesFromDoc(t.docUid,t.sourceUids);},h=function h(t){e.tabService.removeDoc(t);},d=function d(t,i){e.tabService.renameDoc(t,i);},f=function f(){e.tabCleared();},v=function v(t){e.isFocus=t===e.viewerUid;};t.afterLoadImage.on(i),t.afterUpdate.on(r),t.move.on(n),t.switch.on(o),t.reorder.on(a),t.changePage.on(s),t.selectPage.on(l),t.appendPagesToDoc.on(u),t.removePagesFromDoc.on(c),t.removeDoc.on(h),t.renameDoc.on(d),t.afterSetSpace.on(f),t.focusChanged.on(v),e.hooksService.hooks.destroy.on(function(){t.afterLoadImage.off(i),t.afterUpdate.off(r),t.move.off(n),t.switch.off(o),t.reorder.off(a),t.changePage.off(s),t.selectPage.off(l),t.appendPagesToDoc.off(u),t.removePagesFromDoc.off(c),t.removeDoc.off(h),t.renameDoc.off(d),t.afterSetSpace.off(f),t.focusChanged.off(v);});}},{key:"listenViewerHooks",value:function value(e){var t=e.hooksService.hooks,i=e.dvsContext.hooksService,r=function r(e){i.hooks.remove.emit(e);},n=function n(e){i.hooks.move.emit(e);},o=function o(e){i.hooks.switch.emit(e);},a=function a(e){i.hooks.reorder.emit(e);},s=function s(e){i.hooks.changePage.emit(e);},l=function l(e){i.hooks.selectPage.emit(e);},u=function u(e){i.hooks.focusChanged.emit(e);},c=function c(t){i.hooks.focusChanged.emit(t,e.viewerUid);};t.remove.on(r),t.move.on(n),t.switch.on(o),t.reorder.on(a),t.changePage.on(s),t.selectPage.on(l),t.focusChanged.on(u),t.removeTab.on(c),e.hooksService.hooks.destroy.on(function i(){t.remove.off(r),t.move.off(n),t.switch.off(o),t.reorder.off(a),t.changePage.off(s),t.selectPage.off(l),t.focusChanged.off(u),t.removeTab.off(c),e.hooksService.hooks.destroy.off(i);});}}]),e;}(),GN=ok(function e(){ak(this,e);});function KN(e,t){if(e.tabUid===t.uid)return!0;if("tag"===e.tabType)for(var i=t.total,r=0;r<i;r++){var n;if(DT(n=e.uids).call(n,t.getChildByIndex(r).uid)>-1)return!0;}return!1;}var $N=function(){function e(){ak(this,e),tk(this,"undoStack",[]),tk(this,"redoStack",[]);}return ok(e,[{key:"execute",value:function value(e){e.execute(),this.undoStack.push(e),this.redoStack.length>0&&(this.redoStack.length=0);}},{key:"undo",value:function value(e){var t,i=bI(t=this.undoStack).call(t,function(t){return t.uid===e;});if(i>-1){var r,n=this.undoStack[i];sI(r=this.undoStack).call(r,i,1),n.undo(),this.redoStack.push(n);}}},{key:"redo",value:function value(e){var t,i=bI(t=this.redoStack).call(t,function(t){return t.uid===e;});if(i>-1){var r,n=this.redoStack[i];sI(r=this.redoStack).call(r,i,1),n.execute(),this.undoStack.push(n);}}},{key:"removeUidsFromCommand",value:function value(e){this.removeFromStack(this.undoStack,e),this.removeFromStack(this.redoStack,e);}},{key:"removeFromStack",value:function value(e,t){var i;dk(i=ET(e).call(e)).call(i,function(i){var r,n=i.action.uids;if(n&&(dk(r=ET(n).call(n)).call(r,function(e){if(DT(t).call(t,e)>-1){var i=DT(n).call(n,e);sI(n).call(n,i,1);}}),!n.length)){var o=DT(e).call(e,i);sI(e).call(e,o,1);}});}},{key:"reset",value:function value(){this.undoStack=[],this.redoStack=[];}}]),e;}(),QN=function(){function e(){ak(this,e);}return ok(e,[{key:"init",value:function value(e){var t=e.dvsContext.hooksService.hooks,i=t.undo,r=t.redo,n=t.reset,o=t.afterUpdate,a=function a(t){var i,r=t.commandUid;t.trigger,dk(i=e.tabService.getAllTabs()).call(i,function(t){var i,n=t.commandController.undoStack.length;(null===(i=t.commandController.undoStack[n-1])||void 0===i?void 0:i.uid)===r&&(t.commandController.undo(r),e.tabService.isCurrentTab(t.uid)&&e.render());});},s=function s(t){var i,r=t.commandUid;t.trigger,dk(i=e.tabService.getAllTabs()).call(i,function(t){var i,n=t.commandController.redoStack.length;(null===(i=t.commandController.redoStack[n-1])||void 0===i?void 0:i.uid)===r&&(t.commandController.redo(r),e.tabService.isCurrentTab(t.uid)&&e.render());});},l=function l(t){var i,r=t.uids;dk(i=e.tabService.getAllTabs()).call(i,function(i){KN(t,i)&&(i.commandController.removeUidsFromCommand(r),e.tabService.isCurrentTab(i.uid)&&e.render());});};i.on(a),r.on(s),n.on(l),e.hooksService.hooks.destroy.on(function(){i.off(a),r.off(s),n.off(l);});var u=e.hooksService.hooks.removePagesFromDoc,c=function c(t,i){var r=e.tabService.getTab(t);r&&r.commandController.removeUidsFromCommand(i);},h=function h(t){var i;dk(i=e.tabService.getAllTabs()).call(i,function(e){e.commandController.removeUidsFromCommand([t.modifiedUid]);});};u.on(c),o.on(h),e.hooksService.hooks.destroy.on(function(){u.off(c),o.off(h);});}}]),e;}();function JN(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=-1,n=-1,o=-1,a=e.pageX,s=e.pageY,l=t.formatTouches(e,i),u=cb(l,1),c=u[0],h=t.getPointerOverPageInfo(c.pageX,c.pageY);if(r=h.index,h.imageInfo.isOver){n=h.imageInfo.pointerX,o=h.imageInfo.pointerY;var d=t.getCurrentTab();if(d){var f=d.getChildByIndex(r);if(f){var v=t.getStatus(f.uid);if(v&&"multiple"===t.config.displayMode&&t.config.useMinImage){var g=v.imageScale;n*=g,o*=g;}}}}return{index:r,imageX:n,imageY:o,pageX:a,pageY:s};}var eO=function(){function e(){ak(this,e);}return ok(e,[{key:"init",value:function value(e){var t,i,r,n,o=e.rendererService.canvasDom,a=0,s=0,l=0,u=0,c=!1,h=!1,d=null,f=!1,v=null,g=null,m=function m(){g&&(clearTimeout(g),g=null),v?g=RE(function(){e.externalResized();},50):v=RE(function(){e.externalResized(),v=null;},42);},y=function y(t){e.isFocus&&e.emit("keyup",t);},p=function p(t){e.isFocus&&e.emit("keydown",t);},w=function w(t){e.hooksService.hooks.focusChanged.emit("");},b=function b(t){var i=JN(t,e);e.emit("click",i,t),e.hooksService.hooks.focusChanged.emit(e.viewerUid),t.stopPropagation();},k=null,x=function x(i){var n=JN(i,e);e.emit("mousedown",n,i),h=!0;var o=i.pointerType;"mouse"===o?e.draggingPrepared=!0:"touch"!==o&&"pen"!==o||"multiple"!==e.config.displayMode||(k=RE(function(){e.draggingPrepared=!0;},300));var c=cb(e.formatTouches(i),1)[0],d=e.getPointerOverPageInfo(c.pageX,c.pageY).pageInfo.obj,f=e.tabService.getCurrentTab();if(f){var v=e.config;if(d&&"multiple"===v.displayMode&&!i.ctrlKey){var g=f.getChildIndex(d);if(i.shiftKey&&v.enableSelectWithShift||v.multiselectMode){if(i.shiftKey&&v.enableSelectWithShift&&(d!==f.currentPage||1!==f.selected.length)){var m=f.getIndexByUid(f.shiftReference);if(m>-1){var y,p=Math.min(g,m),w=Math.max(g,m)-p+1,b=[];e.isSelectedBorderWidthEqualHovered()||d.clearOptimization();for(var x=0;x<w;x++){var S,C=f.getChildByIndex(p+x);DT(S=f.selected).call(S,C.uid)<0&&C.uid!==d.uid&&!e.isSelectedBorderWidthEqualNormal()&&C.clearOptimization(),b.push(C.uid);}g>m&&ZM(b).call(b);var V={selectedUids:b,indexes:[],docUid:f.uid,trigger:e.viewerUid,groupUid:e.groupUid,operation:"shift",updateShiftReference:!1};dk(y=f.selected).call(y,function(t){if(DT(b).call(b,t)<0&&!e.isSelectedBorderWidthEqualNormal()){var i=f.getChildByUid(t);i&&i.clearOptimization();}}),e.hooksService.hooks.selectPage.emit(V);}}}else{var T=f.selected,I=DT(T).call(T,d.uid)>-1;if(f.currentPage!==d&&T.length<2||!I){var E,P={index:g,docUid:f.uid,trigger:e.viewerUid,groupUid:e.groupUid,operation:"shift"};dk(E=f.selected).call(E,function(t){var i=f.getChildByUid(t);i&&(e.isSelectedBorderWidthEqualNormal()||i.clearOptimization());}),e.isSelectedBorderWidthEqualHovered()||d.clearOptimization(),e.hooksService.hooks.changePage.emit(P);}}}if(d){var B;l=c.pageX,u=c.pageY;var D=d.getPosition();a=c.pageX-D.x,s=c.pageY-D.y,t=d,r=ET(B=f.children).call(B);}}},S=function S(r){var o=JN(r,e);e.emit("mousemove",o,r),h&&!1===e.draggingPrepared&&k&&(clearTimeout(k),k=null);var v=cb(e.formatTouches(r),1)[0],g=e.tabService.getCurrentTab();if(g){var m=e.config,y=e.getPointerOverPageInfo(v.pageX,v.pageY).pageInfo.obj,p=g.getChildIndex(d);if(y?d?d!==y&&(c||(d.isSelected||e.isBorderWidthEqualHovered()||d.clearOptimization(),y.isSelected||e.isBorderWidthEqualHovered()||y.clearOptimization()),e.emit("mouseout",rk(rk({},o),{},{index:p}),r,"page"),e.emit("mouseover",rk({},o),r,"page"),d=y):(c||y.isSelected||e.isBorderWidthEqualHovered()||y.clearOptimization(),f||e.emit("mouseout",rk(rk({},o),{},{index:-1}),r,"canvas"),e.emit("mouseover",rk({},o),r,"page"),d=y,f=!1):d&&(c||d.isSelected||e.isBorderWidthEqualHovered()||d.clearOptimization(),e.emit("mouseout",rk(rk({},o),{},{index:p}),r,"page"),e.emit("mouseover",rk(rk({},o),{},{index:-1}),r,"canvas"),d=null),g&&"multiple"===m.displayMode)if(c){var w,b,x,S;if(y)if(!(DT(S=g.selected).call(S,y.uid)>-1)){var C,V,T,I,E,P=UM(C=jI(V=g.selected).call(V,function(e){return g.getIndexByUid(e);})).call(C,function(e,t){return e-t;}),B=P[0],D=g.getChildIndex(y),M=ET(T=g.children).call(T);dk(I=ZM(E=ET(P).call(P)).call(E)).call(I,function(e){sI(M).call(M,e,1);});var A=DT(M).call(M,y);D>B&&(A+=1),dk(n).call(n,function(e,t){var i=g.getChildByUid(e.uid);sI(M).call(M,A+t,0,i);}),i=jI(M).call(M,function(e){return g.getChildIndex(e);}),g.reorder(i),e.layoutService.layout(g);}dk(w=g.selected).call(w,function(e){var t=g.getChildByUid(e);t.borderBox.setPosition({x:v.pageX-a,y:v.pageY-s}),t.isDragging=!0,t.borderBox.updateStyle({visibility:"hidden"});}),null!==(b=t)&&void 0!==b&&b.updateStyle({zIndex:1}),null!==(x=t)&&void 0!==x&&x.borderBox.updateStyle({visibility:"visible"}),e.render();}else{var z,U,R,L;if(y&&y===t&&DT(z=g.selected).call(z,y.uid)>-1&&"crop"!==m.toolType&&e.draggingPrepared)Math.pow(Math.pow(v.pageX-l,2)+Math.pow(v.pageY-u,2),.5)>=m.dragThreshold&&t&&m.enableDragPage&&(c=!0,n=UM(R=jI(L=g.selected).call(L,function(e){return{uid:e,index:g.getIndexByUid(e)};})).call(R,function(e,t){return e.index-t.index;}));var N=!1;r instanceof MouseEvent&&dk(U=g.children).call(U,function(e){y&&y.uid===e.uid?(e.isHovered||(N=!0),e.isHovered=!0):(e.isHovered&&(N=!0),e.isHovered=!1);}),N&&e.render();}}},C=function C(t){var i=JN(t,e,!0);e.emit("mouseup",i,t);},V=function V(o){if("annotation"!==e.config.toolType&&h){o instanceof MouseEvent?e.draggingPrepared=!1:o instanceof TouchEvent&&(k&&(clearTimeout(k),k=null),e.draggingPrepared=!1);var a=cb(e.formatTouches(o,!0),1)[0],s=e.tabService.getCurrentTab();if(s){var l=e.getPointerOverPageInfo(a.pageX,a.pageY).pageInfo.obj;if(c){var u;if(i){var d,f=jI(d=s.children).call(d,function(e){return DT(r).call(r,e);});s.childNodes=r;var v={indexes:f,trigger:e.viewerUid,docUid:s.uid,type:s.type,operation:"shift"};e.hooksService.hooks.reorder.emit(v),i=null;}null==s||dk(u=s.selected).call(u,function(e){var t=s.getChildByUid(e);t.borderBox.setLocalPosition({x:0,y:0}),t.isDragging=!1,t.borderBox.updateStyle({visibility:"visible"});});var g=[];dk(n).call(n,function(e){var t=s.getIndexByUid(e.uid);g.push([e.index,t]);}),e.emit("dragdone",g);}else if(l&&t===l&&"multiple"===e.config.displayMode&&!o.shiftKey)if(o.ctrlKey&&e.config.enableSelectWithCtrl||e.config.multiselectMode){var m,y=ET(m=s.selected).call(m),p=DT(y).call(y,l.uid),w=!1;if(p>-1?(o.ctrlKey&&y.length>1||e.config.multiselectMode)&&(sI(y).call(y,p,1),w=!0):(y.push(l.uid),w=!0),w){var b={selectedUids:y,indexes:[],docUid:s.uid,trigger:e.viewerUid,groupUid:e.groupUid,operation:"shift"};e.isSelectedBorderWidthEqualHovered()||l.clearOptimization(),e.hooksService.hooks.selectPage.emit(b);}}else if((!o.ctrlKey||!o.shiftKey)&&s.selected.length>1){var x,S={index:s.getChildIndex(l),docUid:s.uid,trigger:e.viewerUid,groupUid:e.groupUid,operation:"shift"};dk(x=s.selected).call(x,function(t){var i=s.getChildByUid(t);i&&(e.isSelectedBorderWidthEqualNormal()||i.clearOptimization());}),e.isSelectedBorderWidthEqualHovered()||l.clearOptimization(),e.hooksService.hooks.changePage.emit(S);}if(s&&"multiple"===e.config.displayMode){var C;if("visible"===e.config.removeBtnStyle.visibility){var V=e.getHitRemoveBtn(a.pageX,a.pageY);V>-1&&e.emit("removePage",V);}null!==(C=t)&&void 0!==C&&C.updateStyle({zIndex:0}),t=null,c=!1,e.render();}h=!1,t=null;}}},T=function T(t){f=!0;var i=JN(t,e);e.emit("mouseover",i,t);},I=function I(t){var i=e.tabService.getCurrentTab(),r=JN(t,e);if(i){var n;if(d){var o=i.getChildIndex(d);r.index=o;}d=null,e.emit("mouseout",r,t),i&&"multiple"===e.config.displayMode&&(dk(n=i.children).call(n,function(e){e.isHovered=!1;}),e.rendererService.render());}},E=function E(t){var i=JN(t,e);e.emit("dblclick",i,t);},P=function P(t){var i=JN(t,e);e.emit("wheel",i,t);},B=function B(t){t.preventDefault();var i=JN(t,e);e.emit("contextmenu",i,t);},D=function D(e){},M=function M(e){e.preventDefault();},A=function A(t){t.preventDefault(),e.emit("drop",t);},z=function z(t){if(!e.isDestroyed){var i=e.getCurrentTab();if(i){var r,n=t.target,o=n.scrollLeft,a=n.scrollTop;if(i.setPosition({x:-o,y:-a}),e.layoutService.layout(i),i.updateLayoutStatus({scrollLeft:o,scrollTop:a}),dk(r=i.children).call(r,function(t){!t.isPreload||t.isLoaded||t.imageContainer.imageData||("multiple"===e.config.displayMode&&e.config.useMinImage?e.dvsContext.minImageService.load(t.uid):e.dvsContext.imageService.load(t.uid));}),e.scrollerService.updateScroller({scrollLeft:o,scrollTop:a}),i&&i.isTopPageChanged&&!i.isLoadPage){var s=i.getIndexByUid(i.topPageUid);if(e.config.autoSelectTopPage){i.current=s,i.select([i.currentUid]);var l={selectedUids:[i.currentUid],indexes:[s],docUid:i.uid,trigger:e.viewerUid,groupUid:e.groupUid,operation:"shift",triggerByScroll:!0};e.getLocalHooks().selectPage.emit(l),e.layoutService.layout(i);}}i.isLoadPage&&(i.isLoadPage=!1),e.render();}}};window.addEventListener("resize",m),document.addEventListener("keydown",p),document.addEventListener("keyup",y),document.addEventListener("click",w),o.addEventListener("click",b),window.PointerEvent?(o.addEventListener("pointerdown",x),o.addEventListener("pointermove",S),o.addEventListener("pointerup",C),document.addEventListener("pointerup",V)):window.MSPointerEvent&&(o.addEventListener("MSPointerDown",x),o.addEventListener("MSPointerMove",S),o.addEventListener("MSPointerUp",C),document.addEventListener("MSPointerUp",V)),o.addEventListener("touchmove",function(e){e.cancelable&&e.preventDefault();},{passive:!1}),o.addEventListener("mouseover",T),o.addEventListener("mouseout",I),o.addEventListener("dblclick",E),o.addEventListener("wheel",P,{passive:!0}),o.addEventListener("contextmenu",B),o.addEventListener("dragstart",D),o.addEventListener("dragover",M),e.uiService.defaultDom.addEventListener("drop",A),e.uiService.hooks.scroll.on(z);e.hooksService.hooks.destroy.on(function t(){v&&clearTimeout(v),g&&clearTimeout(g),k&&clearTimeout(k),window.removeEventListener("resize",m),document.removeEventListener("keydown",p),document.removeEventListener("keyup",y),document.removeEventListener("click",w),o.removeEventListener("click",b),window.PointerEvent?(o.removeEventListener("pointerdown",x),o.removeEventListener("pointermove",S),o.removeEventListener("pointerup",C),document.removeEventListener("pointerup",V)):window.MSPointerEvent&&(o.removeEventListener("MSPointerDown",x),o.removeEventListener("MSPointerMove",S),o.removeEventListener("MSPointerUp",C),document.removeEventListener("MSPointerUp",V)),o.removeEventListener("pointerdown",x),o.removeEventListener("pointermove",S),o.removeEventListener("pointerup",C),document.removeEventListener("pointerup",V),o.removeEventListener("mouseover",T),o.removeEventListener("mouseout",I),o.removeEventListener("dblclick",E),o.removeEventListener("wheel",P),o.removeEventListener("contextmenu",B),o.removeEventListener("dragstart",D),o.removeEventListener("dragover",M),e.uiService.defaultDom.removeEventListener("drop",A),e.hooksService.hooks.destroy.off(t),e.uiService.hooks.scroll.off(z);});}}]),e;}(),tO={visibility:"hidden",left:0,top:0,right:"",bottom:"",width:"24px",height:"24px",opacity:1,borderWidth:1,borderRadius:0,background:"#ffffff",borderColor:"#000000",checkMarkColor:"#000000",checkMarkLineWidth:"2px",translateX:0,translateY:0},iO=function(e){lb(i,e);var t=ub(i);function i(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:iz(tO);return ak(this,i),tk(rc(e=t.call(this,{style:{visibility:"visible"===r.visibility?"visible":"hidden"}})),"shapeType","checkbox"),tk(rc(e),"checkBoxStyle",void 0),tk(rc(e),"parsedCheckBoxStyle",void 0),tk(rc(e),"isChecked",!1),e.checkBoxStyle=rk(rk({},tO),r),e;}return ok(i,[{key:"checked",get:function get(){return this.isChecked;},set:function set(e){this.isChecked=e;}},{key:"updateStyle",value:function value(e){this.checkBoxStyle=rk(rk({},this.checkBoxStyle),e),this.style.visibility=this.checkBoxStyle.visibility;}}]),i;}(_R),rO={visibility:"hidden",left:"",top:"",right:0,bottom:0,width:"24px",height:"24px",opacity:1,borderWidth:1,borderRadius:"50%",background:"#ffffff",borderColor:"#a79898",color:"#a79898",fontFamily:"sans-serif",fontSize:12,translateX:0,translateY:0},nO=function(e){lb(i,e);var t=ub(i);function i(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:iz(rO),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0";return ak(this,i),tk(rc(e=t.call(this,{style:{visibility:"visible"===r.visibility?"visible":"hidden"}})),"shapeType","pageNumber"),tk(rc(e),"pageNumberStyle",void 0),tk(rc(e),"text",void 0),tk(rc(e),"parsedPageNumberStyle",void 0),e.text=n,e.pageNumberStyle=rk(rk({},rO),r),e;}return ok(i,[{key:"updateText",value:function value(e){this.text=e;}},{key:"updateStyle",value:function value(e){this.pageNumberStyle=rk(rk({},this.pageNumberStyle),e),this.style.visibility="visible"===this.pageNumberStyle.visibility?"visible":"hidden";}}]),i;}(_R),oO={visibility:"hidden",left:"",top:0,right:0,bottom:"",width:"24px",height:"24px",borderWidth:1,borderRadius:0,background:"#ffffff",borderColor:"#000000",checkMarkColor:"#ff0000",checkMarkLineWidth:"2px",translateX:0,translateY:0},aO=function(e){lb(i,e);var t=ub(i);function i(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:iz(oO);return ak(this,i),tk(rc(e=t.call(this,r)),"shapeType","removeBtn"),e;}return ok(i);}(iO),sO=function(e){lb(i,e);var t=ub(i);function i(e){var r;ak(this,i),tk(rc(r=t.call(this,e)),"uid",void 0),tk(rc(r),"isSelected",!1),tk(rc(r),"isPreload",!1),tk(rc(r),"isMouseover",!1),tk(rc(r),"isLoaded",!1),tk(rc(r),"blanks",void 0),tk(rc(r),"overlays",void 0),tk(rc(r),"image",void 0),tk(rc(r),"borderBox",void 0),tk(rc(r),"imageContainer",void 0),tk(rc(r),"checkbox",void 0),tk(rc(r),"pageNumber",void 0),tk(rc(r),"removeBtn",void 0),tk(rc(r),"isHovered",!1),tk(rc(r),"isDragging",!1),tk(rc(r),"viewportPosition",void 0),tk(rc(r),"isPageRendered",!1),tk(rc(r),"isEdited",!1),tk(rc(r),"isUpdated",!1),tk(rc(r),"isOptimized",!1),tk(rc(r),"optimizationUid",null),tk(rc(r),"optimizedUid",null),tk(rc(r),"realTimeWidth",void 0),tk(rc(r),"realTimeHeight",void 0),tk(rc(r),"zoom",1),tk(rc(r),"imageScale",1),r.uid=e.uid,r.realTimeWidth=e.realTimeWidth,r.realTimeHeight=e.realTimeHeight,r.updateStyle(e.style);var n=new gL({id:r.uid,style:{x:0,y:0}}),o=new fL({style:{x:0,y:0}});o.clippable=!0;var a=new fL({style:rk(rk({},e.style),e.formattedPageStyle)}),s=new iO(rk({},e.checkboxStyle)),l=new nO(rk({},e.pageNumberStyle),"0"),u=new aO(rk({},e.removeBtnStyle)),c=new fL(),h=new fL();return n.appendChild(c),r.appendChild(a),o.appendChild(n),o.appendChild(h),a.appendChild(o),a.appendChild(l),a.appendChild(s),a.appendChild(u),r.pageNumber=l,r.checkbox=s,r.removeBtn=u,r.image=n,r.borderBox=a,r.imageContainer=o,r.blanks=c,r.overlays=h,r.initEvent(),r;}return ok(i,[{key:"initEvent",value:function value(){var e=this;this.addEventListener("mouseover",function(){e.isMouseover=!0;}),this.addEventListener("mouseout",function(){e.isMouseover=!1;}),this.addEventListener("mouseup",function(){e.isMouseover=!1;});}},{key:"getImage",value:function value(){return this.image;}},{key:"updateImage",value:function value(e){this.image.style.img=e;}},{key:"clearOptimization",value:function value(){this.isOptimized=!1,this.imageContainer.imageData=null,this.optimizationUid=bz();}},{key:"destroy",value:function value(){this.clearOptimization(),this.image.style.img=null,this.image=null,this.imageContainer=null,this.overlays=null,this.blanks=null;}}]),i;}(fL),lO=function(){function e(t,i,r,n){ak(this,e),tk(this,"id",void 0),tk(this,"duration",void 0),tk(this,"step",void 0),tk(this,"verify",void 0),tk(this,"complete",void 0),tk(this,"active",!1),tk(this,"effect",void 0),tk(this,"fps",60),this.id=bz(),this.step=t,this.complete=i,this.duration=r,this.effect=n;}return ok(e,[{key:"play",value:function value(){var e=this,t=eA(),i=t,r=0;return this.active=!0,requestAnimationFrame(function n(o){var a=eA();if(e.active&&!e.verify(e.id)){var s=!0!==o;if(s)for(var l=Math.round((a-i)/(1e3/e.fps))-1,u=0;u<Math.min(l,4);u++)n(!0);e.duration&&(r=(a-t)/e.duration)>1&&(r=1);var c=e.effect(r);!1!==e.step(c,s)&&1!==r||!s?s&&(i=a,requestAnimationFrame(n)):(e.active=!1,e.complete(e.id,1===r||null===e.duration));}else e.complete(e.id,!1);}),this.id;}},{key:"cancel",value:function value(){var e=!0===this.active;return e&&(this.active=!1),e;}},{key:"pause",value:function value(){}}]),e;}(),uO=function(e){lb(i,e);var t=ub(i);function i(){var e;return ak(this,i),tk(rc(e=t.call(this)),"viewportWidth",void 0),tk(rc(e),"viewportHeight",void 0),tk(rc(e),"contentWidth",void 0),tk(rc(e),"contentHeight",void 0),tk(rc(e),"scrollingX",!0),tk(rc(e),"scrollingY",!0),tk(rc(e),"scrollLeft",0),tk(rc(e),"scrollTop",0),tk(rc(e),"maxScrollLeft",0),tk(rc(e),"maxScrollTop",0),tk(rc(e),"zoom",1),tk(rc(e),"minZoom",.01),tk(rc(e),"maxZoom",8),tk(rc(e),"zooming",!0),tk(rc(e),"locking",!1),tk(rc(e),"animating",!1),tk(rc(e),"animationDuration",300),tk(rc(e),"moveThreshold",5),tk(rc(e),"scrollThreshold",3),tk(rc(e),"moveSpeed",1),tk(rc(e),"decelerationVelocityThreshold",1),tk(rc(e),"startX",0),tk(rc(e),"startY",0),tk(rc(e),"startZoom",1),tk(rc(e),"lastX",0),tk(rc(e),"lastY",0),tk(rc(e),"lastScale",0),tk(rc(e),"lastTimeStamp",0),tk(rc(e),"futureLeft",0),tk(rc(e),"futureTop",0),tk(rc(e),"futureZoom",0),tk(rc(e),"isStart",!1),tk(rc(e),"isMoving",!1),tk(rc(e),"originLeft",0),tk(rc(e),"originTop",0),tk(rc(e),"decelerationVelocityX",0),tk(rc(e),"decelerationVelocityY",0),tk(rc(e),"enableScrollX",!0),tk(rc(e),"enableScrollY",!0),tk(rc(e),"interruptedAnimation",!1),tk(rc(e),"isDecelerating",!1),tk(rc(e),"decelerationId",void 0),tk(rc(e),"isAnimating",!1),tk(rc(e),"animationId",void 0),tk(rc(e),"isSingleTouch",!1),tk(rc(e),"isProcessing",!1),tk(rc(e),"isDecelerationComplete",!1),tk(rc(e),"isDragging",!1),tk(rc(e),"positions",[]),tk(rc(e),"hooks",{zoomComplete:Jz.create(),scrollComplete:Jz.create(),publish:Jz.create(),beforeZoom:Jz.create(),zoomTo:Jz.create()}),tk(rc(e),"animations",{}),e.viewportWidth=800,e.viewportHeight=800,e;}return ok(i,[{key:"updateScroller",value:function value(e){eM(this,e),this.calcMaxScroll();}},{key:"setOrigin",value:function value(e,t){this.originLeft=e,this.originTop=t;}},{key:"initScroller",value:function value(e){eM(this,e);}},{key:"zoomTo",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(this.zooming){this.zoom;var n=this.minZoom,o=this.maxZoom;this.viewportWidth,this.viewportHeight;var a=this.scrollLeft,s=this.scrollTop;this.maxScrollLeft,this.maxScrollTop,nz(i)&&(i=this.originLeft),nz(r)&&(r=this.originTop),this.hooks.beforeZoom.emit(i,r),e=kz(e,n,o),this.publish(a,s,e,t);}}},{key:"zoomBy",value:function value(e,t,i,r){this.zoomTo(this.zoom*e,t,i,r);}},{key:"scrollTo",value:function value(e,t,i,r){this.enableScrollX&&(this.scrollLeft=e),this.enableScrollY&&(this.scrollTop=t);var n=this.scrollLeft,o=this.scrollTop;this.emit("_scrollChanged",{scrollLeft:n,scrollTop:o});}},{key:"scrollBy",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.scrollTo(e+this.scrollLeft,t+this.scrollTop,i);}},{key:"canScroll",value:function value(){return this.contentWidth>this.viewportWidth||this.contentHeight>this.viewportHeight;}},{key:"onStartHandler",value:function value(e,t){if(this.canScroll()&&!this.isMoving){var i,r;this.isStart=!0,t instanceof Date&&(t=t.valueOf()),this.interruptedAnimation=!0,this.isDecelerating&&(this.cancelAnimate(this.decelerationId),this.isDecelerating=!0),this.isAnimating&&(this.cancelAnimate(this.animationId),this.isAnimating=!1);var n=1===e.length;n?(i=e[0].pageX,r=e[0].pageY):(i=Math.abs(e[0].pageX+e[1].pageX)/2,r=Math.abs(e[0].pageY+e[1].pageY)/2),this.startX=i,this.startY=r,this.startZoom=this.zoom,this.lastX=i,this.lastY=r,this.lastScale=1,this.lastTimeStamp=t,this.enableScrollX=this.scrollingX&&n,this.enableScrollY=this.scrollingY&&n,this.isProcessing=!0,this.isDecelerationComplete=!1,this.isDragging=!n,this.isSingleTouch=n,this.positions=[];}}},{key:"onMoveHandler",value:function value(e,t,i){if(this.canScroll()&&this.isStart){var r,n;t instanceof Date&&(t=t.valueOf());var o=1===e.length,a=this.positions;if(o?(r=e[0].pageX,n=e[0].pageY):(r=Math.abs(e[0].pageX+e[1].pageX)/2,n=Math.abs(e[0].pageY+e[1].pageY)/2),this.isDragging){var s=r-this.lastX,l=n-this.lastY,u=this.scrollLeft,c=this.scrollTop,h=this.zoom;if(!nz(i)&&this.zooming){var d=h;h=h/this.lastScale*i,d!==(h=kz(h,this.minZoom,this.maxZoom))&&(u=(r+u)/d*h-r,c=(n+c)/d*h-n,this.calcMaxScroll(h));}this.enableScrollX&&(u-=s*this.moveSpeed,u=kz(u,0,this.maxScrollLeft)),this.enableScrollY&&(c-=l*this.moveSpeed,c=kz(c,0,this.maxScrollTop)),a.length>60&&sI(a).call(a,0,30),a.push({scrollLeft:u,scrollTop:c,timeStamp:t}),this.publish(u,c,h);}else{var f=this.locking?this.scrollThreshold:0,v=this.moveThreshold,g=Math.abs(r-this.startX),m=Math.abs(n-this.startY);this.enableScrollX=this.scrollingX&&g>=f,this.enableScrollY=this.scrollingY&&m>=f,a.push({scrollLeft:this.scrollLeft,scrollTop:this.scrollTop,timeStamp:t}),this.isDragging=(this.enableScrollX||this.enableScrollY)&&(g>=v||m>=v),this.isDragging&&(this.interruptedAnimation=!1);}this.lastX=r,this.lastY=n,this.lastTimeStamp=t,this.lastScale=i;}}},{key:"onEndHandler",value:function value(e){if(this.canScroll()&&this.isStart&&this.isProcessing){if(e instanceof Date&&(e=e.valueOf()),this.isProcessing=!1,this.isDragging)if(this.isDragging=!1,this.isSingleTouch&&this.animating&&e-this.lastTimeStamp<100){for(var t=this.positions,i=this.decelerationVelocityThreshold,r=t.length-1,n=r,o=r;o>0&&t[o].timeStamp>this.lastTimeStamp-100;o--)n=o;if(n!==r){var a=t[r].timeStamp-t[n].timeStamp,s=this.scrollLeft-t[n].scrollLeft,l=this.scrollTop-this.positions[n].scrollTop;this.decelerationVelocityX=s/a*(1e3/60),this.decelerationVelocityX=l/a*(1e3/60),Math.abs(this.decelerationVelocityX)>i||Math.abs(this.decelerationVelocityY)>i?this.startDeceleration(e):this.hooks.scrollComplete.emit();}else this.hooks.scrollComplete.emit();}else e-this.lastTimeStamp>100&&this.hooks.scrollComplete.emit();this.isDecelerating||((this.interruptedAnimation||this.isDragging)&&this.hooks.scrollComplete.emit(),this.scrollTo(this.scrollLeft,this.scrollTop,!0,this.zoom)),this.isStart=!1,this.isMoving=!1,this.positions.length=0;}}},{key:"onZoomHandler",value:function value(e,t,i){this.zoomTo(this.zoom*e,!1,t,i);}},{key:"onWheelHandler",value:function value(e){if(!e.ctrlKey){var t=this.scrollLeft,i=this.scrollTop;e.shiftKey?t=this.scrollLeft+e.deltaY:i=this.scrollTop+e.deltaY,this.scrollTo(t,i);}}},{key:"publish",value:function value(e,t,i){var r=this,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=this.isAnimating;if(o&&(this.cancelAnimate(this.animationId),this.isAnimating=!1),n&&this.animating){this.futureLeft=e,this.futureTop=t,this.futureZoom=i;var a=this.scrollLeft,s=this.scrollTop,l=this.zoom,u=function u(n,o){return o&&(r.scrollLeft=a+(e-a)*n,r.scrollTop=s+(t-s)*n,r.zoom=l+(i-l)*n,r.hooks.publish.emit(r.scrollLeft,r.scrollTop,r.zoom)),!0;},c=function c(e,t){r.animationId===e&&(r.isAnimating=!1),(r.isDecelerationComplete||t)&&r.hooks.scrollComplete.emit(),r.zooming&&(r.calcMaxScroll(),r.hooks.zoomComplete.emit());};this.isAnimating=!0,this.animationId=this.animate(u,c,this.animationDuration,o?Kz:Gz);}else this.futureLeft=e,this.futureTop=t,this.futureZoom=i,this.scrollLeft=e,this.scrollTop=t,this.zoom=i,this.hooks.publish.emit(e,t,i),this.zooming&&(this.calcMaxScroll(),this.hooks.zoomComplete.emit());}},{key:"startDeceleration",value:function value(e){}},{key:"animate",value:function value(e,t,i,r){var n=new lO(e,t,i,r);return this.animations[n.id]=n,n.play(),n.id;}},{key:"cancelAnimate",value:function value(e){var t=this.animations[e];t&&(t.cancel(),delete this.animations[e]);}},{key:"calcMaxScroll",value:function value(e){e=e||this.zoom,this.maxScrollLeft=Math.max(0,this.contentWidth*e-this.viewportWidth),this.maxScrollTop=Math.max(0,this.contentHeight*e-this.viewportHeight);}}]),i;}($z),cO=function(e){lb(i,e);var t=ub(i);function i(){return ak(this,i),t.apply(this,arguments);}return ok(i,[{key:"render",value:function value(e,t){e.parsedCheckBoxStyle=hO(e,e.checkBoxStyle);var i=e.parsedCheckBoxStyle.opacity;t.save(),t.globalAlpha=i,this.renderBox(e,t,"out"),t.clip(),this.renderBox(e,t,"in"),iE(this).call(this,e,t),this.renderBox(e,t,"center"),this.stroke(e,t),this.renderCheckMark(e,t),t.restore();}},{key:"renderBox",value:function value(e,t,i){var r=e.parsedCheckBoxStyle,n=r.x,o=r.y,a=r.width,s=r.height,l=r.borderWidth,u=r.borderRadiusX,c=r.borderRadiusY,h=0;"center"===i?h=l/2:"in"===i&&(h=l);var d=[{x:n+u,y:o+c,start:Math.PI,end:3*Math.PI/2},{x:n+a-u,y:o+c,start:3*Math.PI/2,end:2*Math.PI},{x:n+a-u,y:o+s-c,start:0,end:Math.PI/2},{x:n+u,y:o+s-c,start:Math.PI/2,end:Math.PI}],f=Math.max(u-h,0),v=Math.max(c-h,0);if(t.beginPath(),t.ellipse)for(var g=0;g<4;g++){var m=d[g],y=m.x,p=m.y,w=m.start,b=m.end;t.ellipse(y,p,f,v,0,w,b);}else t.rect(n,o,a,s);t.closePath();}},{key:"fill",value:function value(e,t){var i=e.parsedCheckBoxStyle.background;if(fz()){var r=TR(i);t.fillStyle=r.formatted;}else t.fillStyle=i;iE(t).call(t);}},{key:"stroke",value:function value(e,t){var i=e.parsedCheckBoxStyle,r=i.borderColor,n=i.borderWidth;if(fz()){var o=TR(r);t.strokeStyle=o.formatted;}else t.strokeStyle=r;t.lineWidth=n,n>0&&t.stroke();}},{key:"renderCheckMark",value:function value(e,t){if(e.checked){var i=e.parsedCheckBoxStyle,r=i.x,n=i.y,o=i.width,a=i.height,s=i.borderWidth,l=i.checkMarkLineWidth,u=i.checkMarkColor,c=Math.max(Math.min(o-2*s,a-2*s),0),h=r,d=n;if(0!==c){if(o<a?(h+=s,d=d+s+(a-o)/2):(h=h+s+(o-a)/2,d+=s),t.lineWidth=l,fz()){var f=TR(u);t.strokeStyle=f.formatted;}else t.strokeStyle=u;t.beginPath(),t.moveTo(h+.15*c,d+.5*c),t.lineTo(h+.4*c,d+.8*c),t.lineTo(h+.85*c,d+.2*c),t.stroke();}}}}]),i;}(HL);function hO(e,t){var i,r,n,o=iz(t),a=e.parentNode.width||100,s=e.parentNode.height||100;dk(i=["borderWidth","checkMarkLineWidth","opacity","fontSize"]).call(i,function(e){nz(o[e])||(o[e]=pR(o[e]).value||0);}),dk(r=["left","top","right","bottom","width","height"]).call(r,function(e){var t,i=-1!==DT(t=["left","right","width"]).call(t,e)?a:s,r=dL(o[e],i);o[e]=r;}),cz(t.width)||null!==o.width||(cz(o.left)&&cz(o.right)?o.width=a-o.left-o.right:o.width=0),cz(t.height)||null!==o.height||(cz(o.bottom)&&cz(o.top)?o.height=s-o.top-o.bottom:o.height=0),dk(n=["borderRadius","translateX","translateY"]).call(n,function(e){var t=o.width,i=o.height,r=Math.max,n=Math.min;if("borderRadius"===e){var a=dL(o[e],t),s=dL(o[e],i);o.borderRadiusX=r(0,n(a,t/2)),o.borderRadiusY=r(0,n(s,i/2));}"translateX"===e&&(o[e]=dL(o[e],t)),"translateY"===e&&(o[e]=dL(o[e],i));});var l=o.left,u=o.top,c=o.right,h=o.bottom,d=o.translateX,f=o.translateY,v=o.borderWidth,g=l,m=u;return 2*v>o.width&&(o.width=2*v),2*v>o.height&&(o.height=2*v),cz(o.right)&&!cz(o.left)&&(g=a-o.width-c),cz(o.bottom)&&!cz(o.top)&&(m=s-o.height-h),rk({x:g+d,y:m+f},o);}var dO=function(e){lb(i,e);var t=ub(i);function i(){return ak(this,i),t.apply(this,arguments);}return ok(i,[{key:"render",value:function value(e,t){e.parsedPageNumberStyle=hO(e,e.pageNumberStyle);var i=e.parsedPageNumberStyle.opacity;t.save(),t.globalAlpha=i,this.renderBox(e,t,"out"),t.clip(),this.renderBox(e,t,"in"),iE(this).call(this,e,t),this.renderBox(e,t,"center"),this.stroke(e,t),this.renderFont(e,t),t.restore();}},{key:"renderBox",value:function value(e,t,i){var r=e.parsedPageNumberStyle,n=r.x,o=r.y,a=r.width,s=r.height,l=r.borderWidth,u=r.borderRadiusX,c=r.borderRadiusY,h=0;"center"===i?h=l/2:"in"===i&&(h=l);var d=[{x:n+u,y:o+c,start:Math.PI,end:3*Math.PI/2},{x:n+a-u,y:o+c,start:3*Math.PI/2,end:2*Math.PI},{x:n+a-u,y:o+s-c,start:0,end:Math.PI/2},{x:n+u,y:o+s-c,start:Math.PI/2,end:Math.PI}],f=Math.max(u-h,0),v=Math.max(c-h,0);if(t.beginPath(),t.ellipse)for(var g=0;g<4;g++){var m=d[g],y=m.x,p=m.y,w=m.start,b=m.end;t.ellipse(y,p,f,v,0,w,b);}else t.rect(n,o,a,s);t.closePath();}},{key:"renderFont",value:function value(e,t){var i,r=e.parsedPageNumberStyle,n=r.x,o=r.y,a=r.width,s=r.height,l=r.fontSize,u=r.color,c=r.fontFamily;if(fz()){var h=TR(u);t.fillStyle=h.formatted;}else t.fillStyle=u;t.textAlign="center",t.textBaseline="middle",t.font=Ck(i="".concat(l,"px ")).call(i,c),t.fillText(e.text,n+a/2,o+s/2+l/8,a);}},{key:"fill",value:function value(e,t){var i=e.parsedPageNumberStyle.background;if(fz()){var r=TR(i);t.fillStyle=r.formatted;}else t.fillStyle=i;iE(t).call(t);}},{key:"stroke",value:function value(e,t){var i=e.parsedPageNumberStyle,r=i.borderColor,n=i.borderWidth;if(fz()){var o=TR(r);t.strokeStyle=o.formatted;}else t.strokeStyle=r;t.lineWidth=n,n>0&&t.stroke();}}]),i;}(HL),fO=function(e){lb(i,e);var t=ub(i);function i(){return ak(this,i),t.apply(this,arguments);}return ok(i,[{key:"renderCheckMark",value:function value(e,t){var i=e.parsedCheckBoxStyle,r=i.x,n=i.y,o=i.width,a=i.height,s=i.borderWidth,l=i.checkMarkLineWidth,u=i.checkMarkColor,c=Math.max(Math.min(o-2*s,a-2*s),0),h=r,d=n;0!==c&&(o<a?(h+=s,d=d+s+(a-o)/2):(h=h+s+(o-a)/2,d+=s),t.lineWidth=l,t.strokeStyle=u,t.beginPath(),t.moveTo(h+.3*c,d+.3*c),t.lineTo(h+.7*c,d+.7*c),t.moveTo(h+.3*c,d+.7*c),t.lineTo(h+.7*c,d+.3*c),t.stroke());}}]),i;}(cO),vO=function(){function e(t){ak(this,e),tk(this,"isMarginFixed",!0),tk(this,"isGapFixed",!0),tk(this,"isBorderFixed",!0),tk(this,"viewWidth",0),tk(this,"viewHeight",0),tk(this,"validVisualWidth",0),tk(this,"validVisualHeight",0),tk(this,"visualWidth",0),tk(this,"visualHeight",0),tk(this,"layoutWidth",0),tk(this,"layoutHeight",0),tk(this,"validLayoutWidth",0),tk(this,"validLayoutHeight",0),tk(this,"currentLayoutWidth",0),tk(this,"currentLayoutHeight",0),tk(this,"layoutLeft",0),tk(this,"layoutTop",0),tk(this,"calcWidth",0),tk(this,"calcHeight",0),tk(this,"calcViewWidth",0),tk(this,"calcViewHeight",0),tk(this,"fixedWidth",0),tk(this,"fixedHeight",0),tk(this,"defaultWidth",600),tk(this,"defaultHeight",800),tk(this,"rowHeightArray",[]),tk(this,"columnWidthArray",[]),tk(this,"scrollbarWidth",17),tk(this,"zoom",1),tk(this,"_scrollLeft",0),tk(this,"scrollTop",0),tk(this,"realRow",void 0),tk(this,"realCol",void 0),tk(this,"skipCalcZoom",!1),tk(this,"isScrollbarAppeared",!1),tk(this,"isScrollbarXAppeared",!1),tk(this,"isScrollbarYAppeared",!1),tk(this,"isScrollbarChanged",!1),tk(this,"resized",!1),tk(this,"placeholderPages",[]),eM(this,t);}return ok(e,[{key:"scrollLeft",get:function get(){return this._scrollLeft;},set:function set(e){this._scrollLeft=e;}},{key:"resetScrollbarStatus",value:function value(){this.isScrollbarAppeared=!1,this.isScrollbarChanged=!1,this.isScrollbarXAppeared=!1,this.isScrollbarYAppeared=!1;}},{key:"reset",value:function value(){this.validVisualWidth=0,this.validVisualHeight=0,this.visualWidth=0,this.visualHeight=0,this.layoutWidth=0,this.layoutHeight=0,this.validLayoutWidth=0,this.validLayoutHeight=0,this.currentLayoutWidth=0,this.currentLayoutHeight=0,this.layoutLeft=0,this.layoutTop=0,this.calcWidth=0,this.calcHeight=0,this.calcViewWidth=0,this.calcViewHeight=0,this.fixedWidth=0,this.fixedHeight=0;}}]),e;}(),gO=function(e){lb(i,e);var t=ub(i);function i(e){var r;return ak(this,i),tk(rc(r=t.call(this,e)),"uid",void 0),tk(rc(r),"tabName",void 0),tk(rc(r),"type",void 0),tk(rc(r),"doc",void 0),tk(rc(r),"viewer",void 0),tk(rc(r),"current",-1),tk(rc(r),"selected",[]),tk(rc(r),"fitType","window"),tk(rc(r),"displayMode","single"),tk(rc(r),"toolType","default"),tk(rc(r),"keepZoom",!1),tk(rc(r),"isDirty",!0),tk(rc(r),"layoutStatus",void 0),tk(rc(r),"stepPageIdStack",[]),tk(rc(r),"redoStack",[]),tk(rc(r),"isDestroyed",!1),tk(rc(r),"preloadCount",1),tk(rc(r),"row",3),tk(rc(r),"column",3),tk(rc(r),"direction","vertical"),tk(rc(r),"dpr",1),tk(rc(r),"gap",20),tk(rc(r),"margin",10),tk(rc(r),"borderWidth",0),tk(rc(r),"hoveredBorderWidth",0),tk(rc(r),"selectedBorderWidth",0),tk(rc(r),"enableDWT1x1",!1),tk(rc(r),"shiftReference",null),tk(rc(r),"commandController",void 0),tk(rc(r),"topPageUid",null),tk(rc(r),"isTopPageChanged",!1),tk(rc(r),"isLoadPage",!1),eM(rc(r),e),r.layoutStatus=new vO({viewWidth:e.viewWidth||0,viewHeight:e.viewHeight||0}),r.commandController=new $N(),r;}return ok(i,[{key:"currentPage",get:function get(){return this.children[this.current];}},{key:"currentUid",get:function get(){var e;return null===(e=this.currentPage)||void 0===e?void 0:e.uid;}},{key:"children",get:function get(){return this.childNodes;}},{key:"total",get:function get(){return this.childNodes.length;}},{key:"setZoom",value:function value(e){var t;this.layoutStatus.zoom=e,dk(t=this.children).call(t,function(t){t.zoom=e;});}},{key:"destroy",value:function value(){sb(ob(i.prototype),"destroy",this).call(this),this.viewer=null,this.selected=null,this.isDestroyed=!0;}},{key:"updateShiftReference",value:function value(){this.shiftReference=this.currentUid;}},{key:"insertChild",value:function value(e,t){return this.appendChild(e,t),!0;}},{key:"removeChild",value:function value(e){var t=this.isChildExist(e),r=this.getChildIndex(e);return sb(ob(i.prototype),"removeChild",this).call(this,e),t&&this.selected.length&&(0===this.total?(this.current=-1,this.selected=[]):((this.current===r&&r===this.total||r<this.current)&&(this.current-=1),this.selected=[this.currentUid])),e;}},{key:"removeChildByIndex",value:function value(e){if(e>=0||e<this.total)return!1;var t=this.children[e];return this.removeChild(t),!0;}},{key:"removeChildByUid",value:function value(e){var t=this.getChildByUid(e);return!!t&&(this.removeChild(t),!0);}},{key:"move",value:function value(e,t){var i=this.children,r=cb(sI(i).call(i,e,1),1)[0];return!!r&&(sI(i).call(i,t,0,r),this.select([i[t].uid]));}},{key:"switch",value:function value(e,t){var i=this.children,r=this.current;return e!==t&&(this.swapChild(i[e],i[t]),r===e?this.select([i[t].uid]):r===t&&this.select([i[e].uid])),!0;}},{key:"swapChild",value:function value(e,t){if(!e.isEqualNode(t)){var i=this.getChildIndex(e),r=this.getChildIndex(t);this.children[i]=t,this.children[r]=e;}}},{key:"next",value:function value(){return 0===this.total?-1:(this.total-this.current>1&&(this.current+=1),this.selected=[this.children[this.current].uid],this.current);}},{key:"prev",value:function value(){return this.total<=0||this.current<0?-1:(this.current>0&&(this.current-=1),this.selected=[this.children[this.current].uid],this.current);}},{key:"first",value:function value(){return 0===this.total?-1:(this.current=0,this.selected=[this.children[0].uid],0);}},{key:"last",value:function value(){return 0===this.total?-1:(this.current=this.total-1,this.selected=[this.children[this.current].uid],this.current);}},{key:"goto",value:function value(e){var t,i=this;return 0===this.total?-1:(e!==this.current&&(e=kz(e,0,this.total-1),this.current=e),this.selected=[this.children[this.current].uid],dk(t=this.children).call(t,function(e){var t;e.isSelected=DT(t=i.selected).call(t,e.uid)>-1;}),this.current);}},{key:"select",value:function value(e){var t,i=e.length;if(0===i)return this.selected=e,this.current=-1,!0;var r=this.getIndexByUid(e[i-1]);return!(r<0||(dk(t=this.children).call(t,function(t){t.isSelected=DT(e).call(e,t.uid)>-1;}),this.selected=e,this.current=r,0));}},{key:"getSelected",value:function value(){var e;return ET(e=this.selected).call(e);}},{key:"getChildByIndex",value:function value(e){return this.children[e];}},{key:"getChildByUid",value:function value(e){var t;return gE(t=this.children).call(t,function(t){return t.uid===e;});}},{key:"getIndexByUid",value:function value(e){var t;return bI(t=this.children).call(t,function(t){return t.uid===e;});}},{key:"getUidByIndex",value:function value(e){var t;return null===(t=this.children[e])||void 0===t?void 0:t.uid;}},{key:"getChildIndex",value:function value(e){var t;return DT(t=this.children).call(t,e);}},{key:"getChildUids",value:function value(){var e;return jI(e=this.children).call(e,function(e){return e.uid;});}},{key:"reorder",value:function value(e){var t=this.children,i=e.length,r=[],n=!1;if(t.length!==i)return!1;for(var o=0;o<i;o++)e[o]===o||(n=!0);if(!n)return!0;for(var a=0;a<i;a++)r[a]=t[e[a]];for(var s=0;s<i;s++)t[s]=r[s];if(this.selected.length){var l=this.selected[this.selected.length-1],u=this.getIndexByUid(l);this.current=u;}return!0;}},{key:"updateLayoutStatus",value:function value(e){eM(this.layoutStatus,e);}}]),i;}(_R),mO=function(){function e(t){var i=t.tabMode;ak(this,e),tk(this,"tabs",void 0),tk(this,"mode",void 0),tk(this,"currentTabUid",void 0),tk(this,"isDestroyed",!1),tk(this,"hooks",{removeTab:Jz.create()}),tk(this,"tabSelectionStack",void 0),this.tabs=[],this.mode=i,this.currentTabUid=null,this.tabSelectionStack=[];}return ok(e,[{key:"destroy",value:function value(){var e;dk(e=this.tabs).call(e,function(e){return e.destroy();}),this.tabs=null,this.tabSelectionStack=null,this.isDestroyed=!0;}},{key:"clear",value:function value(){this.tabs=[],this.currentTabUid=null,this.tabSelectionStack=[];}},{key:"createTab",value:function value(e,t){var i,r=this,n=gE(i=this.tabs).call(i,function(t){return e.uid===t.uid;});if(!n){var o,a,s=rk({uid:e.uid,name:e.name,type:e.type},t);n=new gO(s),"single"===this.mode&&dk(o=ET(a=this.tabs).call(a)).call(o,function(e){r.closeTab(e.uid);}),this.tabs.push(n);}return n;}},{key:"find",value:function value(e){var t;return gE(t=this.tabs).call(t,function(t){return e===t.uid;});}},{key:"findIndex",value:function value(e){var t;return bI(t=this.tabs).call(t,function(t){return e===t.uid;});}},{key:"setCurrentTab",value:function value(e){var t,i;if(bI(this).call(this,e)<0)return!1;var r=DT(t=this.tabSelectionStack).call(t,e);return r>-1&&sI(i=this.tabSelectionStack).call(i,r,1),this.tabSelectionStack.push(e),this.currentTabUid=e,!0;}},{key:"closeTab",value:function value(e){if(!this.removeTab(e))return!1;var t=this.tabs,i=this.tabSelectionStack,r=DT(i).call(i,e);return sI(i).call(i,r,1),t.length?this.currentTabUid=i[i.length-1]:this.currentTabUid=null,!0;}},{key:"removeTab",value:function value(e){var t,i=bI(this).call(this,e);return i>-1&&(sI(t=this.tabs).call(t,i,1),this.hooks.removeTab.emit(e),!0);}},{key:"getCurTab",value:function value(){return gE(this).call(this,this.currentTabUid);}},{key:"getAllTabs",value:function value(){var e;return ET(e=this.tabs).call(e);}},{key:"setMode",value:function value(e){return("single"===e||"multiple"===e)&&(this.mode=e,!0);}}]),e;}(),yO=function(){function e(){ak(this,e),tk(this,"lastTopPageIndex",-1);}return ok(e,[{key:"init",value:function value(e){var t=e.uiService,i=e.rendererService,r=t.canvasContainer,n=t.getViewportSize(),o=n.width,a=n.height;i.initCanvas({container:r,width:o,height:a}),i.registerShapeRenderer("checkbox",new cO()),i.registerShapeRenderer("pageNumber",new dO()),i.registerShapeRenderer("removeBtn",new fO()),this.listenHooks(e);}},{key:"listenHooks",value:function value(e){var t=this,i=e.rendererService.hooks;i.beforeRender.on(this.beforeRenderListener),i.afterRender.on(this.afterRenderListener),e.hooksService.hooks.destroy.on(function(){i.beforeRender.off(t.beforeRenderListener),i.afterRender.off(t.afterRenderListener);});}},{key:"beforeRenderListener",value:function value(e){var t=e.tabService,i=e.config,r=t.getCurrentTab();if(r){var n,o="multiple"===i.displayMode;dk(n=r.children).call(n,function(t,n){var a,s=i.pageNumberStyle.visibility,l=i.checkboxStyle.visibility,u=i.removeBtnStyle.visibility;o||(s="hidden",l="hidden",u="hidden"),t.pageNumber.updateText(String(n+1)),t.pageNumber.updateStyle({visibility:s}),t.checkbox.checked=DT(a=r.selected).call(a,t.uid)>-1,t.checkbox.updateStyle({visibility:l}),t.removeBtn.updateStyle({visibility:u});var c=r.selected,h=i.pageStyle;o&&(gE(c).call(c,function(e){return e===t.uid;})?h=i.selectedPageStyle:t.isHovered&&(h=i.hoveredPageStyle));var d=h,f=d.background,v=d.border,g={};v&&(g=HN(v));var m=g.borderWidth;if(i.enableSingleModeBorder||"single"!==i.displayMode&&"slide"!==i.displayMode||(m=0),t.borderBox.updateStyle(rk(rk({background:f},g),{},{borderWidth:m})),t.isDragging&&o){g={};var y=i.placeholderStyle,p=y.background,w=y.border;w&&(g=HN(w)),t.updateStyle(rk({background:p},g));}else t.updateStyle({background:"#ffffff00",borderWidth:0});"slide"!==i.displayMode&&"single"!==i.displayMode&&"doc"!==i.displayMode||t.borderBox.updateStyle({background:"rgba(255,255,255,0)"}),!vz()&&!fz()&&!t.isOptimized&&t.isVisible&&t.isLoaded&&t.zoom<1&&new QE(function(e,t){RE(function(){e(null);},500);}).then(function(){e.optimizePage(t.uid);});});}}},{key:"afterRenderListener",value:function value(e){var t,i=e.tabService,r=e.config,n=e.rendererService,o=i.getCurrentTab();if(o&&(o.isTopPageChanged||-1!==n.lastTopPageIndex&&0===o.total)&&(o.isTopPageChanged=!1,"multiple"===r.displayMode)){var a=o.getIndexByUid(o.topPageUid);a!==n.lastTopPageIndex&&(e.emit("topPageChanged",a),n.lastTopPageIndex=a);}o&&dk(t=o.children).call(t,function(t,i){t.isPageRendered&&t.isVisible&&(t.isPageRendered=!1,t.isUpdated=!1,t.isEdited=!1,r.enableEmitPageRendered&&e.emit("pageRendered",i));});}}]),e;}(),pO=function(){function e(){ak(this,e);}return ok(e,[{key:"init",value:function value(e){this.listenNativeEvent(e),this.listenViewerHooks(e);}},{key:"listenViewerHooks",value:function value(e){var t=e.hooksService.hooks,i=function i(t){var i,r,n,o=t.tabNode,a=(null==o||null===(i=o.layoutStatus)||void 0===i?void 0:i.currentLayoutWidth)||0,s=(null==o||null===(r=o.layoutStatus)||void 0===r?void 0:r.currentLayoutHeight)||0;a=Math.max(Math.floor(a)-1,0),s=Math.max(Math.floor(s)-1,0),e.uiService.updateScrollContentSize(a,s),e.scrollerService.updateScroller({contentWidth:a,contentHeight:s}),"single"===e.config.displayMode&&(e.config.zoom=o.layoutStatus.zoom),0!==o.layoutStatus.viewWidth&&0!==o.layoutStatus.viewHeight&&dk(n=o.children).call(n,function(t){if(t.isPreload)t.isLoaded||t.imageContainer.imageData||("multiple"===e.config.displayMode&&e.config.useMinImage?e.dvsContext.minImageService.load(t.uid):e.dvsContext.imageService.load(t.uid));else{t.image.style.img=null,t.isLoaded=!1;var i=e.dvsContext.viewerService.isPageNeedLoad(t.uid);if(i.min&&"multiple"===e.config.displayMode&&e.config.useMinImage){var r=e.getStatus(t.uid);r&&(r.minImg=null);}if(i.ori&&"single"===e.config.displayMode){var n=e.getStatus(t.uid);n&&(n.img=null);}}});},r=function r(t){if(!t.isPassive&&e.config.autoScroll&&"single"!==e.config.displayMode&&"slide"!==e.config.displayMode){var i=e.getCurrentTab(),r=i.layoutStatus,n=r.viewWidth,o=r.viewHeight,a=r.rowHeightArray,s=r.columnWidthArray,l=r.placeholderPages,u=r.scrollLeft,c=r.scrollTop,h=r.realRow,d=r.realCol,f=i.currentPage,v=i.current,g=i.row,m=i.column,y=i.enableDWT1x1,p=f.getLocalPosition(),w=p.x,b=p.y,k=f.viewportPosition,x=u,S=c,C=!1,V=0,T=e.getMargin(),I=e.getGap(),E=1===m&&1===g&&y;if("multiple"===e.config.displayMode)"ahead"===k.x?(x=w-(V=0===k.column?T:E?0:I),C=!0):"behind"===k.x&&(V=k.column===d-1?T:E?0:I,x=w+s[0]-n+V,i.total<=i.row*i.column&&(x=i.getChildByIndex(0).getLocalPosition().x-T),C=!0),"ahead"===k.y?(S=b-(V=0===k.row?T:E?0:I),C=!0):"behind"===k.y&&(V=k.row===h-1?T:E?0:I,S=b+a[0]-o+V,i.total<=i.row*i.column&&(S=i.getChildByIndex(0).getLocalPosition().y-T),C=!0);else if("doc"===e.config.displayMode){var P=l[v];if("ahead"===k.x&&P.x<=i.gap?(C=!0,x=P.x-i.gap):"behind"===k.x&&P.x<=i.gap&&(C=!0,x=P.x+P.width-n+i.gap,P.width>n&&(x=P.x-i.gap)),i.getChildByIndex(i.total-1).getLocalPosition(),l[i.total-1].height,i.margin,"ahead"===k.y)C=!0,S=P.y-i.gap;else if("behind"===k.y){C=!0,S=P.y+P.height-o+i.gap;var B=i.layoutStatus;B.validLayoutHeight*B.zoom+B.fixedHeight<=o&&(S=0),P.height>o&&(S=P.y-i.gap);}}C&&(i.setPosition({x:-x,y:-S}),i.updateLayoutStatus({scrollLeft:x,scrollTop:S}),e.scrollerService.updateScroller({scrollLeft:x,scrollTop:S}),0===i.current?e.uiService.scrollTo(x+1,S+100):i.current===i.total-1&&e.uiService.scrollTo(x-100,S-100),e.uiService.scrollTo(x,S));}};e.layoutService.hooks.afterLayout.on(i),t.currentIndexChanged.on(r),e.hooksService.hooks.destroy.on(function(){e.layoutService.hooks.afterLayout.off(i),t.currentIndexChanged.off(r);});}},{key:"listenNativeEvent",value:function value(e){var t=e.rendererService.canvasDom,i=function i(t){e.scrollerService.mousedownListener(t);},r=function r(t){e.scrollerService.mousemoveListener(t);},n=function n(t){e.scrollerService.mouseupListener(t);},o=function o(t){e.scrollerService.mousedownListener(t);},a=function a(t){e.scrollerService.mousemoveListener(t);},s=function s(t){e.scrollerService.mouseupListener(t);},l=function l(t){var i=e.tabService.getCurrentTab();null==i||!i.total||0===i.selected.length&&"single"===e.config.displayMode||e.scrollerService.wheelListener(t);},u=function u(e){e.cancelable&&e.preventDefault();};t.addEventListener("wheel",l,{passive:!1}),t.addEventListener("touchstart",o,{passive:!1}),t.addEventListener("touchmove",u,{passive:!1}),document.addEventListener("touchmove",a,{passive:!1}),document.addEventListener("touchend",s),t.addEventListener("mousedown",i),document.addEventListener("mousemove",r),document.addEventListener("mouseup",n),e.hooksService.hooks.destroy.on(function(){t.removeEventListener("wheel",l),t.removeEventListener("touchstart",o),t.removeEventListener("touchmove",u),document.removeEventListener("touchmove",a),document.removeEventListener("touchend",s),t.removeEventListener("mousedown",i),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",n);});}}]),e;}(),wO=function(){function e(){ak(this,e);}return ok(e,[{key:"init",value:function value(e){this.listenViewerHooks(e);}},{key:"listenTabHooks",value:function value(e){var t=function t(_t4){e.hooksService.hooks.removeTab.emit(_t4);};e.tabService.tabManager.hooks.removeTab.on(t),e.hooksService.hooks.destroy.on(function i(){e.tabService.tabManager.hooks.removeTab.off(t),e.hooksService.hooks.destroy.off(i);});}},{key:"listenViewerHooks",value:function value(e){var t=this,i={beforeStatus:null,afterStatus:null,operation:null,docUid:null},r=function r(_r2){var n=_r2.modifiedUid,o=_r2.docUid,a=_r2.removedUids,s=e.tabService.getTab(o);s&&e.tabService.isCurrentTab(o)&&(i.beforeStatus=t.createBufferStatus(s,n,a));},n=function n(r){var n=r.modifiedUid,o=r.docUid,a=r.operation,s=r.removedUids,l=e.tabService.getTab(o);if(l&&e.tabService.isCurrentTab(o)){var u,c;i.afterStatus=t.createBufferStatus(l,n,s),i.operation=a,i.docUid=o,i.curIndex=l.current||0,i.total=l.total||0;var h=e.viewer.getSelectedIndexes();e.emit("_imageSelectedUI",h),e.emit("imageSelected",h);var d=l.current,f=l.total;e.emit("_dvsPagerChanged",{current:d,total:f}),e.emit("bufferChanged",rk({},i));var v=null===(u=i.beforeStatus)||void 0===u?void 0:u.currentUid,g=null===(c=i.afterStatus)||void 0===c?void 0:c.currentUid;if("add"===a&&v!==g){var m=iz(i);m.operation="shift",e.emit("bufferChanged",m);}}i={beforeStatus:null,afterStatus:null,operation:null,docUid:null,curIndex:0,total:0};},o=function o(t){e.tabService.openDoc(t);},a=e.hooksService.hooks;a.beforeBufferChanged.on(r),a.afterBufferChanged.on(n),a.openDoc.on(o);e.hooksService.hooks.destroy.on(function t(){a.beforeBufferChanged.off(r),a.afterBufferChanged.off(n),a.openDoc.off(o),e.hooksService.hooks.destroy.off(t);});}},{key:"createBufferStatus",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return{uids:e.getChildUids(),selectedUids:e.getSelected(),currentUid:e.currentUid,modifiedUid:t,removedUids:i};}}]),e;}();function bO(e,t){if(tz(t)){eM(e.config.viewerStyle,t);var i=e.uiService,r=i.scrollContainer,n=i.canvasContainer,o=e.getBorderWidth(e.config.viewerStyle);n&&r&&(eM(n.style,{left:"".concat(o,"px"),top:"".concat(o,"px")}),eM(r.style,t),e.resized());}}function kO(e,t){if(tz(t)){eM(e.config.canvasStyle,t);var i,r=e.rendererService.canvasDom;if(r)eM(r.style,t),DT(i=gk(t||{})).call(i,"border")>-1&&e.resized();}}function xO(e,t){if(tz(t)){var i;eM(e.config.pageStyle,t);var r=e.getBorderWidth(e.config.pageStyle);dk(i=e.getAllTabs()).call(i,function(e){e.borderWidth=r;}),e.clearCurTabOptimization(),e.render();}}function SO(e,t){if(tz(t)){var i;eM(e.config.selectedPageStyle,t);var r=e.getBorderWidth(e.config.selectedPageStyle);dk(i=e.getAllTabs()).call(i,function(e){e.selectedBorderWidth=r;}),e.clearCurTabOptimization(),e.render();}}function CO(e,t){if(tz(t)){var i;eM(e.config.hoveredPageStyle,t);var r=e.getBorderWidth(e.config.hoveredPageStyle);dk(i=e.getAllTabs()).call(i,function(e){e.hoveredBorderWidth=r;}),e.clearCurTabOptimization(),e.render();}}function VO(e,t){tz&&(eM(e.config.placeholderStyle,t),e.render());}function TO(e,t){var i;tz(t)&&(eM(e.config.pageNumberStyle,t),dk(i=e.getAllTabs()).call(i,function(t){var i;dk(i=t.children).call(i,function(t){t.pageNumber.updateStyle(e.config.pageNumberStyle);});}),e.rendererService.render());}function IO(e,t){var i;tz(t)&&(eM(e.config.checkboxStyle,t),dk(i=e.getAllTabs()).call(i,function(t){var i;dk(i=t.children).call(i,function(t){t.checkbox.updateStyle(e.config.checkboxStyle);});}),e.rendererService.render());}function EO(e,t){var i;tz(t)&&(eM(e.config.removeBtnStyle,t),dk(i=e.getAllTabs()).call(i,function(t){var i;dk(i=t.children).call(i,function(t){t.removeBtn.updateStyle(e.config.removeBtnStyle);});}),e.rendererService.render());}function PO(e,t){e.config.enableDragPage=t;}function BO(e,t){e.config.enableKeyboardControl=t;}function DO(e,t){e.config.multiselectMode=t;}function MO(e,t){e.config.zoomOrigin=t;}function AO(e,t){t=kz(t,e.config.minZoom,e.config.maxZoom),e.zoomService.zoomTo(t),e.config.zoom=t;}function zO(e,t){e.config.minZoom=t;}function UO(e,t){e.config.maxZoom=t;}function RO(e,t){e.config.enableZoom=t;}function LO(e,t){e.config.enableScrollX=t;}function NO(e,t){e.config.enableScrollY=t;}function OO(e,t){e.config.keepZoom=t;}function WO(e,t){e.config.zoomInDelta=t;}function HO(e,t){e.config.zoomOutDelta=t;}function FO(e,t){e.config.wheelZoomDelta=t;}function jO(e,t){e.config.scrollDirection=t;var i=e.getCurrentTab();i&&(i.direction=t,e.resized());}function YO(e,t){var i,r=t!==e.config.displayMode;e.config.displayMode=t;var n=e.getCurrentTab();n&&(n.displayMode=t,dk(i=n.children).call(i,function(e){e.isLoaded=!1;}),e.showTab(n),r&&e.resetScrollbarStatus(),e.clearCurTabOptimization(),e.render(),"multiple"===t&&e.emitCurrentIndexChanged());}function XO(e,t){e.config.toolType=t;var i=e.getCurrentTab();i&&(i.toolType=t,e.rendererService.render());}function qO(e,t){if(e.config.fitType!==t){e.config.fitType=t;var i=e.getCurrentTab();if(i){i.fitType=t,e.resetScrollbarStatus(),e.resetScrollerSize(),e.resize(),e.clearCurTabOptimization(),e.render();var r=e.uiService.scrollContainer,n=r.scrollWidth,o=r.scrollHeight,a=n-r.clientWidth,s=o-r.clientHeight,l=e.config.zoomOrigin,u=l.x,c=l.y,h=0,d=0;"center"===u?h=a/2:"right"===u&&(h=a),"center"===c?d=s/2:"bottom"===c&&(d=s),0===h&&0===d||e.uiService.scrollTo(h,d);}}}function ZO(e,t){if(e.config.show!==t){e.config.show=t;var i=e.uiService,r=i.rootDom,n=i.defaultDom;if(r&&(t?(r.style.display="flex",n.style.display="flex"):r.style.display="none"),e.resized(),t){var o=e.getCurrentTab();o&&(e.showTab(o),e.renderOnly());}}}function _O(e,t){e.setViewMode(t,e.config.columns);}function GO(e,t){e.setViewMode(e.config.rows,t);}function KO(e,t){e.config.pure=!0;}function $O(e,t){e.config.margin!==t&&(e.config.margin=t,e.clearCurTabOptimization(),e.render());}function QO(e,t){e.config.gap!==t&&(e.config.gap=t,e.clearCurTabOptimization(),e.render());}function JO(e,t){e.config.autoChangeIndex=t;}function eW(e,t){e.config.autoScroll=t;}function tW(e,t){e.config.autoSelectLatest=t;}function iW(e,t){e.config.enableSelectWithShift=t;}function rW(e,t){e.config.enableZoomWithCtrl=t;}function nW(e,t){e.config.enableSelectWithCtrl=t;}function oW(e,t){"single"===t||"multiple"===t?(e.config.tabMode=t,e.tabService.tabManager.setMode(t),e.ok()):e.err(KA);}function aW(e,t){e.config.enableSyncSelect=t;}function sW(e,t){e.config.enableSingleModeBorder=t;}function lW(e,t){e.config.blankFillColor=t;}function uW(e,t){e.config.dragThreshold=t;}function cW(e,t){e.config.slideThreshold=t;}function hW(e,t){e.config.maxOptimizationSize=t;}function dW(e,t){e.config.enableSlide=t;}function fW(e,t){e.config.enableDWT1x1=t;}function vW(e,t){e.config.enableEmitPageRendered=t;}function gW(e,t){e.config.autoSelectTopPage=t;}function mW(e,t){e.config.enableOptimizeImage=t;}function yW(e,t){e.config.useMinImage=t;}var pW=function(){function e(t){ak(this,e),tk(this,"context",void 0),tk(this,"handlers",{}),this.context=t,this.initHandlers();}return ok(e,[{key:"destroy",value:function value(){this.context=null,this.handlers={};}},{key:"updateConfig",value:function value(e){for(var t=0,i=GE(e);t<i.length;t++){var r=cb(i[t],2),n=r[0],o=r[1],a=this.handlers[n];a&&a(this.context,o);}}},{key:"registerHandler",value:function value(e,t){return!this.handlers[e]&&(this.handlers[e]=t,!0);}},{key:"initHandlers",value:function value(){var e={viewerStyle:bO,canvasStyle:kO,pageStyle:xO,selectedPageStyle:SO,hoveredPageStyle:CO,placeholderStyle:VO,pageNumberStyle:TO,checkboxStyle:IO,removeBtnStyle:EO,enableDragPage:PO,enableKeyboardControl:BO,multiselectMode:DO,zoomOrigin:MO,zoom:AO,minZoom:zO,maxZoom:UO,enableZoom:RO,enableScrollX:LO,enableScrollY:NO,keepZoom:OO,zoomInDelta:WO,zoomOutDelta:HO,wheelZoomDelta:FO,scrollDirection:jO,displayMode:YO,toolType:XO,fitType:qO,show:ZO,rows:_O,columns:GO,pure:KO,margin:$O,gap:QO,autoChangeIndex:JO,autoScroll:eW,autoSelectLatest:tW,enableSelectWithShift:iW,enableZoomWithCtrl:rW,enableSelectWithCtrl:nW,tabMode:oW,enableSyncSelect:aW,enableSingleModeBorder:sW,blankFillColor:lW,dragThreshold:uW,slideThreshold:cW,maxOptimizationSize:hW,enableSlide:dW,enableDWT1x1:fW,enableEmitPageRendered:vW,enableOptimizeImage:mW,useMinImage:yW,autoSelectTopPage:gW};this.handlers=e;}}]),e;}(),wW=ok(function e(t){ak(this,e),tk(this,"hooks",{init:Jz.create(),destroy:Jz.create(),beforeLayout:Jz.create(),layout:Jz.create(),afterLayout:Jz.create(),beforeRender:Jz.create(),render:Jz.create(),afterRender:Jz.create(),resize:Jz.create(),externalResized:Jz.create(),bindContainer:Jz.create(),pageChanged:Jz.create(),afterScroll:Jz.create(),afterZoom:Jz.create(),mousedown:Jz.create(),mousemove:Jz.create(),mouseup:Jz.create(),mouseover:Jz.create(),mouseout:Jz.create(),click:Jz.create(),dblclick:Jz.create(),wheel:Jz.create(),contextmenu:Jz.create(),dragStart:Jz.create(),loadImage:Jz.create(),update:Jz.create(),remove:Jz.create(),move:Jz.create(),switch:Jz.create(),reorder:Jz.create(),changePage:Jz.create(),selectPage:Jz.create(),beforeBufferChanged:Jz.create(),afterBufferChanged:Jz.create(),currentIndexChanged:Jz.create(),scrollValueChanged:Jz.create(),tabCleared:Jz.create(),focusChanged:Jz.create(),removePagesFromDoc:Jz.create(),appendPagesToDoc:Jz.create(),openDoc:Jz.create(),removeTab:Jz.create()}),tk(this,"context",void 0),this.context=t;}),bW=function(){function e(t){ak(this,e),tk(this,"hooks",{beforeLayout:Jz.create(),layout:Jz.create(),afterLayout:Jz.create()}),tk(this,"context",void 0),this.context=t;}return ok(e,[{key:"layout",value:function value(e){this.hooks.beforeLayout.emit({tabNode:e}),this.context.dvsContext.layoutService.layout(e),e.layoutStatus.isScrollbarChanged&&(e.layoutStatus.isScrollbarChanged=!1,this.hooks.afterLayout.emit({tabNode:e}),this.context.resize(),this.context.clearCurTabOptimization(),this.context.dvsContext.layoutService.layout(e)),this.hooks.afterLayout.emit({tabNode:e});}}]),e;}(),kW=function(){function e(t){ak(this,e),tk(this,"canvasDom",void 0),tk(this,"hooks",{beforeRender:Jz.create(),render:Jz.create(),afterRender:Jz.create()}),tk(this,"context",void 0),tk(this,"canvas",void 0),tk(this,"renderer",void 0),tk(this,"isInitialized",!1),tk(this,"lastTopPageIndex",-1),this.context=t;}return ok(e,[{key:"render",value:function value(){if("single"===this.context.config.displayMode){var e,t=null===(e=this.context)||void 0===e?void 0:e.getCurrentTab();if(t){var i=t.currentPage;if(i&&!i.isLoaded)return;}}this.hooks.beforeRender.emit(this.context),this.internalRender(),this.hooks.afterRender.emit(this.context);}},{key:"internalRender",value:function value(){var e,t,i=null===(e=this.context)||void 0===e?void 0:e.getCurrentTab(),r=this.canvas.document.documentElement;if(i)0===r.children.length?r.appendChild(i):DT(t=r.children).call(t,i)<0&&r.replaceChild(i,r.children[0]);else for(var n=r.childNodes.length-1;n>=0;n--)r.removeChild(r.childNodes[n]);this.canvas.render();}},{key:"initCanvas",value:function value(e){var t=e.container,i=e.width,r=e.height,n=new nN({}),o=new WL({renderer:n,container:t,width:i,height:r});this.renderer=n,this.canvas=o,this.canvasDom=o.contextService.getDomElement(),eM(this.canvasDom.style,this.context.config.canvasStyle),this.isInitialized=!0;}},{key:"registerShapeRenderer",value:function value(e,t){this.canvas.contextService.registerShapeRenderer(e,t);}},{key:"getCanvasPosition",value:function value(){var e=this.canvasDom.getBoundingClientRect(),t=_z(),i=t.scrollX,r=t.scrollY;return{x:e.left+i,y:e.top+r};}},{key:"resetCanvasSize",value:function value(){this.canvasDom.style.width="0px",this.canvasDom.style.height="0px";}}]),e;}(),xW=function(){function e(t){var i=this;ak(this,e),tk(this,"context",void 0),tk(this,"isStart",!1),tk(this,"scroller",void 0),tk(this,"startDistance",0),tk(this,"startZoom",1),tk(this,"lastScale",1),tk(this,"originX",0),tk(this,"originY",0),tk(this,"startX",0),tk(this,"startY",0),tk(this,"isSliding",!1),tk(this,"isZoom",!1),tk(this,"slideDirection","left"),tk(this,"slideDistance",0),tk(this,"slideTimer",null),tk(this,"wheelTimer",null),tk(this,"touchZoomTimer",null),tk(this,"startTime",0),tk(this,"isScrolling",!1),tk(this,"scrollTimer",null),tk(this,"scrollDirectionX","left"),tk(this,"scrollDirectionY","up"),tk(this,"lineHeight",this.getLineHeight()),tk(this,"startHandler",function(e,t){var r=i.context.config;"default"===r.toolType?(i.isStart=!0,e.length>1&&(i.startDistance=Math.pow(Math.pow(e[0].pageX-e[1].pageX,2)+Math.pow(e[0].pageY-e[1].pageY,2),.5)),i.scroller.onStartHandler(e,t)):"zoomIn"===r.toolType&&"multiple"!==r.displayMode?i.context.zoomService.zoomTo(r.zoom*r.zoomInDelta,e[0].pageX,e[0].pageY):"zoomOut"===r.toolType&&"multiple"!==r.displayMode&&i.context.zoomService.zoomTo(r.zoom/r.zoomOutDelta,e[0].pageX,e[0].pageY);}),this.context=t,this.scroller=new uO(),this.scroller.hooks.publish.on(function(e,i,r){t.uiService.scrollTo(e,i);});}return ok(e,[{key:"getLineHeight",value:function value(){var e=getComputedStyle(document.body),t=e.lineHeight,i=e.fontSize;if(/\d+/.test(t)){var r=cb(t.match(/(\d+)/),1)[0];return fx(r,10);}if(/\d+/.test(i)){var n=cb(i.match(/(\d+)/),1)[0];return 1.2*fx(n,10);}return 16;}},{key:"destroy",value:function value(){this.wheelTimer&&(clearTimeout(this.wheelTimer),this.wheelTimer=null),this.touchZoomTimer&&(clearTimeout(this.touchZoomTimer),this.touchZoomTimer=null),this.scrollTimer&&(EU.clearTimer(this.scrollTimer),this.scrollTimer=null),this.slideTimer&&(EU.clearTimer(this.slideTimer),this.slideTimer=null);}},{key:"updateScroller",value:function value(e){this.scroller.updateScroller(e);}},{key:"mousedownListener",value:function value(e){var t;if(!(e instanceof MouseEvent&&"multiple"===this.context.config.displayMode||this.isSliding)){var i=null===(t=this.context)||void 0===t?void 0:t.getCurrentTab();if(i&&i.total){var r=this.context.formatTouches(e);this.startX=r[0].pageX,this.startY=r[0].pageY,this.lastScale=1,this.startTime=new Date().getTime(),this.isScrolling=!1,this.scrollTimer&&(EU.clearTimer(this.scrollTimer),this.scrollTimer=null),this.startZoom=this.context.config.zoom,this.startHandler(r,e.timeStamp);}}}},{key:"mousemoveListener",value:function value(e){var t,i=this;if(this.isStart){var r=this.context.formatTouches(e);if(window.TouchEvent&&e instanceof TouchEvent){if(this.context.draggingPrepared)return void(e.cancelable&&e.preventDefault());if(r.length>1&&this.context.config.enableZoom&&"single"===this.context.config.displayMode){var n=(r[0].pageX+r[1].pageX)/2,o=(r[0].pageY+r[1].pageY)/2,a=Math.pow(Math.pow(r[0].pageX-r[1].pageX,2)+Math.pow(r[0].pageY-r[1].pageY,2),.5)/this.startDistance;e.scale&&(a=e.scale);var s=this.context.config.zoom,l=s;return(s=this.startZoom*a)!==l&&(this.touchZoomTimer||(this.touchZoomTimer=RE(function(){i.context.zoomService.zoomTo(s,n,o),clearTimeout(i.touchZoomTimer),i.touchZoomTimer=null;},25))),this.lastScale=a,void(this.isZoom=!0);}}var u=null===(t=this.context)||void 0===t?void 0:t.getCurrentTab(),c=r[0].pageX-this.startX;if(u&&u.total){if(c>0?this.slideDirection="right":c<0&&(this.slideDirection="left"),this.slideDistance=Math.min(u.layoutStatus.viewWidth,Math.abs(c)),this.isSliding)return"right"===this.slideDirection?u.setPosition({x:this.slideDistance,y:0,z:0}):"left"===this.slideDirection&&u.setPosition({x:-this.slideDistance,y:0,z:0}),void this.context.renderOnly();"single"===this.context.config.displayMode&&"default"===this.context.config.toolType&&this.context.config.enableSlide&&Math.abs(c)>this.context.config.slideThreshold&&!this.context.uiService.isScrollbarAppeared()&&(this.isSliding=!0,this.context.updateViewerConfig({displayMode:"slide"}));}this.scroller.onMoveHandler(r,e.timeStamp);}}},{key:"slide",value:function value(e){var t,i=this,r=0,n=0,o=0,a=!1;this.slideDistance>=this.context.config.slideThreshold?(t=(n=e.layoutStatus.viewWidth)-this.slideDistance,"left"===this.slideDirection?e.current!==e.total-1?(o=-this.slideDistance,r=-t/8):(n=0,t=this.slideDistance,a=!0,o=-this.slideDistance,r=t/8):0!==e.current?(o=this.slideDistance,r=t/8):(n=0,t=this.slideDistance,a=!0,o=this.slideDistance,r=-t/8)):(a=!0,n=0,t=this.slideDistance,"left"===this.slideDirection?(o=-this.slideDistance,r=t/8):(o=this.slideDistance,r=-t/8)),this.slideTimer=EU.createTimer(function(){var t=(o+=r)>=0;if(Math.abs(o)>=n&&(o=n,t||(o*=-1)),e.setPosition({x:o,y:0,z:0}),Math.abs(o)===n)return a||("right"===i.slideDirection?i.context.viewer.prevPage():i.context.viewer.nextPage(),i.context.updateViewerConfig({fitType:"window"})),i.isSliding=!1,i.context.updateViewerConfig({displayMode:"single"}),void EU.clearTimer(i.slideTimer);i.context.renderOnly();},25);}},{key:"mouseupListener",value:function value(e){if(this.isStart){var t=this.context.formatTouches(e,!0),i=this.context.config.displayMode;if(this.isZoom||"slide"!==i){this.scroller.onEndHandler(e.timeStamp);var r=this.context.uiService.getMaxScrollValue(),n=r.maxScrollLeft,o=r.maxScrollTop,a=this.context.uiService.scrollContainer,s=a.scrollLeft,l=a.scrollTop;if(!this.isZoom&&!this.isSliding&&!this.isScrolling&&!this.context.draggingPrepared&&(n>0||o>0)&&window.TouchEvent&&e instanceof TouchEvent&&"default"===this.context.config.toolType){var u=new Date().getTime(),c=t[0].pageX,h=t[0].pageY,d=c-this.startX,f=h-this.startY,v=!1,g=!1;d>0?(v=0!==s,this.scrollDirectionX="right"):(v=s!==n,this.scrollDirectionX="left"),f>0?(g=0!==l,this.scrollDirectionY="down"):(g=l!==o,this.scrollDirectionY="up");var m=u-this.startTime;if((Math.abs(d)>10||Math.abs(f)>10)&&m>0&&m<300&&(v||g)){var y=Math.abs(d)/m,p=Math.abs(f)/m;(y>.4||p>.4)&&(y=Math.min(y,2.8),p=Math.min(p,2.8),this.scroll(y,p,-.05));}}}else{var w,b=null===(w=this.context)||void 0===w?void 0:w.getCurrentTab();b&&this.slide(b);}this.isStart=!1,this.lastScale=1,this.isZoom=!1;}}},{key:"scroll",value:function value(e,t,i){var r=this;this.isScrolling=!0;var n=this.context.uiService.scrollContainer,o=n.scrollLeft,a=n.scrollTop,s=0,l=0;this.scrollTimer=EU.createTimer(function(){var n=r.context.uiService.getMaxScrollValue(),u=n.maxScrollLeft,c=n.maxScrollTop;if(e<=0&&t<=0||!1===r.isScrolling)return EU.clearTimer(r.scrollTimer),r.scrollTimer=null,void(r.isScrolling=!1);e>=0&&("right"===r.scrollDirectionX?s-=40*e:s+=40*e,e+=i),t>=0&&("down"===r.scrollDirectionY?l-=40*t:l+=40*t,t+=i);var h=kz(o+s,0,u),d=kz(a+l,0,c);r.context.uiService.scrollTo(h,d);},25);}},{key:"wheelListener",value:function value(e){var t=this,i=this.context.config,r=e.wheelDelta;if(e.deltaY&&(r=-e.deltaY),1===e.deltaMode&&(r*=this.lineHeight),2===e.deltaMode&&(r=r<0?-100:100),e.ctrlKey&&i.enableZoomWithCtrl){if("multiple"!==i.displayMode){e.cancelable&&e.preventDefault();var n=r>0?i.wheelZoomDelta:1/i.wheelZoomDelta,o=this.context.rendererService.getCanvasPosition(),a=o.x,s=o.y;this.wheelTimer||(this.wheelTimer=RE(function(){t.context.zoomService.zoomTo(i.zoom*n,e.pageX-a,e.pageY-s),clearTimeout(t.wheelTimer),t.wheelTimer=null;},40));}}else e.shiftKey?(e.cancelable&&e.preventDefault(),this.context.uiService.scrollBy(-r,0)):(e.cancelable&&e.preventDefault(),this.context.uiService.scrollBy(0,-r));}}]),e;}(),SW=function(){function e(t){var i=this;ak(this,e),tk(this,"context",void 0),tk(this,"tabManager",void 0),tk(this,"appendPageTimer",null),tk(this,"selectPage",function(e){var t=i.context,r=t.groupUid,n=t.hooksService,o=t.viewerUid;if(e.groupUid===r){var a=i.getTab(e.docUid);if(a){i.isCurrentTab(a.uid)&&n.hooks.beforeBufferChanged.emit(e);var s=!e.triggerByScroll||e.triggerByScroll&&e.trigger!==o;s&&(a.select(e.selectedUids),!1!==e.updateShiftReference&&a.updateShiftReference()),i.isCurrentTab(a.uid)&&(s&&!1!==e.updateShiftReference&&i.context.emitCurrentIndexChanged(),n.hooks.afterBufferChanged.emit(e),s&&(i.context.showTab(a),i.context.handleOrigin(),i.context.renderOnly()));}}}),this.context=t,this.tabManager=new mO({tabMode:this.context.config.tabMode});}return ok(e,[{key:"destroy",value:function value(){this.appendPageTimer&&(clearTimeout(this.appendPageTimer),this.appendPageTimer=null);}},{key:"createTab",value:function value(e){var t,i,r=this,n=this.context.config,o=n.displayMode,a=n.toolType,s=n.scrollDirection,l=n.fitType,u=n.rows,c=n.columns,h=n.enableDWT1x1,d=n.pageStyle,f=n.selectedPageStyle,v=n.hoveredPageStyle,g=n.zoom,m=this.context.getBorderWidth(d),y=this.context.getBorderWidth(f),p=this.context.getBorderWidth(v),w=this.context.uiService.getViewportSize(),b={doc:e,displayMode:o,toolType:a,fitType:l,direction:s,viewWidth:w.width||800,viewHeight:w.height||800,dpr:1,scrollbarWidth:17,row:u,column:c,borderWidth:m,selectedBorderWidth:y,hoveredBorderWidth:p,enableDWT1x1:h,viewer:this.context.viewer},k=gE(t=this.tabManager).call(t,e.uid);return k||((k=this.tabManager.createTab(e,b)).layoutStatus.zoom=g,dk(i=e.children).call(i,function(e){var t=r.createPage(e);t&&k.appendChild(t);})),k;}},{key:"getCurrentTab",value:function value(){return this.tabManager.getCurTab();}},{key:"getAllTabs",value:function value(){return this.tabManager.getAllTabs();}},{key:"isCurrentTab",value:function value(e){return this.tabManager.currentTabUid===e;}},{key:"updateTab",value:function value(e){var t,i=this,r=e.modifiedUid,n=e.data,o=this.context,a=o.viewerUid,s=o.groupUid,l=o.hooksService;dk(t=this.tabManager.getAllTabs()).call(t,function(e){var t=e.getChildByUid(r);if(t){var o,u,c,h,d,f={docUid:e.uid,trigger:a,groupUid:s,operation:"modify",modifiedUid:r};i.isCurrentTab(e.uid)&&l.hooks.beforeBufferChanged.emit(f);var v=e.current,g=ET(o=e.selected).call(o);t.isPreload=!1,t.isLoaded=!1,t.isUpdated=!0,t.image.style.img=null,t.clearOptimization(),dk(u=ET(c=t.blanks.childNodes).call(c)).call(u,function(e){t.blanks.removeChild(e);}),void 0!==(null===(h=n.metadata)||void 0===h?void 0:h.width)&&(t.realTimeWidth=n.metadata.width),void 0!==(null===(d=n.metadata)||void 0===d?void 0:d.height)&&(t.realTimeHeight=n.metadata.height),e.current=v,e.selected=g,i.isCurrentTab(e.uid)&&(i.context.showTab(e),l.hooks.afterBufferChanged.emit(f));}});}},{key:"movePage",value:function value(e){var t=this.getTab(e.docUid);if(t){var i=this.context.hooksService;this.isCurrentTab(t.uid)&&i.hooks.beforeBufferChanged.emit(e),t.move(e.from,e.to),this.isCurrentTab(t.uid)&&(this.context.emitCurrentIndexChanged(),i.hooks.afterBufferChanged.emit(e),this.context.showTab(t),this.context.renderOnly());}}},{key:"switchPage",value:function value(e){var t=this.getTab(e.docUid);if(t){var i=this.context.hooksService;this.isCurrentTab(t.uid)&&i.hooks.beforeBufferChanged.emit(e),t.switch(e.one,e.other),this.isCurrentTab(t.uid)&&(this.context.emitCurrentIndexChanged(),i.hooks.afterBufferChanged.emit(e),this.context.showTab(t),this.context.renderOnly());}}},{key:"reorderPages",value:function value(e){var t,i=gE(t=this.tabManager).call(t,e.docUid);if(i){var r=this.context.hooksService;this.isCurrentTab(i.uid)&&r.hooks.beforeBufferChanged.emit(e),i.reorder(e.indexes),this.isCurrentTab(i.uid)&&(r.hooks.afterBufferChanged.emit(e),this.context.showTab(i),this.context.emitCurrentIndexChanged());}}},{key:"changePage",value:function value(e){var t=this.context,i=t.groupUid,r=t.hooksService;if(e.groupUid===i){var n,o=gE(n=this.tabManager).call(n,e.docUid);o&&(o.current!==e.index||o.selected.length>1)&&(this.isCurrentTab(o.uid)&&r.hooks.beforeBufferChanged.emit(e),o.goto(e.index),o.updateShiftReference(),this.isCurrentTab(o.uid)&&(this.context.emitCurrentIndexChanged(),r.hooks.afterBufferChanged.emit(e),this.context.showTab(o),this.context.handleOrigin(),this.context.renderOnly()));}}},{key:"removePagesFromDoc",value:function value(e,t){var i=this.getTab(e);if(i){var r=this.context.hooksService,n={removedUids:t,docUid:i.uid,operation:"remove"};this.isCurrentTab(i.uid)&&r.hooks.beforeBufferChanged.emit(n),dk(t).call(t,function(e){var t=i.getChildByUid(e);t&&t.destroy(),i.removeChildByUid(e);}),i.updateShiftReference(),i.total||(i.topPageUid=null),this.isCurrentTab(i.uid)&&(r.hooks.afterBufferChanged.emit(n),this.context.showTab(i),this.context.handleOrigin(),this.context.renderOnly());}}},{key:"appendPagesToDoc",value:function value(e,t){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n=this.getTab(e);if(n){var o=this.context,a=o.viewerUid,s=o.groupUid,l=o.hooksService,u=o.config,c={docUid:e,trigger:a,groupUid:s,operation:"add"};this.isCurrentTab(n.uid)&&l.hooks.beforeBufferChanged.emit(c);var h=r>-1;if(dk(t).call(t,function(e,t){var o=i.createPage(e);o&&(o.clearOptimization(),h?n.insertChild(o,r+t):n.appendChild(o));}),u.autoSelectLatest){n.currentPage&&n.currentPage.clearOptimization(),n.current=h?r+t.length-1:n.total-1;var d=n.currentPage;d&&n.select([d.uid]);}else n.total>0&&-1===n.current&&(n.current=0,n.select([n.getChildByIndex(0).uid]));n.updateShiftReference(),this.isCurrentTab(n.uid)&&(l.hooks.afterBufferChanged.emit(c),this.appendPageTimer||(this.appendPageTimer=RE(function(){n.isLoadPage=!0,i.getCurrentTab()===n&&(i.context.showTab(n),u.autoSelectLatest&&"single"!==u.displayMode&&"slide"!==u.displayMode&&i.context.config.show?i.context.emitCurrentIndexChanged():i.context.renderOnly()),clearTimeout(i.appendPageTimer),i.appendPageTimer=null;},42)));}}},{key:"openDoc",value:function value(e){var t=this.context,i=t.config,r=t.hooksService,n=t.viewerUid,o=t.groupUid,a=this.getTab(e.uid);a||(a=this.createTab(e)).total>0&&(i.autoSelectLatest?a.current=a.total-1:a.current=0,a.select([a.getChildByIndex(a.current).uid])),this.context.showTab(a);var s={docUid:e.uid,trigger:n,groupUid:o,operation:"filter"};r.hooks.beforeBufferChanged.emit(s),r.hooks.afterBufferChanged.emit(s),i.autoSelectLatest&&"single"!==i.displayMode&&"slide"!==i.displayMode&&this.context.config.show?this.context.emitCurrentIndexChanged():this.context.renderOnly();}},{key:"renameDoc",value:function value(e,t){var i=this.getTab(t);i&&(i.name=e);}},{key:"removeDoc",value:function value(e){return!!az(e)&&!!this.tabManager.closeTab(e)&&(0===this.getAllTabs().length&&this.context.tabCleared(),this.context.render(),!0);}},{key:"getTab",value:function value(e){var t;return gE(t=this.tabManager).call(t,e);}},{key:"createPage",value:function value(e){var t=this.context.config,i=t.pageStyle,r=t.checkboxStyle,n=t.pageNumberStyle,o=t.removeBtnStyle,a=t.blankFillColor,s=t.defaultWidth,l=t.defaultHeight,u=this.getFormattedStyle(i),c=this.context.getStatus(e);if(!c)return null;var h=c.realTimeWidth,d=c.realTimeHeight;return new sO({uid:e,style:{visibility:"hidden",pointerEvents:"auto",width:h||s,height:d||l},formattedPageStyle:u,checkboxStyle:r,pageNumberStyle:n,removeBtnStyle:o,realTimeWidth:h,realTimeHeight:d,blankFillColor:a||"rgba(0,0,0,0)"});}},{key:"getFormattedStyle",value:function value(e){var t=e.border,i=e.background,r={};return t&&(r=HN(t)),rk({background:i},r);}},{key:"setViewportSize",value:function value(e,t){var i=this.tabManager.getCurTab();i&&i.updateLayoutStatus({viewWidth:e,viewHeight:t});}}]),e;}(),CW=function(){function e(t){ak(this,e),tk(this,"container",void 0),tk(this,"scrollContent",void 0),tk(this,"scrollContainer",void 0),tk(this,"canvasAndScrollContainer",void 0),tk(this,"canvasContainer",void 0),tk(this,"defaultDom",void 0),tk(this,"rootDom",void 0),tk(this,"hooks",{scroll:Jz.create()}),tk(this,"isBindContainer",!1),tk(this,"viewerWidth",void 0),tk(this,"viewerHeight",void 0),tk(this,"context",void 0),tk(this,"dpr",qz()),this.context=t;}return ok(e,[{key:"initDefaultUI",value:function value(){var e=this,t=this.context,i=t.postfix,r=t.config,n=this.createDefaultUI(),o=n.querySelector("#dvs-canvas-container".concat(i)),a=n.querySelector("#dvs-scroller-and-canvas".concat(i)),s=n.querySelector("#dvs-scroll-container".concat(i)),l=n.querySelector("#dvs-scroll-content".concat(i));if(this.canvasAndScrollContainer=a,this.scrollContainer=s,this.scrollContent=l,this.canvasContainer=o,this.defaultDom=n,o&&s){var u=this.context.getBorderWidth(r.viewerStyle);eM(o.style,{left:"".concat(u,"px"),top:"".concat(u,"px")}),eM(s.style,r.viewerStyle);}this.scrollContainer.addEventListener("scroll",function(t){e.hooks.scroll.emit(t);});}},{key:"createDefaultUI",value:function value(){var e=this.context,t=e.postfix;return e.config.pure?VW(qN,t):VW(XN,t);}},{key:"updateScrollContentSize",value:function value(e,t){this.scrollContent.style.width="".concat(e,"px"),this.scrollContent.style.height="".concat(t,"px");}},{key:"resizeViewport",value:function value(){var e=this.scrollContainer,t=e.clientWidth,i=e.clientHeight;return this.viewerWidth=e.offsetWidth,this.viewerHeight=e.offsetHeight,eM(this.canvasContainer.style,{width:"".concat(t,"px"),height:"".concat(i,"px")}),{width:t,height:i};}},{key:"getMaxScrollValue",value:function value(){var e=this.scrollContainer;return{maxScrollLeft:e.scrollWidth-e.clientWidth,maxScrollTop:e.scrollHeight-e.clientHeight};}},{key:"isViewerResized",value:function value(){return this.scrollContainer.offsetWidth!==this.viewerWidth||this.scrollContainer.offsetHeight!==this.viewerHeight;}},{key:"isDPRChanged",value:function value(){var e=qz();return this.dpr!==e&&(this.dpr=e,!0);}},{key:"isScrollbarAppeared",value:function value(){return this.scrollContent.offsetWidth>this.scrollContainer.clientWidth||this.scrollContent.offsetHeight>this.scrollContainer.clientHeight;}},{key:"getViewportSize",value:function value(){return{width:this.scrollContainer.clientWidth,height:this.scrollContainer.clientHeight};}},{key:"bindContainer",value:function value(e){var t=e;return e&&az(e)&&(t=document.querySelector("#".concat(e))),t instanceof HTMLElement&&(t.appendChild(this.defaultDom),this.container=t,this.rootDom=this.defaultDom,this.isBindContainer=!0,this.context.resize(),!0);}},{key:"unbindContainer",value:function value(){if(0===this.container.children.length)return!1;for(var e=0;e<this.container.children.length;e++)if(this.container.children[e]===this.rootDom){this.container.removeChild(this.rootDom);break;}return this.isBindContainer=!1,!0;}},{key:"scrollTo",value:function value(e,t){this.scrollContainer.scrollTo?this.scrollContainer.scrollTo(e,t):(this.scrollContainer.scrollLeft=e,this.scrollContainer.scrollTop=t);}},{key:"scrollBy",value:function value(e,t){this.scrollContainer.scrollBy?this.scrollContainer.scrollBy(e,t):(this.scrollContainer.scrollLeft+=e,this.scrollContainer.scrollTop+=t);}}]),e;}();function VW(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=e.tag,r=e.style,n=e.id,o=e.className,a=e.children,s=document.createElement(i);return n&&(s.id=n+t),o&&(s.className=o),eM(s.style,r||{}),a&&dk(a).call(a,function(e){var i=VW(e,t);s.appendChild(i);}),s;}var TW=function(){function e(t){ak(this,e),tk(this,"context",void 0),tk(this,"zoomOriginCache",void 0),this.context=t;}return ok(e,[{key:"zoomTo",value:function value(e,t,i){var r;if((e=kz(e,this.context.config.minZoom,this.context.config.maxZoom))===this.context.config.zoom)return!1;var n=this.formatZoomOrigin(t,i);this.updateZoomReferencePoint(n),this.context.config.fitType="none",this.context.config.zoom=e;var o=null===(r=this.context)||void 0===r?void 0:r.getCurrentTab();if(o){var a;if(o.layoutStatus.zoom=e,o.fitType="none","multiple"===this.context.config.displayMode)return!1;this.context.layoutService.layout(o),n=this.formatZoomOrigin(t,i);var s=this.alignZoomReferencePoint(n),l=s.scrollLeft,u=s.scrollTop;return o.updateLayoutStatus({scrollLeft:l,scrollTop:u}),this.context.uiService.scrollTo(l,u),this.context.scrollerService.updateScroller({scrollLeft:l,scrollTop:u}),dk(a=o.childNodes).call(a,function(e){e.clearOptimization();}),this.context.rendererService.render(),!0;}return!1;}},{key:"formatZoomOrigin",value:function value(e,t){var i=this.context.rendererService.canvasDom.getBoundingClientRect(),r=i.width,n=i.height;if(nz(e)||nz(t)){var o=this.context.config.zoomOrigin,a=.5,s=.5;"left"===o.x?a=0:"right"===o.x&&(a=1),"top"===o.y?s=0:"bottom"===o.y&&(s=1),e=r*a,t=n*s;}return{originX:e=kz(e,0,r),originY:t=kz(t,0,n)};}},{key:"updateZoomReferencePoint",value:function value(e){var t,i,r,n,o=this,a=e.originX,s=e.originY,l=null,u=this.context.getPointerOverPageInfo(a,s).pageInfo.obj;if(u){var c=u.imageContainer.getPosition();r=(a-c.x)/this.context.config.zoom,n=(s-c.y)/this.context.config.zoom,t="center",i="center",l=u.uid;}else{var h,d,f=null===(h=this.context)||void 0===h?void 0:h.getCurrentTab(),v=Number.MAX_VALUE;null==f||dk(d=f.children).call(d,function(e){if(e.isVisible){var u=e.imageContainer.getPosition(),c=e.imageContainer,h=c.width,d=c.height,f=new nU(u.x+h/2,u.y+d/2).distanceTo({x:a,y:s});f<v&&(v=f,l=e.uid,a<u.x?(t="start",r=u.x-a):a>u.x+h?(t="end",r=a-(u.x+h)):(t="center",r=(a-u.x)/o.context.config.zoom),s<u.y?(i="start",n=u.y-s):s>u.y+d?(i="end",n=s-(u.y+d)):(i="center",n=(s-u.y)/o.context.config.zoom));}});}this.zoomOriginCache={imageX:r,imageY:n,positionX:t,positionY:i,pageUid:l};}},{key:"alignZoomReferencePoint",value:function value(e){var t,i=e.originX,r=e.originY,n=0,o=0,a=this.zoomOriginCache,s=a.imageX,l=a.imageY,u=a.positionX,c=a.positionY,h=a.pageUid,d=null===(t=this.context)||void 0===t?void 0:t.getCurrentTab();if(d){var f=d.getChildByUid(h);if(f){var v,g,m=f.imageContainer.getPosition();"start"===u?v=m.x-s:"center"===u?v=m.x+s*this.context.config.zoom:"end"===u&&(v=m.x+f.imageContainer.width+s),"start"===c?g=m.y-l:"center"===c?g=m.y+l*this.context.config.zoom:"end"===c&&(g=m.y+f.imageContainer.height+l),n=v-i,o=g-r;}}var y=this.context.uiService.scrollContainer,p=y.scrollLeft,w=y.scrollTop,b=this.context.uiService.getMaxScrollValue(),k=b.maxScrollLeft,x=b.maxScrollTop;return w+=o,{scrollLeft:p=kz(p+=n,0,k),scrollTop:w=kz(w,0,x)};}}]),e;}(),IW=function(){function e(t,i){ak(this,e),tk(this,"viewerUid",void 0),tk(this,"postfix",void 0),tk(this,"groupUid",void 0),tk(this,"emitter",void 0),tk(this,"viewer",void 0),tk(this,"config",iz(ZN)),tk(this,"dvsContext",void 0),tk(this,"boxRenderer",void 0),tk(this,"configService",void 0),tk(this,"hooksService",void 0),tk(this,"layoutService",void 0),tk(this,"rendererService",void 0),tk(this,"scrollerService",void 0),tk(this,"tabService",void 0),tk(this,"uiService",void 0),tk(this,"zoomService",void 0),tk(this,"isFocus",!1),tk(this,"defaultWidth",600),tk(this,"defaultHeight",800),tk(this,"isDestroyed",!1),tk(this,"iListeners",[]),tk(this,"draggingPrepared",!1),this.viewer=t,this.configService=new pW(this),this.hooksService=new wW(this),this.layoutService=new bW(this),this.rendererService=new kW(this),this.scrollerService=new xW(this),this.tabService=new SW(this),this.uiService=new CW(this),this.zoomService=new TW(this),this.viewerUid=bz(),this.groupUid=i.groupUid,pz(i.viewerConfig||{},this.config),this.emitter=i.emitter,this.postfix="-".concat(this.viewerUid),this.dvsContext=i.dvsContext,this.uiService.initDefaultUI(),this.initPlugins(),i.container&&this.uiService.bindContainer(i.container),this.config.show||(this.uiService.rootDom?this.uiService.rootDom.style.display="none":this.uiService.defaultDom.style.display="none");}return ok(e,[{key:"initPlugins",value:function value(){var e=this;new QN().init(this),new yO().init(this),new pO().init(this),new eO().init(this),new wO().init(this),new _N().init(this),dk(EW).call(EW,function(t){return t.init(e);});}},{key:"clearCurTabOptimization",value:function value(){var e,t=this.getCurrentTab();t&&dk(e=t.children).call(e,function(e){e.clearOptimization();});}},{key:"updateViewerConfig",value:function value(e){this.configService.updateConfig(e);}},{key:"setViewMode",value:function value(e,t){var i;if(!cz(t)||!cz(e))return this.err(ZA),!1;if(e<=0||t<=0)return this.err(_A),!1;var r=this.config.rows!==e||this.config.columns!==t;this.config.rows=e,this.config.columns=t;var n=this.getCurrentTab();return n&&(n.row=e,n.column=t,this.resetScrollbarStatus(),dk(i=n.children).call(i,function(e){e.clearOptimization();}),this.render(),r&&this.emitCurrentIndexChanged()),this.ok(),!0;}},{key:"syncFromViewer",value:function value(e){var t=this,i=e.context.tabService.getAllTabs(),r=e.context.tabService.getCurrentTab();dk(i).call(i,function(e){var i,n,o=t.tabService.createTab(e.doc);o.current=e.current,o.select(ET(i=e.selected).call(i)),dk(n=e.children).call(n,function(e,t){if(e.blanks.children.length){var i,r=o.childNodes[t];dk(i=e.blanks.children).call(i,function(e){var t=new pL({id:e.id,style:{points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],background:e.style.background,borderWidth:0}});r.blanks.appendChild(t);});}if(e.overlays.children.length){var n,a=o.children[t];dk(n=e.overlays.children).call(n,function(e){var t,i=new pL({id:e.id,style:{points:ET(t=e.style.points).call(t),background:e.style.background,borderWidth:0,opacity:e.style.opacity}});a.overlays.appendChild(i);});}}),r.uid===o.uid&&t.showTab(o);});}},{key:"getStatus",value:function value(e){return this.dvsContext.spaceService.getStatus(e);}},{key:"getGlobalHooks",value:function value(){return this.dvsContext.hooksService.hooks;}},{key:"getLocalHooks",value:function value(){return this.hooksService.hooks;}},{key:"getCurrentTab",value:function value(){return this.tabService.getCurrentTab();}},{key:"getTab",value:function value(e){return this.tabService.getTab(e);}},{key:"getAllTabs",value:function value(){return this.tabService.getAllTabs();}},{key:"showTab",value:function value(e){var t,i,r=this;this.tabService.tabManager.setCurrentTab(e.uid),e.style.visibility="visible",this.config.show&&(0===e.total&&(this.resetScrollbarStatus(),this.resetScrollerSize(),this.resize()),this.layoutService.layout(e),0!==e.layoutStatus.viewWidth&&0!==e.layoutStatus.viewHeight&&(0===e.selected.length&&"single"===this.config.displayMode&&(dk(t=e.children).call(t,function(e){e.updateStyle({visibility:"hidden"});}),this.resetScrollbarStatus(),this.resetScrollerSize(),this.resize()),dk(i=e.children).call(i,function(e){e.isPreload&&!e.isLoaded&&("multiple"===r.config.displayMode&&r.config.useMinImage?r.dvsContext.minImageService.load(e.uid):r.dvsContext.imageService.load(e.uid));}),this.hooksService.hooks.pageChanged.emit({current:e.current,total:e.total})));}},{key:"emitCurrentIndexChanged",value:function value(){var e=this.tabService.getCurrentTab();if(e&&(this.layoutService.layout(e),e.currentPage)){var t={isPassive:!1,trigger:this.viewerUid,docUid:""};this.hooksService.hooks.currentIndexChanged.emit(t);}}},{key:"resize",value:function value(){this.rendererService.resetCanvasSize();var e=this.uiService.resizeViewport(),t=e.width,i=e.height,r=qz();this.rendererService.canvas.setDPR(r),this.rendererService.canvas.resize(t,i),this.tabService.setViewportSize(t,i),this.scrollerService.updateScroller({viewportWidth:t,viewportHeight:i});}},{key:"resized",value:function value(){this.uiService.isBindContainer&&this.config.show&&(this.resetScrollbarStatus(),this.resize(),this.hooksService.hooks.resize.emit(),this.emitCurrentIndexChanged(),this.clearCurTabOptimization(),this.rendererService.render(),this.handleOrigin(),this.emit("resize",this.viewer.width,this.viewer.height));}},{key:"externalResized",value:function value(){if((this.uiService.isViewerResized()||this.uiService.isDPRChanged())&&this.uiService.isBindContainer&&this.config.show){this.resetScrollbarStatus(),this.resetScrollerSize(),this.resize(),this.hooksService.hooks.externalResized.emit(),this.emitCurrentIndexChanged();var e=this.getCurrentTab();e&&(this.layoutService.layout(e),this.clearCurTabOptimization()),this.rendererService.render(),this.handleOrigin(),this.emit("resize",this.viewer.width,this.viewer.height);}}},{key:"handleOrigin",value:function value(){if("single"===this.config.displayMode){var e=this.uiService.getMaxScrollValue(),t=e.maxScrollLeft,i=e.maxScrollTop,r=this.config.zoomOrigin,n=r.x,o=r.y,a=t/2,s=i/2;"left"===n?a=0:"right"===n&&(a=t),"top"===o?s=0:"bottom"===o&&(s=i),this.uiService.scrollTo(a,s);}}},{key:"getScrollbarWidth",value:function value(){var e=document.createElement("div"),t=document.createElement("div");e.appendChild(t),e.setAttribute("style","width:60px;height:60px;position:absolute;overflow:auto;"),t.setAttribute("style","width:100px;height:100px;"),document.body.appendChild(e);var i=e.offsetWidth-e.clientWidth;return document.body.removeChild(e),i;}},{key:"selectPage",value:function value(e){this.tabService.selectPage(e),this.dvsContext.hooksService.hooks.selectPage.emit(e);}},{key:"getCanvasDpr",value:function value(){return this.rendererService.canvas.contextService.getDPR();}},{key:"optimizePage",value:function value(e){var t=this;if(this.config.enableOptimizeImage){var i=this.tabService.getCurrentTab();if(i){var r=i.getChildByUid(e);if(r){var n;if(r.isOptimized||!r.isVisible||!r.isLoaded||r.optimizationUid===r.optimizedUid||this.scrollerService.isSliding||this.isDestroyed)return;var o=this.getStatus(e);if(!(null!=o&&o.img||null!=o&&o.minImg))return;var a=r.image.style.img,s=a.naturalWidth,l=a.naturalHeight,u=s,c=l,h=this.config.maxOptimizationSize;if(u>h||c>h||r.realTimeWidth>h||r.realTimeHeight>h)return;var d=[],f=[];if(this.dvsContext.editService){var v={operations:o.operations,width:s,height:l};"multiple"===this.config.displayMode&&this.config.useMinImage&&(v.operations=this.dvsContext.editService.toMinImageOperations(o.operations,o.imageScale));var g=this.dvsContext.editService.handle(v);u=g.width,c=g.height,d=g.matrixes,f=g.blanks||[];}var m=new gL({style:{x:0,y:0,img:a,width:s,height:l}});m.externalMatrixes=d;var y="rgba(0,0,0,0)";if("multiple"===this.config.displayMode){var p=this.config.pageStyle;r.isSelected?p=this.config.selectedPageStyle:r.isHovered&&(p=this.config.hoveredPageStyle),y=p.background;}o.useFillColor&&(y=this.config.blankFillColor);var w=new fL({style:{x:0,y:0,width:u,height:c,background:y}}),b=new fL();dk(f).call(f,function(e){var t=new pL({id:e.uid,style:{background:e.background,points:e.points,borderWidth:0}});b.appendChild(t);}),m.appendChild(b),w.appendChild(m);var k=new fL();dk(n=r.overlays.children).call(n,function(e){var t,i=new pL({id:e.id,style:{points:ET(t=e.style.points).call(t),background:e.style.background,borderWidth:0,opacity:e.style.opacity}});k.appendChild(i);}),w.appendChild(k),this.dvsContext.commonCanvas.render(w),this.dvsContext.commonCanvas.clear();var x=this.dvsContext.commonCanvas.getCanvas(),S=qz(),C=Math.floor(r.imageContainer.width*S-1),V=Math.floor(r.imageContainer.height*S-1);r.isOptimized=!0,this.dvsContext.optimizationService.optimize(x,u,c,C,V,r.optimizationUid).then(function(e){if(!t.isDestroyed&&e.taskUid===r.optimizationUid){r.isOptimized=!0,r.optimizedUid=r.optimizationUid;var i=x.getContext("2d",{willReadFrequently:!0}).createImageData(C,V);i.data.set(e.target),r.imageContainer.imageData=i,r.isVisible&&t.render();}}).catch(function(e){r.isOptimized=!1;});}}}}},{key:"renderPage",value:function value(e){if(!(this.isDestroyed||this.config.useMinImage&&"multiple"===this.config.displayMode)){var t=this.tabService.getCurrentTab();if(t){var i=t.getChildByUid(e);if(i){var r=this.dvsContext.spaceService.getStatus(e);r&&(r.img&&(i.isLoaded=!0,i.updateImage(r.img)),i.isVisible&&(this.render(),this.handleOrigin()));}}}}},{key:"renderMinPage",value:function value(e){if(!this.isDestroyed&&this.config.useMinImage&&"multiple"===this.config.displayMode){var t=this.tabService.getCurrentTab();if(t){var i=t.getChildByUid(e);if(i){var r=this.dvsContext.spaceService.getStatus(e);r&&(r.minImg&&(i.isLoaded=!0,i.updateImage(r.minImg)),i.isVisible&&(this.render(),this.handleOrigin()));}}}}},{key:"renderOnly",value:function value(){this.rendererService.render();}},{key:"render",value:function value(){if(!this.config.show)return!1;if(this.isDestroyed)return!1;var e=this.tabService.getCurrentTab();if(e){var t;this.layoutService.layout(e),0===e.selected.length&&"single"===this.config.displayMode&&(dk(t=e.children).call(t,function(e){e.updateStyle({visibility:"hidden"});}),this.resetScrollbarStatus(),this.resetScrollerSize(),this.resize()),this.config.zoom=e.layoutStatus.zoom;var i=this.uiService.scrollContainer,r=i.scrollLeft,n=i.scrollTop;e.setPosition({x:-r,y:-n}),e.updateLayoutStatus({scrollLeft:r,scrollTop:n}),this.scrollerService.updateScroller({scrollLeft:r,scrollTop:n});}return this.rendererService.render(),this.ok(),!0;}},{key:"tabCleared",value:function value(){this.tabService.tabManager.clear(),this.uiService.updateScrollContentSize(0,0),this.scrollerService.updateScroller({contentWidth:0,contentHeight:0}),this.render();}},{key:"storeActionToStatus",value:function value(e){var t,i=this;dk(t=(e=iz(e)).uids).call(t,function(t){var r=i.getStatus(t);if(r){var n=r.operations[r.operations.length-1];n&&n.type===e.actionType||(n={type:e.actionType,detail:[]},r.operations.push(n)),n.detail.push(e);}});}},{key:"removeActionFromStatus",value:function value(e){var t,i=this;dk(t=e.uids).call(t,function(t){var r=i.getStatus(t);if(r){var n=r.operations[r.operations.length-1];if(n&&n.type===e.actionType&&(n.detail.pop(),!n.detail.length)){var o,a,s=DT(o=r.operations).call(o,n);s>-1&&sI(a=r.operations).call(a,s,1);}}});}},{key:"isEmpty",value:function value(){var e=this.getCurrentTab();return!e||0===e.children.length;}},{key:"resetScrollbarStatus",value:function value(){var e,t=this;dk(e=this.getAllTabs()).call(e,function(e){e.layoutStatus.scrollbarWidth=t.getScrollbarWidth(),e.layoutStatus.resetScrollbarStatus();});}},{key:"resetScrollerSize",value:function value(){var e=this.uiService.scrollContainer;this.rendererService.canvasDom.style.width="0px",this.rendererService.canvasDom.style.height="0px",this.uiService.canvasContainer.style.width="0px",this.uiService.canvasContainer.style.height="0px",this.uiService.scrollContent.style.width="0px",this.uiService.scrollContent.style.height="0px";var t=e.clientWidth,i=e.clientHeight;eM(this.uiService.canvasContainer.style,{width:"".concat(t,"px"),height:"".concat(i,"px")});}},{key:"setScrollbarWidth",value:function value(e){var t;dk(t=this.tabService.tabManager.tabs).call(t,function(t){t.scrollbarWidth=e;});}},{key:"getPointerOverPageInfo",value:function value(e,t){var i=function(e,t,i){var r={pageInfo:{isOver:!1,pointerX:-1,pointerY:-1,obj:null},imageInfo:{isOver:!1,pointerX:-1,pointerY:-1,obj:null},index:-1};if(e)for(var n=0;n<e.children.length;n++){var o=e.children[n],a=FN(o,t,i);if(a.isOver){r.index=n,eM(r.pageInfo,a);var s=FN(o.imageContainer,t,i);return eM(r.imageInfo,s),r;}}return r;}(this.tabService.getCurrentTab(),e,t);return i;}},{key:"getHitRemoveBtn",value:function value(e,t){var i=this.getCurrentTab();if(i)for(var r=0;r<i.total;r++){var n=i.childNodes[r];if(n.isVisible&&n.removeBtn.isVisible){var o=n.removeBtn.parsedCheckBoxStyle,a=o.x,s=o.y,l=o.width,u=o.height,c=n.getPosition(),h=c.x,d=c.y;if(e>=a+h&&t>=s+d&&e<=a+h+l&&t<=s+d+u)return r;}}return-1;}},{key:"getCanvasPosition",value:function value(){return this.rendererService.getCanvasPosition();}},{key:"getBorderWidth",value:function value(e){var t=e.border;if(!t)return 0;var i=t.match(/[0-9]+/g)[0];return fx(i||"0",10);}},{key:"isBorderWidthEqualHovered",value:function value(){return this.getBorderWidth(this.config.pageStyle)===this.getBorderWidth(this.config.hoveredPageStyle);}},{key:"isSelectedBorderWidthEqualHovered",value:function value(){return this.getBorderWidth(this.config.selectedPageStyle)===this.getBorderWidth(this.config.hoveredPageStyle);}},{key:"isSelectedBorderWidthEqualNormal",value:function value(){return this.getBorderWidth(this.config.pageStyle)===this.getBorderWidth(this.config.selectedPageStyle);}},{key:"formatTouches",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=[],r=null;r=e instanceof MouseEvent||e instanceof PointerEvent?[e]:t?e.changedTouches:e.touches;for(var n=this.rendererService.getCanvasPosition(),o=n.x,a=n.y,s=0;s<r.length;s++){var l=r[s];i.push({pageX:l.pageX-o,pageY:l.pageY-a});}return i;}},{key:"getMargin",value:function value(){return this.formatMarginAndGap(this.config.margin);}},{key:"getGap",value:function value(){return this.formatMarginAndGap(this.config.gap);}},{key:"formatMarginAndGap",value:function value(e){if(az(e)){if(/px/.test(e)){var t=cb(e.match(/(\d+)/),1)[0];return fx(t,10);}if(/%/.test(e)){var i=this.rendererService.canvasDom.width/qz(),r=cb(e.match(/(\d+)/),1)[0];return i*fx(r,10)/100;}if(/em/.test(e)){var n=cb(getComputedStyle(this.rendererService.canvasDom).fontSize.match(/(\d+)/),1)[0],o=cb(e.match(/(\d+)/),1)[0];return fx(n,10)*fx(o,10);}}return cz(e)?e:fx(e,10);}},{key:"saveEvents",value:function value(){this.emitter.save();}},{key:"restoreEvents",value:function value(){this.emitter.restore();}},{key:"on",value:function value(e,t){if(az(e)&&dz(t)){var i=this.emitter.on(e,t);this.iListeners.push(i);}else this.err(ZA);}},{key:"emit",value:function value(e){for(var t,i,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];az(e)?(t=this.emitter).emit.apply(t,Ck(i=[e]).call(i,n)):this.err(ZA);}},{key:"off",value:function value(e,t){az(e)&&(void 0===t||dz(t))?this.emitter.off(e,t):this.err(ZA);}},{key:"err",value:function value(e){this.dvsContext.errorService.err(e);}},{key:"ok",value:function value(){this.err(qA);}},{key:"unbindEvents",value:function value(){var e,t=this;dk(e=this.iListeners).call(e,function(e){var i=e.name,r=e.fn,n=e.context,o=e.once;t.emitter.off(i,r,n,o);}),this.iListeners=[];}},{key:"destroy",value:function value(){this.isDestroyed||(this.getLocalHooks().destroy.emit(),this.scrollerService.destroy(),this.tabService.destroy(),this.unbindEvents(),this.isDestroyed=!0);}}]),e;}(),EW=[],PW=function(){function e(t){ak(this,e),tk(this,"context",void 0),tk(this,"OriginalViewer",e),tk(this,"uid",void 0),tk(this,"groupUid",null),tk(this,"postfix",void 0),tk(this,"destroyFlag",!1),this.context=new IW(this,t),this.uid=this.context.viewerUid,this.postfix=this.context.postfix,this.groupUid=this.context.groupUid;}return ok(e,[{key:"isDestroyed",get:function get(){return this.destroyFlag;}},{key:"currentPageCount",get:function get(){var e;return(null===(e=this.getCurrentTab())||void 0===e?void 0:e.total)||0;}},{key:"rootDom",get:function get(){return this.context.uiService.rootDom;}},{key:"defaultDom",get:function get(){return this.context.uiService.defaultDom;}},{key:"container",get:function get(){return this.context.uiService.container;}},{key:"scrollContainer",get:function get(){return this.context.uiService.scrollContainer;}},{key:"canvasContainer",get:function get(){return this.context.uiService.canvasContainer;}},{key:"updateViewerConfig",value:function value(e){this.context.updateViewerConfig(e);}},{key:"getViewerConfig",value:function value(){return this.context.config;}},{key:"getViewerConfigByName",value:function value(e){return this.context.config[e];}},{key:"show",value:function value(){if(!0!==this.context.config.show){this.context.config.show=!0;var e=this.context.uiService,t=e.rootDom,i=e.defaultDom;t&&(t.style.display="flex",i.style.display="flex"),this.resized();var r=this.getCurrentTab();return r&&this.context.showTab(r),!0;}return!1;}},{key:"hide",value:function value(){if(!1!==this.context.config.show){this.context.config.show=!1;var e=this.context.uiService.rootDom;return e&&(e.style.display="none"),!0;}return!1;}},{key:"bindContainer",value:function value(e){return this.context.uiService.bindContainer(e);}},{key:"unbindContainer",value:function value(){return this.context.uiService.unbindContainer();}},{key:"externalResized",value:function value(){this.context.externalResized();}},{key:"resized",value:function value(){this.context.resized();}},{key:"checkPageVisibility",value:function value(e){var t={min:!1,ori:!1},i=this.getCurrentTab();if(i){var r=i.getChildByUid(e);r&&r.isPreload&&("multiple"===this.context.config.displayMode&&(t.min=!0),t.ori=!0);}return t;}},{key:"getCurrentTab",value:function value(){var e;return null===(e=this.context)||void 0===e?void 0:e.getCurrentTab();}},{key:"getTab",value:function value(e){return az(e)?this.context.tabService.getTab(e):(this.err(ZA),null);}},{key:"getAllTabs",value:function value(){return this.context.tabService.getAllTabs();}},{key:"removePage",value:function value(e){if(cz(e)&&(e=[e]),!ez(e))return this.err(ZA),!1;var t=e.length;if(0===t)return this.err(KA),!1;var i=this.getCurrentTab();if(!i)return!1;for(var r=[],n=0;n<t;n++){var o=this.getUidByIndex(e[n]);if(!o)return!1;r.push(o);}var a={removedUids:r,docUid:i.uid,trigger:this.uid,operation:"remove"};return this.context.getLocalHooks().remove.emit(a),!0;}},{key:"removeAllPages",value:function value(){var e=this.getCurrentTab();if(e){var t,i={removedUids:jI(t=e.children).call(t,function(e){return e.uid;}),docUid:e.uid,trigger:this.uid,operation:"remove"};this.context.getLocalHooks().remove.emit(i);}return this.ok(),!0;}},{key:"switchPage",value:function value(e,t){var i=this.getCurrentTab();if(!i||!this.isIndexValid(i,e)||!this.isIndexValid(i,t))return!1;var r={one:e,other:t,trigger:this.uid,docUid:i.uid,type:i.type,operation:"shift"};return this.context.getLocalHooks().switch.emit(r),!0;}},{key:"movePage",value:function value(e,t){var i=this.getCurrentTab();if(!i||!this.isIndexValid(i,e)||!this.isIndexValid(i,t))return!1;var r={from:e,to:t,trigger:this.uid,docUid:i.uid,type:i.type,operation:"shift"};return this.context.getLocalHooks().move.emit(r),!0;}},{key:"reorderPage",value:function value(e){var t=this.getCurrentTab();if(!t||!ez(e)||t.total!==e.length)return!1;var i={indexes:e,trigger:this.uid,docUid:t.uid,type:t.type,operation:"shift"};return this.context.getLocalHooks().reorder.emit(i),!0;}},{key:"setViewMode",value:function value(e,t){return this.context.setViewMode(e,t);}},{key:"nextPage",value:function value(){var e=this.getCurrentTab();if(!e)return-1;var t=e.current;if(t+1===e.total&&e.selected.length<=1)return t;var i={index:t+1,docUid:e.uid,trigger:this.uid,groupUid:this.groupUid,operation:"shift"};return this.context.getLocalHooks().changePage.emit(i),e.current;}},{key:"prevPage",value:function value(){var e=this.getCurrentTab();if(!e)return-1;var t=e.current;if(t-1<0&&e.selected.length<=1)return t;var i={index:t-1,docUid:e.uid,trigger:this.uid,groupUid:this.groupUid,operation:"shift"};return this.context.getLocalHooks().changePage.emit(i),e.current;}},{key:"firstPage",value:function value(){var e=this.getCurrentTab();if(!e)return-1;var t=e.current;if(0===t&&e.selected.length<=1)return t;var i={index:0,docUid:e.uid,trigger:this.uid,groupUid:this.groupUid,operation:"shift"};return this.context.getLocalHooks().changePage.emit(i),e.current;}},{key:"lastPage",value:function value(){var e=this.getCurrentTab();if(!e)return-1;var t=e.current,i=e.total;if(t===i-1&&e.selected.length<=1)return t;var r={index:i,docUid:e.uid,trigger:this.uid,groupUid:this.groupUid,operation:"shift"};return this.context.getLocalHooks().changePage.emit(r),e.current;}},{key:"gotoPage",value:function value(e){var t=this.getCurrentTab();if(!t)return-1;var i=t.current;if(e>t.total-1||e<0)return-1;if(i===e&&t.selected.length<=1)return i;var r={index:e,docUid:t.uid,trigger:this.uid,groupUid:this.groupUid,operation:"shift"};return this.context.getLocalHooks().changePage.emit(r),t.current;}},{key:"getCurrentIndex",value:function value(){var e=this.getCurrentTab();return e?(this.err(qA),e.current):(this.err(GA),-1);}},{key:"setCurrentIndex",value:function value(e){return-1!==this.gotoPage(e);}},{key:"setSelectedIndexes",value:function value(e){if(!ez(e))return this.err(ZA),!1;var t=this.getCurrentTab();if(!t)return!1;var i=t.selected,r=!1;i.length!==e.length&&(r=!0);for(var n=[],o=0;o<e.length;o++){var a=this.getUidByIndex(e[o]);if(!a)return!1;i[o]!==a&&(r=!0),n.push(a);}if(!r)return!0;var s={selectedUids:n,indexes:e,docUid:t.uid,trigger:this.uid,groupUid:this.groupUid,operation:"shift"};return this.context.getLocalHooks().selectPage.emit(s),!0;}},{key:"getSelectedIndexes",value:function value(){var e,t=this.getCurrentTab();if(!t)return this.err(GA),null;var i=jI(e=t.selected).call(e,function(e){return t.getIndexByUid(e);});return this.ok(),i;}},{key:"selectAll",value:function value(){var e,t=this.getCurrentTab();if(!t)return this.err(GA),!1;var i=hb(OP(e=Array(t.total)).call(e));return this.setSelectedIndexes(i);}},{key:"getIndexByUid",value:function value(e){if(!az(e))return null;var t=this.getCurrentTab();if(!t)return this.err(GA),null;var i=t.getIndexByUid(e);return i>-1?this.ok():this.err(KA),i;}},{key:"getUidByIndex",value:function value(e){var t=this.getCurrentTab();return t?this.isIndexValid(t,e)?(this.ok(),t.children[e].uid):null:(this.err(GA),null);}},{key:"undo",value:function value(){var e=this.getCurrentTab();if(e){var t=e.commandController.undoStack,i=t[t.length-1];if(i){var r,n={commandUid:i.uid,trigger:this.uid};return dk(r=i.action.uids).call(r,function(t){var i=e.getChildByUid(t);i&&i.clearOptimization();}),this.context.getGlobalHooks().undo.emit(n),!0;}}return!1;}},{key:"redo",value:function value(){var e=this.getCurrentTab();if(e){var t=e.commandController.redoStack,i=t[t.length-1];if(i){var r,n={commandUid:i.uid,trigger:this.uid};return dk(r=i.action.uids).call(r,function(t){var i=e.getChildByUid(t);i&&i.clearOptimization();}),this.context.storeActionToStatus(i.action),this.context.getGlobalHooks().redo.emit(n),!0;}}return!1;}},{key:"reset",value:function value(e){var t=this;if(!YN(this,e=jN(this,e)))return!1;var i=this.getCurrentTab(),r=jI(e).call(e,function(e){return i.getChildByIndex(e).uid;}),n={tabUid:i.uid,tabType:i.type,trigger:this.uid,uids:r};return dk(r).call(r,function(e){var r=t.context.getStatus(e);r&&(r.operations=[]);var n=i.getChildByUid(e);n&&n.clearOptimization();}),this.context.getGlobalHooks().reset.emit(n),!0;}},{key:"zoomIn",value:function value(){var e=this.getViewerConfigByName("zoom");this.updateViewerConfig({zoom:1.2*e});}},{key:"zoomOut",value:function value(){var e=this.getViewerConfigByName("zoom");this.updateViewerConfig({zoom:e/1.2});}},{key:"render",value:function value(){return this.context.render();}},{key:"on",value:function value(e,t){this.context.on(e,t);}},{key:"emit",value:function value(e){for(var t,i,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];(t=this.context).emit.apply(t,Ck(i=[e]).call(i,n));}},{key:"off",value:function value(e,t){this.context.off(e,t);}},{key:"err",value:function value(e){this.context.dvsContext.errorService.err(e);}},{key:"ok",value:function value(){this.err(qA);}},{key:"isIndexValid",value:function value(e,t){return cz(t)?!(t<0||t>=e.total)||(this.err(_A),!1):(this.err(ZA),!1);}},{key:"destroy",value:function value(){this.destroyFlag||(this.context.destroy(),this.context=null,this.destroyFlag=!0);}}],[{key:"use",value:function value(e){DT(EW).call(EW,e)<0&&EW.push(e);}}]),e;}(),BW={Viewer:PW},DW=function(){function e(t,i){ak(this,e),tk(this,"dvs",void 0),tk(this,"errorService",void 0),tk(this,"hooksService",void 0),tk(this,"imageService",void 0),tk(this,"minImageService",void 0),tk(this,"layoutService",void 0),tk(this,"spaceService",void 0),tk(this,"trackerService",void 0),tk(this,"viewerService",void 0),tk(this,"saveService",void 0),tk(this,"workerService",void 0),tk(this,"commonCanvas",void 0),tk(this,"optimizationService",void 0),this.dvs=t,this.errorService=new DN(this),this.hooksService=new(function(){return ok(function e(t){ak(this,e),tk(this,"context",void 0),tk(this,"hooks",{init:Jz.create(),destroy:Jz.create(),beforeLoad:Jz.create(),load:Jz.create(),afterLoad:Jz.create(),beforeRemove:Jz.create(),remove:Jz.create(),afterRemove:Jz.create(),beforeUpdate:Jz.create(),update:Jz.create(),afterUpdate:Jz.create(),move:Jz.create(),switch:Jz.create(),reorder:Jz.create(),appendPagesToDoc:Jz.create(),removePagesFromDoc:Jz.create(),removeDoc:Jz.create(),renameDoc:Jz.create(),openDoc:Jz.create(),beforeChangeBuffer:Jz.create(),afterChangeBuffer:Jz.create(),changePage:Jz.create(),selectPage:Jz.create(),beforeRender:Jz.create(),render:Jz.create(),afterRender:Jz.create(),createViewer:Jz.create(),removeViewer:Jz.create(),afterLoadImage:Jz.create(),error:Jz.create(),log:Jz.create(),rotate:Jz.create(),scale:Jz.create(),flip:Jz.create(),mirror:Jz.create(),crop:Jz.create(),erase:Jz.create(),changeSize:Jz.create(),reset:Jz.create(),overlay:Jz.create(),beforeUndo:Jz.create(),undo:Jz.create(),beforeRedo:Jz.create(),redo:Jz.create(),layout:Jz.create(),beforeSetSpace:Jz.create(),afterSetSpace:Jz.create(),focusChanged:Jz.create(),checkVisibility:Jz.create(),removeTab:Jz.create()}),this.context=t;});}())(this),this.imageService=new MN(this),this.minImageService=new AN(this),this.layoutService=new(function(){function e(t){ak(this,e),tk(this,"context",void 0),tk(this,"layouts",[]),tk(this,"head",void 0),this.context=t,this.use(new pN()),this.use(new fN()),this.use(new kN()),this.use(new CN()),this.init();}return ok(e,[{key:"use",value:function value(e){var t;DT(t=this.layouts).call(t,e)>-1||this.layouts.push(e);}},{key:"clear",value:function value(){this.layouts=[];}},{key:"layout",value:function value(e){0!==e.total?this.head.layout(e):e.layoutStatus.reset();}},{key:"destroy",value:function value(){this.head=null;}},{key:"init",value:function value(){var e=this.layouts;if(e.length){var t=e[0],i=null;this.head=t;for(var r=1,n=e.length;r<n;r++)i=e[r],t.setNext(i),t=i;}}}]),e;}())(this),this.spaceService=new UN(this,i),this.trackerService=new LN(this),this.viewerService=new NN(this),this.saveService=new zN(this),this.workerService=new ON(this),this.commonCanvas=new sN(),this.optimizationService=new WN(this);}return ok(e,[{key:"destroy",value:function value(){this.imageService.destroy(),this.minImageService.destroy();}},{key:"getSpace",value:function value(){return this.spaceService.space;}}]),e;}(),MW=[],AW=function(){function e(t){ak(this,e),tk(this,"uid",void 0),tk(this,"emitter",void 0),tk(this,"subClasses",void 0),tk(this,"isDestroyed",!1),tk(this,"options",void 0),tk(this,"context",void 0),this.uid=bz(),this.subClasses=BW,this.emitter=$z.create(),this.options=t,this.context=new DW(this,t.space),this.init(),RL(["borderWidth","letterSpacing","lineDashOffset","shadowOffsetX","shadowOffsetY","shadowBlur","textMaxWidth"],pR,void 0),RL(["startAngle","endAngle"],bR,void 0),RL(["r","rx","ry","width","height","padding","fontSize","arrowWidth","markSize","markLineWidth"],pR,void 0),RL(["borderColor","background","shadowColor","color"],TR,void 0),RL(["opacity","fillOpacity","borderOpacity"],PR,void 0),UL("lineDash",ER,void 0),UL("shadow",IR,void 0),RL(["x","y"],void 0,BR),RL(["points"],void 0,BL),RL(["x1","y1","x2","y2"],void 0,PL),RL(["startPoint","endPoint"],void 0,AL),RL(["lineEnding"],void 0,zL),RL(["fontStyle","fontVariant","fontWeight","fontFamily","fontSize"],void 0,DL),RL(["x","y","width","wordWarp","lineHeight","text","textTransform","textBaseLine"],void 0,EL),RL(["width","height"],void 0,ML);}return ok(e,[{key:"init",value:function value(){var e=this;new PN().apply(this.context),new BN().apply(this.context),this.emitter.save(),dk(MW).call(MW,function(t){var i,r=t.plugin,n=t.config;!dz(r)&&dz(r.init)&&r.init.apply(r,Ck(i=[e]).call(i,hb(n)));}),this.context.hooksService.hooks.init.emit(),this.emitter.restore();}},{key:"setSpace",value:function value(e){e!==this.context.spaceService.space&&(this.context.hooksService.hooks.beforeSetSpace.emit(e),this.context.spaceService.setSpace(e),this.context.hooksService.hooks.afterSetSpace.emit(e));}},{key:"getImageData",value:function value(e,t){return this.context.saveService.getImageData(e,t);}},{key:"destroy",value:function value(){var e;this.isDestroyed||(this.context.hooksService.hooks.destroy.emit(),this.context.destroy(),null!==(e=this.emitter)&&void 0!==e&&e.destroy(),this.emitter=null,this.subClasses=null,this.isDestroyed=!0);}},{key:"removeSource",value:function value(e){return this.context.spaceService.space.removeSource(e);}},{key:"loadSource",value:function value(e){return this.context.spaceService.space.loadSource(e);}},{key:"updateSource",value:function value(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.context.spaceService.space.updateSource(e,t,i);}},{key:"createViewer",value:function value(e){return this.context.viewerService.createViewer(e);}},{key:"removeViewer",value:function value(e){return this.context.viewerService.removeViewer(e);}},{key:"getViewerByUid",value:function value(e){return this.context.viewerService.getViewer(e);}},{key:"getViewerByIndex",value:function value(e){return this.context.viewerService.viewerManager.getAllViewers()[e];}},{key:"getViewerList",value:function value(){var e;return ET(e=this.context.viewerService.viewerManager.getAllViewers()).call(e);}}],[{key:"use",value:function value(e){for(var t,i,r,n=arguments.length,o=new Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];return DT(t=jI(MW).call(MW,function(e){return e.plugin;})).call(t,e)>-1?(console.error("The plugin ".concat(e.name," is already installed.")),this):("function"==typeof e?e.apply(void 0,Ck(i=[this]).call(i,o)):"function"==typeof e.install&&e.install.apply(e,Ck(r=[this]).call(r,o)),MW.push({plugin:e,config:o}),this);}},{key:"useAll",value:function value(e){var t=this;return dk(e).call(e,function(e){if(ez(e)){var i,r=dc(a=e)||fh(a)||jh(a)||Yh(),n=r[0],o=ET(r).call(r,1);t.use.apply(t,Ck(i=[n]).call(i,hb(o)));}else t.use(e);var a;}),this;}},{key:"getClassStore",value:function value(){return BW;}},{key:"getPlugins",value:function value(){return MW;}}]),e;}(),zW={sequence:-1,location:"horizontal",size:180,thumbnailStyle:{},canvasStyle:{border:"1px solid #2a2a2a"},pageStyle:{},selectedPageStyle:{},placeholderStyle:{},hoveredPageStyle:{},pageNumberStyle:{},checkboxStyle:{},removeBtnStyle:{},enableDragPage:!0,enableKeyboardControl:!0,multiselectMode:!1,scrollDirection:"vertical",rows:4,columns:1,show:!0,enableResizing:!0,autoChangeIndex:!0,gap:10,margin:10,autoSelectTopPage:!1,autoScroll:!0,autoSelectLatest:!0},UW={enableOptimizeImage:!1,enableZoom:!1,displayMode:"multiple",toolType:"default",rows:4,columns:1,pure:!0,tabMode:"single"},RW=function(){function e(t){ak(this,e),tk(this,"uid",void 0),tk(this,"emitter",void 0),tk(this,"thbConfig",{}),tk(this,"innerViewer",void 0),tk(this,"viewer",void 0),tk(this,"postfix",void 0),tk(this,"container",void 0),tk(this,"hooks",{destroy:Jz.create()}),tk(this,"configHandlers",{}),tk(this,"isDestroyed",!1);var i=$z.create();this.emitter=i,this.viewer=t.viewer,pz(UW,this.thbConfig),pz(zW,this.thbConfig),pz(t.viewerConfig||{},this.thbConfig),this.initThbConfigHandlers(),this.innerViewer=new this.viewer.OriginalViewer(rk(rk({},t),{},{emitter:i,viewerConfig:rk(rk({},this.thbConfig),{},{viewerStyle:rk({},this.thbConfig.thumbnailStyle)}),groupUid:this.viewer.groupUid,dvsContext:t.viewer.context.dvsContext})),this.uid=this.innerViewer.uid,this.postfix=this.innerViewer.context.postfix,this.listenViewerHooks(),t.container||this.updatePosition();}return ok(e,[{key:"listenViewerHooks",value:function value(){var e=this,t=this.viewer.context.hooksService.hooks,i=function i(){e.innerViewer&&e.innerViewer.context.resized();},r=function r(){e.innerViewer&&e.innerViewer.externalResized();},n=function n(t){e.innerViewer.context.hooksService.hooks.openDoc.emit(t);};t.resize.on(i),t.externalResized.on(r),t.openDoc.on(n),t.destroy.on(function(){e.destroy();}),this.hooks.destroy.on(function(){t.resize.off(i),t.externalResized.off(r),t.openDoc.off(n);});}},{key:"updatePosition",value:function value(){var e=null,t=this.innerViewer.context.uiService.defaultDom,i=this.viewer.context.uiService.defaultDom;"horizontal"===this.thbConfig.location?(t.style.width=LW(this.thbConfig.size),t.style.height="100%",e=i.querySelector("#dvs-viewer-middle".concat(this.viewer.context.postfix))):(t.style.width="100%",t.style.height=LW(this.thbConfig.size),e=i);var r=String(this.thbConfig.sequence);if(fz()){var n=t.getAttribute("style");n+=" order:".concat(r),t.setAttribute("style",n);}else t.style.order=r;this.container=e,this.innerViewer.context.uiService.bindContainer(e),this.viewer.externalResized();}},{key:"getThbConfig",value:function value(){return this.thbConfig;}},{key:"getThbConfigByName",value:function value(e){return this.thbConfig[e];}},{key:"updateThbConfig",value:function value(e){for(var t=0,i=GE(e);t<i.length;t++){var r=cb(i[t],2),n=r[0],o=r[1],a=this.configHandlers[n];a&&a(this,o);}}},{key:"initThbConfigHandlers",value:function value(){this.configHandlers={thumbnailStyle:NW,canvasStyle:OW,pageStyle:WW,selectedPageStyle:HW,placeholderStyle:FW,hoveredPageStyle:jW,pageNumberStyle:YW,checkboxStyle:XW,removeBtnStyle:qW,scrollDirection:ZW,multiselectMode:_W,enableDragPage:GW,enableKeyboardControl:KW,show:$W,rows:QW,columns:JW,margin:eH,gap:tH,autoSelectTopPage:iH,size:rH,sequence:nH,location:oH,showRemoveBtn:aH,autoScroll:sH,autoSelectLatest:lH};}},{key:"show",value:function value(){return this.updateThbConfig({show:!0}),!0;}},{key:"hide",value:function value(){return this.updateThbConfig({show:!1}),!0;}},{key:"resized",value:function value(){this.viewer.resized(),this.innerViewer.resized();}},{key:"setViewMode",value:function value(e,t){return this.innerViewer.setViewMode(e,t);}},{key:"bindContainer",value:function value(e){return this.innerViewer.bindContainer(e);}},{key:"unbindContainer",value:function value(){return this.innerViewer.unbindContainer();}},{key:"on",value:function value(e,t){az(e)&&dz(t)?this.emitter.on(e,t):this.err(ZA);}},{key:"emit",value:function value(e){for(var t,i,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];az(e)?(t=this.emitter).emit.apply(t,Ck(i=[e]).call(i,n)):this.err(ZA);}},{key:"off",value:function value(e,t){az(e)&&(void 0===t||dz(t))?this.emitter.off(e,t):this.err(ZA);}},{key:"destroy",value:function value(){this.isDestroyed||(this.hooks.destroy.emit(),this.innerViewer.unbindContainer(),this.innerViewer.destroy(),this.innerViewer=null,this.container=null,this.isDestroyed=!0);}},{key:"err",value:function value(e){this.emitter.emit("_dvsUpdateErrorMessage",e);}},{key:"ok",value:function value(){this.emitter.emit("_dvsUpdateErrorMessage",qA);}}]),e;}();function LW(e){if(az(e)){if(!/%/.test(e)&&!/px/.test(e)&&!/em/.test(e))return"".concat(e,"px");}else if(cz(e))return"".concat(e,"px");return e;}function NW(e,t){eM(e.thbConfig.thumbnailStyle,t),e.innerViewer.updateViewerConfig({viewerStyle:rk({},e.thbConfig.thumbnailStyle)}),e.viewer.resized();}function OW(e,t){eM(e.thbConfig.canvasStyle,t),e.innerViewer.updateViewerConfig({canvasStyle:rk({},e.thbConfig.canvasStyle)}),e.viewer.resized();}function WW(e,t){eM(e.thbConfig.pageStyle,t),e.innerViewer.updateViewerConfig({pageStyle:rk({},e.thbConfig.pageStyle)}),e.innerViewer.render();}function HW(e,t){eM(e.thbConfig.selectedPageStyle,t),e.innerViewer.updateViewerConfig({selectedPageStyle:rk({},e.thbConfig.selectedPageStyle)}),e.innerViewer.render();}function FW(e,t){eM(e.thbConfig.placeholderStyle,t),e.innerViewer.updateViewerConfig({placeholderStyle:rk({},e.thbConfig.placeholderStyle)}),e.innerViewer.render();}function jW(e,t){eM(e.thbConfig.hoveredPageStyle,t),e.innerViewer.updateViewerConfig({hoveredPageStyle:rk({},e.thbConfig.hoveredPageStyle)}),e.innerViewer.render();}function YW(e,t){eM(e.thbConfig.pageNumberStyle,t),e.innerViewer.updateViewerConfig({pageNumberStyle:rk({},e.thbConfig.pageNumberStyle)}),e.innerViewer.render();}function XW(e,t){eM(e.thbConfig.checkboxStyle,t),e.innerViewer.updateViewerConfig({checkboxStyle:rk({},e.thbConfig.checkboxStyle)}),e.innerViewer.render();}function qW(e,t){eM(e.thbConfig.removeBtnStyle,t),e.innerViewer.updateViewerConfig({removeBtnStyle:rk({},e.thbConfig.removeBtnStyle)}),e.innerViewer.render();}function ZW(e,t){e.thbConfig.scrollDirection=t,e.innerViewer.updateViewerConfig({scrollDirection:t}),e.innerViewer.render();}function _W(e,t){e.thbConfig.multiselectMode=t,e.innerViewer.updateViewerConfig({multiselectMode:t}),e.innerViewer.render();}function GW(e,t){e.thbConfig.enableDragPage=t,e.innerViewer.updateViewerConfig({enableDragPage:t});}function KW(e,t){e.thbConfig.enableKeyboardControl=t,e.innerViewer.updateViewerConfig({enableKeyboardControl:t});}function $W(e,t){if(hz(t)&&e.thbConfig.show!==t){e.thbConfig.show=t,e.innerViewer.context.config.show=t;var i=(e.innerViewer||{}).defaultDom;i&&(i.style.display=t?"flex":"none"),e.viewer.externalResized();var r=e.innerViewer.getCurrentTab();if(r){e.innerViewer.context.showTab(r),e.innerViewer.context.renderOnly();var n=e.innerViewer.context.config;n.autoSelectLatest&&n.show&&n.autoScroll&&e.innerViewer.context.emitCurrentIndexChanged();}}}function QW(e,t){cz(t)?t<=0?e.err(_A):(e.thbConfig.rows=t,e.setViewMode(t,e.thbConfig.columns),e.ok()):e.err(ZA);}function JW(e,t){cz(t)?t<=0?e.err(_A):(e.thbConfig.columns=t,e.setViewMode(e.thbConfig.rows,t),e.ok()):e.err(ZA);}function eH(e,t){e.thbConfig.margin=t,e.innerViewer.updateViewerConfig({margin:t});}function tH(e,t){e.thbConfig.gap=t,e.innerViewer.updateViewerConfig({gap:t});}function iH(e,t){e.thbConfig.autoSelectTopPage=t,e.innerViewer.updateViewerConfig({autoSelectTopPage:t});}function rH(e,t){!function(e){var t=String(e);return!!/^\d+(px|em)$|^\d+$|^(100|[1-9]?\d(\.\d\d?\d?)?)%$/.test(t);}(t)?e.err($A):(e.thbConfig.size=t,e.updatePosition(),e.ok());}function nH(e,t){cz(t)?(e.thbConfig.sequence=t,e.updatePosition(),e.ok()):e.err(ZA);}function oH(e,t){"horizontal"===t||"vertical"===t?(e.thbConfig.location=t,e.updatePosition(),e.ok()):e.err(ZA);}function aH(e,t){hz(t)?(e.thbConfig.showRemoveBtn=t,e.ok()):e.err(ZA);}function sH(e,t){e.thbConfig.autoScroll=t,e.innerViewer.updateViewerConfig({autoScroll:t});}function lH(e,t){e.thbConfig.autoSelectLatest=t,e.innerViewer.updateViewerConfig({autoSelectLatest:t});}var uH={name:"dvsThumbnail",install:function install(e){var t=e.getClassStore(),i=function(e){var t;return t=function(e){lb(i,e);var t=ub(i);function i(e){var r;return ak(this,i),tk(rc(r=t.call(this,e)),"thumbnails",void 0),r.thumbnails=[],r;}return ok(i,[{key:"createThumbnail",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new RW({container:e.container||"",viewerConfig:e,dvs:this.dvs,viewer:this});this.thumbnails.push(t);var i=this.context.getCurrentTab();if(i){var r,n,o=t.innerViewer.context,a=o.tabService.createTab(i.doc);a.current=i.current,a.select(ET(r=i.selected).call(r)),dk(n=i.children).call(n,function(e,t){if(e.blanks.children.length){var i,r=a.childNodes[t];dk(i=e.blanks.children).call(i,function(e){var t=new pL({id:e.id,style:{points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],background:e.style.background,borderWidth:0}});r.blanks.appendChild(t);});}if(e.overlays.children.length){var n,o=a.children[t];dk(n=e.overlays.children).call(n,function(e){var t,i=new pL({id:e.id,style:{points:ET(t=e.style.points).call(t),background:e.style.background,borderWidth:0,opacity:e.style.opacity}});o.overlays.appendChild(i);});}}),o.showTab(a),o.config.autoSelectLatest&&o.config.show?o.emitCurrentIndexChanged():o.renderOnly();}return e.container&&this.context.resized(),t;}},{key:"removeThumbnail",value:function value(e){var t,i,r,n;return az(e)?r=bI(t=this.thumbnails).call(t,function(t){return t.uid===e;}):tz(e)&&(r=bI(i=this.thumbnails).call(i,function(t){return t===e;})),r>-1&&(cb(sI(n=this.thumbnails).call(n,r,1),1)[0].destroy(),!0);}},{key:"getThumbnailList",value:function value(){return this.thumbnails;}},{key:"getThumbnailByIndex",value:function value(e){return this.thumbnails[e];}},{key:"getThumbnailByUid",value:function value(e){var t;return gE(t=this.thumbnails).call(t,function(t){return t.uid===e;});}},{key:"checkPageVisibility",value:function value(e){var t={min:!1,ori:!1},i=this.getCurrentTab();if(i){var r=i.getChildByUid(e);r&&r.isPreload&&("multiple"===this.context.config.displayMode&&(t.min=!0),t.ori=!0);}for(var n=0,o=this.thumbnails.length;n<o;n++){var a=this.thumbnails[n].innerViewer.checkPageVisibility(e);a.min&&(t.min=!0),a.ori&&(t.ori=!0);}return t;}}]),i;}(e),tk(t,"use",e.use),t;}(t.Viewer);t.Viewer=i;}},cH=function(){function e(t,i){ak(this,e),tk(this,"reducer",void 0),tk(this,"state",void 0),tk(this,"listeners",[]),this.reducer=t,this.state=i,this.dispatch({type:""});}return ok(e,[{key:"subscribe",value:function value(e){return this.listeners.push(e),function(){var t,i,r=null===(t=this.listeners)||void 0===t?void 0:DT(t).call(t,e);null===(i=this.listeners)||void 0===i||sI(i).call(i,r,1);};}},{key:"dispatch",value:function value(e){var t;this.state=this.reducer(this.state,e),dk(t=this.listeners).call(t,function(t){t(e);});}},{key:"getState",value:function value(){return this.state;}},{key:"replaceReducer",value:function value(e){this.reducer=e,this.dispatch({type:""});}}],[{key:"create",value:function value(t,i,r){return"function"==typeof i&&void 0===r&&(r=i,i=void 0),r?r(e.create)(t,i):new e(t,i);}},{key:"combineReducers",value:function value(e){return function(t,i){var r;null!==(r=t)&&void 0!==r||(t={});for(var n={},o=0,a=GE(e);o<a.length;o++){var s=cb(a[o],2),l=s[0],u=(0,s[1])(t[l],i);n[l]=u;}return n;};}},{key:"applyMiddleware",value:function value(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return function(e){return function(i,r){var n=e(i,r),o={getState:n.getState},a=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return 0===t.length?function(e){return e;}:1===t.length?t[0]:Dx(t).call(t,function(e,t){return function(){return e(t.apply(void 0,arguments));};});}.apply(void 0,hb(jI(t).call(t,function(e){return e(o);})))(n.dispatch);return rk(rk({},n),{},{dispatch:a});};};}}]),e;}(),hH=/^<\/([^>]*)>/,dH=/^<([^\s>]+)[^>]*>/,fH=/^<slot>.*<\/slot>/,vH=/(:?[@\w-]+)\s*=\s*"(.*?)"/;function gH(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=e.template,r=e.data,n=e.components,o=e.injection,a=mH(i,r,n,o,t),s=a.length;return s&&(a[0].cpInstance=e,a[s-1].cpInstance=e),a;}function mH(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=$k(e).call(e),a=[];function s(e){o=o.substring(e);}function l(e){var n=cb(e,2),o=n[0],s=n[1];if(s){var l=function(e){var t={},i=yz(e,vH);return i?(dk(i).call(i,function(e){var i=cb(e,3),r=i[1],n=i[2];t[r]=n;}),t):t;}(o),u=t[":for"];u&&(delete t[":for"],l[":for"]=u);var c={type:"start",name:s,data:t,attrs:l};if(a.push(c),(i[s]||r.components&&r.components[s])&&(c.cpOption={Component:i[s]||r.components[s],injection:r}),"input"===s||/\/>/.test(o)){var h={type:"end",name:s,data:t,attrs:{}};a.push(h);}}}function u(e){var t=cb(e,2)[1];if(t){var i={type:"end",name:t,attrs:{}};a.push(i);}}function c(e){if(e=$k(e).call(e)){var i={type:"text",name:e,attrs:{},data:t};a.push(i);}}for(;o;){var h=DT(o).call(o,"<"),d=void 0;if(0===h){var f=o.match(hH);if(f){s(f[0].length),u(f);continue;}var v=o.match(fH);if(v){s(v[0].length),a.push.apply(a,hb(n));continue;}var g=o.match(dH);if(g&&g[0]!==g.input){s(g[0].length),l(g);continue;}d=o;}else d=h>0?o.substring(0,h):o;d&&(s(d.length),c(d));}return a;}function yH(e){var t=e.cpInstance;e.el;var i=e.children;t&&!t.isInserted&&(t.isInserted=!0,t.inserted&&t.inserted()),dk(i).call(i,function(e){yH(e);});}function pH(e,t){return t.key===e.key&&t.tagName===e.tagName;}function wH(e,t,i){for(var r={},n=t;n<=i;++n){var o=e[n];if(o&&o.data){var a=o.data.key;a&&(r[a]=n);}}return r;}function bH(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t<=i;)kH(e[t]),t+=1;}function kH(e){if(e){var t=e.el,i=e.children;if(function(e){var t,i=e.cpInstance;i&&(i.unbindSelfEvents(),i.unbindGlobalEvents(),i.unbindNativeEvents(),null===(t=i.beforeDestroyed)||void 0===t||t.call(i,e));}(e),t){var r=t.parentElement;r&&r.removeChild(t),t.dvsNode=null,e.el=null;}return function(e){var t=e.cpInstance;t&&t.destroyed&&t.destroyed(e);}(e),e.text=null,e.parent=null,i.length&&dk(i).call(i,function(e){kH(e);}),!0;}return!1;}function xH(e,t,i,r,n){for(var o=document.createDocumentFragment(),a=r;a<=n;a++){var s=i[a];o.appendChild(s.renderDom());}Fz(o,t,e);}function SH(e,t){var i,r,n,o;if(e!==t){if((null===(i=e.cpInstance)||void 0===i||null===(r=i.constructor)||void 0===r?void 0:r.name)!==(null===(n=t.cpInstance)||void 0===n||null===(o=n.constructor)||void 0===o?void 0:o.name))return xH(e.parent.el,e.el,[t],0,0),void kH(e);var a=e.el;e.data;var s=e.children,l=e.tagName,u=e.text;t.el=a,a.dvsNode=t;var c,h=t.data,d=t.children,f=t.tagName,v=t.text;if(a.setAttribute)dk(c=gk(h)).call(c,function(e){a instanceof HTMLInputElement&&"value"===e?a.value=h[e]:a.setAttribute(e,h[e]);});l===f&&"TEXT"===f&&u!==v?a.textContent=Hz(v):s.length&&d.length?function(e,t,i,r){for(var n,o=0,a=0,s=t.length-1,l=i.length-1,u=t[o],c=t[s],h=i[a],d=i[l];o<=s&&a<=l;)if(null==u)u=t[o+=1];else if(null==c)c=t[s-=1];else if(null==h)h=i[a+=1];else if(null==d)d=i[l-=1];else if(pH(u,h))SH(u,h),a+=1,u=t[o+=1],h=i[a];else if(pH(c,d))SH(c,d),l-=1,c=t[s-=1],d=i[l];else if(pH(u,d))SH(u,d),jz(u.el,c.el),l-=1,u=t[o+=1],d=i[l];else if(pH(c,h))SH(c,h),Fz(c.el,u.el,e),a+=1,c=t[s-=1],h=i[a];else{void 0===n&&(n=wH(t,o,s));var f=n[h.key];if(void 0===f)xH(e,u.el,i,a,a),h=i[a+=1];else{var v=t[f];SH(v,h),Fz(v.el,u.el,e),t[f]=null,h=i[a+=1];}}o>s?xH(e,i[l+1]?i[l+1].el:null,i,a,l):a>l&&bH(t,o,s);}(a,s,d):d.length?xH(a,null,d,0,d.length-1):s.length&&bH(s,0,s.length),function(e,t){var i=(e||{}).cpInstance,r=t.cpInstance;i&&(r&&(i.data=r.data,i.injection=rk(rk({},i.injection),r.injection)),t.cpInstance=i,i.dvsNode=t,i.updated&&i.updated(t));}(e,t);}}var CH=function(){function e(t){ak(this,e),tk(this,"el",void 0),tk(this,"tagName",void 0),tk(this,"sel",""),tk(this,"data",void 0),tk(this,"children",void 0),tk(this,"text",void 0),tk(this,"key",void 0),tk(this,"cpInstance",void 0),tk(this,"cpOptions",void 0),tk(this,"inserted",!1),tk(this,"parent",void 0),this.createVNode(t);}return ok(e,[{key:"renderDom",value:function value(){var e,t;if(this.el)return this.el;var i,r=this.cpInstance;if("FRAGMENT"===this.tagName)i=document.createDocumentFragment();else if("TEXT"===this.tagName){var n=Hz(this.text);i=document.createTextNode(n);}else{var o;i=document.createElement("IMAGE"===this.tagName?"IMG":this.tagName);for(var a=0,s=GE(this.data);a<s.length;a++){var l=cb(s[a],2),u=l[0],c=l[1];i.setAttribute(u,c);}if(null!==(o=this.data)&&void 0!==o&&o.events)for(var h=0,d=GE(null===(f=this.data)||void 0===f?void 0:f.events);h<d.length;h++){var f,v=cb(d[h],2),g=v[0],m=v[1];i.addEventListener(g,m);}}return dk(e=this.children).call(e,function(e){var t=e.renderDom();i.appendChild(t);}),i.dvsNode=this,this.el=i,null!=r&&null!==(t=r.updated)&&void 0!==t&&t.call(r,this),function(e){var t,i=e.cpInstance,r=e.el;i&&(i.dvsNode=e,null===(t=i.created)||void 0===t||t.call(i,r));}(this),i;}},{key:"patch",value:function value(e){return function(e,t){var i;if(pH(e,t))SH(e,t);else{var r=e.el,n=r.parentNode;null!==n&&(t.el=t.renderDom(),Fz(t.el,r,n),bH([e]),e=null);}var o=-1,a=e.parent;return null!=a&&dk(i=a.children).call(i,function(t,i){t===e&&(o=i);}),o>-1&&(a.children[o]=t,t.parent=a,e.el=null),t;}(this,e);}},{key:"destroy",value:function value(){return kH(this);}},{key:"createVNode",value:function value(e){var t=e.tagName,i=e.data,r=void 0===i?{}:i,n=e.children,o=void 0===n?[]:n,a=e.el,s=void 0===a?null:a,l=e.key,u=e.text,c=void 0===u?"":u,h=e.cpOptions,d=e.cpInstance,f=t;r.id&&(f+="#".concat(r.id)),r.class&&(f+=".".concat(r.class)),this.sel=f,this.data=r,this.tagName=t,this.children=o,this.el=s,this.key=l,this.text=c,this.cpInstance=d,this.cpOptions=h;}}]),e;}();function VH(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=[],r=[],n=[];return dk(e).call(e,function(e){if("start"===e.type)i.push(e),r.push(n),n=[];else if("text"===e.type)n.push({type:"text",value:e.name,data:e.data});else if(e instanceof CH)n.push(e);else{for(var t=i.pop();t.name!==e.name;)t=i.pop();if(t){var o=t,a=o.name,s=o.cpInstance,l=o.attrs,u={type:"token",tagName:a,cpInstance:s,cpOption:o.cpOption,attrs:l,data:o.data,children:n};dk(n).call(n,function(e){e.parent=u;}),(n=r.pop()).push(u);}}}),t?n[0]:n;}var TH=/'.+'|\\".+\\"|[\w$.]+/g,IH=/{{([^\s@}]+)}}/;function EH(e,t){for(var i=function i(){var i=n[r],o=cb(i.match(/^(:|@)(.+)/)||[],3),a=o[1],s=o[2];if(!s)return"continue";var l=e[i];if(delete e[i],"for"===s){var u,c,h,d=cb(l.split(" in "),2),f=d[0],v=d[1],g=cb(f.split(","),2),m=g[0],y=g[1];m=$k(m).call(m),y=null===(u=y)||void 0===u?void 0:$k(u).call(u),v=null===(c=v)||void 0===c?void 0:$k(c).call(c);var p=[],w=Dx(h=v.split(".")).call(h,function(e,t){return e[t];},t);if(ez(w))dk(w).call(w,function(e,t){var i={};i[m]=e,y&&(i[y]=t),p.push(i);});else if(tz(w))for(var b=0,k=GE(w);b<k.length;b++){var x=cb(k[b],2),S=x[0],C=x[1],V={};V[m]=C,y&&(V[y]=S),p.push(V);}e[":for"]=p;}else{var T,I,E=Dx(T=l.split(".")).call(T,function(e,t){return null==e?void 0:e[t];},t);if(void 0!==E)"class"===s&&e[s]?e[s]=Ck(I="".concat(e[s]," ")).call(I,E):e[s]=E;else{l=l.replace(TH,function(e){if(DT(e).call(e,'"')<0&&DT(e).call(e,"'")<0){var i;if(/^(true|false|\d+|undefined|null)$/.test(e))return e;var r=Dx(i=e.split(".")).call(i,function(e,t){return null==e?void 0:e[t];},t);return sA(r);}return e;});try{var P,B=new Function("return ".concat(l))();"class"===s&&e[s]?e[s]=Ck(P="".concat(e[s]," ")).call(P,B):e[s]=B;}catch(t){e[s]=void 0;}}"@"===a&&(e.events||(e.events={}),e.events[s]=e[s],delete e["@".concat(s)]);}},r=0,n=gk(e);r<n.length;r++)i();}function PH(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(ez(e)){var i=[];return dk(e).call(e,function(e){i.push.apply(i,hb(BH(PH(e))));}),i;}if(e instanceof CH)return e;if("token"===e.type){var r,n,o=e.tagName,a=e.attrs,s=e.cpInstance,l=e.children,u=e.data,c=e.cpOption;if(a[":for"])return function(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.attrs,n=e.data,o=JSON.parse(sA(r)),a={":for":r[":for"]};delete r[":for"],EH(a,rk(rk({},n),i));var s=[];return dk(t=a[":for"]).call(t,function(t){var i=PH(e,t);s.push.apply(s,hb(BH(i)));}),e.attrs=o,s;}(e,t);var h,d=rk(rk({},u),t),f=rk({},a);if(EH(a,d),Object.prototype.hasOwnProperty.call(a,"if")&&!a.if)h=null;else if(delete a.if,c)h=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.children,r=e.attrs,n=e.cpOption,o=DH(i,t),a=n.Component,s=n.injection,l=new a({data:r,injection:s}),u=VH(gH(l,o));return u?BH(PH(u))[0]:null;}(e,t);else{var v=a.key;void 0!==v&&delete a.key;var g=DH(l,t);h=new CH({tagName:o.toUpperCase(),data:a,cpInstance:s,key:v,children:g});}return e.attrs=f,null!==(r=h)&&void 0!==r&&dk(n=r.children).call(n,function(e){e.parent=h;}),h;}return function(e){var t,i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.value,o=null===(t=e.parent)||void 0===t||null===(i=t.attrs)||void 0===i?void 0:i.html;return n=function(e,t){var i=yz(e,IH);return i.length&&dk(i).call(i,function(i){var r,n=Dx(r=i[1].split(".")).call(r,function(e,t){return e[t];},t),o=i[0];e=e.replace(o,n);}),e;}($k(n).call(n),rk(rk({},e.data),r)),o?PH(VH(mH(n),!1)):new CH({tagName:"TEXT",text:n});}(e,t);}function BH(e){return e?(ez(e)||(e=[e]),e):[];}function DH(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=[];return dk(e).call(e,function(e){var r=PH(e,t)||[];i.push.apply(i,hb(BH(r)));}),i;}var MH=function(){function e(t){var i=t.data,r=void 0===i?{}:i,n=t.template,o=void 0===n?"":n,a=t.components,s=void 0===a?{}:a,l=t.injection,u=void 0===l?{}:l;ak(this,e),tk(this,"template",""),tk(this,"data",{}),tk(this,"components",{}),tk(this,"injection",{}),tk(this,"isInserted",!1),tk(this,"emitter",void 0),tk(this,"uiEmitter",void 0),tk(this,"viewerEmitter",void 0),tk(this,"dvsNode",null),tk(this,"el",void 0),tk(this,"created",void 0),tk(this,"inserted",void 0),tk(this,"updated",void 0),tk(this,"beforeDestroyed",void 0),tk(this,"destroyed",void 0),tk(this,"selfEvents",[]),tk(this,"globalEvents",[]),tk(this,"nativeEvents",[]),this.emitter=$z.create(),this.setData(r),this.template=o,this.setComponents(s),this.setInjects(u),this.uiEmitter=this.injection.emitter,this.viewerEmitter=this.injection.viewerEmitter,this.autoBindEvents();}return ok(e,[{key:"parseHTML",value:function value(){return PH(VH(gH(this,[])));}},{key:"setData",value:function value(e){eM(this.data,e);}},{key:"setComponents",value:function value(e){eM(this.components,e);}},{key:"setInjects",value:function value(e){eM(this.injection,e);}},{key:"autoBindEvents",value:function value(){for(var e=this,t=function t(){var t=cb(r[i],2),n=t[0],o=t[1];e.on(n,function(){o.apply(void 0,arguments);});},i=0,r=GE(this.data.events||{});i<r.length;i++)t();for(var n=function n(){var t=cb(a[o],2),i=t[0],r=t[1];e.on(i,function(){for(var t,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];az(r)?e.$emit.apply(e,Ck(t=[r]).call(t,n)):dz(r)&&r.apply(void 0,n);});},o=0,a=GE((null===(s=this.data)||void 0===s||null===(l=s.options)||void 0===l?void 0:l.events)||{});o<a.length;o++){var s,l;n();}}},{key:"unbindSelfEvents",value:function value(){var e,t=this;dk(e=this.selfEvents).call(e,function(e){var i=cb(e,2),r=i[0],n=i[1];t.emitter.off(r,n);}),this.selfEvents=[];}},{key:"unbindGlobalEvents",value:function value(){var e,t=this;dk(e=this.globalEvents).call(e,function(e){var i=cb(e,2),r=i[0],n=i[1];t.uiEmitter.off(r,n);}),this.globalEvents=[];}},{key:"unbindNativeEvents",value:function value(){var e;dk(e=this.nativeEvents).call(e,function(e){e();}),this.nativeEvents=[];}},{key:"on",value:function value(e,t){this.emitter.on(e,t),this.selfEvents.push([e,t]);}},{key:"emit",value:function value(e){for(var t,i,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];(t=this.emitter).emit.apply(t,Ck(i=[e]).call(i,n));}},{key:"$on",value:function value(e,t){var i;this.uiEmitter&&(null!==(i=this.uiEmitter)&&void 0!==i&&i.on(e,t),this.globalEvents.push([e,t]));}},{key:"$emit",value:function value(e){for(var t,i,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];null===(t=this.uiEmitter)||void 0===t||t.emit.apply(t,Ck(i=[e]).call(i,n));}},{key:"nativeOn",value:function value(e,t,i){var r=function(e,t,i,r){return e?(e.addEventListener(t,i,void 0),function(){e.removeEventListener(t,i);}):null;}(e,t,i);r&&this.nativeEvents.push(r);}},{key:"reRenderVNode",value:function value(){var e=function(e){return PH(VH(gH(e)));}(this);this.dvsNode.patch(e);}},{key:"query",value:function value(e){var t;return null===(t=this.el)||void 0===t?void 0:t.querySelector(e);}},{key:"queryAll",value:function value(e){var t;return null===(t=this.el)||void 0===t?void 0:t.querySelectorAll(e);}}]),e;}();tk(MH,"storeName",void 0),tk(MH,"hasStore",!1),tk(MH,"reducer",void 0),tk(MH,"initState",void 0);var AH=function(){function e(t){ak(this,e),tk(this,"container",void 0),tk(this,"emitter",null),tk(this,"viewerEmitter",null),tk(this,"options",void 0),tk(this,"rootVNode",void 0),tk(this,"postfix",void 0),tk(this,"injection",void 0),tk(this,"data",void 0),tk(this,"isInserted",!1),tk(this,"iListeners",[]),tk(this,"rootDom",void 0),tk(this,"stores",{});var i=t.container,r=t.injection,n=t.emitter,o=t.postfix,a=t.data;this.viewerEmitter=n,this.emitter=$z.create(),this.postfix=o||"-".concat(bz()),this.options=t,this.injection=r,this.data=a,az(i)?this.container=document.getElementById(i):i instanceof HTMLElement&&(this.container=i),this.initStore(),this.init();}return ok(e,[{key:"initStore",value:function value(){for(var t=0,i=dA(e.getComponents());t<i.length;t++){var r=i[t];if(!r.hasStore||this.stores[r.storeName]);else{var n=cH.create(r.reducer,r.initState);this.stores[r.storeName]=n;}}}},{key:"init",value:function value(){var t=new MH({data:this.options.uiConfig,template:'<Root :options="root"></Root>',components:e.getComponents(),injection:rk(rk({},this.injection),{},{components:e.getComponents(),postfix:this.postfix,emitter:this.emitter,viewerEmitter:this.viewerEmitter,stores:this.stores,i18n:this.options.uiConfig.i18n})}).parseHTML(),i=t.renderDom();this.rootVNode=t,this.rootDom=i,this.container&&(this.container.appendChild(i),yH(t),this.isInserted=!0);}},{key:"bindContainer",value:function value(e){this.container=e,e.appendChild(this.rootDom),this.isInserted||yH(this.rootVNode);}},{key:"unbindContainer",value:function value(){for(var e=0;e<this.container.children.length;e++)if(this.container.children[e]===this.rootDom)return void this.container.removeChild(this.rootDom);}},{key:"queryByDataId",value:function value(e){var t;return null===(t=this.rootDom)||void 0===t?void 0:t.querySelector("[data-id=".concat(e,"]"));}},{key:"queryAllByDataId",value:function value(e){var t;return null===(t=this.rootDom)||void 0===t?void 0:t.querySelectorAll("[data-id=".concat(e,"]"));}},{key:"on",value:function value(e,t){var i=this.emitter.on(e,t);this.iListeners.push(i);}},{key:"emit",value:function value(e){for(var t,i,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];(t=this.emitter).emit.apply(t,Ck(i=[e]).call(i,n));}},{key:"off",value:function value(e,t){this.emitter.off(e,t);}},{key:"unbindEvents",value:function value(){var e,t=this;dk(e=this.iListeners).call(e,function(e){var i=e.name,r=e.fn,n=e.context,o=e.once;t.emitter.off(i,r,n,o);});}},{key:"destroy",value:function value(){this.unbindEvents();}}],[{key:"registerComponent",value:function value(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=0,r=GE(t);i<r.length;i++){var n=cb(r[i],2),o=n[0],a=n[1];if(e.isAlreadyRegistered(o))return;this.components[o]=a;}}},{key:"isAlreadyRegistered",value:function value(e){return!!this.components[e];}},{key:"getComponents",value:function value(){return this.components;}}]),e;}();tk(AH,"components",{});var zH=function zH(e,t,i,r){var n,o,a=e||{},s=a.id,l=a.title,u=a.dataId,c=a.style,h=a.className,d=function(e){var t="";if(e)for(var i=0,r=GE(e);i<r.length;i++){var n,o=cb(r[i],2),a=o[0],s=o[1];t+=Ck(n="".concat(QA(a),":")).call(n,s,";");}return t;}(c);return(nz(s)?"":' id="'.concat(s,'"'))+Ck(n=Ck(o=' class="'.concat(t)).call(o,null!=i?i:""," ")).call(n,h||"",'"')+(nz(r)?"":' :class="'.concat(r,'"'))+(d?' style="'.concat(d,'"'):"")+(nz(l)?"":' title="'.concat(l,'"'))+(nz(u)?"":' data-id="'.concat(u,'"'));},UH=function UH(e,t){var i,r,n,o=(null===(i=t)||void 0===i?void 0:i.className)||"";return pz(e=e||{},t=t||{}),t.className=Ck(r="".concat(o," ")).call(r,(null===(n=t)||void 0===n?void 0:n.className)||""),t;},RH=function(e){lb(i,e);var t=ub(i);function i(e){var r;if(ak(this,i),tk(rc(r=t.call(this,e)),"status",!1),tk(rc(r),"store",void 0),tk(rc(r),"unsubscribe",void 0),tk(rc(r),"created",function(e){r.el=e,r.initEvent(),r.$on("setButtonClass",function(e,t){e===r.data.options.name&&(r.el.className="dvs-btn ".concat(t));});}),tk(rc(r),"updated",function(){}),tk(rc(r),"destroyed",function(){var e,t;r.data.options.selectable&&(null===(e=(t=r).unsubscribe)||void 0===e||e.call(t));}),r.data.options.selectable){var n;r.store=r.injection.stores[i.storeName];var o=r.store.getState();r.setData({isSelect:DT(n=o.select).call(n,r.data.options.dataId)>-1}),r.unsubscribe=r.store.subscribe(function(){var e=r.data.options.dataId,t=r.store.getState(),i=t.select,n=t.unselect;DT(i).call(i,e)>-1&&!r.data.isSelect?(r.data.isSelect=!0,r.reRenderVNode()):DT(n).call(n,e)>-1&&r.data.isSelect&&(r.data.isSelect=!1,r.reRenderVNode());});}return r.initTemplate(),nc(r);}return ok(i,[{key:"initEvent",value:function value(){var e=this,t=this.data.options,i=t.events;if(t.selectable,i)for(var r=function r(){var t=cb(o[n],2),i=t[0],r=t[1];e.el.addEventListener(i,function(t){e.uiEmitter.emit(r,t,e);});},n=0,o=GE(i);n<o.length;n++)r();}},{key:"initNativeEvent",value:function value(){var e,t=this,i=this.el,r=this.data,n=r.options;r.isSelect,dk(e=gk(n.events||{})).call(e,function(e){t.nativeOn(i,e,function(i){t.emit(e,i,t);});});}},{key:"initTemplate",value:function value(){var e,t=this.data.options,i=t.selectable?"isSelect?'dvs-selected':''":void 0,r=zH(t,"dvs-btn","",i);this.template=Ck(e="<div ".concat(r," >")).call(e,nz(t.label)?"":t.label,"<slot></slot></div>");}}]),i;}(MH);tk(RH,"hasStore",!0),tk(RH,"storeName","button"),tk(RH,"reducer",function(e,t){var i,r,n,o;switch(e||(e={select:[],unselect:[]}),t.type){case"setButton":return dk(i=t.select).call(i,function(t){var i,r,n=bI(i=e.unselect).call(i,function(e){return e===t;});sI(r=e.unselect).call(r,n,1);}),dk(r=t.unselect).call(r,function(t){var i,r,n=bI(i=e.select).call(i,function(e){return e===t;});sI(r=e.select).call(r,n,1);}),e.select=hb(new XB(Ck(n=[]).call(n,hb(e.select),hb(t.select)))),e.unselect=hb(new XB(Ck(o=[]).call(o,hb(e.unselect),hb(t.unselect)))),rk({},e);case"select":return rk(rk({},e),{},{select:t.select});case"unselect":return rk(rk({},e),{},{unselect:t.unselect});default:return e;}});var LH=function(e){lb(i,e);var t=ub(i);function i(e){var r;return ak(this,i),tk(rc(r=t.call(this,e)),"startScroll",!1),tk(rc(r),"allowScroll",!1),tk(rc(r),"startInfo",void 0),tk(rc(r),"created",function(e){r.el=e,r.allowScroll&&(r.addButtonScroll(),r.addResizeEvent());}),tk(rc(r),"inserted",function(){r.updateShowMore();}),r.initTemplate(),r;}return ok(i,[{key:"initTemplate",value:function value(){var e=this.data.options;e.style,e.id,e.className;var t=e.children;this.injection;var i="<div ".concat(zH(this.data.options,"dvs-group",""),">");t&&dk(t).call(t,function(e,t){var r,n,o=e.enable,a=e.type;!1!==o&&($k(a).call(a),i+=Ck(r=Ck(n="<".concat(a,' :options="options.children.')).call(n,t,'"></')).call(r,a,">"));}),i+="</div>",this.template=i;}},{key:"addButtonScroll",value:function value(){var e=this,t=this.el;t.onmousedown=function(i){return!(i.button&&0!==i.button||t.scrollWidth<=t.clientWidth&&t.scrollHeight<=t.clientHeight||(e.startScroll=!0,e.startInfo={x:i.clientX,y:i.clientY,left:t.scrollLeft,top:t.scrollTop},0));},t.onmousemove=function(i){if(!e.startScroll)return!1;var r=e.startInfo,n=r.x,o=r.y,a=r.left,s=r.top,l=i.clientX-n,u=i.clientY-o;return(Math.abs(l)>5||Math.abs(u)>5)&&(t.scrollLeft=a-l,t.scrollTop=s-u),e.updateShowMore(),!0;},this.nativeOn(document.body,"mouseup",function(){e.startScroll=!1;});var i=t.querySelector(".dvs-showBefore");i&&(i.onclick=function(){t.scrollLeft=0,e.updateShowMore();});var r=t.querySelector(".dvs-showAfter");r&&(r.onclick=function(){t.scrollLeft=t.scrollWidth,e.updateShowMore();});}},{key:"updateShowMore",value:function value(){var e=this.el,t=e.clientWidth,i=e.scrollWidth,r=e.scrollLeft,n=e.querySelector(".dvs-showBefore");n&&(n.classList[r>5&&t>40?"remove":"add"]("dvs-display-none"),n.style.transform="translate3d(".concat(r,"px,0,0)"));var o=e.querySelector(".dvs-showAfter");o&&(o.classList[r+t<i-5&&t>40?"remove":"add"]("dvs-display-none"),o.style.transform="translate3d(".concat(r,"px,0,0)"));}},{key:"addResizeEvent",value:function value(){var e=this;this.nativeOn(window,"resize",function(){e.updateShowMore();});}}]),i;}(MH),NH=function(e){lb(i,e);var t=ub(i);function i(e){var r;return ak(this,i),tk(rc(r=t.call(this,e)),"created",function(e){r.el=e;}),tk(rc(r),"inserted",function(){r.injection.viewer.context.uiService.bindContainer(r.el);}),r.initTemplate(),r;}return ok(i,[{key:"initTemplate",value:function value(){var e="<div ".concat(zH(this.data.options,"dvs-main-canvas","")," ><slot></slot></div>");this.template=e;}}]),i;}(MH);var OH=function(e){lb(i,e);var t=ub(i);function i(e){var r;return ak(this,i),tk(rc(r=t.call(this,e)),"current",0),tk(rc(r),"total",0),tk(rc(r),"store",void 0),tk(rc(r),"unsubscribe",void 0),tk(rc(r),"prefix","dvs-pagination-"),tk(rc(r),"created",function(e){r.el=e,r.updateStyle(),r.initEvent();}),tk(rc(r),"updated",function(){r.updateStyle();}),tk(rc(r),"destroyed",function(){var e,t;null===(e=(t=r).unsubscribe)||void 0===e||e.call(t);}),r.data.firstPage=UH(r.data.options.firstPage,{className:r.getClassName("first-page")}),r.data.prevPage=UH(r.data.options.prevPage,{className:r.getClassName("prev-page")}),r.data.nextPage=UH(r.data.options.nextPage,{className:r.getClassName("next-page")}),r.data.lastPage=UH(r.data.options.lastPage,{className:r.getClassName("last-page")}),r.data.gotoPage=e.gotoPage||{},r.data.total=e.total||{},r.data.separator=e.separator||{},r.store=r.injection.stores[i.storeName],r.unsubscribe=r.store.subscribe(function(){r.initDataFromStore(),r.reRenderVNode();}),r.initDataFromStore(),r.initTemplate(),r;}return ok(i,[{key:"getClassName",value:function value(e){var t,i,r=this.prefix;return Ck(t=Ck(i="".concat(r,"iconfont dvs-icon-")).call(i,e," ")).call(t,r+e);}},{key:"initDataFromStore",value:function value(){this.setData({pageDetails:rk(rk({},this.store.getState()),{},{current:this.store.getState().current+1})});}},{key:"updateStyle",value:function value(){if(this.el){var e=this.data.pageDetails,t=e.current,i=e.total,r=this.prefix,n=this.query(".".concat(r,"first-page")),o=this.query(".".concat(r,"prev-page")),a=this.query(".".concat(r,"next-page")),s=this.query(".".concat(r,"last-page"));1===t||0===i?(this.disable(n),this.disable(o)):(this.enable(n),this.enable(o)),t===i||0===i?(this.disable(a),this.disable(s)):(this.enable(a),this.enable(s));}}},{key:"disable",value:function value(e){var t="".concat(this.prefix,"disable");e.classList.contains(t)||e.classList.add(t);}},{key:"enable",value:function value(e){var t="".concat(this.prefix,"disable");e.classList.contains(t)&&e.classList.remove(t);}},{key:"initEvent",value:function value(){var e=this,t=this.prefix,i=this.query(".".concat(t,"first-page")),r=this.query(".".concat(t,"prev-page")),n=this.query(".".concat(t,"next-page")),o=this.query(".".concat(t,"last-page")),a=this.query(".".concat(t,"goto"));this.nativeOn(i,"click",function(){var t=e.data.pageDetails,i=t.current,r=t.total;1!==i&&r>1&&(e.store.dispatch({type:"firstPage"}),e.emit("change",e.data.pageDetails));}),this.nativeOn(r,"click",function(){var t=e.data.pageDetails,i=t.current,r=t.total;1!==i&&r>1&&(e.store.dispatch({type:"previousPage"}),e.emit("change",e.data.pageDetails));}),this.nativeOn(n,"click",function(){var t=e.data.pageDetails,i=t.current,r=t.total;i!==r&&r>1&&(e.store.dispatch({type:"nextPage"}),e.emit("change",e.data.pageDetails));}),this.nativeOn(o,"click",function(){var t=e.data.pageDetails,i=t.current,r=t.total;i!==r&&r>1&&(e.store.dispatch({type:"lastPage"}),e.emit("change",e.data.pageDetails));}),this.nativeOn(a,"input",function(e){a.value=e.target.value.replace(/[^\d]/g,"");}),this.nativeOn(a,"keyup",function(t){if("Enter"===t.key){var i=e.data.pageDetails.total,r=fx(a.value,10);r=kz(r,1,i),a.value=String(r),0!==i&&(e.store.dispatch({type:"gotoPage",current:r-1}),e.emit("change",e.data.pageDetails));}});}},{key:"initTemplate",value:function value(){var e,t,i,r=this.data.options,n=r.gotoPage,o=r.total,a=r.separator;this.injection;var s="dvs-pagination",l=Ck(e=Ck(t=Ck(i="<div ".concat(zH(this.data.options,s,""),'><Button :options="firstPage"></Button><Button :options="prevPage"></Button><input ')).call(i,zH(n,s,"-goto"),' :value="pageDetails.current" :title="pageDetails.current"><div ')).call(t,zH(a,s,"-separator"),"></div><span ")).call(e,zH(o,s,"-total"),' :title="pageDetails.total">{{pageDetails.total}}</span><Button :options="nextPage"></Button><Button :options="lastPage"></Button></div>');this.template=l;}}]),i;}(MH);tk(OH,"hasStore",!0),tk(OH,"storeName","pagination"),tk(OH,"reducer",function(e,t){switch(e||(e={current:-1,total:0}),t.type){case"setPageNumber":return rk(rk({},e),t.pageDetails);case"firstPage":return rk(rk({},e),{},{current:0});case"lastPage":return rk(rk({},e),{},{current:e.total-1});case"nextPage":return rk(rk({},e),{},{current:e.current+1});case"previousPage":return rk(rk({},e),{},{current:e.current-1});case"gotoPage":return rk(rk({},e),{},{current:t.current});default:return e;}});var WH=function(e){lb(i,e);var t=ub(i);function i(e){var r;ak(this,i),tk(rc(r=t.call(this,e)),"postfix",""),tk(rc(r),"created",function(e){r.el=e,r.initNativeEvent();}),e.template&&(r.template=e.template);var n=r.injection,o=n.emitter,a=n.postfix;return r.uiEmitter=o,r.emitter=o,r.postfix=a,r.initTemplate(),r;}return ok(i,[{key:"initTemplate",value:function value(){var e=this.data.options.children,t="<div ".concat(zH(this.data.options,"dvs-root","")," >");e&&dk(e).call(e,function(e,i){var r,n,o=e.enable,a=e.type;!1!==o&&(t+=Ck(r=Ck(n="<".concat(a,' :options="options.children.')).call(n,i,'"></')).call(r,a,">"));}),t+="</div>",this.template=t;}},{key:"initNativeEvent",value:function value(){}}]),i;}(MH);function HH(e,t){if(tz(e)){nz(e.id)||(e.id+=t);for(var i=0,r=GE(e);i<r.length;i++){var n=cb(r[i],2);n[0],HH(n[1],t);}}else ez(e)&&dk(e).call(e,function(e){HH(e,t);});}var FH={name:"dvsUi",install:function install(e){for(var t=e.getClassStore(),i=t.Viewer,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];t.Viewer=function(e,t){var i,r=cb(t,1)[0];return i=function(e){lb(i,e);var t=ub(i);function i(e){var n;return ak(this,i),tk(rc(n=t.call(this,e)),"ui",void 0),tk(rc(n),"uiConfig",void 0),tk(rc(n),"bindPostfix",!0),n.uiConfig=pz(e.uiConfig||{root:{}},iz(r||{})),HH(n.uiConfig.root,n.context.postfix),AH.registerComponent({Group:LH,Button:RH,Root:WH,MainCanvas:NH,Pagination:OH}),n.ui=new AH({container:e.container,emitter:n.context.emitter,postfix:n.context.postfix,uiConfig:n.uiConfig,injection:{viewer:rc(n)}}),n.context.uiService.rootDom=n.ui.rootDom,n.bindContainer(e.container),n.context.hooksService.hooks.destroy.on(function(){n.ui.unbindContainer();}),n.initEvent(),n;}return ok(i,[{key:"width",get:function get(){var e=getComputedStyle(this.rootDom).width.match(/\d+/);if(!e)return 0;var t=cb(e,1)[0];return fx(t,10);},set:function set(e){this.uiConfig.root.style.width=e,e=String(e),/\d+$/.test(e)&&(e="".concat(e,"px")),this.rootDom.style.width="".concat(e),this.externalResized();}},{key:"height",get:function get(){var e=getComputedStyle(this.rootDom).height.match(/\d+/);if(!e)return 0;var t=cb(e,1)[0];return fx(t,10);},set:function set(e){this.uiConfig.root.style.height=e,e=String(e),/\d+$/.test(e)&&(e="".concat(e,"px")),this.rootDom.style.height="".concat(e),this.externalResized();}},{key:"setButtonClass",value:function value(e,t){this.ui.emit("setButtonClass",e,t);}},{key:"updateUiConfig",value:function value(e){return!0;}},{key:"bindContainer",value:function value(e){var t=e;return az(e)&&(t=document.querySelector("#".concat(e))),t instanceof HTMLElement&&(this.ui.bindContainer(t),this.context.uiService.container=t,this.context.uiService.rootDom=this.ui.rootDom,this.getViewerConfig().show||(this.context.uiService.rootDom.style.display="none"),this.context.uiService.isBindContainer=!0,this.resized(),!0);}},{key:"initEvent",value:function value(){var e=this;this.context.hooksService.hooks.pageChanged.on(function(t){var i,r;null===(i=e.ui)||void 0===i||null===(r=i.stores[OH.storeName])||void 0===r||r.dispatch({type:"setPageNumber",pageDetails:t});}),this.context.dvsContext.dvs.emitter.on("fileChanged",function(t){var i=e.getCurrentTab(),r=jI(t).call(t,function(e){var t={id:e.uid,name:e.name,isOpen:!1,isSelected:!1};return i&&i.uid===e.uid&&(t.isSelected=!0),t;});e.emit("treeSetData",r);});}}]),i;}(e),tk(i,"use",e.use),i;}(i,n);}},jH=function(){function e(){ak(this,e);}return ok(e,[{key:"init",value:function value(e){var t=e.dvsContext.hooksService.hooks.overlay,i=function i(t){var i=t.uids,r=t.left,n=t.top,o=t.width,a=t.height,s=t.tabUid;t.trigger;var l=t.color,u=t.opacity,c=t.overlayUid,h=e.getTab(s);h&&(dk(i).call(i,function(e){var t=h.getChildByUid(e);if(t){var i=new pL({id:c,style:{points:[{x:r,y:n},{x:r+o,y:n},{x:r+o,y:n+a},{x:r,y:n+a}],background:l,borderWidth:0,opacity:u}});t.overlays.appendChild(i),t.clearOptimization();}}),e.tabService.isCurrentTab(s)&&(e.showTab(h),e.renderOnly()));},r=function r(t){var i,r=t.tabNode;dk(i=r.childNodes).call(i,function(t){var i=e.getStatus(t.uid);if(i&&t.isVisible){var r,n,o;dk(r=ET(n=t.overlays.childNodes).call(n)).call(r,function(e){t.overlays.removeChild(e);});var a=i.imageScale;dk(o=i.overlays).call(o,function(i){i.uids;var r=i.left,n=i.top,o=i.width,s=i.height;i.tabUid,i.trigger;var l=i.color,u=i.opacity,c=i.overlayUid;"multiple"===e.config.displayMode&&e.config.useMinImage&&(r/=a,n/=a,o/=a,s/=a);var h=new pL({id:c,style:{points:[{x:r,y:n},{x:r+o,y:n},{x:r+o,y:n+s},{x:r,y:n+s}],background:l,borderWidth:0,opacity:u}});t.overlays.appendChild(h);});}});};e.layoutService.hooks.beforeLayout.on(r),t.on(i),e.hooksService.hooks.destroy.on(function(){t.off(i),e.layoutService.hooks.beforeLayout.off(r);});}}]),e;}(),YH={name:"dvsDWT",install:function install(e){var t=e.getClassStore(),i=t.Viewer;if(i){var r=function(e){var t;return t=function(e){lb(i,e);var t=ub(i);function i(e){var r;return ak(this,i),tk(rc(r=t.call(this,e)),"imageSize",void 0),r.context.configService.registerHandler("showVideoContainer",function(e,t){e.config.showVideoContainer=t;var i=document.querySelector("#dvs-video-container".concat(e.postfix));i&&(t?(i.style.display="flex",i.firstChild.style.display="inline",e.uiService.canvasAndScrollContainer.style.display="none"):(i.style.display="none",i.firstChild.style.display="none",e.uiService.canvasAndScrollContainer.style.display="flex",e.resized()));}),r;}return ok(i,[{key:"dwtWidth",get:function get(){return this.width;},set:function set(e){this.width=e,this.emit("dwtResize",this.width,this.height);}},{key:"dwtHeight",get:function get(){return this.height;},set:function set(e){this.height=e,this.emit("dwtResize",this.width,this.height);}},{key:"dwtRender",value:function value(){var e=this,t=this.render();if(t&&"single"===this.context.config.displayMode){var i=this.getCurrentIndex();this.emit("pageRendered",i);}if(t&&"multiple"===this.context.config.displayMode){var r,n=this.getCurrentTab();n&&dk(r=n.children).call(r,function(t,i){t.isVisible&&e.emit("pageRendered",i);});}return t;}},{key:"updateVideoImage",value:function value(e){var t=this;if(!this.getViewerConfig().showVideoContainer)return!1;var i=document.querySelector("#dvs-video-image".concat(this.postfix));return i&&(i.src=e),i.onload=function(){var e=i.naturalWidth,r=i.naturalHeight,n=i.clientWidth,o=i.clientHeight,a=t.imageSize;a&&a.naturalWidth===e&&a.naturalHeight===r&&a.clientWidth===n&&a.clientHeight===o||(t.imageSize={naturalWidth:e,naturalHeight:r,clientWidth:n,clientHeight:o},t.updateVideoSize());},!0;}},{key:"updateVideoSize",value:function value(){if(this.imageSize&&this.getViewerConfig().showVideoContainer){var e=document.querySelector("#dvs-video-container".concat(this.postfix)),t=document.querySelector("#dvs-video-image".concat(this.postfix)),i=e.clientWidth,r=e.clientHeight,n=this.imageSize,o=n.naturalWidth,a=n.naturalHeight,s=o,l=a;o/a>=i/r?(s=i,l=a*(i/o)):(l=r,s=o*(r/a)),t.style.width="".concat(s,"px"),t.style.height="".concat(l,"px"),this.imageSize.clientWidth=t.clientWidth,this.imageSize.clientHeight=t.clientHeight;}}},{key:"overlayRectangle",value:function value(e,t,i,r,n){var o=this,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"#000",s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;if(!YN(this,e=jN(this,e)))return!1;var l=this.getCurrentTab(),u=jI(e).call(e,function(e){return l.getUidByIndex(e);}),c={tabUid:l.uid,tabType:l.type,trigger:this.uid,uids:u,left:t,top:i,width:r,height:n,color:a,opacity:s,overlayUid:bz()};return dk(u).call(u,function(e){o.context.getStatus(e).overlays.push(rk({},c));}),this.context.dvsContext.hooksService.hooks.overlay.emit(c),!0;}},{key:"getCurrentPageUids",value:function value(){var e,t=this.getCurrentTab();return t?jI(e=t.children).call(e,function(e){return e.uid;}):[];}},{key:"getCurrentPageCounts",value:function value(){var e;return(null===(e=this.getCurrentTab())||void 0===e?void 0:e.total)||0;}}]),i;}(e),tk(t,"use",e.use),t;}(i);r.use(new jH()),t.Viewer=r;}}},XH=function(){function e(t){ak(this,e),tk(this,"context",void 0),tk(this,"outer",void 0),tk(this,"inner",void 0),tk(this,"original",void 0),tk(this,"matrixes",void 0),tk(this,"blanks",[]),tk(this,"overlays",[]),this.context=t;}return ok(e,[{key:"handle",value:function value(e){var t,i=this;this.outer=new fL(),this.inner=new fL(),this.outer.appendChild(this.inner),this.original=this.inner,this.matrixes=[],this.blanks=[],this.overlays=[];var r=e.operations,n=e.width,o=e.height,a=e.blanks,s=n,l=o;return this.inner.updateStyle({x:0,y:0,width:n,height:o}),this.outer.updateStyle({width:n,height:o}),r&&dk(r).call(r,function(e){if("r"===e.type){var t=i.rotate(e,s,l),r=t.rWidth,n=t.rHeight;s=r,l=n;}else if("c"===e.type){var o=i.crop(e),u=o.width,c=o.height;s=u,l=c;}else if("f"===e.type)i.flip(e);else if("z"===e.type){var h=i.resize(e,s,l),d=h.rWidth,f=h.rHeight;s=d,l=f;}else"e"===e.type&&i.erase(e,a);}),{width:s,height:l,matrixes:ET(t=this.matrixes).call(t),blanks:this.blanks};}},{key:"erase",value:function value(e,t){var i,r=this;dk(i=e.detail).call(i,function(e){var t,i=e.left,n=e.top,o=e.width,a=e.height,s=r.original.getWorldTransform().clone().invertSelf(),l=jI(t=[[i,n],[i+o,n],[i+o,n+a],[i,n+a]]).call(t,function(e){var t=cb(e,2),i=t[0],r=t[1];return s.transformPoint({x:i,y:r,z:0});});r.blanks.push({uid:e.eraseUid,points:l,background:e.color});});}},{key:"resize",value:function value(e,t,i){var r=e.detail[e.detail.length-1];r||console.error("resize operation is empty");var n=r.width,o=r.height,a=n/t,s=o/i,l=(n-t)/2,u=(o-i)/2,c=new fL();c.updateStyle({x:0,y:0,width:n,height:o}),c.appendChild(this.outer),this.inner=this.outer,this.outer=c,this.inner.scale(a,s,1);var h=this.inner.getPosition(),d=h.x,f=h.y;this.inner.setPosition({x:d+l,y:f+u,z:0});var v=this.inner.getLocalTransform();return this.matrixes.push(v),{rWidth:n,rHeight:o};}},{key:"flip",value:function value(e){var t,i=[1,1,1];dk(t=e.detail).call(t,function(e){"v"===e.dir?(i[1]*=-1,i[2]*=-1):"h"===e.dir&&(i[0]*=-1,i[2]*=-1);});var r=new fL();r.updateStyle({x:0,y:0,width:this.outer.width,height:this.outer.height}),r.appendChild(this.outer),this.outer.scale(i[0],i[1],i[2]),this.inner=this.outer,this.outer=r;var n=this.inner.getLocalTransform();this.matrixes.push(n);}},{key:"crop",value:function value(e){var t,i=null;if(dk(t=e.detail).call(t,function(e){var t=e.left,r=e.top,n=e.width,o=e.height;if(i){var a=i.getRect(),s=a.left,l=a.top,u=new CL(t+s,t+s+n,r+l,r+l+o);i=i.intersection(u);}else i=new CL(t,t+n,r,r+o);}),!i)return console.error("there is no crop operation"),{width:0,height:0};var r=i.getRect(),n=new fL();n.updateStyle({x:0,y:0,width:r.width,height:r.height}),n.appendChild(this.outer),this.inner=this.outer,this.outer=n;var o=this.inner.getPosition(),a=o.x,s=o.y;this.inner.setPosition({x:a-r.left,y:s-r.top,z:0});var l=this.inner.getLocalTransform();return this.matrixes.push(l),i.getRect();}},{key:"rotate",value:function value(e,t,i){var r,n=this,o=null,a=0;if(dk(r=e.detail).call(r,function(e){if(null===o&&(o=e.type),e.type===o)a+=e.angle;else{var r=n.executeRotate(o,a,t,i),s=r.width,l=r.height;t=s,i=l,o=e.type,a=e.angle;}}),o){var s=this.executeRotate(o,a,t,i),l=s.width,u=s.height;t=l,i=u;}return{rWidth:t,rHeight:i};}},{key:"rotateInContainMode",value:function value(e,t,i){var r=function(e,t,i,r,n){var o,a,s=0+i/2,l=0+r/2,u=VU(0,0,s,l,n),c=VU(0+i,0,s,l,n),h=VU(0+i,0+r,s,l,n),d=VU(0,0+r,s,l,n),f=UM(o=[c.x,u.x,d.x,h.x]).call(o,function(e,t){return e-t;}),v=UM(a=[c.y,u.y,d.y,h.y]).call(a,function(e,t){return e-t;});return{x:f[0],y:v[0],width:f[3]-f[0],height:v[3]-v[0]};}(0,0,t,i,eU(e)),n=r.width,o=r.height,a=(n-t)/2,s=(o-i)/2;t=n,i=o;var l=new fL();l.updateStyle({x:0,y:0,width:n,height:o}),l.appendChild(this.outer),this.outer.rotateLocal(e),this.inner=this.outer,this.outer=l;var u=this.inner.getPosition(),c=u.x,h=u.y;this.inner.setPosition({x:c+a,y:h+s,z:0});var d=this.inner.getLocalTransform();return this.matrixes.push(d),{rWidth:n,rHeight:o};}},{key:"executeRotate",value:function value(e,t,i,r){if("clip"===e){var n=new fL();n.updateStyle({x:0,y:0,width:i,height:r}),n.appendChild(this.outer),this.outer.rotateLocal(t),this.inner=this.outer,this.outer=n;var o=this.inner.getLocalTransform();this.matrixes.push(o);}else if("contain"===e){var a=this.rotateInContainMode(t,i,r);i=a.rWidth,r=a.rHeight;}return{width:i,height:r};}},{key:"toMinImageOperations",value:function value(e,t){var i=[];return dk(e).call(e,function(e){var r,n,o,a={type:e.type,detail:[]};i.push(a),"c"===e.type||"e"===e.type?dk(r=e.detail).call(r,function(e){var i=rk(rk({},e),{},{left:e.left/t,top:e.top/t,width:e.width/t,height:e.height/t});a.detail.push(i);}):"f"===e.type||"r"===e.type?dk(n=e.detail).call(n,function(e){var t=rk({},e);a.detail.push(t);}):"z"===e.type&&dk(o=e.detail).call(o,function(e){var i=rk(rk({},e),{},{width:e.width/t,height:e.height/t});a.detail.push(i);});}),i;}}]),e;}(),qH=function(e){lb(i,e);var t=ub(i);function i(e,r){var n;return ak(this,i),tk(rc(n=t.call(this)),"uid",void 0),tk(rc(n),"context",void 0),tk(rc(n),"action",void 0),tk(rc(n),"tabUid",void 0),n.context=e,n.action=r,n.uid=r.commandUid,n.tabUid=r.tabUid,n;}return ok(i,[{key:"execute",value:function value(){}},{key:"undo",value:function value(){this.context.removeActionFromStatus(this.action);}}]),i;}(GN),ZH=function(e){lb(i,e);var t=ub(i);function i(){return ak(this,i),t.apply(this,arguments);}return ok(i);}(qH),_H=function(e){lb(i,e);var t=ub(i);function i(){return ak(this,i),t.apply(this,arguments);}return ok(i);}(qH),GH=function(e){lb(i,e);var t=ub(i);function i(){return ak(this,i),t.apply(this,arguments);}return ok(i,[{key:"execute",value:function value(){var e=this.action,t=e.left,i=e.top,r=e.width,n=e.height,o=e.color,a=e.uids,s=e.eraseUid,l=this.context.getTab(this.tabUid);l&&dk(a).call(a,function(e){var a=l.getChildByUid(e);if(a){var u=new pL({id:s,style:{points:[{x:t,y:i},{x:t+r,y:i},{x:t+r,y:i+n},{x:t,y:i+n}],background:o,borderWidth:0}});a.blanks.appendChild(u);}});}},{key:"undo",value:function value(){var e,t=this;this.context.removeActionFromStatus(this.action);var i=this.context.getTab(this.tabUid);i&&dk(e=this.action.uids).call(e,function(e){var r=i.getChildByUid(e);if(r){var n,o=gE(n=r.blanks.children).call(n,function(e){return e.id===t.action.eraseUid;});o&&r.blanks.removeChild(o);}});}}]),i;}(qH),KH=function(e){lb(i,e);var t=ub(i);function i(){return ak(this,i),t.apply(this,arguments);}return ok(i);}(qH),$H=function(e){lb(i,e);var t=ub(i);function i(){return ak(this,i),t.apply(this,arguments);}return ok(i);}(qH),QH=function(){function e(){ak(this,e);}return ok(e,[{key:"init",value:function value(e){var t=e.getGlobalHooks(),i=t.rotate,r=t.flip,n=t.crop,o=t.erase,a=t.changeSize,s=t.reset,l=function l(t){var i;dk(i=e.getAllTabs()).call(i,function(i){var r;if(KN(t,i)){var n,o=null;switch(dk(n=(t=iz(t)).uids).call(n,function(e){var t=i.getChildByUid(e);t.isEdited=!0,t&&t.clearOptimization();}),t.actionType){case"r":(Math.abs(t.angle)%90||"clip"===t.type)&&dk(r=t.uids).call(r,function(t){var r=i.getChildByUid(t);r&&(r.imageContainer.updateStyle({background:e.config.blankFillColor}),e.getStatus(r.uid).useFillColor=!0);}),o=new $H(e,t);break;case"f":o=new KH(e,t);break;case"c":o=new _H(e,t);break;case"e":o=new GH(e,t);break;case"z":o=new ZH(e,t);}i.commandController.execute(o),e.tabService.isCurrentTab(i.uid)&&e.render();}});},u=function u(t){var i,r=t.uids;dk(i=e.getAllTabs()).call(i,function(i){KN(t,i)&&(dk(r).call(r,function(e){var t,r,n=i.getChildByUid(e);n.isEdited=!0,n&&dk(t=ET(r=n.blanks.childNodes).call(r)).call(t,function(e){n.blanks.removeChild(e);});}),e.tabService.isCurrentTab(i.uid)&&e.render());});};e.layoutService.hooks.beforeLayout.on(function(t){var i,r=t.tabNode;dk(i=r.childNodes).call(i,function(t){var i=e.getStatus(t.uid);if(i&&t.isVisible&&t.isLoaded&&t.image.style.img){var r,n,o,a={operations:i.operations,width:(null===(r=t.image.style.img)||void 0===r?void 0:r.naturalWidth)||0,height:(null===(n=t.image.style.img)||void 0===n?void 0:n.naturalHeight)||0,blanks:jI(o=t.blanks.children).call(o,function(e){return e.id;})};"multiple"===e.config.displayMode&&e.config.useMinImage&&(a.operations=e.dvsContext.editService.toMinImageOperations(i.operations,i.imageScale));var s=e.dvsContext.editService.handle(a),l=s.width,u=s.height,c=s.matrixes,h=s.blanks;t.image.externalMatrixes=c,t.realTimeWidth=l,t.realTimeHeight=u,"multiple"===e.config.displayMode&&e.config.useMinImage||i.setRealTimeSize(l,u),dk(h).call(h,function(e){var i;gE(i=t.blanks.children).call(i,function(t){return t.id===e.uid;}).updateStyle({points:e.points,background:e.background});});}});}),i.on(l),r.on(l),n.on(l),o.on(l),a.on(l),s.on(u),e.hooksService.hooks.destroy.on(function(){i.off(l),r.off(l),n.off(l),o.off(l),a.off(l),s.off(u);});}}]),e;}(),JH={name:"dvsEdit",install:function install(e){var t=e.getClassStore(),i=t.Viewer;if(i){var r=function(e){var t;return t=function(e){lb(i,e);var t=ub(i);function i(e){var r;return ak(this,i),tk(rc(r=t.call(this,e)),"viewerConfig",void 0),r.context.configService.registerHandler("rotationType",function(e,t){e.config.rotationType=t;}),r.context.config.rotationType||(r.context.config.rotationType="contain"),r;}return ok(i,[{key:"rotate",value:function value(e,t){if(!YN(this,t=jN(this,t)))return!1;var i=this.getCurrentTab(),r=jI(t).call(t,function(e){return i.getUidByIndex(e);}),n={actionType:"r",commandUid:bz(),tabUid:i.uid,tabType:i.type,trigger:this.uid,uids:r,angle:e,type:this.getViewerConfigByName("rotationType")};return this.context.storeActionToStatus(n),this.context.getGlobalHooks().rotate.emit(n),!0;}},{key:"flip",value:function value(e,t){if(!YN(this,e=jN(this,e)))return!1;var i=this.getCurrentTab(),r=jI(e).call(e,function(e){return i.getUidByIndex(e);}),n={actionType:"f",commandUid:bz(),tabUid:i.uid,tabType:i.type,trigger:this.uid,uids:r,dir:t||"v"};return this.context.storeActionToStatus(n),this.context.getGlobalHooks().flip.emit(n),!0;}},{key:"mirror",value:function value(e){return this.flip(e,"h");}},{key:"changePageSize",value:function value(e,t,i){if(!YN(this,e=jN(this,e)))return!1;var r=this.getCurrentTab(),n=jI(e).call(e,function(e){return r.getUidByIndex(e);}),o={actionType:"z",commandUid:bz(),tabUid:r.uid,tabType:r.type,trigger:this.uid,uids:n,width:t,height:i};return this.context.storeActionToStatus(o),this.context.getGlobalHooks().changeSize.emit(o),!0;}},{key:"crop",value:function value(e,t,i,r,n){if(!YN(this,e=jN(this,e)))return!1;var o=this.getCurrentTab(),a=jI(e).call(e,function(e){return o.getUidByIndex(e);}),s={actionType:"c",commandUid:bz(),tabUid:o.uid,tabType:o.type,trigger:this.uid,uids:a,left:t,top:i,width:r,height:n};return this.context.storeActionToStatus(s),this.context.getGlobalHooks().crop.emit(s),!0;}},{key:"erase",value:function value(e,t,i,r,n,o){if(!YN(this,e=jN(this,e)))return!1;var a=this.getCurrentTab(),s=jI(e).call(e,function(e){return a.getUidByIndex(e);}),l={actionType:"e",commandUid:bz(),tabUid:a.uid,tabType:a.type,trigger:this.uid,eraseUid:bz(),uids:s,left:t,top:i,width:r,height:n,color:o};return this.context.storeActionToStatus(l),this.context.getGlobalHooks().erase.emit(l),!0;}}]),i;}(e),tk(t,"use",e.use),t;}(i);r.use(new QH()),t.Viewer=r;}},init:function init(e){e.context.editService=new XH(e.context);}},eF=function(){function e(t,i,r,n){ak(this,e),tk(this,"webViewer",void 0),tk(this,"bDispose",!1),tk(this,"element",void 0),tk(this,"container",void 0),tk(this,"css",void 0),this.webViewer=t,this.element=i,this.element.style.flexShrink="0";var o=this.webViewer.myViewer.rootDom;this.container=o.querySelector("#dvs-viewer-main".concat(t.myViewer.postfix));var a="dvs-customElement-right";switch(r){case"left":a="dvs-customElement-left";break;case"top":a="dvs-customElement-top";break;case"bottom":a="dvs-customElement-bottom";}n&&this.element.classList.add("dvs-customElement-full"),this.css=a,this.container.classList.add(a),this.container.appendChild(i),this.hide();}return ok(e,[{key:"show",value:function value(){if(this.element)return this.element.style.display="block",this.webViewer.resized(),this.webViewer.resized(),!0;var e=this.bDispose?"CustomElementDispose":"CustomElementNotExist";return this.webViewer.setError(e),!1;}},{key:"hide",value:function value(){if(this.element)return this.element.style.display="none",this.webViewer.resized(),this.webViewer.resized(),!0;var e=this.bDispose?"CustomElementDispose":"CustomElementNotExist";return this.webViewer.setError(e),!1;}},{key:"dispose",value:function value(){return this.bDispose||(this.element&&(this.container.removeChild(this.element),this.webViewer.resized(),this.webViewer.resized(),this.webViewer.customElement=void 0,this.element=null,this.container.classList.remove(this.css),this.container=void 0),this.bDispose=!0),!0;}}]),e;}();function tF(e){var t=function t(e){var t=Number(e).toString(16).toUpperCase();return 1===t.length&&(t=["0",t].join("")),t;},i=(65280&e)>>8,r=255&e;return["#",t(e>>16),t(i),t(r)].join("");}function iF(e){if(nz(e))return!1;if(""===e)return!0;var t=document.createElement("div");return t.style.background=e,""!==t.style.background;}function rF(e){if(nz(e))return!1;if(""===e)return!0;var t=document.createElement("div");t.style.border=e;var i=t.style,r=i.borderWidth,n=i.borderColor,o=i.borderStyle;return"initial"!==r&&""!==r&&"initial"!==n&&""!==r&&"initial"!==o&&""!==r;}function nF(e){var t=wR(e);return!(nz(t)||t.value<0);}var oF=10===document.documentMode?"dvs-buttons-ie":"dvs-buttons";function aF(e){var t;return Ck(t="dvs-editor-iconfont ds-dwt-ui-icon-".concat(e," ")).call(t,oF);}var sF={type:"Button",className:"".concat(oF," dwt-viewer-imageEditor-emptyBtn"),style:{visibility:"visible"}},lF={type:"Button",name:"previous",id:"previous",className:aF("preImage"),style:{visibility:"visible"},events:{click:"previousImage"}},uF={type:"Button",name:"next",id:"next",className:aF("nextImage"),style:{visibility:"visible"},events:{click:"nextImage"}},cF={type:"Button",name:"scan",id:"scan",className:aF("acquire"),style:{visibility:"visible"},events:{click:"scanImage"}},hF={type:"Button",name:"load",id:"load",className:aF("load"),style:{visibility:"visible"},events:{click:"loadImage"}},dF={type:"Button",name:"print",id:"print",className:aF("printImage"),style:{visibility:"visible"},events:{click:"printImage"}},fF={type:"Button",name:"removeAll",id:"removeAll",className:aF("removeall"),style:{visibility:"visible"},events:{click:"removeAllImage"}},vF={type:"Button",name:"removeSelected",id:"removeSelected",className:aF("removeImage"),style:{visibility:"visible"},events:{click:"removeImage"}},gF={type:"Button",name:"rotateLeft",id:"rotateLeft",className:aF("rotateLeftImage"),style:{visibility:"visible"},events:{click:"rotateLeft"}},mF={type:"Button",name:"rotate",id:"rotate",className:aF("rotate"),style:{visibility:"visible",position:"relative"},events:{click:"rotate"}},yF={type:"Button",name:"rotateRight",id:"rotateRight",className:aF("rotateRightImage"),style:{visibility:"visible"},events:{click:"rotateRight"}},pF={type:"Button",name:"deskew",id:"deskew",className:aF("deskew"),style:{visibility:"visible"},events:{click:"deskew"}},wF={type:"Button",name:"crop",id:"crop",className:aF("cropImage-grey"),style:{visibility:"visible"},events:{click:"cropImage"}},bF={type:"Button",name:"cut",id:"cut",className:aF("erase-grey"),style:{visibility:"visible"},events:{click:"cutImage"}},kF={type:"Button",name:"changeImageSize",id:"changeImageSize",className:aF("changeImageSize"),style:{visibility:"visible",position:"relative"},events:{click:"changeImageSize"}},xF={type:"Button",name:"flip",id:"flip",className:aF("flipImage"),style:{visibility:"visible"},events:{click:"flipImage"}},SF={type:"Button",name:"mirror",id:"mirror",className:aF("mirrorImage"),style:{visibility:"visible"},events:{click:"mirrorImage"}},CF={type:"Button",name:"zoomIn",id:"zoomIn",className:aF("zoomin"),style:{visibility:"visible"},events:{click:"zoomIn"}},VF={type:"Button",name:"originalSize",id:"originalSize",className:aF("originalsize"),style:{visibility:"visible"},events:{click:"originalSize"}},TF={type:"Button",name:"zoomOut",id:"zoomOut",className:aF("zoomout"),style:{visibility:"visible"},events:{click:"zoomOut"}},IF={type:"Button",name:"fit",id:"fit",className:aF("fullWebType"),style:{visibility:"visible"},events:{click:"fitWindow"}},EF={type:"Button",name:"fitW",id:"fitW",className:aF("fitWidthType"),style:{visibility:"visible"},events:{click:"fitWidth"}},PF={type:"Button",name:"fitH",id:"fitH",className:aF("fitHeightType"),style:{visibility:"visible"},events:{click:"fitHeight"}},BF={type:"Button",name:"hand",id:"hand",className:aF("hand"),style:{visibility:"visible"},events:{click:"handMode"}},DF={type:"Button",name:"rectSelect",id:"rectSelect",className:aF("select"),style:{visibility:"visible"},events:{click:"selectMode"}},MF={type:"Button",name:"zoom",id:"zoom",className:aF("clicktozoomin"),style:{visibility:"visible"},events:{click:"zoomMode"}},AF={type:"Button",name:"restore",id:"restore",className:aF("restore"),style:{visibility:"visible"},events:{click:"restoreImage"}},zF={type:"Button",name:"save",id:"save",className:aF("saveImage"),style:{visibility:"visible"},events:{click:"saveImage"}},UF={type:"Button",name:"close",id:"close",className:aF("close"),style:{visibility:"visible"},events:{click:"closeImageEditor"}},RF=["previousImage","nextImage","scanImage","loadImage","printImage","removeAllImage","removeImage","rotateLeft","rotate","rotateRight","deskew","cropImage","cutImage","changeImageSize","flipImage","mirrorImage","zoomIn","originalSize","zoomOut","fitWindow","fitWidth","fitHeight","handMode","selectMode","zoomMode","restoreImage","saveImage","closeImageEditor"],LF=["bufferChanged","click","pageAreaSelected","pageAreaUnselected"],NF={root:{style:{display:"flex",flexDirection:"column",position:"relative"},id:"root",children:[{type:"Group",style:{height:"40px",minHeight:"30px",background:"rgb(58, 57, 59)",boxSizing:"border-box"},id:"header",className:"dwt-viewer-imageEditor-header",children:[{style:{width:"95%"},type:"Group",className:"dwt-viewer-imageEditor-leftButtons",children:[lF,uF,sF,cF,hF,dF,sF,fF,vF,sF,gF,mF,yF,pF,sF,wF,bF,kF,xF,SF,sF,CF,VF,TF,sF,IF,EF,PF,sF,BF,DF,MF,sF,AF,zF]},{style:{width:"5%",justifyContent:"flex-end"},type:"Group",className:"dwt-viewer-imageEditor-rightButtons",children:[UF]}]},{type:"MainCanvas",id:"canvas",className:"dvs-canvas"}]}},OF={flex:"1",visibility:"visible",fontSize:"1.2em"},WF={visibility:"visible",fontSize:"1.2em"},HF={root:{style:{display:"flex",flexDirection:"column",position:"relative"},id:"root",children:[{type:"Group",dataId:"header",style:{padding:"0 8px",height:"40px",background:"#2a292b",boxSizing:"border-box"},className:"dwt-viewer-imageEditor-header",children:[rk(rk({},hF),{},{style:rk({},WF)}),rk(rk({},UF),{},{style:rk({},WF)})]},{type:"Group",dataId:"body",style:{display:"flex",flexDirection:"column"},children:[{type:"Group",dataId:"topMenu",style:{height:"60px",boxSizing:"border-box",background:"#3a393b"},children:[rk(rk({},gF),{},{style:rk({},OF)}),rk(rk({},yF),{},{style:rk({},OF)}),rk(rk({},xF),{},{style:rk({},OF)}),rk(rk({},SF),{},{style:rk({},OF)}),rk(rk({},wF),{},{style:rk({},OF)}),rk(rk({},bF),{},{style:rk({},OF)}),rk(rk({},BF),{},{style:rk({},OF)}),rk(rk({},DF),{},{style:rk({},OF)})]},{type:"MainCanvas",dataId:"canvas",className:"dvs-canvas"},{type:"Group",dataId:"bottomMenu",style:{height:"60px",background:"rgb(58, 57, 59)"},children:[{type:"Pagination",className:"dvs-imageEditor-pagination",events:{change:"paginationChange"},style:{display:"flex",width:"50%"},firstPage:{id:"firstPage",style:{visibility:"visible",flex:1}},lastPage:{id:"lastPage",style:{visibility:"visible",flex:1}},prevPage:{id:"previousPage",style:{visibility:"visible",flex:1}},nextPage:{id:"nextPage",style:{visibility:"visible",flex:1}},gotoPage:{style:{visibility:"visible",flex:1}},total:{style:{visibility:"visible",flex:1,textAlign:"center"}}},rk(rk({},fF),{},{style:rk({},OF)}),rk(rk({},vF),{},{style:rk({},OF)}),rk(rk({},AF),{},{style:rk({},OF)}),rk(rk({},zF),{},{style:rk({},OF)})]}]}]}};function FF(e){var t={};return cz(null==e?void 0:e.borderWidth)&&(t.borderWidth=e.borderWidth),ez(null==e?void 0:e.lineDash)&&cz(e.lineDash[0])&&cz(e.lineDash[1])&&(t.dashLine=[e.lineDash[0],e.lineDash[1]]),az(null==e?void 0:e.borderColor)&&(t.borderColor=e.borderColor),az(null==e?void 0:e.handleColor)&&(t.ctrlBorderColor=e.handleColor),cz(null==e?void 0:e.handleWidth)&&(t.ctrlWidth=e.handleWidth),cz(null==e?void 0:e.handleHeight)&&(t.ctrlHeight=e.handleHeight),t;}function jF(e){return{borderWidth:e.borderWidth,lineDash:e.dashLine,handleWidth:e.ctrlWidth,handleHeight:e.ctrlHeight,handleColor:e.ctrlBorderColor,borderColor:e.borderColor};}var YF=function(){function e(t,i){ak(this,e),tk(this,"dvs",void 0),tk(this,"cutColor","white"),tk(this,"webViewer",void 0),tk(this,"editorViewer",void 0),tk(this,"viewerSetting",void 0),tk(this,"containerElement",void 0),tk(this,"uiSetting",NF),tk(this,"editorSetting",void 0),tk(this,"bShowImageEditor",!1),tk(this,"lastRotateAngle",45),tk(this,"lastRotateKeepSize",!1),tk(this,"promoteSaveChange",!0),tk(this,"workMode",!1),tk(this,"bCrop",!1),tk(this,"bErase",!1),tk(this,"curIndex",0),tk(this,"bChanged",!1),tk(this,"bChangedUid",""),tk(this,"cursor","select"),tk(this,"defaultBtnClass","dvs-btn dvs-editor-iconfont dvs-buttons"),tk(this,"bDispose",!1),tk(this,"bMobile",!1),tk(this,"bFullScreen",!1),tk(this,"deskewStarted",!1),this.webViewer=t,this.dvs=t.myDvs,this.editorSetting=i||iR,this.promoteSaveChange=i.promptToSaveChange,this.workMode=0===i.workMode,this.updateEditorSetting(i),this.init(i);}var t,i,r,n,o,a,s,l,u,c,h,d,f;return ok(e,[{key:"init",value:function value(e){this.bMobile=vz(),this.editorViewer=this.webViewer.myDvs.createViewer({viewerConfig:{viewerStyle:{background:"white"},canvasStyle:{background:"rgba(0,0,0,0)"},pageStyle:{background:"white"},displayMode:"single",enableOptimizeImage:!0,enableSlide:!0,maxZoom:50,margin:0},uiConfig:this.uiSetting,syncViewerUid:this.webViewer.myViewer.uid}),this.updateViewerSetting(e),0!==this.dvs.context.errorService.errorCode&&this.webViewer.setDefaultError(),this.bDispose=!1,this.bindEditorEvents(),gA(this).call(this),this.disableMobileInput(),this.setWidth(null==e?void 0:e.width),this.setHeight(null==e?void 0:e.height),this.setIfAutoScroll(this.webViewer.getIfAutoScroll());}},{key:"updateViewerSetting",value:function value(e){if(!this.editorViewer)return!1;var t=e.innerBorder,i=e.background,r=e.zoomOrigin,n=this.editorViewer.getViewerConfig().canvasStyle,o={border:t||n.border,background:i||n.background};return this.setZoomOrigin(r),this.editorViewer.updateViewerConfig({cropBoxConfig:iz(rR),canvasStyle:o}),!0;}},{key:"updateUISetting",value:function value(e){this.editorSetting=e,this.uiSetting=iz(NF);var t=this.uiSetting.root.children[0],i=t.children[0].children,r=t.children[1].children;if(e.topMenuBorder&&rF(e.topMenuBorder)&&(t.style.border=e.topMenuBorder),e.border&&rF(e.border)&&(this.uiSetting.root.style.border=e.border),this.editorSetting.buttons){for(var n,o=this.editorSetting.buttons,a=o.titles,s=o.visibility,l=[i,r],u=[],c=function c(e){var t;dk(t=l[e]).call(t,function(t,i){var r,n=null==t||null===(r=t.name)||void 0===r?void 0:r.toLocaleLowerCase();nz(a)||nz(a[n])||(t.title=a[n]),nz(s)||nz(s[n])||(t.style.display=!0===s[n]?"":"none",!1===s[n]&&0===e&&u.push(i));});},h=0;h<l.length;h++)c(h);dk(n=[[0,1],[3,4,5],[7,8],[10,11,12,13],[15,16,17,18,19],[21,22,23],[25,26,27],[29,30,31]]).call(n,function(e){if(function(e,t){for(var i=0;i<t.length;i++)if(!VP(e).call(e,t[i]))return!1;return!0;}(u,e)){var t=e[e.length-1]+1;i[t].style.display="none";}});}return this.uiSetting;}},{key:"updateMobileUISetting",value:function value(e){this.editorSetting=e,this.uiSetting=iz(HF);var t=this.uiSetting.root.children[0],i=this.uiSetting.root.children[1],r=t.children,n=i.children[0],o=n.children,a=i.children[2].children;if(e.topMenuBorder&&rF(e.topMenuBorder)&&(n.style.border=e.topMenuBorder),e.border&&rF(e.border)&&(this.uiSetting.root.style.border=e.border),this.editorSetting.buttons)for(var s=this.editorSetting.buttons,l=s.titles,u=s.visibility,c=[r,o,a],h=0;h<c.length;h++){var d;dk(d=c[h]).call(d,function(e){var t,i=null==e||null===(t=e.name)||void 0===t?void 0:t.toLocaleLowerCase();nz(l)||nz(l[i])||(e.title=l[i]),nz(u)||nz(u[i])||(e.style.visibility=!0===u[i]?"visible":"hidden");});}return this.uiSetting;}},{key:"updateEditorSetting",value:function value(e){this.editorSetting=e,vz()?this.updateMobileUISetting(e):this.updateUISetting(e);}},{key:"bindEditorEvents",value:function value(){var e=this;dk(RF).call(RF,function(t){e.editorViewer.ui.on(t,function(){e.hideImageEditorDialog(),e[t]();});}),dk(LF).call(LF,function(t){e.editorViewer.on(t,function(i,r){e[t](i,r);});}),this.editorViewer.on("contextmenu",function(e,t){t.preventDefault();});var t=this.webViewer.webViewerInitConfig.viewerEvents;dz(null==t?void 0:t.onDrop)&&this.editorViewer.on("drop",function(i,r){e.webViewer.acceptDrop&&(null==t||t.onDrop(i,r));}),this.bMobile&&this.editorViewer.ui.on("paginationChange",function(t){e.goToPage(t.current-1);});}},{key:"resize",value:function value(){if(this.editorViewer){var e=this.editorViewer.rootDom;if(e){var t=this.editorViewer.width,i=16;t>600&&(i=Math.min(22,t/750*16)),i<16&&(i=16),this.bMobile&&(i=20),e.style.fontSize="".concat(i,"px");}}}},{key:"hideImageEditorDialog",value:function value(){this.closeRotateDialog(),this.closeChangeSizeDialog();}},{key:"updateZoomInState",value:function value(e){var t=e?"ds-dwt-ui-icon-zoomin":"ds-dwt-ui-icon-zoomin dvs-grey";this.setButtonClass("zoomIn",t);}},{key:"updateZoomOutState",value:function value(e){var t=e?"ds-dwt-ui-icon-zoomout":"ds-dwt-ui-icon-zoomout dvs-grey";this.setButtonClass("zoomOut",t);}},{key:"updateDeskewState",value:function value(e){var t=e?"ds-dwt-ui-icon-deskew":"ds-dwt-ui-icon-deskew dvs-grey";this.setButtonClass("deskew",t);}},{key:"updateEraseState",value:function value(e,t){var i=e?"ds-dwt-ui-icon-erase":"ds-dwt-ui-icon-erase dvs-grey";this.setButtonClass("cut",i),t&&this.clearSelectedArea();}},{key:"updateCropState",value:function value(e,t){var i=e?"ds-dwt-ui-icon-cropImage":"ds-dwt-ui-icon-cropImage dvs-grey";this.setButtonClass("crop",i),t&&this.clearSelectedArea();}},{key:"updateSaveAndRestoreBtn",value:function value(){var e=this.bChanged?"ds-dwt-ui-icon-saveImage":"ds-dwt-ui-icon-saveImage dvs-grey",t=this.bChanged?"ds-dwt-ui-icon-restore":"ds-dwt-ui-icon-restore dvs-grey";this.setButtonClass("save",e),this.setButtonClass("restore",t);}},{key:"updateCursorState",value:function value(){switch(this.cursor){case"pointer":this.handMode();break;case"zoom":this.zoomMode();break;default:this.selectMode();}return!0;}},{key:"updateMouseModeState",value:function value(e){this.setButtonClass("hand","ds-dwt-ui-icon-hand"),this.setButtonClass("rectSelect","ds-dwt-ui-icon-select"),this.setButtonClass("zoom","ds-dwt-ui-icon-clicktozoomin"),"pointer"===e?this.setButtonClass("hand","ds-dwt-ui-icon-hand dwt-viewer-imageEditor-selected"):"crosshair"===e?this.setButtonClass("rectSelect","ds-dwt-ui-icon-select dwt-viewer-imageEditor-selected"):this.setButtonClass("zoom","ds-dwt-ui-icon-clicktozoomin dwt-viewer-imageEditor-selected");}},{key:"updateState",value:function value(){if(this.editorViewer){var e=this.webViewer.getHowManyImagesInBuffer(),t=this.webViewer.getCurrentIndex();e>1?(this.webViewer.getCurrentIndex()===e-1||e<=1?this.setButtonClass("next","ds-dwt-ui-icon-nextImage dvs-grey"):this.setButtonClass("next","ds-dwt-ui-icon-nextImage"),t<=0||e<=1?this.setButtonClass("previous","ds-dwt-ui-icon-preImage dvs-grey"):this.setButtonClass("previous","ds-dwt-ui-icon-preImage")):(this.setButtonClass("next","ds-dwt-ui-icon-nextImage dvs-grey"),this.setButtonClass("previous","ds-dwt-ui-icon-preImage dvs-grey")),this.updateSaveAndRestoreBtn(),this.updateCropState(!1,!0),this.updateEraseState(!1,!0),this.updateCursorState();}}},{key:"setChangedState",value:function value(e){e?(this.bChanged=!0,this.bChangedUid=this.webViewer.getCurrentImgUUid()):(this.bChanged=!1,this.bChangedUid="");}},{key:"disableMobileInput",value:function value(){if(this.bMobile){var e=document.querySelector(".dvs-pagination-goto");e&&(e.disabled=!0);}}},{key:"bindStopPropagation",value:function value(e){var t=document.getElementById(e);t&&(t.onclick=function(e){Yz(e);});}},{key:"updateEditorConfig",value:function value(e){this.editorViewer.updateViewerConfig(e);}},{key:"setIfAutoScroll",value:function value(e){return!!this.editorViewer&&(this.updateEditorConfig({autoSelectLatest:e,autoScroll:e}),!0);}},{key:"getSelectionBoxStyle",value:function value(){if(!this.editorViewer){var e=this.bDispose?"ImageEditorDispose":"ImageEditorNotExist";return this.webViewer.setError(e),!1;}return jF(this.editorViewer.cropBoxConfig);}},{key:"setSelectionBoxStyle",value:function value(e){if(!this.editorViewer){var t=this.bDispose?"ImageEditorDispose":"ImageEditorNotExist";return this.webViewer.setError(t),!1;}if(!tz(e))return!1;var i=FF(e);return this.updateEditorConfig({cropBoxConfig:i}),!0;}},{key:"resetButtonState",value:function value(){this.setChangedState(!1),this.updateSaveAndRestoreBtn();}},{key:"bind",value:function value(){var e;if(this.bShowImageEditor)return!0;if(!this.editorViewer){var t=this.bDispose?"ImageEditorDispose":"ImageEditorNotExist";return this.webViewer.setError(t),!1;}if(this.editorSetting&&this.editorSetting.element)this.bFullScreen=!1,az(this.editorSetting.element)?this.containerElement=document.getElementById(this.editorSetting.element):this.containerElement=this.editorSetting.element;else{var i=document.createElement("div");i.className="dwt-viewer-imageEditor-fullScreen",document.body.insertBefore(i,document.body.firstElementChild),this.bFullScreen=!0,this.containerElement=i;}if(this.editorViewer.bindContainer(this.containerElement),this.editorViewer.hide(),this.updateState(),this.setSelectionRectAspectRatio((null===(e=this.editorSetting)||void 0===e?void 0:e.selectionRectAspectRatio)||0),!this.bMobile){var r=document.getElementById("header".concat(this.editorViewer.postfix));r&&r.addEventListener("wheel",function(e){e.preventDefault();},{passive:!1});}return!0;}},{key:"close",value:function value(){if(!this.editorViewer){var e=this.bDispose?"ImageEditorDispose":"ImageEditorNotExist";return this.webViewer.setError(e),!1;}this.bFullScreen&&document.body.removeChild(this.containerElement);var t=this.webViewer.webViewerInitConfig.imageEditorEvents;return this.bShowImageEditor=!1,this.webViewer.bShowImageEditor=!1,this.hideImageEditorDialog(),this.dvs.removeViewer(this.editorViewer),this.bFullScreen=!1,this.containerElement=null,this.editorViewer=void 0,this.webViewer.imageEditor=void 0,this.dvs=null,this.bDispose=!0,t&&dz(null==t?void 0:t.close)&&null!=t&&t.close(),window.removeEventListener("resize",window.dvsResize),window.dvsResize=null,document.body.style.overflow="",!0;}},{key:"show",value:function value(){var e;if(this.bShowImageEditor)return!0;if(this.editorViewer)return this.bFullScreen&&(this.containerElement.style.display="block",document.body.style.overflow="hidden"),this.bShowImageEditor=!0,this.editorViewer.show(),window.dvsResize=gA(e=this.resize).call(e,this),window.addEventListener("resize",window.dvsResize),this.resize(),!0;var t=this.bDispose?"ImageEditorDispose":"ImageEditorNotExist";return this.webViewer.setError(t),!1;}},{key:"hide",value:function value(){if(this.editorViewer)return this.editorViewer.hide(),this.bShowImageEditor=!1,this.bFullScreen&&(document.body.style.overflow="",this.containerElement.style.display="none"),window.removeEventListener("resize",window.dvsResize),window.dvsResize=null,!0;var e=this.bDispose?"ImageEditorDispose":"ImageEditorNotExist";return this.webViewer.setError(e),!1;}},{key:"hideImageEditor",value:function value(){var e=this;this.bChanged?this.showSaveDialog(function(){e.hide();},this.webViewer.getCurrentImgUUid()):this.hide();}},{key:"setSelectionRectAspectRatio",value:function value(e){if(!this.editorViewer)return!1;var t=e>0,i=e>0?e:0;return this.editorViewer.updateViewerConfig({cropBoxConfig:{aspectRatio:i,keepAspectRatio:t}}),!0;}},{key:"clearSelectedArea",value:function value(){if(!this.editorViewer||this.bDispose)return!1;var e=this.webViewer.getHowManyImagesInBuffer(),t=this.webViewer.getCurrentIndex();if(e<=0||t<0)return!0;var i=this.editorViewer.clearCropBox();return this.editorViewer.render(),i||this.webViewer.setDefaultError(),i;}},{key:"setOperationMode",value:function value(e){if(this.editorViewer){var t="default";switch(e){case 1:t="crop";break;case 2:t="zoomIn";break;case 3:t="zoomOut";break;case 4:t="annotation";break;default:t="default";}this.editorViewer.updateViewerConfig({toolType:t});}}},{key:"setCursor",value:function value(e){if(!this.editorViewer)return!1;var t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex();if(t<=0||i<0)return!1;var r="pointer",n=0,o=this.bMobile?"pointer":"crosshair";switch(e){case"zoom-out":o="zoom",r="zoom-out",n=3;break;case"zoom-in":o="zoom",r="zoom-in",n=2;break;case"crosshair":o="crosshair",r="crosshair",n=1;break;default:o="pointer",r="pointer",n=0;}var a={cursor:r};return this.editorViewer.updateViewerConfig({canvasStyle:a}),this.setOperationMode(n),this.updateMouseModeState(e),this.cursor=o,!0;}},{key:"setFit",value:function value(e){if(!this.webViewer||!this.editorViewer)return!1;var t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex();return!(t<=0||i<0||(this.editorViewer.updateViewerConfig({fitType:e}),this.updateZoomInState(!0),this.updateZoomOutState(!0),this.updateCropState(!1,!0),this.updateEraseState(!1,!0),0));}},{key:"setWidth",value:function value(e){return!(!this.webViewer||!this.editorViewer)&&!(az(e)&&!/^((\d+em)|(\d+px)|(\d+%)|(\d+))$/.test(e)||cz(e)&&e<=0||(this.editorViewer.dwtWidth=e,this.resize(),0));}},{key:"setHeight",value:function value(e){return!(!this.webViewer||!this.editorViewer)&&!(az(e)&&!/^((\d+em)|(\d+px)|(\d+%)|(\d+))$/.test(e)||cz(e)&&e<=0||(this.editorViewer.dwtHeight=e,this.resize(),0));}},{key:"setButtonClass",value:function value(e,t){var i;return!!this.editorViewer&&this.editorViewer.setButtonClass(e,Ck(i="".concat(this.defaultBtnClass," ")).call(i,t));}},{key:"setZoomOrigin",value:function value(e){var t,i;if(!this.editorViewer){var r=this.bDispose?"ImageEditorDispose":"ImageEditorNotExist";return this.webViewer.setError(r),!1;}if(!tz(e)||!az(null==e?void 0:e.x)||!az(null==e?void 0:e.y))return this.webViewer.setError("InvalidValue"),!1;var n=e.x,o=e.y;return-1===DT(t=["left","right","center"]).call(t,n)||-1===DT(i=["top","bottom","center"]).call(i,o)?(this.webViewer.setError("InvalidValue"),!1):(this.editorViewer.updateViewerConfig({zoomOrigin:{x:n,y:o}}),!0);}},{key:"getZoomOrigin",value:function value(){return this.bDispose?"":this.editorViewer.getViewerConfigByName("zoomOrigin");}},{key:"previousImage",value:function value(){var e=this;if(!this.webViewer||!this.editorViewer)return!1;var t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex();return!(t<2||0===i||(this.bChanged?this.showSaveDialog(function(){e.editorViewer.prevPage(),e.updateState();},this.webViewer.getCurrentImgUUid()):(this.editorViewer.prevPage(),this.updateState()),0));}},{key:"nextImage",value:function value(){var e=this;if(!this.webViewer||!this.editorViewer)return!1;var t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex();return!(t<2||i===t-1||(this.bChanged?this.showSaveDialog(function(){e.editorViewer.nextPage(),e.updateState();},this.webViewer.getCurrentImgUUid()):(this.editorViewer.nextPage(),this.updateState()),0));}},{key:"scanImage",value:function value(){var e=this;if(!this.webViewer||!this.editorViewer)return!1;var t=this.webViewer.webViewerInitConfig.imageEditorEvents;return!(!t||!dz(null==t?void 0:t.acquire)||(this.bChanged?this.showSaveDialog(function(){null!=t&&t.acquire(e.editorSetting.dialogText.selectSource),e.updateState();},this.webViewer.getCurrentImgUUid()):(null!=t&&t.acquire(this.editorSetting.dialogText.selectSource),this.updateState()),0));}},{key:"loadImage",value:function value(){var e=this;if(!this.webViewer||!this.editorViewer)return!1;var t=this.webViewer.webViewerInitConfig.imageEditorEvents;return!(!t||!dz(null==t?void 0:t.loadImage)||(this.bChanged?this.showSaveDialog(function(){null!=t&&t.loadImage(),e.updateState();},this.webViewer.getCurrentImgUUid()):(null!=t&&t.loadImage(),this.updateState()),0));}},{key:"removeAllImage",value:function value(){var e=this.webViewer.webViewerInitConfig.imageEditorEvents,t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex();return!(t<=0||i<0||(e&&dz(null==e?void 0:e.removeAllImage)?null==e||e.removeAllImage():this.webViewer.bufferService.removeAllImages(),this.setChangedState(!1),this.updateState(),0));}},{key:"removeImage",value:function value(){var e=this.webViewer.webViewerInitConfig.imageEditorEvents,t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex();return!(t<=0||i<0||(e&&dz(null==e?void 0:e.removeImage)?null==e||e.removeImage():this.webViewer.bufferService.removeSelectedImages(),this.setChangedState(!1),this.updateState(),0));}},{key:"rotate",value:function value(){this.showRotateDialog();}},{key:"changeImageSize",value:function value(){this.showChangeSizeDialog();}},{key:"zoomIn",value:function value(){if(!this.webViewer||!this.editorViewer)return!1;var e=this.webViewer.getHowManyImagesInBuffer(),t=this.webViewer.getCurrentIndex();if(e<=0||t<0)return!1;var i=this.editorViewer.getViewerConfig();return i.zoom<i.maxZoom?(this.editorViewer.zoomIn(),this.updateZoomInState(!0)):this.updateZoomInState(!1),this.updateZoomOutState(!0),this.updateCropState(!1,!0),this.updateEraseState(!1,!0),!0;}},{key:"originalSize",value:function value(){if(!this.webViewer||!this.editorViewer)return!1;var e=this.webViewer.getHowManyImagesInBuffer(),t=this.webViewer.getCurrentIndex();return!(e<=0||t<0||(this.editorViewer.updateViewerConfig({zoom:1}),this.updateZoomInState(!0),this.updateZoomOutState(!0),this.updateCropState(!1,!0),this.updateEraseState(!1,!0),0));}},{key:"zoomOut",value:function value(){if(!this.webViewer||!this.editorViewer)return!1;var e=this.webViewer.getHowManyImagesInBuffer(),t=this.webViewer.getCurrentIndex();if(e<=0||t<0)return!1;var i=this.editorViewer.getViewerConfig();return i.zoom>i.minZoom?(this.editorViewer.zoomOut(),this.updateZoomOutState(!0)):this.updateZoomOutState(!1),this.updateZoomInState(!0),this.updateCropState(!1,!0),this.updateEraseState(!1,!0),!0;}},{key:"fitWindow",value:function value(){this.setFit("window");}},{key:"fitWidth",value:function value(){this.setFit("width");}},{key:"fitHeight",value:function value(){this.setFit("height");}},{key:"selectMode",value:function value(){this.setCursor("crosshair");}},{key:"handMode",value:function value(){this.clearSelectedArea(),this.setCursor("pointer");}},{key:"zoomMode",value:function value(){this.clearSelectedArea(),this.setCursor("zoom-in");}},{key:"restoreImage",value:function value(e){if(!this.webViewer||!this.editorViewer)return!1;if(!this.bChanged)return!1;var t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex();if(nz(e)||(i=this.webViewer.myViewer.getIndexByUid(e)),t<=0||i<0)return!1;var r=this.webViewer.webViewerInitConfig.imageEditorServerCallback;if(this.workMode&&r&&dz(null==r?void 0:r.restore)){var n=e||this.webViewer.getCurrentImgUUid();r.restore(n);}else this.editorViewer.reset(i),this.webViewer.myViewer.resized();return this.setChangedState(!1),this.updateState(),this.webViewer.clearSelectedAreas(),!0;}},{key:"first",value:function value(){var e=this;this.bChanged?this.showSaveDialog(function(){e.goToPage(0);},this.webViewer.getCurrentImgUUid()):this.goToPage(0);}},{key:"last",value:function value(){var e=this,t=this.webViewer.getHowManyImagesInBuffer()-1;this.bChanged?this.showSaveDialog(function(){e.goToPage(t);},this.webViewer.getCurrentImgUUid()):this.goToPage(t);}},{key:"go",value:function value(e){var t=this;this.bChanged?this.showSaveDialog(function(){t.goToPage(e);},this.webViewer.getCurrentImgUUid()):this.goToPage(e);}},{key:"goToPage",value:function value(e){var t=this;if(!this.webViewer||!this.editorViewer)return!1;var i=this.webViewer.getHowManyImagesInBuffer(),r=this.webViewer.getCurrentIndex();return!(i<=0||r<0||!this.bShowImageEditor||nz(e)||-1===e||(this.bChanged?this.showSaveDialog(function(){t.editorViewer.gotoPage(e),t.updateState();},this.webViewer.getCurrentImgUUid()):(this.editorViewer.gotoPage(e),this.updateState()),0));}},{key:"selectPages",value:function value(e){var t=this,i=this.webViewer.getHowManyImagesInBuffer();return VA(e).call(e,function(e){return e>i-1;})?(this.webViewer.setError("ParameterOutRange"),!1):(this.bChanged?this.showSaveDialog(function(){t.webViewer.myViewer.setSelectedIndexes(e),t.updateState();},this.webViewer.getCurrentImgUUid()):(this.webViewer.myViewer.setSelectedIndexes(e),this.updateState()),!0);}},{key:"closeImageEditor",value:function value(){var e=this;0!==this.webViewer.getHowManyImagesInBuffer()&&this.bChanged?this.showSaveDialog(function(){e.close();},this.webViewer.getCurrentImgUUid()):this.close();}},{key:"dispose",value:function value(){this.bChanged&&this.saveImage(this.webViewer.getCurrentImgUUid()),this.close();}},{key:"printImage",value:(f=Pw(Iw().mark(function e(){var t,i,r,n,o,a,s,l,u;return Iw().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.webViewer&&this.editorViewer){e.next=2;break;}return e.abrupt("return",!1);case 2:if(t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex(),!(t<=0||i<0)){e.next=5;break;}return e.abrupt("return",!1);case 5:return r=this.editorViewer.getCurrentTab(),n=r.currentPage,o=n.realTimeWidth,a=n.realTimeHeight,s=n.uid,l="",e.next=9,this.webViewer.myDvs.getImageData(s,{type:"blob"});case 9:if(u=e.sent,!fz()){e.next=16;break;}return e.next=13,new QE(function(e){var t=new FileReader();t.onload=function(){return e(t.result);},t.readAsDataURL(u);});case 13:l=e.sent,e.next=17;break;case 16:l=Xz(u).data;case 17:return e.abrupt("return",(function(e){var t=e.width,i=e.height,r=1120,n=850,o=e.url,a=t<=0?n:t,s=i<=0?r:i,l=n/a,u=r/s;l<u?r=Math.floor(s*l):l>u&&(n=Math.floor(a*u));var c=["alwaysRaised=yes,z-look=yes,top=0,left=0,toolbar=no,menubar=no,location=no,status=no,width=",a,",height=",s].join(""),h=window.open("about:blank","_blank",c),d=["<html><body id='D_body'","<div style='width:",n,"px; ","height:",r,"px'>","<img id='D_img' src='",o,"' style='position:relative; left:0px; top:0px; width:",n,"px; ","height:",r,"px'"," referrerpolicy='strict-origin-when-cross-origin' />","</div>","</body></html>"].join("");if(h){h.document.write(d),h.document.close(),h.focus();var f=h.document.getElementById("D_body");f&&(fz()?h&&h.print():f.onload=function(){h&&h.print();});}}({url:l,width:Math.floor(o),height:Math.floor(a)}),this.updateState(),!0));case 18:case"end":return e.stop();}},e,this);})),function(){return f.apply(this,arguments);})},{key:"rotateLeft",value:(d=Pw(Iw().mark(function e(){var t,i,r;return Iw().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex(),!(t<=0||i<0)){e.next=3;break;}return e.abrupt("return",!1);case 3:if(e.t0=!1===this.bChanged&&this.workMode,!e.t0){e.next=7;break;}return e.next=7,this.saveToServerBeforeEdit();case 7:return r=this.webViewer.webViewerInitConfig.imageEditorServerCallback,e.abrupt("return",(this.workMode&&r&&dz(null==r?void 0:r.rotateLeft)?null==r||r.rotateLeft():this.editorViewer.rotate(-90,i),this.setChangedState(!0),this.updateState(),this.webViewer.clearSelectedAreas(),!0));case 9:case"end":return e.stop();}},e,this);})),function(){return d.apply(this,arguments);})},{key:"rotateInner",value:(h=Pw(Iw().mark(function e(){var t,i,r,n,o,a,s;return Iw().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.getElementById("dvsImageEditorKeepSize"),i=document.getElementById("dvsImageEditorRotateAngle"),r=fx(i.value,10),n=this.webViewer.getHowManyImagesInBuffer(),o=this.webViewer.getCurrentIndex(),!(n<=0||o<0)){e.next=3;break;}return e.abrupt("return",!1);case 3:if(e.t0=!1===this.bChanged&&this.workMode,!e.t0){e.next=7;break;}return e.next=7,this.saveToServerBeforeEdit();case 7:return a=this.webViewer.webViewerInitConfig.imageEditorServerCallback,this.workMode&&a&&dz(null==a?void 0:a.rotate)?(s=document.getElementById("dvsImageEditorInterpolation"),null==a||a.rotate(r,s.selectedIndex+1,t.checked)):this.webViewer.rotateInner(o,r,t.checked),e.abrupt("return",(this.setChangedState(!0),this.closeRotateDialog(),this.updateState(),this.webViewer.clearSelectedAreas(),this.lastRotateAngle=r,this.lastRotateKeepSize=t.checked,!0));case 10:case"end":return e.stop();}},e,this);})),function(){return h.apply(this,arguments);})},{key:"rotateRight",value:(c=Pw(Iw().mark(function e(){var t,i,r,n;return Iw().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.webViewer.getHowManyImagesInBuffer(),r=this.webViewer.getCurrentIndex(),!(i<=0||r<0)){e.next=3;break;}return e.abrupt("return",!1);case 3:if(e.t0=!1===this.bChanged&&this.workMode,!e.t0){e.next=7;break;}return e.next=7,this.saveToServerBeforeEdit();case 7:return n=this.webViewer.webViewerInitConfig.imageEditorServerCallback,e.abrupt("return",(this.workMode&&n&&dz(null==n?void 0:n.rotateRight)?null==n||n.rotateRight():null===(t=this.editorViewer)||void 0===t||t.rotate(90,r),this.setChangedState(!0),this.updateState(),this.webViewer.clearSelectedAreas(),!0));case 9:case"end":return e.stop();}},e,this);})),function(){return c.apply(this,arguments);})},{key:"deskew",value:(u=Pw(Iw().mark(function e(){var t,i,r,n,o,a,s,l,u=this;return Iw().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex(),!(t<=0||i<0)){e.next=3;break;}return e.abrupt("return",!1);case 3:if(r=this.webViewer.webViewerInitConfig,n=r.imageEditorEvents,o=r.imageEditorServerCallback,e.t0=!1===this.bChanged&&this.workMode,!e.t0){e.next=8;break;}return e.next=8,this.saveToServerBeforeEdit();case 8:if(!this.deskewStarted){e.next=10;break;}return e.abrupt("return",!1);case 10:if(this.deskewStarted=!0,this.updateDeskewState(!1),!(this.workMode&&o&&dz(null==o?void 0:o.deskew))){e.next=14;break;}o.deskew(),this.setChangedState(!0),this.deskewStarted=!1,this.updateDeskewState(!0),e.next=22;break;case 14:if(n&&dz(null==n?void 0:n.deskew)){e.next=16;break;}return e.abrupt("return",!1);case 16:return a=this.webViewer.getCurrentImgUUid(),s=this.webViewer.getCurrentIndex(),e.next=20,this.webViewer.myDvs.getImageData(a,{type:"blob",min:!0});case 20:l=e.sent,n.deskew(l,function(e){u.webViewer.rotateInner(s,e,!0),u.setChangedState(!0),u.deskewStarted=!1,u.updateDeskewState(!0),u.updateSaveAndRestoreBtn();});case 22:return e.abrupt("return",(this.updateState(),!0));case 23:case"end":return e.stop();}},e,this);})),function(){return u.apply(this,arguments);})},{key:"cropImage",value:(l=Pw(Iw().mark(function e(){var t,i,r,n,o,a,s,l,u;return Iw().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.bCrop){e.next=2;break;}return e.abrupt("return",!1);case 2:if(t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex(),!(t<=0||i<0)){e.next=5;break;}return e.abrupt("return",!1);case 5:if(1===(r=this.editorViewer.getCropBoxes()).length){e.next=8;break;}return e.abrupt("return",!1);case 8:if(n=r[0],o=n.left,a=n.top,s=n.width,l=n.height,e.t0=!1===this.bChanged&&this.workMode,!e.t0){e.next=13;break;}return e.next=13,this.saveToServerBeforeEdit();case 13:return u=this.webViewer.webViewerInitConfig.imageEditorServerCallback,e.abrupt("return",(this.workMode&&u&&dz(null==u?void 0:u.crop)?u.crop(n):this.editorViewer.crop(i,o,a,s,l),this.setChangedState(!0),this.updateState(),this.webViewer.clearSelectedAreas(),!0));case 15:case"end":return e.stop();}},e,this);})),function(){return l.apply(this,arguments);})},{key:"cutImage",value:(s=Pw(Iw().mark(function e(){var t,i,r,n,o,a,s,l,u;return Iw().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.bErase){e.next=2;break;}return e.abrupt("return",!1);case 2:if(t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex(),!(t<=0||i<0)){e.next=5;break;}return e.abrupt("return",!1);case 5:if(1===(r=this.editorViewer.getCropBoxes()).length){e.next=8;break;}return e.abrupt("return",!1);case 8:if(n=r[0],o=n.left,a=n.top,s=n.width,l=n.height,e.t0=!1===this.bChanged&&this.workMode,!e.t0){e.next=13;break;}return e.next=13,this.saveToServerBeforeEdit();case 13:return u=this.webViewer.webViewerInitConfig.imageEditorServerCallback,e.abrupt("return",(this.workMode&&u&&dz(null==u?void 0:u.erase)?u.erase(n):this.editorViewer.erase(i,o,a,s,l,this.cutColor),this.setChangedState(!0),this.updateState(),this.webViewer.clearSelectedAreas(),!0));case 15:case"end":return e.stop();}},e,this);})),function(){return s.apply(this,arguments);})},{key:"changeImageSizeInner",value:(a=Pw(Iw().mark(function e(){var t,i,r,n,o,a,s,l;return Iw().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex(),!(t<=0||i<0)){e.next=3;break;}return e.abrupt("return",!1);case 3:if(r=document.getElementById("dvsImageEditorChangeH"),n=document.getElementById("dvsImageEditorChangeW"),o=fx(r.value,10),a=fx(n.value,10),e.t0=!1===this.bChanged&&this.workMode,!e.t0){e.next=8;break;}return e.next=8,this.saveToServerBeforeEdit();case 8:return s=this.webViewer.webViewerInitConfig.imageEditorServerCallback,this.workMode&&s&&dz(null==s?void 0:s.changeImageSize)?(l=document.getElementById("dvsImageEditorInterpolation"),s.changeImageSize(a,o,l.selectedIndex+1)):this.editorViewer.changePageSize(i,a,o),e.abrupt("return",(this.setChangedState(!0),this.updateState(),this.closeChangeSizeDialog(),this.webViewer.clearSelectedAreas(),!0));case 11:case"end":return e.stop();}},e,this);})),function(){return a.apply(this,arguments);})},{key:"flipImage",value:(o=Pw(Iw().mark(function e(){var t,i,r;return Iw().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex(),!(t<=0||i<0)){e.next=3;break;}return e.abrupt("return",!1);case 3:if(e.t0=!1===this.bChanged&&this.workMode,!e.t0){e.next=7;break;}return e.next=7,this.saveToServerBeforeEdit();case 7:return r=this.webViewer.webViewerInitConfig.imageEditorServerCallback,e.abrupt("return",(this.workMode&&r&&dz(null==r?void 0:r.flip)?r.flip():this.editorViewer.flip(i),this.setChangedState(!0),this.updateState(),this.webViewer.clearSelectedAreas(),!0));case 9:case"end":return e.stop();}},e,this);})),function(){return o.apply(this,arguments);})},{key:"mirrorImage",value:(n=Pw(Iw().mark(function e(){var t,i,r;return Iw().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex(),!(t<=0||i<0)){e.next=3;break;}return e.abrupt("return",!1);case 3:if(e.t0=!1===this.bChanged&&this.workMode,!e.t0){e.next=7;break;}return e.next=7,this.saveToServerBeforeEdit();case 7:return r=this.webViewer.webViewerInitConfig.imageEditorServerCallback,e.abrupt("return",(this.workMode&&r&&dz(null==r?void 0:r.mirror)?r.mirror():this.editorViewer.mirror(i),this.setChangedState(!0),this.updateState(),this.webViewer.clearSelectedAreas(),!0));case 9:case"end":return e.stop();}},e,this);})),function(){return n.apply(this,arguments);})},{key:"saveImageAsync",value:(r=Pw(Iw().mark(function e(){var t,i,r,n,o,a,s;return Iw().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.editorViewer){e.next=3;break;}return t=this.bDispose?"ImageEditorDispose":"ImageEditorNotExist",e.abrupt("return",(this.webViewer.setError(t),QE.reject("The ImageEditor object has been disposed.")));case 3:if(this.bChanged||!this.workMode){e.next=5;break;}return e.abrupt("return",QE.resolve());case 5:if(this.bChanged){e.next=7;break;}return e.abrupt("return",QE.resolve());case 7:if(i=this.webViewer.webViewerInitConfig,r=i.viewerEvents,n=i.imageEditorServerCallback,o=this.webViewer.getCurrentImgUUid(),this.setChangedState(!1),this.updateState(),this.webViewer.clearSelectedAreas(),this.workMode&&n&&dz(null==n?void 0:n.save)){e.next=16;break;}if(r&&dz(null==r?void 0:r.save)){e.next=11;break;}return e.abrupt("return",QE.reject());case 11:return e.next=13,this.webViewer.myDvs.getImageData(o,{type:"imageData"});case 13:return a=e.sent,s=rk(rk({},this.webViewer.bufferService.getMetadataByUid(o)),{},{width:Math.floor(a.width),height:Math.floor(a.height)}),e.abrupt("return",null==r?void 0:r.save(o,a.data.buffer,s,!0));case 16:return e.abrupt("return",(n.save(o),QE.resolve()));case 17:case"end":return e.stop();}},e,this);})),function(){return r.apply(this,arguments);})},{key:"saveImage",value:(i=Pw(Iw().mark(function e(t){var i,r,n,o,a,s,l,u;return Iw().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.editorViewer){e.next=2;break;}return e.abrupt("return");case 2:if(this.bChanged){e.next=4;break;}return e.abrupt("return");case 4:if(i=this.webViewer.webViewerInitConfig,r=i.viewerEvents,n=i.imageEditorServerCallback,o=t||this.webViewer.getCurrentImgUUid(),this.setChangedState(!1),this.updateState(),this.webViewer.clearSelectedAreas(),!(this.workMode&&n&&dz(null==n?void 0:n.save))){e.next=9;break;}n.save(o),e.next=23;break;case 9:if(r&&dz(null==r?void 0:r.save)){e.next=11;break;}return e.abrupt("return");case 11:return e.next=13,this.webViewer.myDvs.getImageData(o,{type:"imageData"});case 13:return l=e.sent,u=rk(rk({},(null===(a=this.webViewer)||void 0===a||null===(s=a.bufferService)||void 0===s?void 0:s.getMetadataByUid(o))||{}),{},{width:Math.floor(l.width),height:Math.floor(l.height)}),e.prev=15,e.next=18,null==r?void 0:r.save(o,l.data.buffer,u,!0);case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(15),this.setChangedState(!0),this.updateState();case 23:case"end":return e.stop();}},e,this,[[15,20]]);})),function(e){return i.apply(this,arguments);})},{key:"saveToServerBeforeEdit",value:(t=Pw(Iw().mark(function e(){var t,i,r;return Iw().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.webViewer.webViewerInitConfig.imageEditorServerCallback,i=this.webViewer.myViewer,!(this.workMode&&t&&dz(null==t?void 0:t.save))){e.next=8;break;}return i.updateViewerConfig({enableEmitPageRendered:!1}),this.webViewer.bEmitBufferChanged=!1,r=this.webViewer.getCurrentImgUUid(),e.next=6,t.save(r);case 6:this.webViewer.bEmitBufferChanged=!0,i.updateViewerConfig({enableEmitPageRendered:!0});case 8:case"end":return e.stop();}},e,this);})),function(){return t.apply(this,arguments);})},{key:"bufferChanged",value:function value(e){return this.curIndex!==this.webViewer.getCurrentIndex()&&(this.curIndex=this.webViewer.getCurrentIndex(),this.updateState()),"shift"===e.operation&&this.bChanged||"add"===e.operation&&this.bChanged?(this.showSaveDialog(function(){},e.beforeStatus.currentUid),!1):("remove"===e.operation&&this.bChanged&&this.bChangedUid===e.beforeStatus.currentUid&&(this.setChangedState(!1),this.updateState()),!0);}},{key:"click",value:function value(){this.hideImageEditorDialog();var e=this.editorViewer.getViewerConfig();e.zoom<e.maxZoom?this.updateZoomInState(!0):this.updateZoomInState(!1),this.updateZoomOutState(!0);}},{key:"pageAreaSelected",value:function value(e,t){var i=1===t.length;this.bCrop=i,this.updateCropState(i,!1);var r=1===t.length;this.bErase=r,this.updateEraseState(r,!1);}},{key:"pageAreaUnselected",value:function value(){this.updateCropState(!1,!1),this.updateEraseState(!1,!1);}},{key:"wheel",value:function value(e,t){if(t.ctrlKey){var i=this.editorViewer.getViewerConfig(),r=i.zoom,n=r<i.maxZoom,o=r>i.minZoom;this.updateZoomInState(n),this.updateZoomOutState(o);}}},{key:"showMask",value:function value(){var e=document.createElement("div");e.className="dvs-imageEditor-mask",this.editorViewer.rootDom.appendChild(e);}},{key:"closeMask",value:function value(){var e=document.querySelector(".dvs-imageEditor-mask");e&&e.parentNode.removeChild(e);}},{key:"createSaveDialog",value:function value(){var e=this.editorSetting.dialogText,t=null==e?void 0:e.saveChangedImage;(nz(e)||nz(null==e?void 0:e.saveChangedImage))&&(t=tR.saveChangedImage);var i=document.createElement("div");i.className="dvs-imageEditor-saveDlg";var r=["<div class = 'dvs-imageEditor-saveDlg-header'><i class='dynamsoft-dialog-close'></i></div>","<div class = 'dvs-imageEditor-saveDlg-box'>","<div>".concat(t[0],"</div>"),"<div class = 'dvs-imageEditor-saveDlg-btnGroup'>","<input class='dynamsoft_btnSave' type='button'","value='".concat(t[1],"'/>"),"<input class='dynamsoft_btnCancel' type='button'","value='".concat(t[2],"'/>"),"</div></div>"];return i.innerHTML=r.join(""),i.style.width=this.bMobile?"300px":"420px",i;}},{key:"showSaveDialog",value:function value(e,t){var i=this;if(document.querySelector(".dvs-imageEditor-saveDlg")||!this.bChanged)return!1;if(!this.promoteSaveChange)return this.saveImage(t),e(),!0;this.showMask();var r=this.createSaveDialog();this.editorViewer.rootDom.appendChild(r);var n=document.querySelector(".dynamsoft_btnSave"),o=document.querySelector(".dynamsoft_btnCancel"),a=document.querySelector(".dynamsoft-dialog-close");return a&&(a.onclick=function(){i.closeSaveDialog(),i.closeMask();}),n&&(n.onclick=Pw(Iw().mark(function r(){return Iw().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,i.saveImage(t);case 2:i.closeSaveDialog(),i.closeMask(),e();case 5:case"end":return r.stop();}},r);}))),o&&(o.onclick=function(){i.restoreImage(t),i.closeSaveDialog(),i.closeMask(),e();}),!0;}},{key:"closeSaveDialog",value:function value(){var e=document.querySelector(".dvs-imageEditor-saveDlg");e&&e.parentNode.removeChild(e);}},{key:"createRotateDialog",value:function value(){var e,t,i,r,n=this.editorSetting.dialogText,o=null==n?void 0:n.dlgRotateAnyAngle;(nz(n)||nz(null==n?void 0:n.dlgRotateAnyAngle))&&(o=tR.dlgRotateAnyAngle);var a=document.createElement("div");a.className="dvs-imageEditor-rotateBox",a.id="dvsImageEditorRotateBox";var s=!0===this.lastRotateKeepSize?"checked":"",l=this.workMode?"flex":"none",u=['<select size="1" id="dvsImageEditorInterpolation">','<option value="1">NearestNeighbor</option>','<option value="2">Bilinear</option>','<option value="3">Bicubic</option>',"</select>"].join(""),c=[Ck(e="<div><span>".concat(o[0],'</span><input id="dvsImageEditorRotateAngle" type="number" value="')).call(e,this.lastRotateAngle,'"/></div>'),Ck(t=Ck(i='<div style = "display:'.concat(l,'"><span>')).call(i,o[1],"</span>")).call(t,u,"</div>"),Ck(r="<div><input type='checkbox' id='dvsImageEditorKeepSize' ".concat(s," />")).call(r,o[2],"</div>"),"<div><input id='dvsImageEditorRotateOk' type='button' value=".concat(o[3],"/>"),"<input id='dvsImageEditorRotateCancel' type='button' value=".concat(o[4],">"),"</div>"];return a.innerHTML=c.join(""),a;}},{key:"showRotateDialog",value:function value(){var e=this;if(!document.getElementById("dvsImageEditorRotateBox")){var t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex();if(!(t<=0||i<0)){var r=document.getElementById("rotate".concat(this.editorViewer.postfix));if(r){var n=this.createRotateDialog();r.appendChild(n);var o=r.getBoundingClientRect(),a=o.width,s=o.height;n.style.left=a/2+"px",n.style.top=s/2+"px";var l=document.getElementById("dvsImageEditorRotateOk"),u=document.getElementById("dvsImageEditorRotateCancel");this.bindStopPropagation("dvsImageEditorRotateBox"),l&&(l.onclick=function(t){e.rotateInner();}),u&&(u.onclick=function(t){e.closeRotateDialog();});}}}}},{key:"closeRotateDialog",value:function value(){var e=document.getElementById("dvsImageEditorRotateBox");e&&e.parentNode.removeChild(e);}},{key:"createChangeSizeDialog",value:function value(e,t){var i,r,n=this.editorSetting.dialogText,o=null==n?void 0:n.dlgChangeImageSize;(nz(n)||nz(null==n?void 0:n.dlgChangeImageSize))&&(o=tR.dlgChangeImageSize);var a=document.createElement("div");a.className="dvs-imageEditor-changeSizeBox",a.id="dvsImageEditorChangeSizeBox";var s=this.workMode?"flex":"none",l=['<select size="1" id="dvsImageEditorInterpolation">','<option value="1">NearestNeighbor</option>','<option value="2">Bilinear</option>','<option value="3">Bicubic</option>',"</select>"].join(""),u=["<div><span>".concat(o[0],"</span>"),"<div><input id='dvsImageEditorChangeH' type='number' value='".concat(t,"'/>pixel</div></div>"),"<div style='margin-top:10px'><span>".concat(o[1],"</span>"),"<div><input id='dvsImageEditorChangeW' type='number' value='".concat(e,"'/>pixel</div></div>"),Ck(i=Ck(r='<div style = "display:'.concat(s,'"><span>')).call(r,o[2],"</span>")).call(i,l,"</div>"),"<div><input id='dvsImageEditorChangeSizeOk' type='button' value=".concat(o[3],"/>"),"<input id='dvsImageEditorChangeSizeCancel' type='button' value=".concat(o[4],">"),"</div>"];return a.innerHTML=u.join(""),a;}},{key:"showChangeSizeDialog",value:function value(){var e=this;if(!document.getElementById("dvsImageEditorChangeSizeBox")){var t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex();if(!(t<=0||i<0)){var r=document.getElementById("changeImageSize".concat(this.editorViewer.postfix));if(r){var n=this.editorViewer.getCurrentTab().currentPage,o=n.realTimeWidth,a=n.realTimeHeight,s=this.createChangeSizeDialog(Math.floor(o),Math.floor(a));r.appendChild(s);var l=r.getBoundingClientRect(),u=l.width,c=l.height;s.style.left=u/2+"px",s.style.top=c/2+"px";var h=document.getElementById("dvsImageEditorChangeSizeOk"),d=document.getElementById("dvsImageEditorChangeSizeCancel");this.bindStopPropagation("dvsImageEditorChangeSizeBox"),h&&(h.onclick=function(t){Yz(t),e.changeImageSizeInner();}),d&&(d.onclick=function(t){Yz(t),e.closeChangeSizeDialog();});}}}}},{key:"closeChangeSizeDialog",value:function value(){var e=document.getElementById("dvsImageEditorChangeSizeBox");e&&e.parentNode.removeChild(e);}}]),e;}(),XF=function(){function e(t,i){ak(this,e),tk(this,"inner",void 0),this.inner=new YF(t,i);}return ok(e,[{key:"idPostfix",get:function get(){return this.inner.editorViewer.postfix;}},{key:"zoomOrigin",get:function get(){return this.inner.getZoomOrigin();},set:function set(e){this.inner.webViewer.setError("Successful"),this.inner.setZoomOrigin(e);}},{key:"show",value:function value(){return this.inner.webViewer.setError("Successful"),this.inner.show();}},{key:"hide",value:function value(){return this.inner.webViewer.setError("Successful"),this.inner.hideImageEditor();}},{key:"save",value:function value(){return this.inner.webViewer.setError("Successful"),this.inner.saveImageAsync();}},{key:"dispose",value:function value(){return this.inner.webViewer.setError("Successful"),this.inner.dispose();}},{key:"updateSelectionBoxStyle",value:function value(e){this.inner.setSelectionBoxStyle(e);}}]),e;}();function qF(e,t){var i=t.getViewerConfig(),r=i.rows,n=i.columns,o=getComputedStyle(t.canvasContainer).fontSize,a=t.canvasContainer.getBoundingClientRect(),s=a.width,l=a.height,u=wR(e),c=s||0,h=l||0,d=wR(o).value,f=Math.floor(Math.min(h/(2*r+1),c/(2*n+1))),v=e,g=0;switch(u.unit){case"%":g=.01*u.value*c;break;case"em":g=u.value*d;break;default:g=u.value;}if(g>f)switch(u.unit){case"%":v="".concat(Math.floor(f/c*100),"%");break;case"em":v="".concat(Math.floor(f/d),"em");break;case"px":v="".concat(f,"px");break;default:v=f;}return v;}var ZF=function(){function e(t,i){if(ak(this,e),tk(this,"stretchBarColor","black"),tk(this,"bHide",!0),tk(this,"pageMargin",10),tk(this,"bSingleMode",!1),tk(this,"bDispose",!1),tk(this,"webViewer",void 0),tk(this,"myThumbnailViewer",void 0),tk(this,"thbStretchBar",null),tk(this,"enableResizing",!1),tk(this,"enableProps",["enableDragPage","enableResizing","autoSelectTopPage"]),tk(this,"keyboardControl",!0),this.webViewer=t,i){var r=function(e){var t,i,r,n,o,a,s=e.size,l=e.pageMargin,u=e.checkbox,c=e.pageNumber,h=e.scrollDirection,d={};return dk(t=["showThumbnail","allowKeyboardControl","allowPageDragging","allowResizing","autoChangeIndex"]).call(t,function(t){var i;i=e[t],!nz(i)&&hz(i)&&(d[t]=e[t]);}),dk(i=["columns","rows"]).call(i,function(t){(function(e){var t=wR(e);return!(nz(t)||t.value<0);})(e[t])&&(d[t]=e[t]);}),dk(r=["background","hoverPageBackground","pageBackground","placeholderBackground","selectedPageBackground"]).call(r,function(t){iF(e[t])&&(d[t]=e[t]);}),dk(n=["border","hoverPageBorder","pageBorder","selectedPageBorder"]).call(n,function(t){rF(e[t])&&(d[t]=e[t]);}),dk(o=["location"]).call(o,function(t){var i;i=e[t],!nz(i)&&az(i)&&(d[t]=e[t]);}),function(e){var t=wR(e);return!nz(t)&&!(t.value>100&&"%"===t.unit||t.value<0);}(s)&&(d.size=s),nF(l)&&(d.pageMargin=l),nz(u)||(d.checkbox=u),nz(c)||(d.pageNumber=c),-1!==DT(a=["vertical","horizontal"]).call(a,h)&&(d.scrollDirection=h),d;}(i);i=this.mergeThumbSettings(r);}else i=iz(eR);this.myThumbnailViewer=this.webViewer.myViewer.createThumbnail(i),this.bDispose=!1,this.pageMargin=this.myThumbnailViewer.getThbConfigByName("gap"),this.webViewer.bThumbnailDispose=!1,this.setIfAutoScroll(this.webViewer.getIfAutoScroll()),i.show&&(this.bHide=!1,this.setPageMargin(this.pageMargin)),this.bindDefaultEvent(),this.initStretchBar(),this.allowResize=i.enableResizing;}return ok(e,[{key:"setDefaultError",value:function value(){var e=this.bDispose?"ThumbnailViewerDispose":"ThumbnailViewerNotExist";this.webViewer.setError(e);}},{key:"getLegalBorder",value:function value(e,t){var i,r;if(nz(e))return"";if(""===e)return"";var n=document.createElement("div");n.style.border=e;var o=n.style,a=o.borderWidth,s=o.borderColor,l=o.borderStyle;return Ck(i=Ck(r="".concat(""===a||"initial"===a||"medium"===a?"1px":a," ")).call(r,"initial"===l||"none"===l?"solid":l," ")).call(i,"initial"===s||"currentcolor"===s?t:s);}},{key:"mergeThumbSettings",value:function value(e){var t="horizontal",i=-1;switch(e.location||"left"){case"right":t="horizontal",i=1;break;case"top":t="vertical",i=-1;break;case"bottom":t="vertical",i=1;}var r=e.showThumbnail,n=e.size,o=e.columns,a=e.rows,s=e.autoChangeIndex,l=e.allowPageDragging,u=e.allowKeyboardControl,c=e.allowResizing,h=e.pageMargin,d=e.scrollDirection,f=e.background,v=e.border,g=e.hoverPageBackground,m=e.hoverPageBorder,y=e.pageBackground,p=e.pageBorder,w=e.placeholderBackground,b=e.selectedPageBackground,k=e.selectedPageBorder,x=h,S=h;a===o&&1===a&&(S=0,this.bSingleMode=!0);var C={location:t,sequence:i,show:r,size:n,columns:o,rows:a,autoSelectTopPage:s,enableDragPage:l,enableKeyboardControl:u,enableResizing:c,gap:x,margin:S,scrollDirection:d,thumbnailStyle:{background:f||this.webViewer.getBackground(),border:this.getLegalBorder(v,"rgba(0,0,0,0)")||""},hoveredPageStyle:{background:g||"rgb(239, 246, 253)",border:this.getLegalBorder(m,"rgb(238, 238, 238)")||"1px solid rgb(238, 238, 238)"},pageStyle:{background:y||"transparent",border:this.getLegalBorder(p,"rgb(238, 238, 238)")||"1px solid rgb(238, 238, 238)"},placeholderStyle:{background:w||"rgb(251, 236, 136)"},selectedPageStyle:{background:b||"rgb(199, 222, 252)",border:this.getLegalBorder(k,"rgb(125, 162, 206)")||"1px solid rgb(125, 162, 206)"},checkboxStyle:rk(rk({},this.webViewer.myViewer.getViewerConfig().checkboxStyle),Wz(e.checkbox)),pageNumberStyle:rk(rk({},this.webViewer.myViewer.getViewerConfig().pageNumberStyle),Wz(e.pageNumber)),multiselectMode:1===this.webViewer.getMultiSelectMode()},V={};return pz(iz(eR),V),pz(Wz(C),V),V;}},{key:"bindDefaultEvent",value:function value(){this.myThumbnailViewer&&this.webViewer&&(this.bindDefaultKeyDown(),this.bindDefaultContextmenu());}},{key:"bindDefaultKeyDown",value:function value(){var e=this;this.myThumbnailViewer.on("keydown",function(t){e.keyboardControl&&(t.preventDefault(),"ArrowUp"!==t.key&&"Up"!==t.key?"ArrowDown"!==t.key&&"Down"!==t.key||e.webViewer.next():e.webViewer.previous());});}},{key:"bindDefaultContextmenu",value:function value(){var e=this;this.myThumbnailViewer.on("contextmenu",function(t,i){e.webViewer.hideContextmenu&&i.preventDefault();});}},{key:"initStretchBar",value:function value(){var e=document.createElement("div");e.id="thbStretchBar",e.style.display="none",this.thbStretchBar=e;var t=this.getLocation(),i=this.myThumbnailViewer.innerViewer.rootDom;e.className="top"!==t&&"bottom"!==t?"dvs-thbStretchBarH dvs-thbStretchBar-".concat(t):"dvs-thbStretchBarV dvs-thbStretchBar-".concat(t),i.appendChild(e),this.bindStretchEvent(e);}},{key:"bindStretchEvent",value:function value(e){var t=this,i=0,r=0,n=!1,o=this.getLocation(),a=0,s=0,l=0,u=0,c=function c(_c2){if(t.myThumbnailViewer){var h=t.myThumbnailViewer.innerViewer.rootDom,d=t.webViewer.myViewer.rootDom,f=getComputedStyle(h),v=getComputedStyle(d);l=pR(f.width).value,u=pR(f.height).value,a=pR(v.width).value,s=pR(v.height).value,i=_c2.clientX,r=_c2.clientY,n=!0,o=t.getLocation(),e.style.background=t.stretchBarColor;}},h=function h(c){if(n&&t.myThumbnailViewer){var h="left"===o?c.clientX-i:i-c.clientX,d="top"===o?c.clientY-r:r-c.clientY;"right"===o&&t.thbStretchBar.classList.remove("dvs-thbStretchBar-right"),"bottom"===o&&t.thbStretchBar.classList.remove("dvs-thbStretchBar-bottom");var f=l+h;"top"!==o&&"bottom"!==o||(f=u+d),f<0&&(f=0),("left"===o||"right"===o)&&f>a&&(f=a),("top"===o||"bottom"===o)&&f>s&&(f=s),e.style[o]="".concat(f,"px");}},d=function d(i){if(n&&t.myThumbnailViewer){n=!1;var r,a=t.myThumbnailViewer.getThbConfigByName("size");switch(o){case"top":""!==e.style.top&&(r=pR(e.style.top),e.style.top="");break;case"bottom":""!==e.style.bottom&&(r=pR(e.style.bottom),e.style.bottom="",t.thbStretchBar.classList.add("dvs-thbStretchBar-bottom"));break;case"right":""!==e.style.right&&(r=pR(e.style.right),e.style.right="",t.thbStretchBar.classList.add("dvs-thbStretchBar-right"));break;default:""!==e.style.left&&(r=pR(e.style.left),e.style.left="");}e.style.background="",r&&a!==r.value&&(t.myThumbnailViewer.updateThbConfig({size:Math.floor(r.value)}),t.emitThumbnailResize(),t.resized());}};window.PointerEvent?(e.addEventListener("pointerdown",c),document.addEventListener("pointermove",h),document.addEventListener("pointerup",d)):window.MSPointerEvent?(e.addEventListener("MSPointerDown",c),document.addEventListener("MSPointerMove",h),document.addEventListener("MSPointerUp",d)):(e.addEventListener("mousedown",c),document.addEventListener("mousemove",h),document.addEventListener("mouseup",d));}},{key:"showThumbnail",get:function get(){return this.myThumbnailViewer.getThbConfig().show;},set:function set(e){this.showThumbnail===e&&!0===e||(this.bHide=!e,this.myThumbnailViewer.updateThbConfig({show:e}),this.setPageMargin(this.pageMargin));}},{key:"allowResize",get:function get(){return this.enableResizing;},set:function set(e){this.enableResizing=e,this.thbStretchBar.style.display=!0===e?"":"none";}},{key:"updateThumbnailConfig",value:function value(e){this.myThumbnailViewer.updateThbConfig(e);}},{key:"e",value:function value(){this.webViewer.setError("Successful");}},{key:"setError",value:function value(e){this.webViewer.setError(e);}},{key:"setBorder",value:function value(e){var t;if(!this.myThumbnailViewer)return!1;var i=this.getLocation(),r=this.myThumbnailViewer.innerViewer.defaultDom;if(!r)return!1;switch(dk(t=["borderLeft","borderBottom","borderTop","borderRight"]).call(t,function(e){r.style[e]="";}),i){case"right":r.style.borderLeft=e;break;case"top":r.style.borderBottom=e;break;case"bottom":r.style.borderTop=e;break;default:r.style.borderRight=e;}return!0;}},{key:"getLocation",value:function value(){return this.myThumbnailViewer?"vertical"===this.myThumbnailViewer.getThbConfig().location?this.myThumbnailViewer.getThbConfig().sequence>0?"bottom":"top":this.myThumbnailViewer.getThbConfig().sequence>0?"right":"left":(this.setDefaultError(),"");}},{key:"setLocation",value:function value(e){var t=e||"left",i="horizontal",r=-1;if(this.myThumbnailViewer){switch(t){case"right":i="horizontal",r=1;break;case"top":i="vertical",r=-1;break;case"bottom":i="vertical",r=1;}this.myThumbnailViewer.updateThbConfig({location:i,sequence:r});var n=this.getLocation();return this.setBorder(this.webViewer.getBorder()),this.thbStretchBar.className="top"!==n&&"bottom"!==n?"dvs-thbStretchBarH dvs-thbStretchBar-".concat(n):"dvs-thbStretchBarV dvs-thbStretchBar-".concat(n),this.resized(),!0;}return this.setDefaultError(),!1;}},{key:"getSize",value:function value(){return this.myThumbnailViewer?this.myThumbnailViewer.getThbConfig().size:(this.setDefaultError(),!1);}},{key:"setSize",value:function value(e){return!/^((\d+em)|(\d+px)|(\d+%)|(\d+))$/.test(e)||e<0?(this.webViewer.setError("InvalidValue"),!1):e===this.myThumbnailViewer.getThbConfig().size||(this.myThumbnailViewer?(this.setPageMargin(this.pageMargin),this.myThumbnailViewer.updateThbConfig({size:e}),this.bHide?(this.show(),this.emitThumbnailResize(),this.hide()):this.emitThumbnailResize(),this.myThumbnailViewer.innerViewer.resized(),!0):(this.setDefaultError(),!1));}},{key:"getScrollDirection",value:function value(){return this.myThumbnailViewer?this.myThumbnailViewer.getThbConfig().scrollDirection:(this.setDefaultError(),!1);}},{key:"setScrollDirection",value:function value(e){return"horizontal"!==e&&(e="vertical"),this.myThumbnailViewer?(this.myThumbnailViewer.updateThbConfig({scrollDirection:e}),!0):(this.setDefaultError(),!1);}},{key:"getShowPageNumber",value:function value(){return this.myThumbnailViewer?"visible"===this.myThumbnailViewer.getThbConfig().pageNumberStyle.visibility:(this.setDefaultError(),!1);}},{key:"setShowPageNumber",value:function value(e){if(!hz(e))return this.webViewer.setError("InvalidValue"),!1;var t={visibility:e?"visible":"hidden"};return this.updatePageNumberStyle(t),!0;}},{key:"getShowCheckbox",value:function value(){return this.myThumbnailViewer?"visible"===this.myThumbnailViewer.getThbConfig().checkboxStyle.visibility:(this.setDefaultError(),!1);}},{key:"setShowCheckbox",value:function value(e){if(!hz(e))return this.webViewer.setError("InvalidValue"),!1;if(this.myThumbnailViewer){var t={visibility:e?"visible":"hidden"};this.updateCheckboxStyle(t);var i="visible"===t.visibility?1:0;return this.setMultiSelectMode(i),!0;}return this.setDefaultError(),!1;}},{key:"getShowRemoveBtn",value:function value(){return this.myThumbnailViewer?"visible"===this.myThumbnailViewer.getThbConfig().removeBtnStyle.visibility:(this.setDefaultError(),!1);}},{key:"setShowRemoveBtn",value:function value(e){if(!hz(e))return this.webViewer.setError("InvalidValue"),!1;if(this.myThumbnailViewer){var t={visibility:e?"visible":"hidden"};return this.updateRemoveBtnStyle(t),!0;}return this.setDefaultError(),!1;}},{key:"getPageMargin",value:function value(){if(this.myThumbnailViewer){var e=this.myThumbnailViewer.getThbConfig(),t=e.columns,i=e.rows;return t===i&&1===i?0:this.pageMargin;}return this.setDefaultError(),0;}},{key:"setPageMargin",value:function value(e){if(!/^((\d+em)|(\d+px)|(\d+%)|(\d+))$/.test(e)||e<0)return this.webViewer.setError("InvalidValue"),!1;this.pageMargin=e;var t=qF(e,this.myThumbnailViewer.innerViewer);return this.myThumbnailViewer?(this.myThumbnailViewer.updateThbConfig({gap:t}),this.bSingleMode||this.myThumbnailViewer.updateThbConfig({margin:t}),this.resized(),!0):(this.setDefaultError(),!1);}},{key:"getEnableProp",value:function value(e){var t;return-1!==DT(t=this.enableProps).call(t,e)&&("enableResizing"===e?this.allowResize:this.myThumbnailViewer?this.myThumbnailViewer.getThbConfigByName(e):(this.setDefaultError(),!1));}},{key:"setEnableProp",value:function value(e,t){var i;return-1!==DT(i=this.enableProps).call(i,e)&&(hz(t)?("enableResizing"===e&&(this.allowResize=t),this.myThumbnailViewer?(this.myThumbnailViewer.updateThbConfig(tk({},e,t)),!0):(this.setDefaultError(),!1)):(this.webViewer.setError("InvalidValue"),!1));}},{key:"getThumbSetting",value:function value(e){return this.myThumbnailViewer?this.myThumbnailViewer.getThbConfig().thumbnailStyle[e]:(this.setDefaultError(),"");}},{key:"setThumbSetting",value:function value(e,t){if(this.myThumbnailViewer){var i=tk({},e,t);return this.myThumbnailViewer.updateThbConfig({thumbnailStyle:i}),!0;}return this.setDefaultError(),!1;}},{key:"getPageSetting",value:function value(e){return this.myThumbnailViewer?this.myThumbnailViewer.getThbConfig().pageStyle[e]:(this.setDefaultError(),"");}},{key:"setPageSetting",value:function value(e,t){if(this.myThumbnailViewer){var i=tk({},e,t);return this.myThumbnailViewer.updateThbConfig({pageStyle:i}),!0;}return this.setDefaultError(),!1;}},{key:"getHoverSetting",value:function value(e){return this.myThumbnailViewer?this.myThumbnailViewer.getThbConfig().hoveredPageStyle[e]:(this.setDefaultError(),"");}},{key:"setHoverSetting",value:function value(e,t){if(this.myThumbnailViewer){var i=tk({},e,t);return this.myThumbnailViewer.updateThbConfig({hoveredPageStyle:i}),!0;}return this.setDefaultError(),!1;}},{key:"getSelectSetting",value:function value(e){return this.myThumbnailViewer?this.myThumbnailViewer.getThbConfig().selectedPageStyle[e]:(this.setDefaultError(),"");}},{key:"setSelectSetting",value:function value(e,t){if(this.myThumbnailViewer){var i=tk({},e,t);return this.myThumbnailViewer.updateThbConfig({selectedPageStyle:i}),!0;}return this.setDefaultError(),!1;}},{key:"getPlaceholderSetting",value:function value(e){return this.myThumbnailViewer?this.myThumbnailViewer.getThbConfig().placeholderStyle[e]:(this.setDefaultError(),"");}},{key:"setPlaceholderSetting",value:function value(e,t){if(this.myThumbnailViewer){var i=tk({},e,t);return this.myThumbnailViewer.updateThbConfig({placeholderStyle:i}),!0;}return this.setDefaultError(),!1;}},{key:"show",value:function value(){return this.myThumbnailViewer?(this.webViewer.myViewer.setViewMode(1,1),this.webViewer.setIfSinglePageMode(!0),this.myThumbnailViewer.show(),this.bHide=!1,this.setPageMargin(this.pageMargin),!0):(this.setDefaultError(),!1);}},{key:"hide",value:function value(){return this.myThumbnailViewer?(this.bHide=!0,this.myThumbnailViewer.hide(),!0):(this.setDefaultError(),!1);}},{key:"dispose",value:function value(){if(this.bDispose)return!0;var e=this.webViewer.myViewer.removeThumbnail(this.myThumbnailViewer);return this.webViewer.resized(),e&&(this.bDispose=!0,this.webViewer.bThumbnailDispose=!0,this.myThumbnailViewer=void 0,this.webViewer.thumbnailViewer=void 0),e;}},{key:"updateViewMode",value:function value(e){if(!e)return this.webViewer.setError("InvalidValue"),!1;if(this.myThumbnailViewer){var t=e.columns,i=e.rows,r=e.scrollDirection;if(i&&t){var n;if(i<0||t<0)return this.webViewer.setError("InvalidPropertyValue"),!1;this.myThumbnailViewer.setViewMode(i,t),i===t&&1===i?(this.bSingleMode=!0,this.myThumbnailViewer.updateThbConfig({margin:0})):(this.bSingleMode=!1,this.setPageMargin(this.pageMargin),this.myThumbnailViewer.updateThbConfig({margin:this.myThumbnailViewer.getThbConfig().gap})),r&&-1!==DT(n=["horizontal","vertical"]).call(n,r)&&this.myThumbnailViewer.updateThbConfig({scrollDirection:r});}return this.resized(),!0;}return this.setDefaultError(),!1;}},{key:"updateCheckboxStyle",value:function value(e){return this.myThumbnailViewer?(this.myThumbnailViewer.updateThbConfig({checkboxStyle:e}),!0):(this.setDefaultError(),!1);}},{key:"updatePageNumberStyle",value:function value(e){return this.myThumbnailViewer?(this.myThumbnailViewer.updateThbConfig({pageNumberStyle:e}),!0):(this.setDefaultError(),!1);}},{key:"updateRemoveBtnStyle",value:function value(e){return this.myThumbnailViewer?(this.myThumbnailViewer.updateThbConfig({removeBtnStyle:e}),!0):(this.setDefaultError(),!1);}},{key:"on",value:function value(e,t){if(e)if(dz(t)){var i=e;switch(e){case"onDrop":i="drop";break;case"rightclick":i="contextmenu";break;case"resize":i="dwtResize";break;default:i=e;}this.myThumbnailViewer.on(i,t);}else this.webViewer.setError("CallbackNotAFunction");}},{key:"off",value:function value(e,t){if(e){var i=e;switch(e){case"onDrop":i="drop";break;case"rightclick":i="contextmenu";break;case"resize":i="dwtResize";break;default:i=e;}if(nz(t))return this.myThumbnailViewer.off(i),"keydown"===i&&this.bindDefaultKeyDown(),void("contextmenu"===i&&this.bindDefaultContextmenu());dz(t)?this.myThumbnailViewer.off(i,t):this.webViewer.setError("CallbackNotAFunction");}}},{key:"setIfAutoScroll",value:function value(e){return!!this.myThumbnailViewer&&(this.myThumbnailViewer.updateThbConfig({autoSelectLatest:e,autoScroll:e}),!0);}},{key:"setMultiSelectMode",value:function value(e){return cz(e)?this.myThumbnailViewer?(this.myThumbnailViewer.updateThbConfig({multiselectMode:1===e}),!0):(this.setDefaultError(),!1):(this.webViewer.setError("InvalidValue"),!1);}},{key:"emitThumbnailResize",value:function value(){if(this.myThumbnailViewer){var e=this.myThumbnailViewer.innerViewer.defaultDom;if(e){var t=e.getClientRects();if(!(t.length<1)){var i=t[0],r=i.width,n=i.height;this.myThumbnailViewer.innerViewer.emit("dwtResize",r,n);}}}}},{key:"resized",value:function value(){this.myThumbnailViewer&&this.myThumbnailViewer.innerViewer.resized();}}]),e;}(),_F=function(){function e(t,i){ak(this,e),tk(this,"inner",void 0),this.inner=new ZF(t,i);}return ok(e,[{key:"location",get:function get(){return this.inner.e(),this.inner.getLocation();},set:function set(e){this.inner.e(),this.inner.setLocation(e);}},{key:"size",get:function get(){return this.inner.e(),this.inner.getSize();},set:function set(e){this.inner.e(),this.inner.setSize(e);}},{key:"scrollDirection",get:function get(){return this.inner.e(),this.inner.getScrollDirection();},set:function set(e){this.inner.e(),this.inner.setScrollDirection(e);}},{key:"showPageNumber",get:function get(){return this.inner.e(),this.inner.getShowPageNumber();},set:function set(e){this.inner.e(),this.inner.setShowPageNumber(e);}},{key:"showCheckbox",get:function get(){return this.inner.e(),this.inner.getShowCheckbox();},set:function set(e){this.inner.e(),this.inner.setShowCheckbox(e);}},{key:"pageMargin",get:function get(){return this.inner.e(),this.inner.getPageMargin();},set:function set(e){this.inner.e(),nF(e)?this.inner.setPageMargin(e):this.inner.setError("InvalidValue");}},{key:"border",get:function get(){return this.inner.e(),this.inner.getThumbSetting("border");},set:function set(e){this.inner.e(),rF(e)&&this.inner.setThumbSetting("border",e);}},{key:"background",get:function get(){return this.inner.e(),this.inner.getThumbSetting("background");},set:function set(e){this.inner.e(),cz(e)&&(e=tF(e)),iF(e)&&this.inner.setThumbSetting("background",e);}},{key:"pageBackground",get:function get(){return this.inner.e(),this.inner.getPageSetting("background");},set:function set(e){this.inner.e(),cz(e)&&(e=tF(e)),iF(e)&&this.inner.setPageSetting("background",e);}},{key:"pageBorder",get:function get(){return this.inner.e(),this.inner.getPageSetting("border");},set:function set(e){this.inner.e(),rF(e)&&this.inner.setPageSetting("border",e);}},{key:"hoverPageBackground",get:function get(){return this.inner.e(),this.inner.getHoverSetting("background");},set:function set(e){this.inner.e(),cz(e)&&(e=tF(e)),iF(e)&&this.inner.setHoverSetting("background",e);}},{key:"hoverPageBorder",get:function get(){return this.inner.e(),this.inner.getHoverSetting("border");},set:function set(e){this.inner.e(),rF(e)&&this.inner.setHoverSetting("border",e);}},{key:"placeholderBackground",get:function get(){return this.inner.e(),this.inner.getPlaceholderSetting("background");},set:function set(e){this.inner.e(),cz(e)&&(e=tF(e)),iF(e)&&this.inner.setPlaceholderSetting("background",e);}},{key:"selectedPageBorder",get:function get(){return this.inner.e(),this.inner.getSelectSetting("border");},set:function set(e){this.inner.e(),rF(e)&&this.inner.setSelectSetting("border",e);}},{key:"selectedPageBackground",get:function get(){return this.inner.e(),this.inner.getSelectSetting("background");},set:function set(e){this.inner.e(),cz(e)&&(e=tF(e)),iF(e)&&this.inner.setSelectSetting("background",e);}},{key:"allowKeyboardControl",get:function get(){return this.inner.e(),this.inner.keyboardControl;},set:function set(e){this.inner.e(),hz(e)&&(this.inner.keyboardControl=e);}},{key:"allowPageDragging",get:function get(){return this.inner.e(),this.inner.getEnableProp("enableDragPage");},set:function set(e){this.inner.e(),this.inner.setEnableProp("enableDragPage",e);}},{key:"allowResizing",get:function get(){return this.inner.e(),this.inner.getEnableProp("enableResizing");},set:function set(e){this.inner.e(),this.inner.setEnableProp("enableResizing",e);}},{key:"autoChangeIndex",get:function get(){return this.inner.e(),this.inner.getEnableProp("autoSelectTopPage");},set:function set(e){this.inner.e(),this.inner.setEnableProp("autoSelectTopPage",e);}},{key:"show",value:function value(){return this.inner.e(),this.inner.show();}},{key:"hide",value:function value(){return this.inner.e(),this.inner.hide();}},{key:"dispose",value:function value(){return this.inner.e(),this.inner.dispose();}},{key:"updateViewMode",value:function value(e){return this.inner.e(),this.inner.updateViewMode(e);}},{key:"updateCheckboxStyle",value:function value(e){return this.inner.e(),this.inner.updateCheckboxStyle(e);}},{key:"updatePageNumberStyle",value:function value(e){return this.inner.e(),this.inner.updatePageNumberStyle(e);}},{key:"on",value:function value(e,t){return this.inner.e(),this.inner.on(e,t);}},{key:"off",value:function value(e,t){return this.inner.e(),this.inner.off(e,t);}}]),e;}(),GF={root:{style:{},className:"dvs-web-viewer",id:"root",children:[{type:"Group",dataId:"body",className:"dvs-body",children:[{type:"MainCanvas",style:{},dataId:"canvas",className:"dvs-canvas"}]}]}},KF=function(){function e(t,i){ak(this,e),tk(this,"myDvs",void 0),tk(this,"myViewer",void 0),tk(this,"error",void 0),tk(this,"containerElement",void 0),tk(this,"imageEditor",void 0),tk(this,"customElement",void 0),tk(this,"thumbnailViewer",void 0),tk(this,"bindViewUI",!1),tk(this,"hideContextmenu",!0),tk(this,"acceptDrop",void 0),tk(this,"bShowImageEditor",void 0),tk(this,"bThumbnailDispose",void 0),tk(this,"bufferService",void 0),tk(this,"webViewerInitConfig",{}),tk(this,"bEmitBufferChanged",!0),tk(this,"pageMargin",10),tk(this,"initWidth",void 0),tk(this,"initHeight",void 0),tk(this,"bSingleMode",!0),tk(this,"oldEnableDrag",!0),tk(this,"oldBShowThumbnail",!1),tk(this,"outerBorder","1px solid rgb(204, 204, 204)"),tk(this,"minZoom",.02),tk(this,"maxZoom",65),tk(this,"bindViewEvent",!1),tk(this,"resizeObserver",null),this.acceptDrop=!0,this.bShowImageEditor=!1,this.error=new nR(),this.bufferService=t||new oR(),this.webViewerInitConfig=i||{},this.init(),this.bufferService.bindViewer(this);}var t,i;return ok(e,[{key:"init",value:function value(){var t=this;e.isInstallDVSPlugin||(AW.use(FH),AW.use(JH),AW.use(uH),AW.use(mR),AW.use(YH),e.isInstallDVSPlugin=!0),this.myDvs=new AW({space:this.bufferService.space,container:""}),this.myViewer=this.myDvs.createViewer({uiConfig:iz(GF),viewerConfig:iz(JU)}),this.myViewer.updateViewerConfig({cropBoxConfig:iz(rR)});var i=this.webViewerInitConfig.viewerEvents;dz(null==i?void 0:i.bufferChanged)&&this.myViewer.on("bufferChanged",function(e,r){t.bEmitBufferChanged&&i.bufferChanged(e,r);}),this.initBind();}},{key:"initBind",value:function value(){var e=this.webViewerInitConfig.viewerContainer;if(nz(e))return!1;var t=e.container,i=e.width,r=e.height;return!!this.bindView(t)&&(nz(i)||(this.setWidth(i),this.initWidth=this.getWidth()),nz(r)||(this.setHeight(r),this.initHeight=this.getHeight()),this.show(),!0);}},{key:"bindDefaultKeyEvent",value:function value(){var e=this;this.myViewer.on("keydown",function(t){var i=e.myViewer.getViewerConfig(),r=i.rows,n=i.columns,o=i.displayMode;r<1&&n<1||"single"===o||(t.preventDefault(),"ArrowUp"!==t.key&&"Up"!==t.key?"ArrowDown"!==t.key&&"Down"!==t.key||e.next():e.previous());});}},{key:"bindDefaultDrop",value:function value(){var e=this,t=this.webViewerInitConfig.viewerEvents;this.myViewer.on("drop",function(i,r){e.acceptDrop&&t.onDrop(i,r);});}},{key:"bindDefaultRightClick",value:function value(){var e=this.webViewerInitConfig.viewerEvents;this.myViewer.on("contextmenu",function(t,i){e.rightclick(t,i);});}},{key:"preventDefaultContextmenu",value:function value(){var e=this;this.myViewer.on("contextmenu",function(t,i){e.hideContextmenu&&i.preventDefault();});}},{key:"bindViewerEvents",value:function value(){var e=this;if(this.myViewer){var t=this.webViewerInitConfig.viewerEvents;this.myViewer.off("bufferChanged"),this.bindDefaultKeyEvent(),this.preventDefaultContextmenu(),dk(QU).call(QU,function(i){t&&dz(t[i])&&("onDrop"===i?e.bindDefaultDrop():"rightclick"===i?e.bindDefaultRightClick():"bufferChanged"===i?e.myViewer.on("bufferChanged",function(i,r){e.bEmitBufferChanged&&t.bufferChanged(i,r);}):e.myViewer.on(i,function(e,r){t[i](e,r);}));}),this.bindViewEvent=!0;}}},{key:"unbindViewEvents",value:function value(){var e=this;dk(QU).call(QU,function(t){"bufferChanged"!==t&&e.myViewer.off(t);});}},{key:"initViewer",value:function value(){this.myViewer.updateViewerConfig({autoSelectLatest:!0,maxZoom:this.maxZoom,minZoom:this.minZoom}),vz()?this.setCursor("default"):this.setCursor("crosshair"),this.setAcceptDrop(!0),this.setAllowSlide(!0);}},{key:"getErrorInfo",value:function value(e){return _U[e].errorString||"Successful";}},{key:"disConnectObserver",value:function value(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null);}},{key:"emitPageRendered",value:function value(){var e,t=this;this.myViewer.updateViewerConfig({enableEmitPageRendered:!0});var i=this.myViewer.getCurrentTab();i&&dk(e=i.children).call(e,function(e,i){e.isVisible&&t.myViewer.emit("pageRendered",i);});}},{key:"updateViewerConfig",value:function value(e){this.myViewer.updateViewerConfig(e);}},{key:"resetImageEditorButton",value:function value(){this.imageEditor&&this.imageEditor.inner.resetButtonState();}},{key:"resized",value:function value(){return!!this.myViewer&&(this.myViewer.resized(),!0);}},{key:"setBufferService",value:function value(e){return!!e&&e!==this.bufferService&&(this.bufferService.webViewer=void 0,this.myDvs.setSpace(e.space),this.bufferService=e,this.bufferService.bindViewer(this),this.bufferService.isActiveFile?this.bufferService.openDocument(this.bufferService.getCurrentDocument()):this.bufferService.isActiveTag&&this.bufferService.filterImagesByTag(this.bufferService.getCurrentTag(),function(){},function(){}),this.resized(),!0);}},{key:"setDefaultError",value:function value(){var e=this.webViewerInitConfig.viewerError,t=this.myDvs.context.errorService,i=t.errorCode,r=t.errorMessage;dz(null==e?void 0:e.setError)&&null!=e&&e.setError(i,r),this.error.setError(i,r);}},{key:"setError",value:function value(e){var t=this.webViewerInitConfig.viewerError,i=_U[e],r=i.errorCode,n=i.errorString;dz(null==t?void 0:t.setError)&&null!=t&&t.setError(r,n),this.error.setError(r,n);}},{key:"show",value:function value(){return this.bindViewUI?!!this.myViewer&&(this.myViewer.show(),this.setPageMargin(this.pageMargin),!0):(this.setError("UnBindViewer"),!1);}},{key:"hide",value:function value(){return this.bindViewUI?!!this.myViewer&&(this.myViewer.hide(),!0):(this.setError("UnBindViewer"),!1);}},{key:"setOperationMode",value:function value(e){if(this.myViewer){var t="default";switch(e){case 1:t="crop";break;case 3:t="zoomOut";break;case 2:t="zoomIn";break;case 4:t="annotation";break;default:t="default";}this.myViewer.updateViewerConfig({toolType:t});}}},{key:"bindView",value:function value(e){var t,i,r,n=this,o=null;if(this.closeImageEditor(),e&&(o=e instanceof HTMLElement&&"DIV"===e.nodeName?e:document.getElementById(e)),nz(o)||gz(o))return this.setError("ElementNotExist"),!1;if(az(o.id)||(o.id=bz()),(null===(t=o)||void 0===t||null===(i=t.getElementsByClassName("dvs-root dvs-web-viewer"))||void 0===i?void 0:i.length)>0)return this.setError("AlReadyBindViewer"),!1;if(!(r=this.myViewer.bindContainer(o)))return this.setDefaultError(),!1;var a=this.webViewerInitConfig.viewerEvents;if(a&&dz(a.onBind)&&a.onBind(o),this.bindViewUI=!0,this.containerElement=o,this.initWidth=this.getWidth(),this.initHeight=this.getHeight(),this.initViewer(),this.setBorder(this.outerBorder),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),dz(window.ResizeObserver)){var s=new ResizeObserver(function(){n.render();});s.observe(this.myViewer.rootDom),this.resizeObserver=s;}else this.resizeObserver=null;return this.bindViewUI&&!this.bindViewEvent&&this.bindViewerEvents(),r;}},{key:"unbindView",value:function value(){if(!this.bindViewUI)return!0;var e;if(this.resetViewerSettings(!1),this.disposeComponent(),e=this.myViewer.unbindContainer()){this.hide(),this.unbindViewEvents(),this.bindViewUI=!1,this.bindViewEvent=!1;var t=this.webViewerInitConfig.viewerEvents;t&&dz(t.onUnBind)&&t.onUnBind(this.containerElement),this.containerElement="";}else this.setDefaultError();return e;}},{key:"getIdPostfix",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.postfix:(this.setError("UnBindViewer"),"");}},{key:"getCursor",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.getViewerConfig().canvasStyle.cursor:(this.setError("UnBindViewer"),"");}},{key:"setCursor",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;if(("zoom-in"===e||"zoom-out"===e)&&!this.getIfSinglePageMode())return this.setError("CursorInvalidMode"),!1;"crosshair"===this.getCursor()&&"crosshair"!==e&&this.clearSelectedAreas();var t="default",i=0;switch(e){case"zoom-out":t="zoom-out",i=3;break;case"zoom-in":t="zoom-in",i=2;break;case"crosshair":t="crosshair",i=1;break;case"pointer":t="pointer",i=0;break;default:t="default",i=0;}return this.myViewer.updateViewerConfig({canvasStyle:{cursor:t}}),this.setOperationMode(i),!0;}},{key:"setIfSinglePageMode",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;var t=e?"single":"multiple",i=0;if(e)this.bSingleMode=!0,i=0;else{var r=this.myViewer.getViewerConfig(),n=r.rows,o=r.columns;(n>1||o>1)&&(i=this.myViewer.getViewerConfig().gap,this.bSingleMode=!1);}return this.myViewer.updateViewerConfig({displayMode:t,margin:i}),this.clearSelectedAreas(),this.resized(),!0;}},{key:"getIfSinglePageMode",value:function value(){return this.bindViewUI?!!this.myViewer&&"single"===this.myViewer.getViewerConfigByName("displayMode"):(this.setError("UnBindViewer"),!1);}},{key:"setZoom",value:function value(e){return this.bindViewUI?!!this.myViewer&&(this.myViewer.updateViewerConfig({zoom:e}),!0):(this.setError("UnBindViewer"),!1);}},{key:"getZoom",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.getViewerConfigByName("zoom"):(this.setError("UnBindViewer"),"");}},{key:"setZoomOrigin",value:function value(e){var t,i;if(!this.bindViewUI)return this.setError("UnBindViewer"),"";if(!this.myViewer)return!1;if(!tz(e)||!az(null==e?void 0:e.x)||!az(null==e?void 0:e.y))return this.setError("InvalidValue"),!1;var r=e.x,n=e.y;return-1===DT(t=["left","right","center"]).call(t,r)||-1===DT(i=["top","bottom","center"]).call(i,n)?(this.setError("InvalidValue"),!1):(this.updateViewerConfig({zoomOrigin:{x:r,y:n}}),!0);}},{key:"getZoomOrigin",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.getViewerConfigByName("zoomOrigin"):(this.setError("UnBindViewer"),"");}},{key:"setAcceptDrop",value:function value(e){return this.bindViewUI?!!this.myViewer&&(hz(e)?(this.acceptDrop=e,!0):(this.setError("InvalidValue"),!1)):(this.setError("UnBindViewer"),!1);}},{key:"getAcceptDrop",value:function value(){return this.bindViewUI?!!this.myViewer&&this.acceptDrop:(this.setError("UnBindViewer"),"");}},{key:"setAllowSlide",value:function value(e){return this.bindViewUI?!!this.myViewer&&(hz(e)?(this.myViewer.updateViewerConfig({enableSlide:e}),!0):(this.setError("InvalidValue"),!1)):(this.setError("UnBindViewer"),!1);}},{key:"getAllowSlide",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.getViewerConfigByName("enableSlide"):(this.setError("UnBindViewer"),"");}},{key:"setShowRemoveBtn",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;if(!hz(e))return this.setError("InvalidValue"),!1;var t=e?"visible":"hidden";return this.myViewer.updateViewerConfig({removeBtnStyle:{visibility:t}}),!0;}},{key:"getShowRemoveBtn",value:function value(){return this.bindViewUI?!!this.myViewer&&"visible"===this.myViewer.getViewerConfig().removeBtnStyle.visibility:(this.setError("UnBindViewer"),"");}},{key:"setShowCheckbox",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;if(!hz(e))return this.setError("InvalidValue"),!1;var t=e?"visible":"hidden",i="visible"===t?1:0;return this.myViewer.updateViewerConfig({checkboxStyle:{visibility:t}}),this.setMultiSelectMode(i),this.thumbnailViewer&&(this.thumbnailViewer.showCheckbox=!0),!0;}},{key:"getShowCheckbox",value:function value(){return this.bindViewUI?!!this.myViewer&&"visible"===this.myViewer.getViewerConfig().checkboxStyle.visibility:(this.setError("UnBindViewer"),"");}},{key:"getSelectionRectAspectRatio",value:function value(){if(!this.bindViewUI)return this.setError("UnBindViewer"),"";if(!this.myViewer)return!1;var e=this.myViewer.cropBoxConfig,t=e.aspectRatio;return!1===e.keepAspectRatio||t<1?0:this.myViewer.cropBoxConfig.aspectRatio;}},{key:"setSelectionRectAspectRatio",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;var t=e>0,i=e>0?e:0;return this.myViewer.updateViewerConfig({cropBoxConfig:{aspectRatio:i,keepAspectRatio:t}}),!0;}},{key:"getIfAutoScroll",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.getViewerConfig().autoScroll:(this.setError("UnBindViewer"),"");}},{key:"setIfAutoScroll",value:function value(e){return this.bindViewUI?!!this.myViewer&&(hz(e)?(this.thumbnailViewer&&this.thumbnailViewer.inner.setIfAutoScroll(e),this.imageEditor&&this.imageEditor.inner.setIfAutoScroll(e),this.myViewer.updateViewerConfig({autoSelectLatest:e,autoScroll:e}),!0):(this.setError("InvalidValue"),!1)):(this.setError("UnBindViewer"),!1);}},{key:"getPageMargin",value:function value(){return this.bindViewUI?!!this.myViewer&&this.pageMargin:(this.setError("UnBindViewer"),0);}},{key:"setPageMargin",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;if(!/^((\d+em)|(\d+px)|(\d+%)|(\d+))$/.test(e)||e<0)return this.setError("InvalidValue"),!1;if(!nF(e))return!1;this.pageMargin=e;var t=qF(e,this.myViewer);return this.myViewer.updateViewerConfig({gap:t}),this.bSingleMode||this.myViewer.updateViewerConfig({margin:t}),this.resized(),!0;}},{key:"getWidth",value:function value(){if(!this.bindViewUI)return this.setError("UnBindViewer"),"";if(this.myViewer){var e=this.myViewer.dwtWidth||"";if(window.navigator.userAgent.match(/Trident/g)||window.navigator.userAgent.match(/MSIE/g)){var t=this.myViewer.rootDom,i=getComputedStyle(t).borderLeftWidth,r=2*pR(i).value;if(cz(e))return e+r;}return e;}return"";}},{key:"setWidth",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(az(e)&&!/^((\d+em)|(\d+px)|(\d+%)|(\d+))$/.test(e)||cz(e)&&e<0)return this.setError("InvalidWidth"),!1;if(e===this.myViewer.dwtWidth)return!0;if(this.myViewer.dwtWidth=e,this.myViewer.getViewerConfig().show&&this.setPageMargin(this.pageMargin),this.thumbnailViewer){var t=this.thumbnailViewer.size;"%"===wR(t).unit&&this.thumbnailViewer.inner.emitThumbnailResize();}return!0;}},{key:"getHeight",value:function value(){if(!this.bindViewUI)return this.setError("UnBindViewer"),"";if(this.myViewer){var e=this.myViewer.dwtHeight||"";if(window.navigator.userAgent.match(/Trident/g)||window.navigator.userAgent.match(/MSIE/g)){var t=this.myViewer.rootDom,i=getComputedStyle(t).borderLeftWidth,r=2*pR(i).value;if(cz(e))return e+r;}return e;}return"";}},{key:"setHeight",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(az(e)&&!/^((\d+em)|(\d+px)|(\d+%)|(\d+))$/.test(e)||cz(e)&&e<0)return this.setError("InvalidHeight"),!1;if(e===this.myViewer.dwtHeight)return!0;if(this.myViewer.dwtHeight=e,this.myViewer.getViewerConfig().show&&this.setPageMargin(this.pageMargin),this.thumbnailViewer){var t=this.thumbnailViewer.size;"%"===wR(t).unit&&this.thumbnailViewer.inner.emitThumbnailResize();}return!0;}},{key:"getBackground",value:function value(){return this.bindViewUI?this.myViewer?this.myViewer.getViewerConfig().canvasStyle.background:"":(this.setError("UnBindViewer"),"");}},{key:"setBackground",value:function value(e){return this.bindViewUI?!(!this.myViewer&&!this.thumbnailViewer||!iF(e)||(this.myViewer&&this.myViewer.updateViewerConfig({canvasStyle:{background:e}}),this.thumbnailViewer&&(this.thumbnailViewer.background=e),0)):(this.setError("UnBindViewer"),!1);}},{key:"getBorder",value:function value(){return this.bindViewUI?this.outerBorder:(this.setError("UnBindViewer"),"");}},{key:"setBorder",value:function value(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;if(!rF(e))return!1;var i=this.myViewer.rootDom;return i&&(i.style.border=e),this.outerBorder=e,this.thumbnailViewer&&this.thumbnailViewer.inner.setBorder(e),t&&this.myViewer.externalResized(),!0;}},{key:"getInnerBorder",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.getViewerConfig().viewerStyle.border:(this.setError("UnBindViewer"),"");}},{key:"setInnerBorder",value:function value(e){return this.bindViewUI?!!this.myViewer&&!!rF(e)&&(this.myViewer.updateViewerConfig({viewerStyle:{border:e}}),this.resized(),!0):(this.setError("UnBindViewer"),!1);}},{key:"getSelectedPageBorder",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.getViewerConfig().selectedPageStyle.border:(this.setError("UnBindViewer"),"");}},{key:"setSelectedPageBorder",value:function value(e){return this.bindViewUI?!!this.myViewer&&!!rF(e)&&(this.myViewer.updateViewerConfig({selectedPageStyle:{border:e}}),this.thumbnailViewer&&(this.thumbnailViewer.selectedPageBorder=e),!0):(this.setError("UnBindViewer"),!1);}},{key:"getSelectedPageBackground",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.getViewerConfig().selectedPageStyle.background:(this.setError("UnBindViewer"),"");}},{key:"setSelectedPageBackground",value:function value(e){return this.bindViewUI?!(!this.myViewer&&!this.thumbnailViewer||!iF(e)||(this.myViewer.updateViewerConfig({selectedPageStyle:{background:e}}),this.thumbnailViewer&&(this.thumbnailViewer.selectedPageBackground=e),0)):(this.setError("UnBindViewer"),!1);}},{key:"getShowPageNumber",value:function value(){return this.bindViewUI?!!this.myViewer&&"visible"===this.myViewer.getViewerConfig().pageNumberStyle.visibility:(this.setError("UnBindViewer"),"");}},{key:"setShowPageNumber",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;if(!hz(e))return this.setError("InvalidValue"),!1;var t={visibility:e?"visible":"hidden"};return this.updatePageNumberStyle(t),!0;}},{key:"setMultiSelectMode",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;if(!cz(e))return this.setError("InvalidValue"),!1;var t=1===e;return this.myViewer.updateViewerConfig({multiselectMode:t}),this.thumbnailViewer&&this.thumbnailViewer.inner.setMultiSelectMode(e),t&&this.setCursor("pointer"),!0;}},{key:"getMultiSelectMode",value:function value(){return this.bindViewUI?!!this.myViewer&&(this.myViewer.getViewerConfig().multiselectMode?1:0):(this.setError("UnBindViewer"),"");}},{key:"setAllowPageDragging",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;if(!hz)return this.setError("InvalidValue"),!1;var t=e;return this.bSingleMode&&(this.oldEnableDrag=e,t=!1),this.myViewer.updateViewerConfig({enableDragPage:t}),!0;}},{key:"getAllowPageDragging",value:function value(){return this.bindViewUI?!!this.myViewer&&(this.bSingleMode?this.oldEnableDrag:this.myViewer.getViewerConfig().enableDragPage):(this.setError("UnBindViewer"),"");}},{key:"getAutoChangeIndex",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.getViewerConfig().autoSelectTopPage:(this.setError("UnBindViewer"),"");}},{key:"setAutoChangeIndex",value:function value(e){return this.bindViewUI?!!this.myViewer&&(hz(e)?(this.myViewer.updateViewerConfig({autoSelectTopPage:e}),!0):(this.setError("InvalidValue"),!1)):(this.setError("UnBindViewer"),!1);}},{key:"getSelectedAreaBorderColor",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.cropBoxConfig.borderColor:(this.setError("UnBindViewer"),"");}},{key:"setSelectedAreaBorderColor",value:function value(e){return this.bindViewUI?!!this.myViewer&&!!iF(e)&&(this.myViewer.updateViewerConfig({cropBoxConfig:{borderColor:e,ctrlBorderColor:e}}),!0):(this.setError("UnBindViewer"),!1);}},{key:"updateCheckboxStyle",value:function value(e){return this.bindViewUI?(this.myViewer.updateViewerConfig({checkboxStyle:e}),this.thumbnailViewer&&this.thumbnailViewer.inner.updateCheckboxStyle(e),!0):(this.setError("UnBindViewer"),!1);}},{key:"updatePageNumberStyle",value:function value(e){return this.bindViewUI?!(!this.myViewer&&!this.thumbnailViewer||(this.myViewer&&this.myViewer.updateViewerConfig({pageNumberStyle:e}),this.thumbnailViewer&&this.thumbnailViewer.updatePageNumberStyle(e),0)):(this.setError("UnBindViewer"),!1);}},{key:"updateRemoveBtnStyle",value:function value(e){return this.bindViewUI?(this.myViewer.updateViewerConfig({removeBtnStyle:e}),this.thumbnailViewer&&this.thumbnailViewer.inner.updateRemoveBtnStyle(e),!0):(this.setError("UnBindViewer"),!1);}},{key:"getUISettings",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.uiConfig:(this.setError("UnBindViewer"),!1);}},{key:"resetViewerSettings",value:function value(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;var t=iz(JU);return this.initViewer(),this.setWidth(this.initWidth),this.setHeight(this.initHeight),this.setBorder("1px solid rgb(204, 204, 204)",e),this.pageMargin=10,this.bSingleMode=!0,this.oldEnableDrag=!0,this.myViewer.updateViewerConfig({rows:1,columns:1,margin:0,gap:10,zoom:1,enableDragPage:!1,scrollDirection:"vertical",displayMode:"multiple",fitType:"window",autoSelectTopPage:!1,autoScroll:!0,viewerStyle:t.viewerStyle,canvasStyle:t.canvasStyle,pageStyle:t.pageStyle,selectedPageStyle:t.selectedPageStyle,hoveredPageStyle:t.hoveredPageStyle,placeholderStyle:t.placeholderStyle,checkboxStyle:t.checkboxStyle,pageNumberStyle:t.pageNumberStyle}),this.resized(),!0;}},{key:"updateUISettings",value:function value(){return!!this.bindViewUI||(this.setError("UnBindViewer"),!1);}},{key:"setSelectionBoxStyle",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),"";if(!tz(e))return!1;if(!this.myViewer)return!1;var t=FF(e);return this.updateCropBoxConfig(t),!0;}},{key:"getSelectionBoxStyle",value:function value(){return this.bindViewUI?!!this.myViewer&&jF(this.myViewer.cropBoxConfig):(this.setError("UnBindViewer"),"");}},{key:"updateCropBoxConfig",value:function value(e){return!!this.myViewer&&(this.myViewer.updateViewerConfig({cropBoxConfig:e}),!0);}},{key:"getIfShowVideoContainer",value:function value(){return!!this.myViewer&&this.myViewer.getViewerConfig().showVideoContainer;}},{key:"showVideoContainer",value:function value(e){return!!this.myViewer&&(this.getIfShowVideoContainer()===e||(this.thumbnailViewer&&(e?(this.oldBShowThumbnail=this.thumbnailViewer.inner.showThumbnail,this.thumbnailViewer.inner.showThumbnail=!1):this.thumbnailViewer.inner.showThumbnail=this.oldBShowThumbnail),this.myViewer.updateViewerConfig({showVideoContainer:e})),!0);}},{key:"updateVideoImage",value:function value(e){var t=this.myViewer.updateVideoImage(e);return t||this.setDefaultError(),t;}},{key:"createThumbnailViewer",value:function value(e){return this.bindViewUI?this.thumbnailViewer?(this.setError("ThumbnailViewerExist"),this.thumbnailViewer):(this.thumbnailViewer=new _F(this,e),this.setBorder(this.outerBorder),this.thumbnailViewer):(this.setError("UnBindViewer"),null);}},{key:"createImageEditor",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),null;if(this.imageEditor)this.setError("ImageEditorExist");else{var t,i,r=rz(iz(iR),this.webViewerInitConfig.imageEditorUiConfig);r.border=this.getBorder(),r.selectionRectAspectRatio=this.getSelectionRectAspectRatio();var n=r;dz(null===(t=this.webViewerInitConfig)||void 0===t?void 0:t.beforeImageEditorCreated)&&null!==(i=this.webViewerInitConfig)&&void 0!==i&&i.beforeImageEditorCreated(n),e&&(n=rz(n,e)),this.imageEditor=new XF(this,n);var o=this.getSelectionBoxStyle();this.imageEditor.updateSelectionBoxStyle(o);}return this.imageEditor;}},{key:"closeImageEditor",value:function value(){this.imageEditor&&(this.imageEditor.dispose(),this.imageEditor=void 0);}},{key:"createCustomElement",value:function value(e,t,i){if(!this.bindViewUI)return this.setError("UnBindViewer"),null;var r=t||"right",n=!!hz(i)&&i;return nz(e)?(this.setError("ElementRequired"),null):e instanceof HTMLDivElement?(this.customElement?this.setError("CustomElementExist"):this.customElement=new eF(this,e,r,n),this.customElement):(this.setError("ElementNotExist"),null);}},{key:"getCurrentIndex",value:function value(){var e=-1;return this.getHowManyImagesInBuffer()>0&&(e=this.myViewer.getCurrentIndex(),(nz(e)||e<0)&&this.setDefaultError()),e;}},{key:"getCurrentImgUUid",value:function value(){var e=this.myViewer.getCurrentIndex();return-1===e?"":this.bufferService.getUidByIndex(e);}},{key:"getHowManyImagesInBuffer",value:function value(){return!!this.myViewer&&(nz(this.myViewer.currentPageCount)?0:this.myViewer.currentPageCount);}},{key:"getSelectedImagesIndices",value:function value(){return!!this.myViewer&&this.myViewer.getSelectedIndexes();}},{key:"setButtonClass",value:function value(e,t){return this.bindViewUI?nz(e)||nz(t)?(this.setError("InvalidValue"),!1):(this.myViewer.setButtonClass(e,t),!0):(this.setError("UnBindViewer"),!1);}},{key:"setViewMode",value:function value(e,t){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;var i=!1,r="vertical";if(!cz(e)||!cz(t))return this.setError("InvalidValue"),!1;this.myViewer.updateViewerConfig({enableEmitPageRendered:!1}),this.thumbnailViewer&&this.thumbnailViewer.hide();var n=this.myViewer.getViewerConfig(),o=n.rows,a=n.columns;return-1===e&&-1===t?(this.setIfSinglePageMode(!0),i=!0):(t<0&&(r="horizontal",t=-t),e=e<0?-e:e,this.myViewer.updateViewerConfig({scrollDirection:r}),i=this.myViewer.setViewMode(t,e),1===e&&1===t?(this.bSingleMode=!0,1===o&&1===a||(this.oldEnableDrag=this.myViewer.getViewerConfig().enableDragPage),this.myViewer.updateViewerConfig({margin:0,enableDragPage:!1})):(this.bSingleMode=!1,this.setPageMargin(this.pageMargin),this.myViewer.updateViewerConfig({enableDragPage:this.oldEnableDrag})),this.setIfSinglePageMode(!1),i||this.setDefaultError(),"zoom-in"===this.getCursor()&&this.setCursor("crosshair")),this.emitPageRendered(),i;}},{key:"setFitType",value:function value(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"window";if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;var i="window";return-1===DT(e=["width","height","window"]).call(e,t)?(this.setError("InvalidValue"),!1):(i=t,this.myViewer.updateViewerConfig({fitType:i}),!0);}},{key:"setSelectedAreas",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if("crosshair"!==this.getCursor())return this.setError("OperationError"),!1;var t,i=[],r=!0;if(this.getCurrentIndex()<0)return this.setError("NoImage"),!1;if(nz(e)||nz(e.length)||0===e.length)return this.setError("InvalidLeftOrTopOrRightOrBottom"),!1;if(e.length&&e.length>0)for(var n=0;n<e.length;n++){var o=e[n],a=o.left,s=o.right,l=o.top,u=o.bottom;if(t={},cz(a+s+l+u)){if(a<0||l<0||s<0||u<0)continue;if(a>s||l>u)continue;t.left=a,t.top=l,t.width=s-a,t.height=u-l,i.push(t);}}return 0===i.length?(this.setError("InvalidLeftOrTopOrRightOrBottom"),!1):((r=this.myViewer.setCropBox(i,!0))||this.setDefaultError(),r);}},{key:"clearSelectedAreas",value:function value(){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;var e=!0;return!(this.getHowManyImagesInBuffer()<=0)&&(e=this.myViewer.clearCropBox(),this.myViewer.render(),e||this.setDefaultError(),e);}},{key:"next",value:function value(){if(!this.bindViewUI)return this.setError("UnBindViewer"),-1;if(!this.myViewer)return!1;var e=this.getHowManyImagesInBuffer();if(e<=0)return this.setError("NoImage"),-1;if(0===e)return 0;var t=this.getIfAutoScroll();return!1===t&&this.setIfAutoScroll(!0),this.imageEditor&&this.imageEditor.inner&&this.imageEditor.inner.bShowImageEditor?this.imageEditor.inner.nextImage():this.myViewer.nextPage(),!1===t&&this.setIfAutoScroll(!1),this.getCurrentIndex();}},{key:"previous",value:function value(){if(!this.bindViewUI)return this.setError("UnBindViewer"),-1;if(!this.myViewer)return!1;var e=this.getHowManyImagesInBuffer();if(e<=0)return this.setError("NoImage"),-1;if(0===e)return 0;var t=this.getIfAutoScroll();return!1===t&&this.setIfAutoScroll(!0),this.imageEditor&&this.imageEditor.inner&&this.imageEditor.inner.bShowImageEditor?this.imageEditor.inner.previousImage():this.myViewer.prevPage(),!1===t&&this.setIfAutoScroll(!1),this.getCurrentIndex();}},{key:"first",value:function value(){if(!this.bindViewUI)return this.setError("UnBindViewer"),-1;if(this.getHowManyImagesInBuffer()<=0)return this.setError("NoImage"),-1;var e=this.getIfAutoScroll();return!1===e&&this.setIfAutoScroll(!0),this.imageEditor&&this.imageEditor.inner&&this.imageEditor.inner.bShowImageEditor?this.imageEditor.inner.first():this.myViewer.firstPage(),this.myViewer.firstPage(),!1===e&&this.setIfAutoScroll(!1),0;}},{key:"last",value:function value(){if(!this.bindViewUI)return this.setError("UnBindViewer"),-1;var e=this.getHowManyImagesInBuffer();if(e<=0)return this.setError("NoImage"),-1;var t=this.getIfAutoScroll();return!1===t&&this.setIfAutoScroll(!0),this.imageEditor&&this.imageEditor.inner&&this.imageEditor.inner.bShowImageEditor?this.imageEditor.inner.last():this.myViewer.lastPage(),!1===t&&this.setIfAutoScroll(!1),e-1;}},{key:"gotoPage",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),-1;var t=this.getHowManyImagesInBuffer();if(t<=0)return this.setError("NoImage"),-1;if(t<0||e>=this.getHowManyImagesInBuffer())return this.setError("IndexOutOfRange"),-1;if(!/^(\d+)$/.test(e)||e<0)return this.setError("MobileServer_InvalidIndex"),-1;var i=this.getIfAutoScroll();return!1===i&&this.setIfAutoScroll(!0),this.imageEditor&&this.imageEditor.inner&&this.imageEditor.inner.bShowImageEditor?this.imageEditor.inner.goToPage(e):this.myViewer.gotoPage(e),!1===i&&this.setIfAutoScroll(!1),this.resized(),e;}},{key:"render",value:function value(){return this.bindViewUI?!!this.myViewer&&(this.myViewer.dwtRender(),this.myViewer.externalResized(),this.resized(),!0):(this.setError("UnBindViewer"),!1);}},{key:"on",value:function value(e,t){if(!e)return this.setError("InvalidValue"),!1;if(!dz(t))return this.setError("CallbackNotAFunction"),!1;var i=e;switch(e){case"onDrop":i="drop";break;case"rightclick":i="contextmenu";break;case"resize":i="dwtResize";break;default:i=e;}return this.myViewer.on(i,t),!0;}},{key:"off",value:function value(e,t){if(!e)return this.setError("InvalidValue"),!1;var i=e;switch(e){case"onDrop":i="drop";break;case"rightclick":i="contextmenu";break;case"resize":i="dwtResize";break;default:i=e;}if(nz(t)){this.myViewer.off(i),"contextmenu"===e&&this.preventDefaultContextmenu();var r=this.webViewerInitConfig.viewerEvents;DT(QU).call(QU,e)>=0&&dz(r[e])&&("onDrop"===e?this.bindDefaultDrop():"rightclick"===e?this.bindDefaultRightClick():this.myViewer.on(i,function(t,i){r[e](t,i);}));}else{if(!dz(t))return this.setError("CallbackNotAFunction"),!1;this.myViewer.off(i,t);}return!0;}},{key:"disposeComponent",value:function value(){this.disConnectObserver(),this.imageEditor&&this.imageEditor.dispose(),this.thumbnailViewer&&this.thumbnailViewer.dispose(),this.customElement&&this.customElement.dispose();}},{key:"dispose",value:function value(){if(this.myViewer){this.myViewer.off("bufferChanged"),this.disposeComponent(),this.myViewer.destroy(),this.myViewer=null;var e=this.webViewerInitConfig.viewerEvents;e&&dz(e.onUnBind)&&e.onUnBind(this.containerElement);}this.bufferService&&(this.bufferService.space.destroy(),this.bufferService=null),this.myDvs&&(this.myDvs.destroy(),this.myDvs=null);}},{key:"rotateInner",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:90,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.myViewer)return!1;if(!cz(e)||e<0)return this.setError("InvalidIndex"),!1;var r=this.getHowManyImagesInBuffer();return r<0?(this.setError("NoImage"),!1):e>=r?(this.setError("IndexOutOfRange"),!1):cz(t)?(this.myViewer.updateViewerConfig({rotationType:i?"clip":"contain"}),this.myViewer.rotate(t,e)):(this.setError("InvalidValue"),!1);}},{key:"rotate",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:90,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!cz(e)||e<0)return this.setError("InvalidIndex"),QE.reject(this.getErrorInfo("InvalidIndex"));var r=this.getHowManyImagesInBuffer();if(r<0)return this.setError("NoImage"),QE.reject(this.getErrorInfo("NoImage"));if(e>=r)return this.setError("IndexOutOfRange"),QE.reject(this.getErrorInfo("IndexOutOfRange"));if(!cz(t))return this.setError("InvalidValue"),QE.reject(this.getErrorInfo("InvalidValue"));var n=this.webViewerInitConfig.viewerEvents;return n&&dz(null==n?void 0:n.rotate)?n.rotate(e,t,i):(this.myViewer.updateViewerConfig({rotationType:i?"clip":"contain"}),this.myViewer.rotate(t,e),this.saveToServer(e));}},{key:"crop",value:(i=Pw(Iw().mark(function e(t,i){var r,n,o,a,s,l,u,c,h;return Iw().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.getHowManyImagesInBuffer(),!(t<0)&&cz(t)){e.next=3;break;}return e.abrupt("return",(this.setError("InvalidIndex"),QE.reject(this.getErrorInfo("InvalidIndex"))));case 3:if(!(r<0)){e.next=5;break;}return e.abrupt("return",(this.setError("NoImage"),QE.reject(this.getErrorInfo("NoImage"))));case 5:if(!(t>=r)){e.next=7;break;}return e.abrupt("return",(this.setError("IndexOutOfRange"),QE.reject(this.getErrorInfo("IndexOutOfRange"))));case 7:if(n=i.x,o=i.y,a=i.width,s=i.height,!nz(i)&&cz(n+o+a+s)){e.next=10;break;}return e.abrupt("return",(this.setError("InvalidValue"),QE.reject(this.getErrorInfo("InvalidValue"))));case 10:if(!(n<0||o<0||a<=0||s<=0)){e.next=12;break;}return e.abrupt("return",(this.setError("InvalidValue"),QE.reject(this.getErrorInfo("InvalidValue"))));case 12:if(l=this.myViewer.getCurrentTab().getChildByIndex(t),u=l.realTimeWidth,c=l.realTimeHeight,!(a>u||s>c)){e.next=15;break;}return e.abrupt("return",(this.setError("WidthOrHeightOutOfImageSize"),QE.reject(this.getErrorInfo("WidthOrHeightOutOfImageSize"))));case 15:return h=this.webViewerInitConfig.viewerEvents,e.abrupt("return",h&&dz(null==h?void 0:h.crop)?h.crop(t,n,o,a,s):(this.myViewer.crop(t,n,o,a,s),this.saveToServer(t)));case 17:case"end":return e.stop();}},e,this);})),function(e,t){return i.apply(this,arguments);})},{key:"saveToServer",value:(t=Pw(Iw().mark(function e(t){var i,r,n,o;return Iw().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.bufferService.getUidByIndex(t),(r=this.webViewerInitConfig.viewerEvents)&&dz(null==r?void 0:r.save)){e.next=3;break;}return e.abrupt("return",QE.reject());case 3:return e.next=5,this.myDvs.getImageData(i,{type:"imageData"});case 5:return n=e.sent,o=rk(rk({},this.bufferService.getMetadataByUid(i)),{},{width:Math.floor(n.width),height:Math.floor(n.height)}),e.abrupt("return",r.save(i,n.data.buffer,o,!1));case 8:case"end":return e.stop();}},e,this);})),function(e){return t.apply(this,arguments);})},{key:"overlayRectangle",value:function value(e,t,i,r,n,o,a){if(nz(e)||nz(t)||nz(i)||nz(r)||nz(n))return!1;var s=r-t,l=n-i;return!(s<=0||l<=0)&&this.myViewer.overlayRectangle(e,t,i,s,l,o,a);}},{key:"selectPages",value:function value(e){if(!this.myViewer)return!1;var t=e[e.length-1],i=this.getCurrentIndex();return this.imageEditor&&this.imageEditor.inner&&this.imageEditor.inner.bShowImageEditor&&t!==i?this.imageEditor.inner.selectPages(e):this.myViewer.setSelectedIndexes(e);}},{key:"removePageByUid",value:function value(e){if(!this.myViewer)return!1;var t=this.myViewer.getIndexByUid(e);return null!==t&&this.myViewer.removePage(t);}},{key:"removePageByIndexes",value:function value(e){return!!this.myViewer&&this.myViewer.removePage(e);}},{key:"removeAllPages",value:function value(){return!!this.myViewer&&this.myViewer.removeAllPages();}}]),e;}();tk(KF,"isInstallDVSPlugin",!1);var $F=function(){function e(t,i){ak(this,e),tk(this,"webViewer",void 0),tk(this,"elements",[]),this.webViewer=new KF(t,i),this.elements=[];}return ok(e,[{key:"e",value:function value(){this.webViewer.setError("Successful");}},{key:"idPostfix",get:function get(){return this.e(),this.webViewer.getIdPostfix();}},{key:"width",get:function get(){return this.e(),this.webViewer.getWidth();},set:function set(e){this.e(),this.webViewer.setWidth(e);}},{key:"height",get:function get(){return this.e(),this.webViewer.getHeight();},set:function set(e){this.e(),this.webViewer.setHeight(e);}},{key:"background",get:function get(){return this.e(),this.webViewer.getBackground();},set:function set(e){this.e(),cz(e)&&(e=tF(e)),this.webViewer.setBackground(e);}},{key:"border",get:function get(){return this.e(),this.webViewer.getBorder();},set:function set(e){this.e(),this.webViewer.setBorder(e);}},{key:"innerBorder",get:function get(){return this.e(),this.webViewer.getInnerBorder();},set:function set(e){this.e(),this.webViewer.setInnerBorder(e);}},{key:"selectedPageBorder",get:function get(){return this.e(),this.webViewer.getSelectedPageBorder();},set:function set(e){this.e(),this.webViewer.setSelectedPageBorder(e);}},{key:"selectedPageBackground",get:function get(){return this.e(),this.webViewer.getSelectedPageBackground();},set:function set(e){this.e(),cz(e)&&(e=tF(e)),this.webViewer.setSelectedPageBackground(e);}},{key:"selectedAreaBorderColor",get:function get(){return this.e(),this.webViewer.getSelectedAreaBorderColor();},set:function set(e){this.e(),cz(e)&&(e=tF(e)),this.webViewer.setSelectedAreaBorderColor(e);}},{key:"selectionRectAspectRatio",get:function get(){return this.e(),this.webViewer.getSelectionRectAspectRatio();},set:function set(e){this.e(),this.webViewer.setSelectionRectAspectRatio(e);}},{key:"showPageNumber",get:function get(){return this.e(),this.webViewer.getShowPageNumber();},set:function set(e){this.e(),this.webViewer.setShowPageNumber(e);}},{key:"cursor",get:function get(){return this.e(),this.webViewer.getCursor();},set:function set(e){this.e(),this.webViewer.setCursor(e);}},{key:"ifAutoScroll",get:function get(){return this.e(),this.webViewer.getIfAutoScroll();},set:function set(e){this.e(),this.webViewer.setIfAutoScroll(e);}},{key:"pageMargin",get:function get(){return this.e(),this.webViewer.getPageMargin();},set:function set(e){this.e(),this.webViewer.setPageMargin(e);}},{key:"zoom",get:function get(){return this.e(),this.webViewer.getZoom();},set:function set(e){this.e(),this.webViewer.setZoom(e);}},{key:"zoomOrigin",get:function get(){return this.e(),this.webViewer.getZoomOrigin();},set:function set(e){this.e(),this.webViewer.setZoomOrigin(e);}},{key:"singlePageMode",get:function get(){return this.e(),this.webViewer.getIfSinglePageMode();},set:function set(e){this.e(),this.webViewer.setIfSinglePageMode(e);}},{key:"acceptDrop",get:function get(){return this.e(),this.webViewer.getAcceptDrop();},set:function set(e){this.e(),this.webViewer.setAcceptDrop(e);}},{key:"allowSlide",get:function get(){return this.e(),this.webViewer.getAllowSlide();},set:function set(e){this.e(),this.webViewer.setAllowSlide(e);}},{key:"autoChangeIndex",get:function get(){return this.e(),this.webViewer.getAutoChangeIndex();},set:function set(e){this.e(),this.webViewer.setAutoChangeIndex(e);}},{key:"showCheckbox",get:function get(){return this.e(),this.webViewer.getShowCheckbox();},set:function set(e){this.e(),this.webViewer.setShowCheckbox(e);}},{key:"selectionMode",get:function get(){return this.e(),this.webViewer.getMultiSelectMode();},set:function set(e){this.e(),this.webViewer.setMultiSelectMode(e);}},{key:"allowPageDragging",get:function get(){return this.e(),this.webViewer.getAllowPageDragging();},set:function set(e){this.e(),this.webViewer.setAllowPageDragging(e);}},{key:"selectedImagesIndices",get:function get(){return this.e(),this.webViewer.getSelectedImagesIndices();}},{key:"next",value:function value(){return this.e(),this.webViewer.next();}},{key:"previous",value:function value(){return this.e(),this.webViewer.previous();}},{key:"first",value:function value(){return this.e(),this.webViewer.first();}},{key:"last",value:function value(){return this.e(),this.webViewer.last();}},{key:"gotoPage",value:function value(e){return this.e(),this.webViewer.gotoPage(e);}},{key:"render",value:function value(){return this.e(),this.webViewer.render();}},{key:"show",value:function value(){return this.e(),this.webViewer.show();}},{key:"hide",value:function value(){return this.e(),this.webViewer.hide();}},{key:"on",value:function value(e,t){return this.e(),this.webViewer.on(e,t);}},{key:"off",value:function value(e,t){return this.e(),this.webViewer.off(e,t);}},{key:"createImageEditor",value:function value(e){return this.e(),this.webViewer.createImageEditor(e);}},{key:"createThumbnailViewer",value:function value(e){return this.e(),this.webViewer.createThumbnailViewer(e);}},{key:"createCustomElement",value:function value(e,t,i){return this.e(),this.webViewer.createCustomElement(e,t,i);}},{key:"updateCheckboxStyle",value:function value(e){return this.e(),this.webViewer.updateCheckboxStyle(e);}},{key:"updatePageNumberStyle",value:function value(e){return this.e(),this.webViewer.updatePageNumberStyle(e);}},{key:"updateSelectionBoxStyle",value:function value(e){return this.e(),this.webViewer.setSelectionBoxStyle(e);}},{key:"clearSelectedAreas",value:function value(){return this.e(),this.webViewer.clearSelectedAreas();}},{key:"setSelectedAreas",value:function value(e){return this.e(),this.webViewer.setSelectedAreas(e);}},{key:"fitWindow",value:function value(e){return this.e(),this.webViewer.setFitType(e);}},{key:"setButtonClass",value:function value(e,t){return this.e(),this.webViewer.setButtonClass(e,t);}},{key:"setViewMode",value:function value(e,t){return this.e(),this.webViewer.setViewMode(e,t);}},{key:"bind",value:function value(e){this.e();var t,i,r=e;if(t=r,window.ShadowRoot&&t instanceof window.ShadowRoot){var n=document.createElement("div");r.appendChild(n),this.elements.push(n),r=n;}if(i=r,"object"==("undefined"==typeof HTMLElement?"undefined":ic(HTMLElement))?i instanceof HTMLElement:i&&"object"==ic(i)&&1===i.nodeType&&"string"==typeof i.nodeName){var o=function(e){var t=e;if(window.ShadowRoot)for(;t;){if(t instanceof window.ShadowRoot)return t;t=t.parentNode;}return!1;}(r);if(o){var a=document.createElement("style");a.innerHTML=['@import url("',Dynamsoft.DWT.ResourcesPath,"/src/dynamsoft.webtwain.viewer.css",'")'].join(""),o.appendChild(a);var s=document.createElement("style");s.innerHTML=['@import url("',Dynamsoft.DWT.ResourcesPath,"/src/dynamsoft.webtwain.css",'")'].join(""),o.appendChild(s),this.elements.push(a,s);}else o=!1;r.id&&""!==r.id||(r.id=["dwt_",bz()].join(""));}return this.webViewer.bindView(r);}},{key:"unbind",value:function value(){var e;return this.e(),dk(e=this.elements).call(e,function(e){e.parentNode&&e.parentNode.removeChild(e);}),this.webViewer.unbindView();}},{key:"getUISettings",value:function value(){return this.e(),this.webViewer.getUISettings();}},{key:"updateUISettings",value:function value(){return this.e(),this.webViewer.updateUISettings();}},{key:"resetUISettings",value:function value(){return this.e(),this.webViewer.resetViewerSettings();}}]),e;}(),QF=function(e){lb(i,e);var t=ub(i);function i(e,r){return ak(this,i),t.call(this,e,r);}return ok(i,[{key:"errorCode",get:function get(){return this.webViewer.error.getError().errCode;}},{key:"errorString",get:function get(){return this.webViewer.error.getError().errorString;}},{key:"SelectedImagesIndices",get:function get(){return this.webViewer.getSelectedImagesIndices();}},{key:"rotate",value:function value(e,t,i){return this.webViewer.rotate(e,t,i);}},{key:"crop",value:function value(e,t){return this.webViewer.crop(e,t);}}]),i;}($F);HTMLCanvasElement.prototype.toBlob||LA(HTMLCanvasElement.prototype,"toBlob",{value:function value(e,t,i){for(var r=atob(this.toDataURL(t,i).split(",")[1]),n=r.length,o=new Uint8Array(n),a=0;a<n;a++)o[a]=r.charCodeAt(a);e(new Blob([o],{type:t||"image/png"}));}});var JF=window.Dynamsoft||window;JF.DWTViewer=$F,JF.DWTViewerEx=QF;}();
